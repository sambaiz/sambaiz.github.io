<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Aws on sambaiz-net</title>
    <link>https://www.sambaiz.net/en/tags/aws/</link>
    <description>Recent content in Aws on sambaiz-net</description>
    <generator>Hugo</generator>
    <language>en</language>
    <copyright>sambaiz-net</copyright>
    <lastBuildDate>Tue, 31 Dec 2024 23:57:00 +0900</lastBuildDate>
    <atom:link href="https://www.sambaiz.net/en/tags/aws/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Copy and Query S3 Data in Snowflake</title>
      <link>https://www.sambaiz.net/en/article/518/</link>
      <pubDate>Tue, 31 Dec 2024 23:57:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/518/</guid>
      <description>&lt;p&gt;Snowflake is a fully managed data platform that runs on AWS, GCP, and Azure. It &lt;a href=&#34;https://docs.snowflake.com/en/user-guide/intro-key-concepts#database-storage&#34;&gt;stores data&lt;/a&gt; in columnar format and is built with &lt;a href=&#34;https://docs.snowflake.com/en/user-guide/intro-key-concepts#snowflake-architecture&#34;&gt;shared-nothing architecture&lt;/a&gt; where nodes store portions of datasets locally without sharing resources, enabling rapid scaling for large-scale query execution.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/386/&#34;&gt;Columnar format Parquet structure and read optimization - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Beyond eliminating the need to maintain infrastructure like Hadoop clusters, it offers features such as &lt;a href=&#34;https://docs.snowflake.com/en/user-guide/data-time-travel&#34;&gt;time travel&lt;/a&gt; similar to BigQuery and easily &lt;a href=&#34;https://docs.snowflake.com/en/user-guide/data-sharing-intro&#34;&gt;data sharing&lt;/a&gt; between accounts.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Connect Tableau Desktop to Athena and handle tables with struct columns and date split into year, month, and day</title>
      <link>https://www.sambaiz.net/en/article/499/</link>
      <pubDate>Mon, 14 Oct 2024 22:54:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/499/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://www.tableau.com/&#34;&gt;Tableau&lt;/a&gt; is a BI tool that can connect to various data sources such as local files and BigQuery, visualize and analyze easily by dragging columns.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/499/images/visualize.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/499/images/visualize_hu341943746122422845.png&#34; width=&#34;600&#34; height=&#34;313&#34; alt=&#34;Visualize&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Adding trends and forecasts,&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/499/images/forecast.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/499/images/forecast_hu7012552695835106962.png&#34; width=&#34;600&#34; height=&#34;297&#34; alt=&#34;予測値&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;you can also create and share stories for presentations and dashboards.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/499/images/dashboard.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/499/images/dashboard_hu15134898829781420087.png&#34; width=&#34;600&#34; height=&#34;361&#34; alt=&#34;Dashboard&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.tableau.com/ja-jp/pricing&#34;&gt;Pricing&lt;/a&gt; is $75/month for Creator, which allows connecting to data sources and creating workbooks, while Viewer, which is for viewing only, is $15/month. There&amp;rsquo;s also a free version called Tableau Desktop Public Edition, but it doesn&amp;rsquo;t allow internal sharing via Tableau Server and has &lt;a href=&#34;https://help.tableau.com/current/pro/desktop/ja-jp/desktop_comparison.htm&#34;&gt;limitations&lt;/a&gt; on data sources.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Handle Actions that take too long or are too heavy for Agents for Bedrock by using RETURN_CONTROL and processing them in a Go client</title>
      <link>https://www.sambaiz.net/en/article/496/</link>
      <pubDate>Tue, 27 Aug 2024 20:06:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/496/</guid>
      <description>&lt;p&gt;Agents for Bedrock can register and invoke Lambda functions as Actions. However, for processes that take a long time, there&amp;rsquo;s a risk of hitting Lambda timeouts or resource limits. Moreover, when considering running heavy processes in parallel or notifying users of progress, it can be inconvenient to call these from the Agent. ReturnControls solves this by not handling Actions on the Agent side, but instead returning the Action that should be called and its inputs to the client. The client can then pass the results back to the Agent.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Create Agents for Bedrock using CDK and check that Lambda functions are called based on input</title>
      <link>https://www.sambaiz.net/en/article/495/</link>
      <pubDate>Tue, 27 Aug 2024 09:39:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/495/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/bedrock/agents/&#34;&gt;Agents for Amazon Bedrock&lt;/a&gt; is a feature that builds generative AI agents using various foundation models of Bedrock to perform multi-step processes. It can call Lambda functions as needed and connect with services like OpenSearch Serverless to perform RAG.&lt;/p&gt;&#xA;&lt;p&gt;The Lambda functions called by Agents need to return responses in the following &lt;a href=&#34;https://docs.aws.amazon.com/bedrock/latest/userguide/agents-lambda.html&#34;&gt;format&lt;/a&gt;. Also, it is &lt;a href=&#34;https://repost.aws/questions/QUXk7QWdzGTh-c5MIWch9NNQ/error-when-bedrock-agent-invoke-lambda&#34;&gt;necessary&lt;/a&gt; to set permissions for Bedrock for invocation in the Lambda&amp;rsquo;s Resource-based policy, not in the &lt;a href=&#34;https://docs.aws.amazon.com/bedrock/latest/userguide/agents-permissions.html&#34;&gt;agentResourceRole&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Calculate costs per labels of pods from Prometheus metrics provided by Kubecost</title>
      <link>https://www.sambaiz.net/en/article/493/</link>
      <pubDate>Wed, 17 Jul 2024 19:59:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/493/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://www.kubecost.com/&#34;&gt;Kubecost&lt;/a&gt; is a tool to visualize Kubernetes costs and optimize them.&#xA;AWS provides &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/cost-monitoring.html&#34;&gt;EKS optimized bundle&lt;/a&gt; and some Enterprise features are available.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/493/images/eksoptimized.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/493/images/eksoptimized_hu3245230747283652861.png&#34; width=&#34;600&#34; height=&#34;184&#34; alt=&#34;EKS Optimized license&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Install with Helm. Prometheus will be installed by default, but you can use existing one.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/487/&#34;&gt;Install Prometheus with CDK and remote write aggregated data to New Relic with recording rules to save the amount of data - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-ts&#34; data-lang=&#34;ts&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cluster.addHelmChart(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;KubecostHelmChart&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  chart&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;cost-analyzer&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  repository&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;oci://public.ecr.aws/kubecost/cost-analyzer&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;namespace&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;kubecost&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  release&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;kubecost&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  version&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;2.3.1&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  values&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;global&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      grafana&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        enabled: &lt;span style=&#34;color:#8be9fd&#34;&gt;false&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy: &lt;span style=&#34;color:#8be9fd&#34;&gt;false&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;/*&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;      prometheus: {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;        enabled: false, // If false, use an existing Prometheus install.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;        fqdn: &amp;#34;http://kube-prometheus-stack-prometheus.prometheus.svc.cluster.local:9090&amp;#34;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;      },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;      */&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/*&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;    /*&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;    serviceMonitor: {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;      enabled: true, // Set this to true to create ServiceMonitor for Prometheus operator&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;      additionalLabels: {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;        release: &amp;#39;kube-prometheus-stack&amp;#39;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;      },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;    */&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    prometheus&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      server&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;global&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          external_labels&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            cluster_id: &lt;span style=&#34;color:#8be9fd&#34;&gt;cluster.clusterName&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// https://raw.githubusercontent.com/kubecost/cost-analyzer-helm-chart/develop/cost-analyzer/values-eks-cost-monitoring.yaml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    kubecostFrontend&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      image&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;public.ecr.aws/kubecost/frontend&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    kubecostModel&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      image&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;public.ecr.aws/kubecost/cost-model&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    forecasting&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      enabled: &lt;span style=&#34;color:#8be9fd&#34;&gt;false&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On dashboard, you can see how efficiently resources are being used,&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install Prometheus with CDK and remote write aggregated data to New Relic with recording rules to save the amount of data</title>
      <link>https://www.sambaiz.net/en/article/487/</link>
      <pubDate>Thu, 23 May 2024 02:22:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/487/</guid>
      <description>&lt;p&gt;Prometheus&amp;rsquo; &lt;a href=&#34;https://prometheus.io/docs/prometheus/2.52/configuration/recording_rules/&#34;&gt;recording rules&lt;/a&gt; is a feature that allows you to create new metrics from existing metrics in PromQL. This can save the amount of data sent to New Relic by sending aggregated data compared to sending raw data, but Prometheus in newrelic-prometheus-configurator included in newrelic-bundle is in Agent mode, so it &lt;a href=&#34;https://github.com/prometheus/prometheus/blob/v2.52.0/config/config.go#L124&#34;&gt;doesn’t support&lt;/a&gt; Recording rules.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/466/&#34;&gt;Install newrelic-bundle to EKS cluster with CDK and monitor it - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;So I install my own Prometheus using &lt;a href=&#34;https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus&#34;&gt;Helm&lt;/a&gt; and do remote write.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install Livy on EMR on EKS and run Spark jobs from local Jupyter notebooks with Sparkmagic</title>
      <link>https://www.sambaiz.net/en/article/486/</link>
      <pubDate>Wed, 22 May 2024 23:55:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/486/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://livy.apache.org/&#34;&gt;Apache Livy&lt;/a&gt; provides a REST API for interacting with Spark clusters, and &lt;a href=&#34;https://github.com/jupyter-incubator/sparkmagic&#34;&gt;Sparkmagic&lt;/a&gt; calls this API to run jobs on remote Spark clusters from Jupyter Notebooks. It is also used by Athena for Apache Spark, and being able to run jobs interactively and check the results is useful for debugging and running ad-hoc queries.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/438/&#34;&gt;Athena for Apache Spark の Notebook で DataFrame.toPandas().plot() した際の日本語が文字化けしないようにする - sambaiz-net&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Receive NewRelic alerts on Lambda through EventBridge</title>
      <link>https://www.sambaiz.net/en/article/480/</link>
      <pubDate>Tue, 23 Apr 2024 22:42:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/480/</guid>
      <description>&lt;p&gt;NewRelic&amp;rsquo;s alert destinations include Slack and PagerDuty, and you can specify these in Workflows and add additional data with NRQL.&#xA;However, in order to customize the alert text or perform other processing, it is necessary to handle it with Lambda, etc.&#xA;It can also receive the alert with Webhook &amp;amp; Custom header, but with EventBridge a public endpoint is not needed.&lt;/p&gt;&#xA;&lt;p&gt;Creating an EventBridge destination,&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/480/images/destination.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/480/images/destination_hu3917047771685282441.png&#34; width=&#34;600&#34; height=&#34;360&#34; alt=&#34;Destination&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;and setting as Notify destination of Workflows, when you select event source, it it hasn&amp;rsquo;t existed yet, the partner event source in EventBridge will be created.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install ExternalDNS to an EKS cluster with CDK, and register Service or Ingress host to Route53</title>
      <link>https://www.sambaiz.net/en/article/475/</link>
      <pubDate>Wed, 20 Mar 2024 15:01:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/475/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/external-dns&#34;&gt;ExternalDNS&lt;/a&gt; is an application that synchronizes Service or Ingress host with external DNS records. Route53 records can also be created using CDK, but it is hard to handle ELBs that are created asynchronously after cluster.addManifest() and are managed by controllers.&lt;/p&gt;&#xA;&lt;p&gt;First, let&amp;rsquo;s create a &lt;a href=&#34;https://github.com/kubernetes-sigs/external-dns/blob/v0.14.0/docs/tutorials/aws.md#iam-policy&#34;&gt;Role&lt;/a&gt; to edit records.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-tsx&#34; data-lang=&#34;tsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; externalDNSRole &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.Role(scope, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;ExternalDNSRole&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  roleName&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;`ExternalDNSRole-&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cluster.clusterName&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  assumedBy: &lt;span style=&#34;color:#8be9fd&#34;&gt;new&lt;/span&gt; iam.WebIdentityPrincipal(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cluster.openIdConnectProvider.openIdConnectProviderArn,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;StringEquals&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; cdk.CfnJson(scope, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;ExternalDNSRoleStringEquals&amp;#39;&lt;/span&gt;, { value&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cluster.clusterOpenIdConnectIssuer&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:aud`&lt;/span&gt;]&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;sts.amazonaws.com&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cluster.clusterOpenIdConnectIssuer&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:sub`&lt;/span&gt;]&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;system:serviceaccount:external-dns:external-dns-sa&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }}),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  inlinePolicies&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;Route53&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.PolicyDocument({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      statements&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.PolicyStatement({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          actions&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;route53:ChangeResourceRecordSets&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          resources&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;arn:aws:route53:::hostedzone/*&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.PolicyStatement({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          actions&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;route53:ListHostedZones&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;route53:ListResourceRecordSets&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;route53:ListTagsForResource&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          resources&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I registered some records to check the behavior in the existing zone.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Create a CloudFront Distribution with ALB and S3 as origins using CDK</title>
      <link>https://www.sambaiz.net/en/article/474/</link>
      <pubDate>Wed, 13 Mar 2024 23:32:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/474/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/cloudfront/?nc1=h_ls&#34;&gt;Amazon CloudFront&lt;/a&gt; is a CDN service, and&#xA;it can improve latency and reduce the load on the origin by caching responses on edge servers.&#xA;The main use case is distributing static files from origins such as S3, but it is also possible to return dynamic responses by placing it in front of ALB etc.&#xA;In that case, the cache needs to be disabled, so the number of requests to the origin won&amp;rsquo;t be reduced, but the load will be reduced somewhat as connections can be reused.&#xA;Besides, the traffic between CloudFront and the origin passes through the AWS network, so you can expect improved latency.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install AWS Load Balancer Controller on EKS cluster and set up ALB Ingress</title>
      <link>https://www.sambaiz.net/en/article/471/</link>
      <pubDate>Mon, 26 Feb 2024 23:55:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/471/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.7/&#34;&gt;AWS Load Balancer Controller&lt;/a&gt; is a controller that creates and manages ELBs for Kubernetes resources.&#xA;It can be installed with a service account granted the required &lt;a href=&#34;https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.7.0/docs/install/iam_policy.json&#34;&gt;policies&lt;/a&gt; and &lt;a href=&#34;https://artifacthub.io/packages/helm/aws/aws-load-balancer-controller&#34;&gt;Helm Chart&lt;/a&gt;, but if you create the cluster with CDK, &lt;a href=&#34;https://github.com/aws/aws-cdk/blob/798ef6789c53fc1ba28ffefa480889d5b0c9b151/packages/aws-cdk-lib/aws-eks/lib/alb-controller.ts#L304&#34;&gt;this is done&lt;/a&gt; by specifying the version in albController.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-ts&#34; data-lang=&#34;ts&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; eks.Cluster(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;Cluster&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ...&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  albController&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    version: &lt;span style=&#34;color:#8be9fd&#34;&gt;eks.AlbControllerVersion.V2_6_2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;An ALB is created by creating the Ingress as follows.&#xA;Subnets can be specified with &lt;a href=&#34;https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/ingress/annotations/#subnets&#34;&gt;alb.ingress.kubernetes.io/subnets&lt;/a&gt;, but&#xA;if subnets have following tags, &lt;a href=&#34;https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.7/deploy/subnet_discovery/&#34;&gt;auto discovery&lt;/a&gt; works.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Call AWS API with AwsCustomResource in CDK</title>
      <link>https://www.sambaiz.net/en/article/468/</link>
      <pubDate>Tue, 30 Jan 2024 22:19:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/468/</guid>
      <description>&lt;p&gt;When you need to pass values that can be obtained only after createing resources in CDK,&#xA;you may want to call Describe API. Normally, to do someting like this that is not managed by CloudFormation, you need to prepare your own lambda function and create a CustomResource,&#xA;but if you just want to &lt;a href=&#34;https://github.com/aws/aws-cdk/blob/v2.124.0/packages/%40aws-cdk/custom-resource-handlers/lib/custom-resources/aws-custom-resource-handler/aws-sdk-v3-handler.ts#L122&#34;&gt;call&lt;/a&gt; AWS APIs, you can use &lt;a href=&#34;https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.custom_resources.AwsCustomResource.html&#34;&gt;AwsCustomResource&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-ts&#34; data-lang=&#34;ts&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;as&lt;/span&gt; cdk &lt;span style=&#34;color:#ff79c6&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;aws-cdk-lib&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;import&lt;/span&gt; { Construct } &lt;span style=&#34;color:#ff79c6&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;constructs&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;as&lt;/span&gt; ec2 &lt;span style=&#34;color:#ff79c6&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;aws-cdk-lib/aws-ec2&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;as&lt;/span&gt; eks &lt;span style=&#34;color:#ff79c6&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;aws-cdk-lib/aws-eks&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;import&lt;/span&gt; { KubectlV27Layer } &lt;span style=&#34;color:#ff79c6&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;@aws-cdk/lambda-layer-kubectl-v27&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;export&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;class&lt;/span&gt; CdkCallAwsApiTestStack &lt;span style=&#34;color:#ff79c6&#34;&gt;extends&lt;/span&gt; cdk.Stack {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;constructor&lt;/span&gt;(scope: &lt;span style=&#34;color:#8be9fd&#34;&gt;Construct&lt;/span&gt;, id: &lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;, props?: &lt;span style=&#34;color:#8be9fd&#34;&gt;cdk.StackProps&lt;/span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;super&lt;/span&gt;(scope, id, props);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; vpc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; ec2.Vpc(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;vpc&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      vpcName&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;cdk-call-aws-api-test&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ipAddresses: &lt;span style=&#34;color:#8be9fd&#34;&gt;ec2.IpAddresses.cidr&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;10.18.0.0/18&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      maxAzs: &lt;span style=&#34;color:#8be9fd&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ipProtocol: &lt;span style=&#34;color:#8be9fd&#34;&gt;ec2.IpProtocol.DUAL_STACK&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; cluster &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; eks.Cluster(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;cluster&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      vpc,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      clusterName&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;cdk-call-aws-api-test&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      version: &lt;span style=&#34;color:#8be9fd&#34;&gt;eks.KubernetesVersion.V1_27&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      kubectlLayer: &lt;span style=&#34;color:#8be9fd&#34;&gt;new&lt;/span&gt; KubectlV27Layer(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;KubectlV27Layer&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      defaultCapacity: &lt;span style=&#34;color:#8be9fd&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      defaultCapacityInstance: &lt;span style=&#34;color:#8be9fd&#34;&gt;new&lt;/span&gt; ec2.InstanceType(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;m5.large&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ipFamily: &lt;span style=&#34;color:#8be9fd&#34;&gt;eks.IpFamily.IP_V6&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; customResourceParams &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; ({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      onCreate&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        service&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;eks&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// https://docs.aws.amazon.com/eks/latest/APIReference/API_DescribeCluster.html&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;        action&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;describeCluster&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        parameters&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          name: &lt;span style=&#34;color:#8be9fd&#34;&gt;cluster.clusterName&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        physicalResourceId: &lt;span style=&#34;color:#8be9fd&#34;&gt;cdk.custom_resources.PhysicalResourceId.fromResponse&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;cluster.arn&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#6272a4&#34;&gt;// = PhysicalResourceId.of(cluster.clusterArn)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      onUpdate&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        service&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;sts&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        action&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;getCallerIdentity&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;span style=&#34;color:#6272a4&#34;&gt;// parameters: {},&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      policy: &lt;span style=&#34;color:#8be9fd&#34;&gt;cdk.custom_resources.AwsCustomResourcePolicy.fromSdkCalls&lt;/span&gt;({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        resources: &lt;span style=&#34;color:#8be9fd&#34;&gt;cdk.custom_resources.AwsCustomResourcePolicy.ANY_RESOURCE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      timeout: &lt;span style=&#34;color:#8be9fd&#34;&gt;cdk.Duration.minutes&lt;/span&gt;(&lt;span style=&#34;color:#bd93f9&#34;&gt;5&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; clusterInfo &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; cdk.custom_resources.AwsCustomResource(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;EksDescribeCluster&amp;#39;&lt;/span&gt;, customResourceParams);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; cdk.custom_resources.AwsCustomResource(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;EksDescribeCluster2&amp;#39;&lt;/span&gt;, customResourceParams);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; cdk.CfnOutput(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;ServiceIpv6CidrOutput&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      value: &lt;span style=&#34;color:#8be9fd&#34;&gt;clusterInfo.getResponseField&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;cluster.kubernetesNetworkConfig.serviceIpv6Cidr&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When you deploy this, the following Role will be created and the response of eks.describeCluster in onCreate will be shown as Output.&lt;/p&gt;</description>
    </item>
    <item>
      <title>See traffic denied by SG or Network ACL with VPC Flow Logs and CloudWatch Logs Insights</title>
      <link>https://www.sambaiz.net/en/article/467/</link>
      <pubDate>Mon, 22 Jan 2024 23:48:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/467/</guid>
      <description>&lt;p&gt;There are security groups and &lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html&#34;&gt;network ACLs&lt;/a&gt; settings to allow or deny traffic within the VPC.&#xA;In security groups, responses to requests allowed inbound are allowed regardless of the outbound settings, but network ACLs are stateless for each request and response.&lt;/p&gt;&#xA;&lt;p&gt;Once traffic is denied by these settings, the action field in &lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html&#34;&gt;VPC Flow Logs&lt;/a&gt; becomes REJECT, so&#xA;if you &lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs-cwl.html&#34;&gt;output&lt;/a&gt; it to CloudWatch Logs,&#xA;you can see the number of rejections of specific enis for each src/dst by executing the following query with Insights.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install newrelic-bundle to EKS cluster with CDK and monitor it</title>
      <link>https://www.sambaiz.net/en/article/466/</link>
      <pubDate>Sat, 13 Jan 2024 21:07:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/466/</guid>
      <description>&lt;p&gt;NewRelic &lt;a href=&#34;https://docs.newrelic.com/docs/kubernetes-pixie/kubernetes-integration/installation/kubernetes-integration-install-configure/&#34;&gt;Kubernetes Integration&lt;/a&gt; has various components, and &lt;a href=&#34;https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle&#34;&gt;nri-bundle&lt;/a&gt; Helm Chart bundles them.&#xA;Proceeding with Guided install, the parameters to pass are generated, so I copied them to CDK.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/466/images/guided_install.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/466/images/guided_install_hu408785833327826002.png&#34; width=&#34;600&#34; height=&#34;228&#34; alt=&#34;Guided install&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Looking at the chart, credentials can be passed as strings as it is or Secrets, so I imported them from SecretsManager with External Secrets.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/465/&#34;&gt;Install External Secrets Operator with CDK and make Secrets Manager data available as Kubernetes Secret - sambaiz-net&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install External Secrets Operator with CDK and make Secrets Manager data available as Kubernetes Secret</title>
      <link>https://www.sambaiz.net/en/article/465/</link>
      <pubDate>Thu, 11 Jan 2024 20:15:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/465/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/external-secrets/external-secrets&#34;&gt;External Secrets Operator (ESO)&lt;/a&gt; is an Operator that creates Kubernetes Secrets from secrets stored in external services,&#xA;and is the successor to the deprecated &lt;a href=&#34;https://github.com/external-secrets/external-secrets&#34;&gt;Kubernetes External Secrets (KES)&lt;/a&gt;.&#xA;In this article, I install it with CDK and create a Secret that contains data from Secrets Manager.&lt;/p&gt;&#xA;&lt;p&gt;First, create an IAM Role to be granted to a ServiceAccount and install the operator with Helm Chart.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-ts&#34; data-lang=&#34;ts&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; externalSecretsRole &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.Role(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;ExternalSecretsRole&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  roleName&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;`ExternalSecretsRole-&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cluster.clusterName&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  assumedBy: &lt;span style=&#34;color:#8be9fd&#34;&gt;new&lt;/span&gt; iam.WebIdentityPrincipal(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cluster.openIdConnectProvider.openIdConnectProviderArn,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;StringEquals&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; cdk.CfnJson(&lt;span style=&#34;color:#ff79c6&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;SecretStoreSecretsmanagerRoleStringEquals&amp;#39;&lt;/span&gt;, { value&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          [&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cluster.clusterOpenIdConnectIssuer&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:aud`&lt;/span&gt;]&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;sts.amazonaws.com&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          [&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cluster.clusterOpenIdConnectIssuer&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:sub`&lt;/span&gt;]&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;`system:serviceaccount:external-secrets:secret-store-sa`&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  inlinePolicies&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;SecretsAccess&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.PolicyDocument({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      statements&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; iam.PolicyStatement({&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          actions&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;secretsmanager:GetSecretValue&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          resources&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f1fa8c&#34;&gt;`arn:&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cdk.Aws.PARTITION&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:secretsmanager:&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cdk.Aws.REGION&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;cdk.Aws.ACCOUNT_ID&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;:secret:some-secret-*`&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; externalSecrets &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; cluster.addHelmChart(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;ExternalSecrets&amp;#39;&lt;/span&gt;, {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  release&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;external-secrets&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  chart&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;external-secrets&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  repository&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;https://charts.external-secrets.io&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  version&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;0.9.9&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;namespace&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;external-secrets&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  createNamespace: &lt;span style=&#34;color:#8be9fd&#34;&gt;true&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  values&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    serviceAccount&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      name&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;secret-store-sa&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      annotations&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;eks.amazonaws.com/role-arn&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; externalSecretsRole.roleArn&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  wait: &lt;span style=&#34;color:#8be9fd&#34;&gt;true&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next, create a SecretStore for SecretsManager.&#xA;I create a ClusterSecretStore to use it from multiple namespaces.&lt;/p&gt;</description>
    </item>
    <item>
      <title>IP address exhaustion with EKS cluster and migration to IPv6</title>
      <link>https://www.sambaiz.net/en/article/460/</link>
      <pubDate>Fri, 15 Dec 2023 01:02:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/460/</guid>
      <description>&lt;p&gt;When I ran a large application on an EKS cluster, the subnet&amp;rsquo;s IP addresses ran out.&lt;/p&gt;&#xA;&lt;h2 id=&#34;reason-for-ip-address-exhaustion&#34;&gt;Reason for IP address exhaustion&lt;/h2&gt;&#xA;&lt;p&gt;Pod IP addresses are assigned by ipamd (IP Address Management Daemon) of &lt;a href=&#34;https://github.com/aws/amazon-vpc-cni-k8s&#34;&gt;VPC CNI&lt;/a&gt;, and these are from the instance&amp;rsquo;s secondary IP addresses.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/460/images/secondary_ip_addrs.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/460/images/secondary_ip_addrs_hu6279438281126401799.png&#34; width=&#34;600&#34; height=&#34;323&#34; alt=&#34;Secondary IP address&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;The number of secondary IP addresses are controlled with &lt;a href=&#34;https://github.com/aws/amazon-vpc-cni-k8s/blob/21c4bd73015b715866480cb1cfb9caba2f788027/README.md#warm_eni_target&#34;&gt;WARM_ENI_TARGET&lt;/a&gt; (Default: 1), which is the number of spare ENIs, or&#xA;&lt;a href=&#34;https://github.com/aws/amazon-vpc-cni-k8s/blob/21c4bd73015b715866480cb1cfb9caba2f788027/README.md#warm_eni_target&#34;&gt;WARM_IP_TARGET&lt;/a&gt; (Default: None), which is the number of spare IP addresses in VPC CNI settings.&#xA;By default, when the first Pod runs, the remaining IP address of the ENI is reduced by one, the second ENI is attached, and the maximum IP addresses that can be attached to the ENI are newly retained.&#xA;The maximum number of ENIs that can be attached to an instance and the maximum number of IP addresses that can be attached to an ENI are &lt;a href=&#34;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI&#34;&gt;depending on&lt;/a&gt; the instance type.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Setting security groups for node instances in an EKS cluster created with CDK</title>
      <link>https://www.sambaiz.net/en/article/459/</link>
      <pubDate>Tue, 05 Dec 2023 20:59:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/459/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_eks.Cluster.html#securitygroup&#34;&gt;securityGroup&lt;/a&gt; that can be passed when creating an aws_eks.Cluster is not associated with the node instances but with the control plane&amp;rsquo;s ENI.&lt;/p&gt;&#xA;&lt;p&gt;There&amp;rsquo;s &lt;a href=&#34;https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_eks.Cluster.html#defaultcapacity-1&#34;&gt;defaultCapacity&lt;/a&gt; field in Cluster, so I attempted to add a SG through it, but nothing happened.&#xA;When an EKS cluster is created, if the DefaultCapacityType is NODEGROUP, which is the default, it creates a &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/managed-node-groups.html&#34;&gt;managed node group&lt;/a&gt;, which consists of defaultCapacity nodes, where operations such as drains are managed by EKS.　As a matter of fact, defaultCapacity has value only when the DefaultCapacityType is EC2.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Run AutoML jobs with no code using SageMaker Canvas Custom models</title>
      <link>https://www.sambaiz.net/en/article/458/</link>
      <pubDate>Thu, 16 Nov 2023 23:36:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/458/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/sagemaker/canvas/&#34;&gt;SageMaker Canvas&lt;/a&gt; provides an interface for using pre-trained models provided by &lt;a href=&#34;https://aws.amazon.com/sagemaker/jumpstart/&#34;&gt;SageMaker JumpStart&lt;/a&gt; and&#xA;a feature to run jobs of &lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/autopilot-automate-model-development.html&#34;&gt;SageMaker Autopilot&lt;/a&gt;, an AutoML feature, with no code.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/458/images/ready-to-use-model.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/458/images/ready-to-use-model_hu15217144541276253265.png&#34; width=&#34;600&#34; height=&#34;307&#34; alt=&#34;Pre-trained model&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Note that if you finish using SageMaker Canvas, you need to &lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/canvas-log-out.html&#34;&gt;log out&lt;/a&gt; explicitly, or you will continue to be &lt;a href=&#34;https://aws.amazon.com/sagemaker/canvas/pricing&#34;&gt;charged&lt;/a&gt; for the workspace instance.&lt;/p&gt;&#xA;&lt;p&gt;In this article, I try to run AutoML jobs with &lt;a href=&#34;https://aws.amazon.com/getting-started/hands-on/machine-learning-tutorial-generate-predictions-without-writing-code/?nc1=h_ls&#34;&gt;tutorial&lt;/a&gt; datasets, product descriptions and shipping logs.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Create resources required for EC2 instance without public IPv4 but IPv6 address to communicate with the Internet</title>
      <link>https://www.sambaiz.net/en/article/457/</link>
      <pubDate>Mon, 06 Nov 2023 09:30:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/457/</guid>
      <description>&lt;p&gt;Public IPv4 addresses will start being &lt;a href=&#34;https://aws.amazon.com/jp/blogs/aws/new-aws-public-ipv4-address-charge-public-ip-insights/&#34;&gt;charged&lt;/a&gt; like EIPs soon, so I would like to migrate them to IPv6 recently.&#xA;In this article, I construct an IPv6 environment with CDK and check the resources required to communicate with the Internet and the behavior.&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;(PS: 2024-01-29) In &lt;a href=&#34;https://github.com/aws/aws-cdk/releases/tag/v2.122.0&#34;&gt;v2.122.0&lt;/a&gt;, ipProtocol: ec2.IpProtocol.DUAL_STACK was added to ec2.Vpc, which creates resources for IPv6 automatically.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h2 id=&#34;create-a-vpc&#34;&gt;Create a VPC&lt;/h2&gt;&#xA;&lt;p&gt;IPv6 block assigned to VPC is fixed length &lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-cidr-blocks.html#vpc-sizing-ipv6&#34;&gt;/56&lt;/a&gt; and one assigned to subnets is also fixed length &lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/subnet-sizing.html#subnet-sizing-ipv6&#34;&gt;/64&lt;/a&gt;.&#xA;I disabled automatically assigning public IPv4 addresses and make IPv6 addresses assigned automatically.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Install Karpenter on an EKS cluster with CDK to auto-scale flexibility and quickly</title>
      <link>https://www.sambaiz.net/en/article/455/</link>
      <pubDate>Fri, 13 Oct 2023 20:35:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/455/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://karpenter.sh/&#34;&gt;Karpenter&lt;/a&gt; is an OSS that scales a Kubernetes cluster developed by AWS.&#xA;Compared to &lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/README.md&#34;&gt;Cluster Autoscaler&lt;/a&gt;, it can perform fast and flexible provisioning not through Auto Scaling Group.&#xA;It supports only EKS so far, but it seems to have &lt;a href=&#34;https://karpenter.sh/docs/faq/#what-cloud-providers-are-supported&#34;&gt;possibility&lt;/a&gt; to support other cloud providers.&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;(PS: 2023-12-06) now &lt;a href=&#34;https://azure.microsoft.com/ja-jp/updates/provider-for-running-karpenter-on-azure-kubernetes-service-aks/&#34;&gt;available&lt;/a&gt; on AKS&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;In this article, I install Karpenter on an EKS cluster with CDK, and confirm the cluster to be auto-scaled when the number of replicas is changed.&#xA;The entire code is on &lt;a href=&#34;https://github.com/sambaiz/install-karpenter-with-cdk&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Deploy Japanese LLMs in TGI Container with SageMaker&#39;s HuggingFaceModel and generate texts</title>
      <link>https://www.sambaiz.net/en/article/451/</link>
      <pubDate>Tue, 05 Sep 2023 23:55:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/451/</guid>
      <description>&lt;p&gt;Recently, some Japanese LLMs have been released in Hugging Face,&#xA;such as &lt;a href=&#34;https://huggingface.co/cyberagent/open-calm-7b&#34;&gt;OpenCALM-7B&lt;/a&gt; by CyberAgent and&#xA;&lt;a href=&#34;https://huggingface.co/elyza/ELYZA-japanese-Llama-2-7b&#34;&gt;ELYZA-japanese-Llama-2-7b&lt;/a&gt; by ELYZA, spun-out from Matsuo Lab., University of Tokyo.&#xA;SageMaker SDK has a HuggingFaceModel class, which can be used to deploy a model by specifying the model ID.&#xA;Also, if you press the deploy button in Hugging Face, you can see the minimum code to run the model in SageMaker.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/451/images/deploy.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/451/images/deploy_hu7053936003149172719.png&#34; width=&#34;600&#34; height=&#34;216&#34; alt=&#34;Deploy button&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;get_huggingface_llm_image_uri() returns the image_uri of &lt;a href=&#34;https://github.com/aws/deep-learning-containers/blob/master/available_images.md#huggingface-text-generation-inference-containers&#34;&gt;HuggingFace Text Generation Inference Containers&lt;/a&gt;.&#xA;&lt;a href=&#34;https://aws.amazon.com/blogs/machine-learning/announcing-the-launch-of-new-hugging-face-llm-inference-containers-on-amazon-sagemaker&#34;&gt;This&lt;/a&gt; is a DLC (Deep Learning Container) of&#xA;&lt;a href=&#34;https://github.com/huggingface/text-generation-inference&#34;&gt;Text Generation Inference (TGI)&lt;/a&gt;, which is an OSS by Hugging Face that performs parallel processing on multiple GPUs to generate text quickly.&#xA;&lt;a href=&#34;https://aws.amazon.com/ec2/instance-types/g5/&#34;&gt;ml.g5.12xlarge&lt;/a&gt; has 4 GPUs, so I set SM_NUM_GPUS to 4, which is referenced by &lt;a href=&#34;https://github.com/huggingface/text-generation-inference/blob/62fc40103079bc27e97194ef69e9e34a180b0a85/sagemaker-entrypoint.sh#L14&#34;&gt;sagemaker-entrypoint.sh&lt;/a&gt; in the TGI repository.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Check how job parameters of SageMaker Batch Transform work from called functions in entrypoint and its arguments</title>
      <link>https://www.sambaiz.net/en/article/448/</link>
      <pubDate>Mon, 14 Aug 2023 18:16:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/448/</guid>
      <description>&lt;p&gt;SageMaker &lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/batch-transform.html&#34;&gt;Batch Transform&lt;/a&gt; is a feature that runs a one-time batch inference job.&#xA;It calls the entrypoint function of the Model as in the case of inference endpoints. I check how job parameters work from the function and its arguments.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/290/&#34;&gt;SageMakerで学習したPyTorchのモデルをElastic Inferenceを有効にしてデプロイする - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;from&lt;/span&gt; sagemaker.transformer &lt;span style=&#34;color:#ff79c6&#34;&gt;import&lt;/span&gt; Transformer&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;transformer &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; Transformer(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  model_name&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;model_name,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  instance_type&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;ml.m5.xlarge&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  instance_count&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  output_path&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;s3://&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;{&lt;/span&gt;os&lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt;getenv(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;S3_BUCKET&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;/output/&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# strategy=&amp;#39;SingleRecord&amp;#39;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# max_payload=1,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# assemble_with=&amp;#39;Line&amp;#39;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# accept=&amp;#39;application/json&amp;#39;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;transformer&lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt;transform(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;s3://&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;{&lt;/span&gt;os&lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt;getenv(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;S3_BUCKET&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;/batch_input/&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  content_type&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# compression_type=&amp;#39;Gzip&amp;#39;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# split_type=&amp;#39;Line&amp;#39;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# output_filter=&amp;#34;$[&amp;#39;SageMakerOutput&amp;#39;,&amp;#39;value&amp;#39;]&amp;#34;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# join_source=&amp;#39;Input&amp;#39;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Looking at the Transformer class in the SageMaker Inference Toolkit, I found that the following functions are called in &lt;a href=&#34;https://github.com/aws/sagemaker-inference-toolkit/blob/2ed6f3d19daffccab390d8e9142c9c39c9932271/src/sagemaker_inference/transformer.py#L241&#34;&gt;transform_fn()&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Cause and solution of timeout when ssh_connect() in libssh is executed with ssm-over-ssh as ProxyCommand</title>
      <link>https://www.sambaiz.net/en/article/450/</link>
      <pubDate>Sun, 30 Jul 2023 16:54:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/450/</guid>
      <description>&lt;p&gt;When I connect to RDS in Private subnet,&#xA;I found that &lt;a href=&#34;https://sequel-ace.com/&#34;&gt;Sequel Ace&lt;/a&gt; running in Sandbox Mode &lt;a href=&#34;https://github.com/Sequel-Ace/Sequel-Ace/issues/1450&#34;&gt;can&amp;rsquo;t&lt;/a&gt; do SSH tunneling with ssh-over-ssm as ProxyCommand,&#xA;so I tried &lt;a href=&#34;https://tableplus.com/&#34;&gt;TablePlus&lt;/a&gt; introduced in this Issue, but it also failed.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/449/&#34;&gt;SSH connection to EC2 instance through Session Manager with ssh-over-ssm - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;I enabled SSH Debug Log from Help, and found that libssh was used.&#xA;So I tried executing ssh_connect() but it timed out after the connection.&lt;/p&gt;</description>
    </item>
    <item>
      <title>SSH connection to EC2 instance through Session Manager with ssh-over-ssm</title>
      <link>https://www.sambaiz.net/en/article/449/</link>
      <pubDate>Thu, 29 Jun 2023 07:30:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/449/</guid>
      <description>&lt;p&gt;Session Manager can execute commands and port forwarding by itself. Besides, it also supports &lt;a href=&#34;https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-getting-started-enable-ssh-connections.html&#34;&gt;SSH connection&lt;/a&gt; with &amp;ndash;document-name AWS-StartSSHSession.&#xA;The content of this document is sessionType Port same as AWS-StartPortForwardingSession, and SSM Agent &lt;a href=&#34;https://github.com/aws/amazon-ssm-agent/blob/2b7ab82bbf39190dbb237a609e4d1dc048a686a1/agent/session/plugins/port/port.go#L110&#34;&gt;establishes a TCP connection&lt;/a&gt; to the target port.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/449/images/startssh.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/449/images/startssh_hu2176239254195671034.png&#34; width=&#34;597&#34; height=&#34;370&#34; alt=&#34;AWS-StartSSHSession document&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/410/&#34;&gt;Deploy a container to ECS on Fargate, execute commands by ECS Exec, and perform port forwarding by Session Manager - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;This allows you to copy files with scp and use tools such as DB clients to perform SSH port forwarding.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Create a cost-optimized real-time inference endpoint with SageMaker Inference Recommender</title>
      <link>https://www.sambaiz.net/en/article/447/</link>
      <pubDate>Thu, 15 Jun 2023 09:38:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/447/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/inference-recommender.html&#34;&gt;SageMaker Inference Recommender&lt;/a&gt; is a feature to recommend endpoint&amp;rsquo;s instance types and settings.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/290/&#34;&gt;SageMakerで学習したPyTorchのモデルをElastic Inferenceを有効にしてデプロイする - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;I try running an Inference Recommender job for a PyTorch model created in the past and setting up an inference endpoint with the lowest cost instance type.&#xA;The full code is on &lt;a href=&#34;https://github.com/sambaiz/sagemaker-inference-recommendation-test&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;defaulthttpsdocsawsamazoncomsagemakerlatestdginference-recommender-instance-recommendationhtml&#34;&gt;&lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/inference-recommender-instance-recommendation.html&#34;&gt;Default&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;First, run a job with Default JobType and npy input that default inference handler supports.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Preprocess data with SageMaker Processing, train model with Training and record the parameters and accuracy with Experiments</title>
      <link>https://www.sambaiz.net/en/article/442/</link>
      <pubDate>Thu, 04 May 2023 19:20:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/442/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/experiments.html&#34;&gt;SageMaker Experiments&lt;/a&gt; is a feature to record parameters and metrics&#xA;of &lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/processing-job.html&#34;&gt;Processing&lt;/a&gt;&#xA;and &lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html&#34;&gt;Training&lt;/a&gt; jobs etc.&#xA;In this article, I track from preprocessing to learning as a Run in Experiments and confirm that multiple results can be compared.&lt;/p&gt;&#xA;&lt;p&gt;The full code is on &lt;a href=&#34;https://github.com/sambaiz/sagemaker-processing-training-experiments-test&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sagemaker-experiments&#34;&gt;SageMaker Experiments&lt;/h2&gt;&#xA;&lt;p&gt;experiments.Run() creates an Experiment if it hasn&amp;rsquo;t existed yet and starts a Run.&#xA;Previously, it was a separate library called sagemaker-experiments, but now it is &lt;a href=&#34;https://docs.aws.amazon.com/sagemaker/latest/dg/experiments-additional-sdk.html&#34;&gt;integrated&lt;/a&gt; into sagemaker.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Make EMR clusters&#39; scale-in faster with Task nodes</title>
      <link>https://www.sambaiz.net/en/article/445/</link>
      <pubDate>Sun, 19 Mar 2023 22:51:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/445/</guid>
      <description>&lt;p&gt;EMR cluster &lt;a href=&#34;https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-master-core-task-nodes.html&#34;&gt;consists&lt;/a&gt; of a Master (primary) node and Core nodes and Task nodes.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/427/&#34;&gt;How Hadoop YARN allocates resources to applications and check how much resources are allocated - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Resources of both core nodes and task nodes are used to run tasks, but core nodes are HDFS&amp;rsquo;s DataNode while task nodes aren&amp;rsquo;t.&#xA;Therefore, core nodes need to be decommissioned and then terminated to prevent data loss, but replication bandwidth is limited to prevent spikes, so &lt;a href=&#34;https://aws.amazon.com/jp/blogs/big-data/best-practices-for-resizing-and-automatic-scaling-in-amazon-emr/&#34;&gt;it takes time&lt;/a&gt; to scale in.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Enable S3 versioning to retrieve accidentally overwritten or deleted objects</title>
      <link>https://www.sambaiz.net/en/article/444/</link>
      <pubDate>Wed, 15 Mar 2023 22:35:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/444/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html&#34;&gt;Versioning&lt;/a&gt; is settings of S3 Bucket.&#xA;When enabled, all PUT data will remain with the version ID, and on DELETE, a delete marker is put as the latest version without actually deleting.&#xA;If you GET an object whose latest version is a delete marker, it returns Not found like when there is no object, but if you delete the delete marker version, you can get that object again.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/444/images/deletemarker.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/444/images/deletemarker_hu4171680499348479009.png&#34; width=&#34;600&#34; height=&#34;101&#34; alt=&#34;Delete marker&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;If you delete an object with the version, the delete marker is not created.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Launch an EKS cluster and register it to EMR on EKS with CDK to run Spark jobs</title>
      <link>https://www.sambaiz.net/en/article/434/</link>
      <pubDate>Mon, 02 Jan 2023 14:53:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/434/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/emr-eks.html&#34;&gt;EMR on EKS&lt;/a&gt; is a feature to run Spark on EKS.&#xA;While normal EMR also manages Hadoop clusters, EMR on EKS is only responsible for starting containers.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/409/&#34;&gt;Launch an EMR cluster with AWS CLI and run Spark applications - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;By running on Kubernetes, you can use tools and functions for Kubernetes to manage and monitor, and utilize resources left over if you have an existing cluster.&#xA;It also enables to use knowledge about Kubernetes learned from other applications for aggregation and analysis, and also may be vice versa.&#xA;However, some knowledge about Kubernetes and EKS is required.&#xA;You can start using normal EMR without knowledge of YARN, but I think EMR on EKS will be difficult to even operate with no knowledge.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Check records of operations for AWS resources with CloudTrail</title>
      <link>https://www.sambaiz.net/en/article/431/</link>
      <pubDate>Tue, 06 Dec 2022 21:12:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/431/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/cloudtrail&#34;&gt;AWS CloudTrail&lt;/a&gt; records AWS API call history, which is used for security auditing and other services such as GuardDuty.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/430/&#34;&gt;Check security issues detected by GuardDuty, Inspector, and Macie, etc. in AWS Security Hub collectively - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;event-historyhttpsdocsawsamazoncomawscloudtraillatestuserguideview-cloudtrail-eventshtml&#34;&gt;&lt;a href=&#34;https://docs.aws.amazon.com/awscloudtrail/latest/userguide/view-cloudtrail-events.html&#34;&gt;Event history&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Event history is recorded per region by default, which is &lt;a href=&#34;https://aws.amazon.com/jp/cloudtrail/pricing/&#34;&gt;free&lt;/a&gt;.&#xA;The retention period is 90 days, and &lt;a href=&#34;https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-data-events-with-cloudtrail.html&#34;&gt;data events&lt;/a&gt;, such as Lambda&amp;rsquo;s invoke and object-level operations in S3, are not included.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/431/images/eventhistory.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/431/images/eventhistory_hu1648094947753967785.png&#34; width=&#34;600&#34; height=&#34;173&#34; alt=&#34;Event history&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;h2 id=&#34;trails&#34;&gt;Trails&lt;/h2&gt;&#xA;&lt;p&gt;Creating a trail with selecting the Events to be recorded, logs of all regions are outputted to S3.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Check security issues detected by GuardDuty, Inspector, and Macie, etc. in AWS Security Hub collectively</title>
      <link>https://www.sambaiz.net/en/article/430/</link>
      <pubDate>Sun, 04 Dec 2022 10:34:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/430/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/security-hub&#34;&gt;AWS Security Hub&lt;/a&gt; is a service that allows you to collectively check security issues detected by various services&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/430/images/findings.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/430/images/findings_hu9051172854731674462.png&#34; width=&#34;600&#34; height=&#34;279&#34; alt=&#34;findings&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;h2 id=&#34;security-standardshttpsdocsawsamazoncomsecurityhublatestuserguidestandards-availablehtml&#34;&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/standards-available.html&#34;&gt;Security standards&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Security Hub supports following security standards, and they are enabled, rules are added to &lt;a href=&#34;https://docs.aws.amazon.com/config/latest/developerguide/WhatIsConfig.html&#34;&gt;AWS Config&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AWS Foundational Security Best Practices: Best practices for each service&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-acm-1&#34;&gt;[ACM.1] Imported and ACM-issued certificates should be renewed after a specified time period&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-cloudfront-1&#34;&gt;[CloudFront.1] CloudFront distributions should have a default root object configured&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Center for Internet Security (CIS) AWS Foundations Benchmark: Meet the requirements for certification by the security standardized organization &lt;a href=&#34;https://www.cisecurity.org/&#34;&gt;CIS&lt;/a&gt; established by the NSA, etc.&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-cis-controls-1.4.0.html#securityhub-cis1.4-controls-1.4&#34;&gt;1.4 – Ensure no root user account access key exists&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-cis-controls-1.4.0.html#securityhub-cis1.4-controls-4.4&#34;&gt;4.4 – Ensure a log metric filter and alarm exist for IAM policy changes&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Payment Card Industry Data Security Standard (PCI DSS)&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-pci-controls.html#pcidss-ec2-1&#34;&gt;[PCI.EC2.1] Amazon EBS snapshots should not be publicly restorable&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-pci-controls.html#pcidss-ssm-3&#34;&gt;[PCI.SSM.3] EC2 instances should be managed by AWS Systems Manager&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;After waiting for a while, the score will be displayed, and you can check each result.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Create an environment of Amazon Managed Workflow for Apache Airflow (MWAA) with CDK and run a workflow</title>
      <link>https://www.sambaiz.net/en/article/428/</link>
      <pubDate>Mon, 28 Nov 2022 19:34:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/428/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/managed-workflows-for-apache-airflow&#34;&gt;Amazon Managed Workflow for Apache Airflow (MWAA)&lt;/a&gt; is a managed service of &lt;a href=&#34;https://airflow.apache.org/&#34;&gt;Apache Airflow&lt;/a&gt;.&#xA;Unlike Step Functions that is serverless, it &lt;a href=&#34;https://aws.amazon.com/managed-workflows-for-apache-airflow/pricing/&#34;&gt;costs&lt;/a&gt; per an instance hour,&#xA;but Airflow&amp;rsquo;s abundant features and third-party&amp;rsquo;s, including AWS, &lt;a href=&#34;https://airflow.apache.org/docs/#providers-packagesdocsapache-airflow-providersindexhtml&#34;&gt;providers packages&lt;/a&gt; are available.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/425/&#34;&gt;Run Apache Airflow with Docker Compose and execute a workflow - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Step Functions doesn&amp;rsquo;t support execution from the middle of the workflow currently, so retrying a very long workflow can be hard.&#xA;Also, if you include the input value in an array of object values such as args of EmrAddStep, you need to process it into an array with Lambda in advance.&#xA;If you feel inconvenienced with such things now, migrating to MWAA may be a option.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Pass AWS credentials to services for Docker Compose</title>
      <link>https://www.sambaiz.net/en/article/426/</link>
      <pubDate>Wed, 23 Nov 2022 15:30:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/426/</guid>
      <description>&lt;p&gt;When you run a docker container locally, you can &lt;a href=&#34;https://docs.docker.com/storage/volumes/&#34;&gt;mount&lt;/a&gt; ~/.aws to pass AWS credentials, and similarly, you can do that with &lt;a href=&#34;https://docs.docker.com/compose/compose-file/compose-file-v3/#volumes&#34;&gt;volumes&lt;/a&gt; in Docker Compose.&#xA;Besides, there is also a &lt;a href=&#34;https://docs.docker.com/compose/compose-file/compose-file-v3/#secrets&#34;&gt;secrets&lt;/a&gt; field.&#xA;According to the &lt;a href=&#34;https://docs.docker.com/engine/swarm/secrets/&#34;&gt;document&lt;/a&gt;, it looks to depend on Swarm, but actually, it can run &lt;a href=&#34;https://github.com/docker/compose/issues/8707&#34;&gt;standalone&lt;/a&gt;.&#xA;However, this is for development, and it seems to just bind the file.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;3&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;secrets&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;aws_creds&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;file&lt;/span&gt;: ~/.aws&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;services&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;aws_cli&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;image&lt;/span&gt;: amazon/aws-cli:2.9.0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;secrets&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ff79c6&#34;&gt;source&lt;/span&gt;: aws_creds&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;target&lt;/span&gt;: /root/.aws&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;# volumes:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;#  - type: bind&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;#    source: ~/.aws&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;#    target: /root/.aws&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;environment&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;AWS_PROFILE&lt;/span&gt;: xxxx&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;command&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - sts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - get-caller-identity&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>Monitor AWS costs with New Relic</title>
      <link>https://www.sambaiz.net/en/article/424/</link>
      <pubDate>Sun, 13 Nov 2022 15:34:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/424/</guid>
      <description>&lt;h2 id=&#34;visualize-billing-metrics&#34;&gt;Visualize Billing metrics&lt;/h2&gt;&#xA;&lt;p&gt;There are Billing metrics in CloudWatch, so if you are sending all metrics in &lt;strong&gt;us-east-1&lt;/strong&gt; with Cloud Metric Streams, you can refer them with a query as follows.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/424/images/billing_metrics.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/424/images/billing_metrics_hu15224444542806073005.png&#34; width=&#34;600&#34; height=&#34;257&#34; alt=&#34;Billing metrics&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;aws.billing.EstimatedCharges&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;) &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;aws.billing.EstimatedCharges&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;) &lt;span style=&#34;color:#ff79c6&#34;&gt;as&lt;/span&gt; daily_usage&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;FROM&lt;/span&gt; Metric&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;WHERE&lt;/span&gt; aws.Namespace &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;AWS/Billing&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;metricName&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;aws.billing.EstimatedCharges&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;aws.billing.ServiceName&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;IS&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;NULL&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    FACET monthOf(&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;), &lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;aws.billing.ServiceName&lt;span style=&#34;color:#ff79c6&#34;&gt;`&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TIMESERIES &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;day&lt;/span&gt; SLIDE &lt;span style=&#34;color:#ff79c6&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;day&lt;/span&gt; SINCE &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt; week ago&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The values are accumulated monthly, so daily costs can be shown with taking differences from previous day&amp;rsquo;s one with &lt;a href=&#34;https://docs.newrelic.com/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/create-smoother-charts-sliding-windows/&#34;&gt;Sliding window&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Monitor and optimize costs with AWS Cost Management</title>
      <link>https://www.sambaiz.net/en/article/422/</link>
      <pubDate>Thu, 10 Nov 2022 21:00:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/422/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/cost-management/latest/userguide/what-is-costmanagement.html&#34;&gt;AWS Cost Management&lt;/a&gt; is a feature group for monitoring, forecasting, and optimizing costs.&#xA;&lt;a href=&#34;https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/billing-what-is.html&#34;&gt;Billing&lt;/a&gt; has similar features.&#xA;Billing is for managing present costs whereas Cost Management seems to target future costs.&lt;/p&gt;&#xA;&lt;h2 id=&#34;cost-explorerhttpsdocsawsamazoncomcost-managementlatestuserguidece-what-ishtml&#34;&gt;&lt;a href=&#34;https://docs.aws.amazon.com/cost-management/latest/userguide/ce-what-is.html&#34;&gt;Cost Explorer&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Cost Explorer can show costs grouped and filtered by services and regions etc.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/422/images/costexplorer.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/422/images/costexplorer_hu6894020999383962288.png&#34; width=&#34;589&#34; height=&#34;370&#34; alt=&#34;Cost Explorer&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;With filtering with Usage type filter, &lt;a href=&#34;https://aws.amazon.com/blogs/mt/using-aws-cost-explorer-to-analyze-data-transfer-costs/&#34;&gt;you can see&lt;/a&gt; costs for data transfer from ELB and EC2.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/422/images/datatransfer.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/422/images/datatransfer_hu9250006668268774368.png&#34; width=&#34;174&#34; height=&#34;370&#34; alt=&#34;costs for data transfer&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;h2 id=&#34;budgetshttpsdocsawsamazoncomcost-managementlatestuserguidebudgets-managing-costshtml&#34;&gt;&lt;a href=&#34;https://docs.aws.amazon.com/cost-management/latest/userguide/budgets-managing-costs.html&#34;&gt;Budgets&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Budgets can notice that set budgets have been exceeded and report the usage with email etc. periodically.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Create a role that can assume with OIDC from GitHub Actions with CDK</title>
      <link>https://www.sambaiz.net/en/article/421/</link>
      <pubDate>Sun, 30 Oct 2022 02:33:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/421/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/aws-actions/configure-aws-credentials&#34;&gt;aws-actions/configure-aws-credentials&lt;/a&gt; is an action that assumes a role, and it also supports authentication with an access key,&#xA;but JWT issued by &lt;a href=&#34;https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect&#34;&gt;GitHub OIDC Provider&lt;/a&gt; enables to access to API securely without setting credential.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/136/&#34;&gt;OpenID ConnectのIDトークンの内容と検証 - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;To trust the external provider, it is necessary to register the certificate thumbprint of the top intermediate certificate authority in the chain used for HTTPS communication.&#xA;The thumbprint can be &lt;a href=&#34;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc_verify-thumbprint.html&#34;&gt;obtained&lt;/a&gt; as follows.&#xA;When the intermediate certificate authority &lt;a href=&#34;https://github.blog/changelog/2022-01-13-github-actions-update-on-oidc-based-deployments-to-aws/&#34;&gt;changed&lt;/a&gt;, it was necessary to update the thumbprint as well.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Develop Spark Applications in Scala, deploy with GitHub Actions, and perform remote debugging on EMR</title>
      <link>https://www.sambaiz.net/en/article/420/</link>
      <pubDate>Fri, 21 Oct 2022 23:36:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/420/</guid>
      <description>&lt;p&gt;Spark provides Java and Python APIs in addition to Scala, which is used for developing Spark itself.&#xA;You can choose among them depending on the technical stack and technologies used in other components, etc.&lt;/p&gt;&#xA;&lt;p&gt;While Python has highly compatible with data analysis and machine learning skill sets and easy to edit and run on Glue Studio, the error is hard to understand, and the performance also has disadvantages because it needs to exchange the data between JVM and Python Workers.&#xA;Also, if the Python interpreter, which is not controlled by the JVM, try to use more memory than a resource manager such as YARN has allocated, the executor can be killed.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Aggregate logs of spark running on an EMR cluster with Fluent Bit</title>
      <link>https://www.sambaiz.net/en/article/416/</link>
      <pubDate>Sun, 04 Sep 2022 14:44:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/416/</guid>
      <description>&lt;p&gt;If Spark jobs run on Cluster mode, the logs are not outputted to step/ directory, so it is hard to check it on the console,&#xA;so try aggregating them to New Relic.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/409/&#34;&gt;Launch an EMR cluster with AWS CLI and run Spark applications - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/399/&#34;&gt;Monitor infrastructure and applications with New Relic - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;option-1-sending-logs-with-self-installed-fluent-bit&#34;&gt;Option 1. Sending logs with self installed fluent bit&lt;/h2&gt;&#xA;&lt;p&gt;Install &lt;a href=&#34;https://docs.fluentbit.io/manual/about/fluentd-and-fluent-bit&#34;&gt;Fluent Bit&lt;/a&gt; that is memory saving fluentd, and send logs with it.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Why can Athena v2 fail to query map columns in parquet source tables</title>
      <link>https://www.sambaiz.net/en/article/415/</link>
      <pubDate>Tue, 16 Aug 2022 21:26:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/415/</guid>
      <description>&lt;p&gt;Output logs containing map fields as json etc., convert it to parquet with Glue Studio, and execute queries with Athena, then the queries can succeed or fail depending on the table.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/386/&#34;&gt;Columnar format Parquet structure and read optimization - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; Log &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;struct&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    A &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;=&amp;gt; {&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;:{&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#bd93f9&#34;&gt;10&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#bd93f9&#34;&gt;20&lt;/span&gt;}}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The parquet metadata is as follows and the information about map is lost.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ parquet meta test.parquet&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File path:  test.parquet&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Created by: parquet-glue version 1.8.2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Properties:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  org.apache.spark.sql.parquet.row.metadata: &lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;struct&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;fields&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#ff79c6&#34;&gt;[{&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;struct&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;fields&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#ff79c6&#34;&gt;[{&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;integer&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;nullable&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#ff79c6&#34;&gt;{}}&lt;/span&gt;,&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;integer&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;nullable&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#ff79c6&#34;&gt;{}}]}&lt;/span&gt;,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;nullable&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#ff79c6&#34;&gt;{}}]}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Schema:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message glue_schema &lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  optional group A &lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    optional int32 B;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    optional int32 C;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Row group 0:  count: &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;  116.00 B records  start: &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;  total&lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;compressed&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#bd93f9&#34;&gt;116&lt;/span&gt; B total&lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;uncompressed&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;:112 B &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt;      encodings count     avg size   nulls   min / max&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.B  INT32     S   _     &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;         58.00 B    &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;       &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;10&amp;#34;&lt;/span&gt; / &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;10&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.C  INT32     S   _     &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;         58.00 B    &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;       &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;20&amp;#34;&lt;/span&gt; / &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;20&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If set this column type to map, I thought queries always fail, but if both key and value&amp;rsquo;s type are set to value&amp;rsquo;s one, queries themselves succeed.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Settings for running Spark on EMR</title>
      <link>https://www.sambaiz.net/en/article/414/</link>
      <pubDate>Sat, 13 Aug 2022 19:53:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/414/</guid>
      <description>&lt;p&gt;EMR and Glue are managed services that run Spark applications on AWS.&#xA;Glue is easy to run ETL jobs with serverless, while EMR allows fine-tuning of resources and parameters.&#xA;In other words, if the settings are not appropriate, the resources cannot be fully used, and tasks can fail due to OOM even if there is excess memory.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/414/images/resource.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/414/images/resource_hu1325476225419147310.png&#34; width=&#34;600&#34; height=&#34;356&#34; alt=&#34;a resource that isn&amp;#39;t fully used&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;In the CLI, settings can be passed as json string or a file with &amp;ndash;configurations.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Deploy a container to ECS on Fargate, execute commands by ECS Exec, and perform port forwarding by Session Manager</title>
      <link>https://www.sambaiz.net/en/article/410/</link>
      <pubDate>Sat, 23 Jul 2022 13:45:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/410/</guid>
      <description>&lt;p&gt;When investigating an application running in a remote non-container environment, sshd is often running, so commands can be executed with SSH connection.&#xA;On the other hand, sshd isn&amp;rsquo;t usually running in a container environment, so it can&amp;rsquo;t be executed similarly.&#xA;If absolutely necessary, there is a way to run sshd, but it would be better to avoid it in terms of opening ports and managing keys.&#xA;In this article, command execution and port forwarding are performed without running sshd in a container running in ECS on Fargate.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Launch an EMR cluster with AWS CLI and run Spark applications</title>
      <link>https://www.sambaiz.net/en/article/409/</link>
      <pubDate>Wed, 22 Jun 2022 00:05:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/409/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/emr/&#34;&gt;Amazon EMR&lt;/a&gt; is the service that launches a cluster installed Spark, Hive, and Presto on EC2 or EKS. While Glue, the managed Spark service, can easily run Spark ETL jobs with serverless, EMR has the advantage of excellent cost performance by spot instances etc., and also fine-tuning is available, but now that &lt;a href=&#34;https://aws.amazon.com/jp/emr/serverless/&#34;&gt;EMR Serverless&lt;/a&gt; has been released, the difference has narrowed a little. Glue also has handy features such as &lt;a href=&#34;https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-crawler-pyspark-extensions-dynamic-frame.html&#34;&gt;DynamicFrame&lt;/a&gt;, which doesn&amp;rsquo;t need to be specified the schema, and Bookmark, which makes processing being executed from the previous continuation. However, if heavy processing is executed repeatedly, it can be expensive, besides, it causes to reach quotas such as DPU, so it would be better to use it properly.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Settings for querying tables of other accounts with Athena</title>
      <link>https://www.sambaiz.net/en/article/405/</link>
      <pubDate>Tue, 17 May 2022 23:51:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/405/</guid>
      <description>&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/405/images/structure.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/405/images/structure_hu17349683740843418479.png&#34; width=&#34;600&#34; height=&#34;197&#34; alt=&#34;Structure&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/392/&#34;&gt;Redshift Serverless and other serverless aggregation services, run query with Glue Data Catalog - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Borrower Account that executes the query needs to access the resources of Owner Account having Data Catalog and the data.&#xA;There are some ways to access resources of other accounts, such as access tokens or AssumeRole, but in this case, the role used to execute queries also needs the permission of the Borrower Account&amp;rsquo;s Athena, so it should be allowed to access resources of both accounts.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Implement Athena&#39;s data source connectors and user defined functions (UDF)</title>
      <link>https://www.sambaiz.net/en/article/402/</link>
      <pubDate>Sat, 23 Apr 2022 18:09:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/402/</guid>
      <description>&lt;p&gt;Athena has a feature called Federate Query that can access data sources other than S3 using Lambda as a connector, and&#xA;&lt;a href=&#34;https://github.com/awslabs/aws-athena-query-federation&#34;&gt;the official repository&lt;/a&gt; provides connectors for various data sources such as BigQuery and Snowflake, but you can also implement your own.&#xA;This article, implement the minimum connector while referring to &lt;a href=&#34;https://github.com/awslabs/aws-athena-query-federation/tree/master/athena-example&#34;&gt;Example Connector&lt;/a&gt; and run it. The full codes has been pushed to &lt;a href=&#34;https://github.com/sambaiz/athena-connector-udf-example&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/391/&#34;&gt;Generate data with TPC-DS Connector in Athena&amp;rsquo;s Federated Query - sambaiz-net&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>About newrelic-lambda-extension and how it works telemetry without CloudWatch Logs</title>
      <link>https://www.sambaiz.net/en/article/401/</link>
      <pubDate>Fri, 08 Apr 2022 12:11:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/401/</guid>
      <description>&lt;p&gt;Theare are two methods &lt;a href=&#34;https://docs.newrelic.com/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/monitoring-aws-lambda-serverless-monitoring&#34;&gt;to send Lambda logs to New Relic&lt;/a&gt;.&#xA;First is a conventional method that uses a Lambda function &lt;a href=&#34;https://github.com/newrelic/aws-log-ingestion&#34;&gt;aws-log-ingestion&lt;/a&gt; to subscribe and transfer CloudWatch Logs, and second is a method that uses a Lambda layer &lt;a href=&#34;https://github.com/newrelic/newrelic-lambda-extension&#34;&gt;newrelic-lambda-extension&lt;/a&gt;. The latter send trace logs etc. without outputting to CloudWatch Logs so it can minimize the cost.&lt;/p&gt;&#xA;&lt;h2 id=&#34;installhttpsgithubcomnewrelicnewrelic-lambda-extensioninstallation&#34;&gt;&lt;a href=&#34;https://github.com/newrelic/newrelic-lambda-extension#installation&#34;&gt;Install&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Doing &lt;code&gt;newrelic-lambda integrations install&lt;/code&gt;, Secret containing API Key Layer refers is deployed.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ pip3 install newrelic-lambda-cli&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ newrelic-lambda integrations install &lt;span style=&#34;color:#f1fa8c&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    --nr-account-id &amp;lt;account id&amp;gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    --nr-api-key &amp;lt;api key&amp;gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    --linked-account-name &amp;lt;linked account name&amp;gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    --enable-license-key-secret &lt;span style=&#34;color:#f1fa8c&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    --aws-profile &amp;lt;aws_profile_name&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    --aws-region &amp;lt;aws_region&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Validating New Relic credentials&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Retrieving integration license key&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Creating the AWS role &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; the New Relic AWS Lambda Integration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Waiting &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; stack creation to complete... ✔️ Done&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;✔️ Created role &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;NewRelicLambdaIntegrationRole_*****&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt; in AWS account.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Linking New Relic account to AWS account&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;✔️ Cloud integrations account &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;*****&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt; already exists in New Relic account &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;*****&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt; with IAM role &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;arn:aws:iam::*****:role/newrelic&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Enabling Lambda integration on the link between New Relic and AWS&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;✔️ Cloud integrations account &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;*****&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt; is using CloudWatch Metric Streams&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Creating the managed secret &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; the New Relic License Key&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Setting up NewRelicLicenseKeySecret stack in region: us-east-1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Creating change set: NewRelicLicenseKeySecret-CREATE-1648894216&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Waiting &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; change &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; creation to complete, this may take a minute... Waiting &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; change &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; to finish execution. This may take a minute... ✔️ Done&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Creating newrelic-log-ingestion Lambda &lt;span style=&#34;color:#ff79c6&#34;&gt;function&lt;/span&gt; in AWS account&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Setting up &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;newrelic-log-ingestion&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;function&lt;/span&gt; in region: us-east-1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Fetching new CloudFormation template url&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Creating change set: NewRelicLogIngestion-CREATE-1648894271&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Waiting &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; change &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; creation to complete, this may take a minute... Waiting &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; change &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; to finish execution. This may take a minute... ✖️ Failed to create &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;newrelic-log-ingestion&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;function&lt;/span&gt;: &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;Status&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;✖️ Install Incomplete. See messages above &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; details.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Grant the read policy for arn which is exported by the stack and set the layer and environment values.&#xA;This time, output debug logs to easy to track the process.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Monitor infrastructure and applications with New Relic</title>
      <link>https://www.sambaiz.net/en/article/399/</link>
      <pubDate>Wed, 30 Mar 2022 19:11:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/399/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://newrelic.com/&#34;&gt;New Relic&lt;/a&gt; is a SaaS that monitors infrastructure and applications, and there is Datadog as a similar service.&#xA;It seems that the &lt;a href=&#34;https://newrelic.com/pricing&#34;&gt;pricing plans&lt;/a&gt; were &lt;a href=&#34;https://newrelic.com/jp/blog/nerdlog/new-relic-one-observability-made-simple&#34;&gt;changed&lt;/a&gt; drastically in 2020, and it charges according to the transfer volume and the number of admin users. Therefore compared to Datadog, which &lt;a href=&#34;https://www.datadoghq.com/ja/pricing/&#34;&gt;charges&lt;/a&gt; for hosts and additional features, there is an advantage when managing a large number of instances with a small number of people.&#xA;And Datadog pricing plans are relatively complex and hard to estimate how much the bill will be in an environment where the number of instances increases and decreases frequently, while New Relic&amp;rsquo;s plans are easy.&#xA;Even if you try to new features, the unit price will not increase, so you can easily try it.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Compare Redshift Serverless and Athena performances by TPC-DS queries</title>
      <link>https://www.sambaiz.net/en/article/397/</link>
      <pubDate>Sun, 20 Feb 2022 01:49:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/397/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/392/&#34;&gt;Redshift Serverless and other serverless aggregation services, run query with Glue Data Catalog - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Compare the performance between Redshift Serverless (Preview) and Athena by queries of TPC-DS, which is a database benchmark.&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;(PS: 2022-07-13) Following values were calculated at the rate at the time of preview. When it became &lt;a href=&#34;https://aws.amazon.com/jp/blogs/aws/amazon-redshift-serverless-now-generally-available-with-new-capabilities/&#34;&gt;GA&lt;/a&gt;, the rate dropped by about 30%.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/393/&#34;&gt;Generate data with TPC-DS Connector for Glue - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;First, executed the following query to the json and parquet data.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Generate data with TPC-DS Connector for Glue</title>
      <link>https://www.sambaiz.net/en/article/393/</link>
      <pubDate>Tue, 18 Jan 2022 21:26:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/393/</guid>
      <description>&lt;p&gt;Previously, I tried to generate 250GB of data with Athena&amp;rsquo;s TPC-DS Connector and output it to S3 but it timed out even if I increased the Lambda resource to the maximum, so I do it with Glue this time.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/391/&#34;&gt;Generate data with TPC-DS Connector in Athena&amp;rsquo;s Federated Query - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Subscribe and activate &lt;a href=&#34;https://aws.amazon.com/marketplace/pp/prodview-xtty6azr4xgey&#34;&gt;TPC-DS connector&lt;/a&gt; for Glue.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/393/images/activate.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/393/images/activate_hu11961216322509352012.png&#34; width=&#34;450&#34; height=&#34;370&#34; alt=&#34;Activate TPC-DS connector for Glue&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Write a script like following. The scale is in GB, the same as Athena&amp;rsquo;s one.&#xA;Tables are added to a catalog at the time of upload.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Redshift Serverless and other serverless ETL services, run query with Glue Data Catalog</title>
      <link>https://www.sambaiz.net/en/article/392/</link>
      <pubDate>Sun, 26 Dec 2021 22:03:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/392/</guid>
      <description>&lt;h2 id=&#34;redshift-serverless&#34;&gt;Redshift Serverless&lt;/h2&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/redshift/redshift-serverless/&#34;&gt;Redshift Serverless&lt;/a&gt; is a new feature that can use Redshift, a petabyte-scale DWH without launching an instance, announced at this year&amp;rsquo;s re:Invent.&#xA;It is available existing features such as &lt;a href=&#34;https://docs.aws.amazon.com/redshift/latest/dg/c-using-spectrum.html&#34;&gt;Redshift Spectrum&lt;/a&gt;, refer to S3 directly, &lt;a href=&#34;https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/federated-overview.html&#34;&gt;Federated Query&lt;/a&gt; to RDS, and &lt;a href=&#34;https://docs.aws.amazon.com/redshift/latest/dg/machine_learning.html&#34;&gt;Redshift ML&lt;/a&gt;.&#xA;I&amp;rsquo;m happy with this update as it is costly to keep the instance running for occasional usage such as analytics.&lt;/p&gt;&#xA;&lt;p&gt;The &lt;a href=&#34;https://aws.amazon.com/redshift/pricing&#34;&gt;cost&lt;/a&gt; is charged for at least 1 minute &lt;a href=&#34;https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-serverless.html#serverless-considerations&#34;&gt;RPU&lt;/a&gt; time and storage. RPU is a resource unit that contains 2vCPU and 16GiB memory and scales automatically.&#xA;The rate is &lt;strong&gt;$0.45/RPU hour&lt;/strong&gt; in Oregon, whereas Tokyo is set relatively high at &lt;strong&gt;$0.70/RPU hour&lt;/strong&gt;.&#xA;Since dc2.large (2vCPU, 15 GiB memory) instance is &lt;strong&gt;$0.314/hour&lt;/strong&gt; on-demand in Tokyo, if the resource usage is not over 40% on average due to like infrequent use or irregularity, it seems that the cost can be suppressed.&#xA;If RI is applied to the maximum, the rate becomes &lt;strong&gt;$0.110/hour&lt;/strong&gt; so the threshold drop to 15%, but there is also an operational advantage that you do not have to worry about the scale. In addition, there is no charge for the load amount of Redshift Spectrum.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Generate data with TPC-DS Connector in Athena&#39;s Federated Query</title>
      <link>https://www.sambaiz.net/en/article/391/</link>
      <pubDate>Sat, 25 Dec 2021 23:55:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/391/</guid>
      <description>&lt;p&gt;Athena&amp;rsquo;s &lt;a href=&#34;https://docs.aws.amazon.com/athena/latest/ug/connect-to-a-data-source.html&#34;&gt;Federated Query&lt;/a&gt; is a feature to execute queries on non-S3 data sources such as DynamoDB and RDS through Lambda function which is a data sources connector.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/402/&#34;&gt;Implement Athena&amp;rsquo;s data source connectors and user defined functions (UDF) - sambaiz-net&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/391/images/datasource.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/391/images/datasource_hu17845722387085838377.png&#34; width=&#34;372&#34; height=&#34;370&#34; alt=&#34;Data sources&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;This article uses TPC-DS Connector in the &lt;a href=&#34;https://github.com/awslabs/aws-athena-query-federation/tree/master/athena-tpcds&#34;&gt;AWS official repository&lt;/a&gt;. It generates the data of &lt;a href=&#34;http://www.tpc.org/tpcds/&#34;&gt;TPC-DS&lt;/a&gt;, which is a database benchmark in Decision Support.&lt;/p&gt;&#xA;&lt;p&gt;Although it is in the official repository, it is a custom connector, so you need to build it yourself. Basically, you can do it according to &lt;a href=&#34;https://github.com/awslabs/aws-athena-query-federation/tree/master/athena-tpcds#readme&#34;&gt;README&lt;/a&gt;, but it fails to build in jdk16, so install jdk8.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Spark Web UI: Monitor Job Stages, Tasks distribution and SQL plan</title>
      <link>https://www.sambaiz.net/en/article/382/</link>
      <pubDate>Thu, 30 Sep 2021 13:00:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/382/</guid>
      <description>&lt;p&gt;Spark &lt;a href=&#34;https://spark.apache.org/docs/latest/web-ui.html&#34;&gt;Web UI&lt;/a&gt; is a tool for monitoring Jobs and Executors.&lt;/p&gt;&#xA;&lt;p&gt;Get Dockerfile that runs Spark based on maven:3.6-amazoncorretto-8 from &lt;a href=&#34;https://github.com/aws-samples/aws-glue-samples/tree/b76ad0583bdc66e9e5a903f9da3a953c9f6aac4f&#34;&gt;aws-glue-samples&lt;/a&gt;, and &lt;a href=&#34;https://docs.aws.amazon.com/glue/latest/dg/monitor-spark-ui-history.html#monitor-spark-ui-history-local&#34;&gt;start&lt;/a&gt; &lt;a href=&#34;https://spark.apache.org/docs/latest/monitoring.html&#34;&gt;History Server&lt;/a&gt; with the path of EventLog output by Glue and authentication information to get it.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;img_container&#34;&gt;&lt;a href=&#34;https://www.sambaiz.net/article/382/images/eventlog-settings.png&#34;&gt;&#xA;    &lt;img style=&#34;max-width: 100%; width: auto; height: auto;&#34; src=&#34;https://www.sambaiz.net/article/382/images/eventlog-settings_hu17683940079105328013.png&#34; width=&#34;385&#34; height=&#34;167&#34; alt=&#34;Output EventLog config&#34;&gt;&#xA;&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git clone https://github.com/aws-samples/aws-glue-samples.git&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; aws-glue-samples/utilities/Spark_UI/glue-3_0/&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ docker build -t glue/sparkui:latest .&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ docker run -it -e &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;SPARK_HISTORY_OPTS&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$SPARK_HISTORY_OPTS&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt; -Dspark.history.fs.logDirectory=s3a://path_to_eventlog &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-Dspark.hadoop.fs.s3a.access.key=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt; -Dspark.hadoop.fs.s3a.secret.key=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-p 18080:18080 glue/sparkui:latest &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/opt/spark/bin/spark-class org.apache.spark.deploy.history.HistoryServer&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, you can access http://localhost:18080 and select Application.&#xA;The timeline of executing Jobs and adding Executors is displayed.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Athena (Presto) and Glue (Spark) can return different values when running the same query</title>
      <link>https://www.sambaiz.net/en/article/370/</link>
      <pubDate>Sat, 03 Jul 2021 23:13:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/370/</guid>
      <description>&lt;p&gt;AWS has multiple managed services that aggregate with SQL-like queries.&#xA;If queries are executed ad-hoc, Presto-based Athena, which can quickly and easily query to tables in Glue&amp;rsquo;s data catalog, is handy, while if heavy queries are executed in batch, Spark-based Glue, which can avoid resource and time limitation, can be better. Therefore, they can be used properly depending on the case.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/en/article/392/&#34;&gt;Redshift Serverless and other serverless aggregation services, run query with Glue Data Catalog - sambaiz-net&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Enable Job Bookmark of AWS Glue to process from the records following ones executed previously</title>
      <link>https://www.sambaiz.net/en/article/333/</link>
      <pubDate>Fri, 16 Apr 2021 20:00:00 +0900</pubDate>
      <guid>https://www.sambaiz.net/en/article/333/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/glue/latest/dg/monitor-continuations.html&#34;&gt;Job Bookmark&lt;/a&gt; of AWS Glue is a feature that saves what records are processed, and prevent it from being executed next time.&#xA;Parquet and ORC, which were not supported before 1.0, are now supported.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/203/&#34;&gt;AWS GlueでCSVを加工しParquetに変換してパーティションを切りAthenaで参照する - sambaiz-net&lt;/a&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
