<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Check if there is a cycle in the undirected graph by Union-Find Tree - sambaiz-net</title>
  <meta name="twitter:title" content="Check if there is a cycle in the undirected graph by Union-Find Tree - sambaiz-net">
  <meta property='og:title' content="Check if there is a cycle in the undirected graph by Union-Find Tree - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="Unite sets and check if two elements are in the same set efficiently">
  <meta name="twitter:description" content="Unite sets and check if two elements are in the same set efficiently">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/390/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/390/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/390/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/390/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Check if there is a cycle in the undirected graph by Union-Find Tree",
    "datePublished": "2021-12-12T16:39:00JST",
    "dateModified": "2021-12-12T16:39:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "Unite sets and check if two elements are in the same set efficiently"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/390/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Check if there is a cycle in the undirected graph by Union-Find Tree</h1>
        <time>2021-12-12</time>
        <a class="tag" href='/en/tags/c&#43;&#43;/'>c&#43;&#43;</a><a class="tag" href='/en/tags/algorithm/'>algorithm</a>
      </div>
      <h2 id="union-find-tree">Union-Find Tree</h2>
<p>Union-Find Tree is a data structure having some disjoint sets and can do &ldquo;Union&rdquo; which merges two sets, and &ldquo;Find&rdquo; which checks if two elements are in the same set with amortized O(α(n)) (α(n) is an inverse <a href="https://en.wikipedia.org/wiki/Ackermann_function">Ackermann function</a> and smaller than log(n)).</p>
<p>&ldquo;Union&rdquo; connects the tree with the smaller rank to under side so that merged tree will be in equilibrium as much as possible.
The rank of one element tree is 0, and when trees of the same rank are merged, merged tree&rsquo;s rank is the original rank + 1.
&ldquo;Find&rdquo; compares the root values and after that reconnects checked nodes with the root so that enable efficient processing from the next time onward.</p>




<div class="img_container"><a href="/article/390/images/union-find-tree.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/390/images/union-find-tree_hu7456172090064353808.png" width="530" height="370" alt="Union-Find Tree, Union and Find">
</a></div>


<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;bits/stdc++.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#ff79c6">using</span> <span style="color:#ff79c6">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">union_find_tree</span> {
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> parent;
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> rank;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>    union_find_tree(vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> values) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">for</span>(<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> values.size(); i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>        parent[values[i]] <span style="color:#ff79c6">=</span> values[i];
</span></span><span style="display:flex;"><span>        rank[values[i]] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">find</span>(<span style="color:#8be9fd">int</span> x) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (parent[x] <span style="color:#ff79c6">==</span> x) <span style="color:#ff79c6">return</span> x;
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd">int</span> root <span style="color:#ff79c6">=</span> find(parent[x]);
</span></span><span style="display:flex;"><span>      parent[x] <span style="color:#ff79c6">=</span> root;
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> root;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">unite</span>(<span style="color:#8be9fd">int</span> x, <span style="color:#8be9fd">int</span> y) {
</span></span><span style="display:flex;"><span>      x <span style="color:#ff79c6">=</span> find(x);
</span></span><span style="display:flex;"><span>      y <span style="color:#ff79c6">=</span> find(y);
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (x <span style="color:#ff79c6">==</span> y) <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (rank[x] <span style="color:#ff79c6">&gt;</span> rank[y]) {
</span></span><span style="display:flex;"><span>        parent[y] <span style="color:#ff79c6">=</span> x;
</span></span><span style="display:flex;"><span>      } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>        parent[x] <span style="color:#ff79c6">=</span> y;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (rank[x] <span style="color:#ff79c6">==</span> rank[y]) rank[y]<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">bool</span> <span style="color:#50fa7b">same</span>(<span style="color:#8be9fd">int</span> x, <span style="color:#8be9fd">int</span> y) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> find(x) <span style="color:#ff79c6">==</span> find(y);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">auto</span> tree <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> union_find_tree({<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">3</span>,<span style="color:#bd93f9">4</span>,<span style="color:#bd93f9">5</span>,<span style="color:#bd93f9">6</span>});
</span></span><span style="display:flex;"><span>  tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>);
</span></span><span style="display:flex;"><span>  tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>);
</span></span><span style="display:flex;"><span>  tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">5</span>);
</span></span><span style="display:flex;"><span>  tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">6</span>);
</span></span><span style="display:flex;"><span>  cout <span style="color:#ff79c6">&lt;&lt;</span> tree<span style="color:#ff79c6">-&gt;</span>same(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">5</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">5</span>);
</span></span><span style="display:flex;"><span>  cout <span style="color:#ff79c6">&lt;&lt;</span> tree<span style="color:#ff79c6">-&gt;</span>same(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">5</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span></code></pre></div><h2 id="check-if-there-is-a-cycle-in-the-undirected-graph-by-union-find-tree">Check if there is a cycle in the undirected graph by Union-Find Tree</h2>
<p>If you put edges of the graph into Union-Find Tree, nodes which can be already reached each other belongs to the same set, so it is possible to check whether or not a cycle will be created before creating a new edge.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">auto</span> tree <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> union_find_tree({<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">3</span>});
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>tree<span style="color:#ff79c6">-&gt;</span>same(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>)) tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>tree<span style="color:#ff79c6">-&gt;</span>same(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>)) tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>tree<span style="color:#ff79c6">-&gt;</span>same(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">1</span>)) tree<span style="color:#ff79c6">-&gt;</span>unite(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">1</span>); <span style="color:#6272a4">// detects the creation of a cycle
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span></code></pre></div><p>This is used in Kruskal&rsquo;s algorithm to create a minimum spanning tree, which is a connected graph with the smallest sum of costs, by sorting the edges in ascending order of cost and connecting those which does not make a cycle.</p>
<p>&ldquo;Union&rdquo; and &ldquo;Find&rdquo; are done per edge so let the number of edges be |E|, and the number of nodes be |V|, this algorithm is O((|E|+|V|)α(|V|)).
Searching a cycle with DFS or BFS is O(|E|+|V|) so it looks slower but the influence of α(|V|) is very small so these are nearly same.</p>
<h2 id="references">References</h2>
<p><a href="https://book.mynavi.jp/ec/products/detail/id=22672">プログラミングコンテストチャレンジブック [第2版]</a></p>
<p><a href="https://en.wikipedia.org/wiki/Disjoint-set_data_structure">Disjoint-set data structure - Wikipedia</a></p>
<p><a href="https://cs.stackexchange.com/questions/47596/dfs-vs-union-find-for-computing-connected-components-of-a-static-graph">runtime analysis - DFS vs. Union Find for computing connected components of a static graph - Computer Science Stack Exchange</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>