<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Calling Cloud Run functions from BigQuery to process data using any libraries and services - sambaiz-net</title>
  <meta name="twitter:title" content="Calling Cloud Run functions from BigQuery to process data using any libraries and services - sambaiz-net">
  <meta property='og:title' content="Calling Cloud Run functions from BigQuery to process data using any libraries and services - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="In addition to User-defined functions that can be defined in SQL or JavaScript, BigQuery has remote functions that, similar to Athena’s UDF, can call Cloud Run and Cloud Run functions (formerly Cloud Functions 2nd gen), allowing you to process data using any library or service">
  <meta name="twitter:description" content="In addition to User-defined functions that can be defined in SQL or JavaScript, BigQuery has remote functions that, similar to Athena’s UDF, can call Cloud Run and Cloud Run functions (formerly Cloud Functions 2nd gen), allowing you to process data using any library or service">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/522/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/522/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/522/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/522/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Calling Cloud Run functions from BigQuery to process data using any libraries and services",
    "datePublished": "2025-01-21T23:55:00JST",
    "dateModified": "2025-01-21T23:55:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "In addition to User-defined functions that can be defined in SQL or JavaScript, BigQuery has remote functions that, similar to Athena’s UDF, can call Cloud Run and Cloud Run functions (formerly Cloud Functions 2nd gen), allowing you to process data using any library or service"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/522/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Calling Cloud Run functions from BigQuery to process data using any libraries and services</h1>
        <time>2025-01-21</time>
        <a class="tag" href='/en/tags/gcp/'>gcp</a><a class="tag" href='/en/tags/terraform/'>terraform</a>
      </div>
      <p>In addition to <a href="https://cloud.google.com/bigquery/docs/user-defined-functions">User-defined functions</a> that can be defined in SQL or JavaScript, BigQuery has <a href="https://cloud.google.com/bigquery/docs/remote-functions">remote functions</a> that, similar to Athena’s UDF, can call Cloud Run and Cloud Run functions (<a href="https://cloud.google.com/blog/products/serverless/google-cloud-functions-is-now-cloud-run-functions?hl=en">formerly Cloud Functions 2nd gen</a>), allowing you to process data using any library or service.</p>
<p><a href="https://www.sambaiz.net/en/article/402/">Implement Athena&rsquo;s data source connectors and user defined functions (UDF) - sambaiz-net</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FUNCTION</span> (project).(dataset).<span style="color:#ff79c6">add</span>(x FLOAT64, y FLOAT64)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">RETURNS</span> FLOAT64
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LANGUAGE</span> js
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> r<span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  return x+y;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FUNCTION</span> (project).(dataset).remote_add(x INT64, y INT64)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">RETURNS</span> INT64
</span></span><span style="display:flex;"><span>REMOTE <span style="color:#ff79c6">WITH</span> (project).us.my_connection
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">OPTIONS</span> (
</span></span><span style="display:flex;"><span>  endpoint <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;ENDPOINT_URL&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Implement an API that receives <a href="https://cloud.google.com/bigquery/docs/remote-functions">input</a> as calls and <a href="https://cloud.google.com/bigquery/docs/remote-functions">returns</a> values as replies.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> remote_add
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;github.com/GoogleCloudPlatform/functions-framework-go/functions&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">init</span>() {
</span></span><span style="display:flex;"><span>	functions.<span style="color:#50fa7b">HTTP</span>(<span style="color:#f1fa8c">&#34;RemoteAdd&#34;</span>, RemoteAdd)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">RemoteAdd</span>(w http.ResponseWriter, r <span style="color:#ff79c6">*</span>http.Request) {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> requestData <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>		Calls [][]<span style="color:#8be9fd">int64</span> <span style="color:#f1fa8c">`json:&#34;calls&#34;`</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> json.<span style="color:#50fa7b">NewDecoder</span>(r.Body).<span style="color:#50fa7b">Decode</span>(<span style="color:#ff79c6">&amp;</span>requestData); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		http.<span style="color:#50fa7b">Error</span>(w, <span style="color:#f1fa8c">&#34;Invalid JSON&#34;</span>, http.StatusBadRequest)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	replies <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">make</span>([]<span style="color:#8be9fd">int64</span>, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(requestData.Calls))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> _, call <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> requestData.Calls {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(call) <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">2</span> {
</span></span><span style="display:flex;"><span>			http.<span style="color:#50fa7b">Error</span>(w, <span style="color:#f1fa8c">&#34;Invalid num of args&#34;</span>, http.StatusBadRequest)
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		replies = <span style="color:#8be9fd;font-style:italic">append</span>(replies, call[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">+</span>call[<span style="color:#bd93f9">1</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	responseData <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">map</span>[<span style="color:#8be9fd">string</span>]<span style="color:#8be9fd;font-style:italic">interface</span>{}{
</span></span><span style="display:flex;"><span>		<span style="color:#f1fa8c">&#34;replies&#34;</span>: replies,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	w.<span style="color:#50fa7b">Header</span>().<span style="color:#50fa7b">Set</span>(<span style="color:#f1fa8c">&#34;Content-Type&#34;</span>, <span style="color:#f1fa8c">&#34;application/json&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> json.<span style="color:#50fa7b">NewEncoder</span>(w).<span style="color:#50fa7b">Encode</span>(responseData); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		http.<span style="color:#50fa7b">Error</span>(w, <span style="color:#f1fa8c">&#34;Failed to encode response&#34;</span>, http.StatusInternalServerError)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://cloud.google.com/sdk/gcloud/reference/functions/deploy">Deploy</a> to the <a href="https://cloud.google.com/bigquery/docs/remote-functions">same region</a> as BigQuery.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> $ gcloud functions deploy remote-add-function <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --gen2 <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --runtime<span style="color:#ff79c6">=</span>go122 <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --region<span style="color:#ff79c6">=</span>us-central1 <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --source<span style="color:#ff79c6">=</span>. <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --entry-point<span style="color:#ff79c6">=</span>RemoteAdd <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --trigger-http <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --ingress-settings<span style="color:#ff79c6">=</span>internal-only
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>url: https://us-central1-*****.cloudfunctions.net/remote-add-function
</span></span></code></pre></div><p>Create a <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_connection">google_bigquery_connection</a> and define the function using <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_routine">google_bigquery_routine</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-tf" data-lang="tf"><span style="display:flex;"><span><span style="color:#ff79c6">variable</span> <span style="color:#f1fa8c">&#34;project_id&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">type</span> = string
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">variable</span> <span style="color:#f1fa8c">&#34;region&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">type</span> = string
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">variable</span> <span style="color:#f1fa8c">&#34;dataset_id&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">type</span> = string
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">variable</span> <span style="color:#f1fa8c">&#34;function_endpoint&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">type</span> = string
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">provider</span> <span style="color:#f1fa8c">&#34;google&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">project</span> = <span style="color:#8be9fd;font-style:italic">var</span>.project_id
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">region</span>  = <span style="color:#8be9fd;font-style:italic">var</span>.region
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">resource</span> <span style="color:#f1fa8c">&#34;google_bigquery_connection&#34;</span> <span style="color:#f1fa8c">&#34;my_connection&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">connection_id</span> = <span style="color:#f1fa8c">&#34;my_connection&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">location</span>      = <span style="color:#f1fa8c">&#34;US&#34;</span>
</span></span><span style="display:flex;"><span>  cloud_resource {}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">resource</span> <span style="color:#f1fa8c">&#34;google_bigquery_routine&#34;</span> <span style="color:#f1fa8c">&#34;remote_function&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">dataset_id</span>      = <span style="color:#8be9fd;font-style:italic">var</span>.<span style="color:#8be9fd;font-style:italic">data</span>set_id
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">routine_id</span>      = <span style="color:#f1fa8c">&#34;remote_add&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">routine_type</span>    = <span style="color:#f1fa8c">&#34;SCALAR_FUNCTION&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">definition_body</span> = <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  arguments {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">name</span>      = <span style="color:#f1fa8c">&#34;X&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">data_type</span> = <span style="color:#f1fa8c">&#34;{</span>\<span style="color:#f1fa8c">&#34;</span>typeKind\<span style="color:#f1fa8c">&#34;: </span>\<span style="color:#f1fa8c">&#34;</span>INT64\<span style="color:#f1fa8c">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  arguments {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">name</span>      = <span style="color:#f1fa8c">&#34;Y&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">data_type</span> = <span style="color:#f1fa8c">&#34;{</span>\<span style="color:#f1fa8c">&#34;</span>typeKind\<span style="color:#f1fa8c">&#34;: </span>\<span style="color:#f1fa8c">&#34;</span>INT64\<span style="color:#f1fa8c">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">return_type</span> = <span style="color:#f1fa8c">&#34;{</span>\<span style="color:#f1fa8c">&#34;</span>typeKind\<span style="color:#f1fa8c">&#34; :  </span>\<span style="color:#f1fa8c">&#34;</span>INT64\<span style="color:#f1fa8c">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  remote_function_options {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">endpoint</span>          = <span style="color:#8be9fd;font-style:italic">var</span>.function_endpoint
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">connection</span>        = google_bigquery_connection.my_connection.name
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">max_batching_rows</span> = <span style="color:#f1fa8c">&#34;10&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Call the function.</p>




<div class="img_container"><a href="/article/522/images/query.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/522/images/query_hu_f77236a68ed4aefa.png" width="600" height="307" alt="Query">
</a></div>



    </div>
  </article>
</div>

</div>
</body>

</html>