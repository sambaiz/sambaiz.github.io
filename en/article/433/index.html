<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>The Scheduler which allocates resources in Hadoop YARN, and Dominant Resource Fairness (DRF) - sambaiz-net</title>
  <meta name="twitter:title" content="The Scheduler which allocates resources in Hadoop YARN, and Dominant Resource Fairness (DRF) - sambaiz-net">
  <meta property='og:title' content="The Scheduler which allocates resources in Hadoop YARN, and Dominant Resource Fairness (DRF) - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="DominantResourceCalculator compares resources that have a larger share, so it treats CPU shares for CPU-heavy tasks as equal to memory shares for memory-heavy tasks">
  <meta name="twitter:description" content="DominantResourceCalculator compares resources that have a larger share, so it treats CPU shares for CPU-heavy tasks as equal to memory shares for memory-heavy tasks">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/433/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/433/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/433/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/433/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "The Scheduler which allocates resources in Hadoop YARN, and Dominant Resource Fairness (DRF)",
    "datePublished": "2022-12-24T22:15:00JST",
    "dateModified": "2022-12-24T22:15:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "DominantResourceCalculator compares resources that have a larger share, so it treats CPU shares for CPU-heavy tasks as equal to memory shares for memory-heavy tasks"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/433/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>The Scheduler which allocates resources in Hadoop YARN, and Dominant Resource Fairness (DRF)</h1>
        <time>2022-12-24</time>
        <a class="tag" href='/en/tags/hadoop/'>hadoop</a><a class="tag" href='/en/tags/paper/'>paper</a><a class="tag" href='/en/tags/algorithm/'>algorithm</a>
      </div>
      <p>YARN&rsquo;s ResourceManager consists of ApplicationsManager, which receives applications from clients and launches ApplicationMaster, and <a href="https://github.com/apache/hadoop/blob/release-3.3.5-RC0/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/YarnScheduler.java">Scheduler</a>, which receives requests from ApplicationMaster and allocates resources.</p>
<p><a href="https://www.sambaiz.net/en/article/427/">How Hadoop YARN allocates resources to applications and check how much resources are allocated - sambaiz-net</a></p>
<h2 id="scheduler">Scheduler</h2>
<p>Scheduler has <a href="https://github.com/apache/hadoop/tree/release-3.3.5-RC0/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler">implementations</a>
such as <a href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html">CapacityScheduler</a>, which aims to maximize the throughput in multi-tenant clusters, and
<a href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/FairScheduler.html">FairScheduler</a>, which allocates fair resources to all applications.
You can choose to use which one with yarn.resourcemanager.scheduler.class, and CapacityScheduler is used in EMR by default.</p>
<h2 id="resourcecalculator">ResourceCalculator</h2>
<p>CapacityScheduler has settings for <a href="https://github.com/apache/hadoop/blob/release-3.3.5-RC0/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/util/resource/ResourceCalculator.java#L31">ResourceCalculator</a>, which calculates the amount of allocated resources, and it seems to determine the allocation of resources.
Whereas DefaultResourceCalculator, which is used by default, watches only the <a href="https://github.com/apache/hadoop/blob/release-3.3.5-RC0/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/util/resource/DefaultResourceCalculator.java#L43">memory</a>,
DominantResourceCalculator watches <a href="https://github.com/apache/hadoop/blob/3262495904d1af03f0f8c77aba69fea6e3122b64/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/util/resource/DominantResourceCalculator.java#L214">resources that have a larger share</a>, so it attempts to equalize CPU shares for CPU-heavy tasks and memory shares for memory-heavy tasks.
This resource allocation method is called Dominant Resource Fairness (DRF).</p>
<h2 id="dominant-resource-fairness-fair-allocation-of-multiple-resource-types-ghodsi-et-al-2011"><a href="https://cs.stanford.edu/~matei/papers/2011/nsdi_drf.pdf">Dominant Resource Fairness: Fair Allocation of Multiple Resource Types, Ghodsi et al. (2011)</a></h2>
<p>The paper introduces Asset Fairness and Competitive Equilibrium from Equal Income (CEEI) as other methods and compares them from the following viewpoints.</p>
<ul>
<li>Sharing incentive: Should user be better to share resources rather than own exclusively?</li>
<li>Strategy-proofness: Are there benefits for users to lie about their needs?</li>
<li>Envy-freeness: Aren&rsquo;t resources allocated in preference to other users?</li>
<li>Pareto efficiency: Can&rsquo;t users increase their amounts without reducing the amounts for other users?</li>
</ul>
<p>Asset Fairness is a method that treats different resources such as CPU, memory usage, bandwidth, etc.
In the following cases, User2 would be better off occupying half the resources and not fulfilling the Sharing incentive.</p>
<p>Asset Fairness treats different resources such as CPU, memory usage, and bandwidth as the same one, and balances the sum.
In the following cases, User2 would be better off occupying half the resources, so this method violates Sharing incentive.</p>
<ul>
<li>The amount of each resource is (30, 30) and there are 2 users</li>
<li>User1&rsquo;s task needs (1, 3) resources -&gt; 3 tasks (6, 18) are allocated</li>
<li>User2&rsquo;s task needs (1, 1) resources -&gt; 12 tasks (12, 12) are allocated</li>
</ul>
<p>CEEI is a method that users receive equal resources and then negotiate with others to determine amounts through the Nash bargaining solution.
This method violates Strategy-proofness in the following cases.</p>
<ul>
<li>Total amount of each resource is (100, 100) and there are 2 users</li>
<li>User1&rsquo;s task needs (16, 1) resources -&gt; 100/31 = 3.2 tasks are allocated</li>
<li>User2&rsquo;s task needs (1, 2) resources -&gt; 1500/31 = 48.8 tasks are allocated</li>
<li>If User1 lies and says the task needs (16, 8) resources, 25/6 = 4.2 tasks are allocated</li>
</ul>
<p>On the other hand, DRF doesn&rsquo;t violate all viewpoints, and the result that it succeeded to use any resources efficiently compared to per fixed-size-slot allocation, is shown.</p>
<h2 id="references">References</h2>
<p><a href="https://aws.amazon.com/jp/blogs/big-data/configure-hadoop-yarn-capacityscheduler-on-amazon-emr-on-amazon-ec2-for-multi-tenant-heterogeneous-workloads/">Configure Hadoop YARN CapacityScheduler on Amazon EMR on Amazon EC2 for multi-tenant heterogeneous workloads | AWS Big Data Blog</a></p>
<p><a href="https://qiita.com/Lewuathe/items/9552407619c045b119df">Dominant Resource Fairness on YARN - Qiita</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>