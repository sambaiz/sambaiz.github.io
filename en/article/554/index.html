<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }

    .single ol {
        list-style-type: decimal;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Share Python Packages Across Multiple SAM Projects in the Same Repository - sambaiz-net</title>
  <meta name="twitter:title" content="Share Python Packages Across Multiple SAM Projects in the Same Repository - sambaiz-net">
  <meta property='og:title' content="Share Python Packages Across Multiple SAM Projects in the Same Repository - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="Exploring ways to share Python packages across multiple SAM projects.">
  <meta name="twitter:description" content="Exploring ways to share Python packages across multiple SAM projects.">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/554/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/554/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/554/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/554/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Share Python Packages Across Multiple SAM Projects in the Same Repository",
    "datePublished": "2025-12-30T19:07:00JST",
    "dateModified": "2025-12-30T19:07:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "Exploring ways to share Python packages across multiple SAM projects."
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/554/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="/places/">
            <img src="/image/pin.svg" width="32px" height="32px" alt="places">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Share Python Packages Across Multiple SAM Projects in the Same Repository</h1>
        <time>2025-12-30</time>
        <a class="tag" href='/en/tags/aws/'>aws</a><a class="tag" href='/en/tags/python/'>python</a>
      </div>
      <p>Exploring ways to share Python packages across multiple SAM projects.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ tree .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── project1
</span></span><span style="display:flex;"><span>│   ├── <span style="color:#ff79c6">function</span>
</span></span><span style="display:flex;"><span>│   │   ├── app.py
</span></span><span style="display:flex;"><span>│   │   └── requirements.txt
</span></span><span style="display:flex;"><span>│   └── template.yaml
</span></span><span style="display:flex;"><span>├── project2
</span></span><span style="display:flex;"><span>│   ├── <span style="color:#ff79c6">function</span>
</span></span><span style="display:flex;"><span>│   │   ├── app.py
</span></span><span style="display:flex;"><span>│   │   └── requirements.txt
</span></span><span style="display:flex;"><span>│   └── template.yaml
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>└── mylib
</span></span><span style="display:flex;"><span>    └── mylib.py
</span></span></code></pre></div><p>Considering packaging during deployment, one approach is to copy the shared package directory into each project. By specifying <code>BuildMethod: makefile</code>, the <a href="https://github.com/aws/aws-lambda-builders/blob/v1.51.0/aws_lambda_builders/workflows/custom_make/workflow.py">CustomMakeWorkflow</a> <a href="https://github.com/aws/aws-lambda-builders/blob/v1.51.0/aws_lambda_builders/workflows/custom_make/workflow.py#L65">copies</a> the function code to ARTIFACTS_DIR during build and calls <a href="https://github.com/aws/aws-lambda-builders/blob/v1.51.0/aws_lambda_builders/workflows/custom_make/actions.py#L102">make build-{logicalId}</a>, allowing this to be automated. Note that to reference the parent directory with a relative path, you need to pass the &ndash;build-in-source flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cat template.yaml
</span></span><span style="display:flex;"><span>AWSTemplateFormatVersion: <span style="color:#f1fa8c">&#39;2010-09-09&#39;</span>
</span></span><span style="display:flex;"><span>Transform: AWS::Serverless-2016-10-31
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Resources:
</span></span><span style="display:flex;"><span>  TestFunction:
</span></span><span style="display:flex;"><span>    Type: AWS::Serverless::Function
</span></span><span style="display:flex;"><span>    Properties:
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>    Metadata:
</span></span><span style="display:flex;"><span>      BuildMethod: makefile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#ff79c6">function</span>/Makefile
</span></span><span style="display:flex;"><span>build-TestFunction:
</span></span><span style="display:flex;"><span>    pip install -r requirements.txt -t <span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>ARTIFACTS_DIR<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    cp -r ../../mylib <span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>ARTIFACTS_DIR<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">/&#34;</span>
</span></span></code></pre></div><p>This method has some drawbacks: the imported package cannot be found during development, and if the shared code has dependencies, they must be managed by the caller, making it fragile to changes. It&rsquo;s preferable to create a pyproject.toml and use pip install. Note that the default <a href="https://github.com/aws/aws-lambda-builders/blob/v1.51.0/aws_lambda_builders/workflows/python_pip/workflow.py">PythonPipWorkflow</a> doesn&rsquo;t support &ndash;build-in-source, so BuildMethod: makefile is still necessary.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>$ cat mylib/pyproject.toml
</span></span><span style="display:flex;"><span>[build-system]
</span></span><span style="display:flex;"><span>requires = [<span style="color:#f1fa8c">&#34;setuptools&gt;=61.0&#34;</span>]
</span></span><span style="display:flex;"><span>build-backend = <span style="color:#f1fa8c">&#34;setuptools.build_meta&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[project]
</span></span><span style="display:flex;"><span>name = <span style="color:#f1fa8c">&#34;mylib&#34;</span>
</span></span><span style="display:flex;"><span>version = <span style="color:#f1fa8c">&#34;0.1.0&#34;</span>
</span></span><span style="display:flex;"><span>dependencies = [
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;numpy&gt;=1.24.0,&lt;2.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Unfortunately, installing via relative paths doesn&rsquo;t work with sam build &ndash;use-container since the parent directory isn&rsquo;t mounted to the container. Another approach is to pip install from a Git repository.
Using pip install git+(repository) clones the repository and installs the library from the directory specified with #subdirectory=.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ <span style="color:#8be9fd;font-style:italic">cd</span> example-app
</span></span><span style="display:flex;"><span>$ cat requirements.txt
</span></span><span style="display:flex;"><span>git+https://github.com/sambaiz/pip-install-from-git-test.git@main#subdirectory<span style="color:#ff79c6">=</span>stats-lib
</span></span><span style="display:flex;"><span>git+https://github.com/sambaiz/pip-install-from-git-test.git@main#subdirectory<span style="color:#ff79c6">=</span>text-lib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ pip install -r requirements.txt
</span></span><span style="display:flex;"><span>Collecting git+https://github.com/sambaiz/pip-install-from-git-test.git@main#subdirectory<span style="color:#ff79c6">=</span>stats-lib <span style="color:#ff79c6">(</span>from -r requirements.txt <span style="color:#ff79c6">(</span>line 1<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>  Cloning https://github.com/sambaiz/pip-install-from-git-test.git <span style="color:#ff79c6">(</span>to revision main<span style="color:#ff79c6">)</span> to /tmp/pip-req-build-rss0j5g6
</span></span><span style="display:flex;"><span>  Running <span style="color:#8be9fd;font-style:italic">command</span> git clone --filter<span style="color:#ff79c6">=</span>blob:none --quiet https://github.com/sambaiz/pip-install-from-git-test.git /tmp/pip-req-build-rss0j5g6
</span></span><span style="display:flex;"><span>  Resolved https://github.com/sambaiz/pip-install-from-git-test.git to commit 605fa82f41ecf763308190fb6b0ae5113c05d893
</span></span><span style="display:flex;"><span>  Installing build dependencies ... <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>  Getting requirements to build wheel ... <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>  Preparing metadata <span style="color:#ff79c6">(</span>pyproject.toml<span style="color:#ff79c6">)</span> ... <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>Collecting git+https://github.com/sambaiz/pip-install-from-git-test.git@main#subdirectory<span style="color:#ff79c6">=</span>text-lib <span style="color:#ff79c6">(</span>from -r requirements.txt <span style="color:#ff79c6">(</span>line 2<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>  Cloning https://github.com/sambaiz/pip-install-from-git-test.git <span style="color:#ff79c6">(</span>to revision main<span style="color:#ff79c6">)</span> to /tmp/pip-req-build-ivwe3ami
</span></span><span style="display:flex;"><span>  Running <span style="color:#8be9fd;font-style:italic">command</span> git clone --filter<span style="color:#ff79c6">=</span>blob:none --quiet https://github.com/sambaiz/pip-install-from-git-test.git /tmp/pip-req-build-ivwe3ami
</span></span><span style="display:flex;"><span>  Resolved https://github.com/sambaiz/pip-install-from-git-test.git to commit 605fa82f41ecf763308190fb6b0ae5113c05d893
</span></span><span style="display:flex;"><span>  Installing build dependencies ... <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>  Getting requirements to build wheel ... <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>  Preparing metadata <span style="color:#ff79c6">(</span>pyproject.toml<span style="color:#ff79c6">)</span> ... <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>Requirement already satisfied: numpy&gt;<span style="color:#ff79c6">=</span>1.24.0 in ./venv/lib/python3.14/site-packages <span style="color:#ff79c6">(</span>from stats-lib<span style="color:#ff79c6">==</span>0.1.0-&gt;-r requirements.txt <span style="color:#ff79c6">(</span>line 1<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">(</span>2.4.0<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><p>Even for the same repository, cloning is required, and when using this in CI/CD, you need to grant appropriate permissions, but this approach still works even if moved to a different repository. If you plan to do so, using an external repository like <a href="https://aws.amazon.com/codeartifact">CodeArtifact</a> is also an option.</p>
<p>Alternatively, you could use a Lambda Layer. sam local invoke works as-is. However, since you still need to pip install during development and testing, it may not be much different from other approaches. While using relative paths works, it makes it difficult to fix the version of shared code. Ideally, you&rsquo;d be better to specify release versions rather than relative paths. From there, whether to deploy each project with the shared code included or share a Lambda Layer is a choice that doesn&rsquo;t matter much unless the size becomes large.</p>
<p><a href="https://www.sambaiz.net/article/232/">Lambda Layerでバイナリやライブラリを切り出す - sambaiz-net</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">Resources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">MyLibLayer</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Type</span>: AWS::Serverless::LayerVersion
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Properties</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">LayerName</span>: mylib-layer
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">ContentUri</span>: ../mylib/
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">CompatibleRuntimes</span>:
</span></span><span style="display:flex;"><span>        - python3.11
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">BuildMethod</span>: makefile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">TestFunction</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Type</span>: AWS::Serverless::Function
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Properties</span>:
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">Layers</span>:
</span></span><span style="display:flex;"><span>        - !Ref MyLibLayer
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">BuildMethod</span>: makefile
</span></span></code></pre></div>
    </div>
  </article>
</div>

</div>
</body>

</html>