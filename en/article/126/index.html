<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>What is HDFS(Hadoop Distributed File System) - sambaiz-net</title>
  <meta name="twitter:title" content="What is HDFS(Hadoop Distributed File System) - sambaiz-net">
  <meta property='og:title' content="What is HDFS(Hadoop Distributed File System) - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="It distributes the disk I/O, which is a big problem when the data size is enormous and makes a block size, a unit for reading and writing, big to reduce the seek cost and improve the throughput">
  <meta name="twitter:description" content="It distributes the disk I/O, which is a big problem when the data size is enormous and makes a block size, a unit for reading and writing, big to reduce the seek cost and improve the throughput">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/126/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/126/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/126/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/126/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "What is HDFS(Hadoop Distributed File System)",
    "datePublished": "2017-08-14T22:52:00JST",
    "dateModified": "2017-08-14T22:52:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "It distributes the disk I/O, which is a big problem when the data size is enormous and makes a block size, a unit for reading and writing, big to reduce the seek cost and improve the throughput"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/126/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>What is HDFS(Hadoop Distributed File System)</h1>
        <time>2017-08-14</time>
        <a class="tag" href='/en/tags/hadoop/'>hadoop</a>
      </div>
      <h2 id="what-is-hdfs">What is HDFS</h2>
<p>HDFS stands for Hadoop Distributed File System, one of the implementations of file systems for Hadoop, and other implementations include local files and S3. It distributes the disk I/O, which is a big problem when the data size is enormous and makes a block size, a unit for reading and writing, big to reduce the seek cost and improve the throughput.</p>
<p>You can see disk I/O can be a bottleneck from <a href="https://gist.github.com/jboner/2841832">the data</a> that while communication within the data center takes about 0.5ms for a round trip, seeking takes 10ms, and reading 1MB takes 20ms.</p>
<p>HDFS is not good at handling many files because 150 bytes of metadata per file is allocated in the memory of NameNode. Besides, files can only be appended data.</p>
<h3 id="namenode-and-datanode">NameNode and DataNode</h3>
<p>The cluster has <strong>DataNodes</strong>, which have distributed blocks, and per namespace, a <strong>NameNode</strong>, which manages which DataNode has blocks of a file. NameNode has <strong>fsimage</strong>, which is a snapshot of file&rsquo;s metadata, and <strong>edit log</strong>, which haven&rsquo;t yet contained in fsimage. Edit log is periodically merged to fsimage by <strong>Secondary NameNode</strong>.</p>
<p>If NameNode is down, any data can&rsquo;t be read and written, so it needs to start a new NameNode.
At that time, the state is recovered with applying edit log to fsimage, so these files should be backuped to prevent from losing.</p>
<p>It can take over 30 minutes to start a NameNode if the cluster is big, so <strong>Standby NameNode</strong> can be placed instead of Secondary NameNode to improve the availability. Standby NameNode share edit log on a shared storage with NameNode, and the latest state is on memory, so it can be switched within a few tens of seconds after it is determined that the NameNode is dead.</p>
<h2 id="write-and-read">Write and read</h2>
<h3 id="write">Write</h3>
<p>File system ommunicates with NameNode to check the file exists and have permissions, and if there is no problem, returns FSDataOutputStream to the client. First, written data is put into a queue, and then <strong>DataStreamer</strong> selects which DataNodes are written with communicating with NameNode. The number of replica settings DataNodes are selected, and a pipeline is created between the DataNodes to write data in order. If succeeded, an ack packet is returned from each DetaNode, so put it into an ack queue and wait for ack packets to be returned from all DataNodes. If some DataNodes fails, erase the written data, remove it from the pipeline, and create a new pipeline.</p>
<h3 id="read">Read</h3>
<p>File system asks NameNode where blocks of the file is.
NameNode sorts DataNode having blocks in order of closeness on the network topology and returns the address of neareset one.
After that, file system returns FSDataInputStream containing the address to the client, and it reads data.</p>
<h2 id="start-on-singlenode-clusterhttphadoopapacheorgdocscurrenthadoop-project-disthadoop-commonsingleclusterhtml"><a href="http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/SingleCluster.html">Start on SingleNode Cluster</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ yum --enablerepo=epel -y install pdsh
</span></span><span style="display:flex;"><span>$ echo $JAVA_HOME
</span></span><span style="display:flex;"><span>/usr/lib/jvm/jre
</span></span><span style="display:flex;"><span>$ wget http://ftp.jaist.ac.jp/pub/apache/hadoop/common/hadoop-2.7.3/hadoop-2.7.3.tar.gz
</span></span><span style="display:flex;"><span>$ tar xvzf hadoop-2.7.3.tar.gz 
</span></span><span style="display:flex;"><span>$ cd hadoop-2.7.3
</span></span><span style="display:flex;"><span>$ bin/hadoop version
</span></span><span style="display:flex;"><span>Hadoop 2.7.3
</span></span></code></pre></div><p>Set the default file system to HDFS and the replica to 1.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>$ vi etc/hadoop/core-site.xml
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;configuration.xsl&#34;?&gt;</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;name&gt;</span>fs.defaultFS<span style="color:#ff79c6">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;value&gt;</span>hdfs://localhost:9000<span style="color:#ff79c6">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi etc/hadoop/hdfs-site.xml
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;configuration.xsl&#34;?&gt;</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;name&gt;</span>dfs.replication<span style="color:#ff79c6">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;value&gt;</span>1<span style="color:#ff79c6">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>Allow ssh to start/stop the Hadoop daemon.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ssh-keygen -t rsa -P &#39;&#39; -f ~/.ssh/id_rsa
</span></span><span style="display:flex;"><span>$ cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</span></span><span style="display:flex;"><span>$ chmod 0600 ~/.ssh/authorized_keys
</span></span><span style="display:flex;"><span>$ ssh localhost
</span></span></code></pre></div><p>Start.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ bin/hdfs namenode -format
</span></span><span style="display:flex;"><span>$ sbin/start-dfs.sh
</span></span><span style="display:flex;"><span>localhost: starting namenode, ...
</span></span><span style="display:flex;"><span>localhost: starting datanode, ...
</span></span><span style="display:flex;"><span>0.0.0.0: starting secondarynamenode, ...
</span></span></code></pre></div><p>Create a directory and a file and access them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ bin/hdfs dfs -mkdir /home
</span></span><span style="display:flex;"><span>$ bin/hdfs dfs -mkdir /user/ec2-user
</span></span><span style="display:flex;"><span>$ echo &#39;aaaaa&#39; &gt; hoge
</span></span><span style="display:flex;"><span>$ bin/hdfs dfs -put hoge ./
</span></span><span style="display:flex;"><span>$ bin/hdfs dfs -put hoge ./
</span></span><span style="display:flex;"><span>put: `hoge&#39;: File exists
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/hdfs dfs -appendToFile hoge hoge
</span></span><span style="display:flex;"><span>$ bin/hdfs dfs -ls ./
</span></span><span style="display:flex;"><span>Found 1 items
</span></span><span style="display:flex;"><span>-rw-r--r--   1 ec2-user supergroup         12 2017-08-14 13:44 hoge
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/hdfs dfs -cat hoge
</span></span><span style="display:flex;"><span>aaaaa
</span></span><span style="display:flex;"><span>aaaaa
</span></span></code></pre></div><p>Run filesystem check utility.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ bin/hdfs fsck ./ -files -blocks
</span></span><span style="display:flex;"><span>Connecting to namenode via http://localhost:50070/fsck?ugi=ec2-user&amp;files=1&amp;blocks=1&amp;path=%2Fuser%2Fec2-user
</span></span><span style="display:flex;"><span>FSCK started by ec2-user (auth:SIMPLE) from /127.0.0.1 for path /user/ec2-user at Mon Aug 14 13:44:48 UTC 2017
</span></span><span style="display:flex;"><span>/user/ec2-user &lt;dir&gt;
</span></span><span style="display:flex;"><span>/user/ec2-user/hoge 12 bytes, 1 block(s):  OK
</span></span><span style="display:flex;"><span>0. BP-478671077-172.31.3.159-1502715364675:blk_1073741825_1002 len=12 repl=1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Status: HEALTHY
</span></span><span style="display:flex;"><span> Total size:	12 B
</span></span><span style="display:flex;"><span> Total dirs:	1
</span></span><span style="display:flex;"><span> Total files:	1
</span></span><span style="display:flex;"><span> Total symlinks:		0
</span></span><span style="display:flex;"><span> Total blocks (validated):	1 (avg. block size 12 B)
</span></span><span style="display:flex;"><span> Minimally replicated blocks:	1 (100.0 %)
</span></span><span style="display:flex;"><span> Over-replicated blocks:	0 (0.0 %)
</span></span><span style="display:flex;"><span> Under-replicated blocks:	0 (0.0 %)
</span></span><span style="display:flex;"><span> Mis-replicated blocks:		0 (0.0 %)
</span></span><span style="display:flex;"><span> Default replication factor:	1
</span></span><span style="display:flex;"><span> Average block replication:	1.0
</span></span><span style="display:flex;"><span> Corrupt blocks:		0
</span></span><span style="display:flex;"><span> Missing replicas:		0 (0.0 %)
</span></span><span style="display:flex;"><span> Number of data-nodes:		1
</span></span><span style="display:flex;"><span> Number of racks:		1
</span></span><span style="display:flex;"><span>FSCK ended at Mon Aug 14 13:44:48 UTC 2017 in 2 milliseconds
</span></span></code></pre></div><h2 id="references">References</h2>
<p><a href="http://shop.oreilly.com/product/0636920033448.do">Hadoop: The Definitive Guide, 4th Edition</a></p>
<p><a href="https://blog.cloudera.com/blog/2014/03/a-guide-to-checkpointing-in-hadoop/">A Guide to Checkpointing in Hadoop – Cloudera Engineering Blog</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>