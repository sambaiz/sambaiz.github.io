<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 30px;
        height: 30px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .share-button > img {
        border: none;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .share {
        position: relative;
        text-align: right;
        margin-top: 5px;
    }

    .share .cell {
        display: inline-block;
        text-align: center;
        margin-bottom: 5px;
    }

    .share-button {
        display: inline-block;
        margin: 0 5px;
    }

    @media screen and (min-width: 1400px) {
        .share .cell {
            position: absolute;
            bottom: 0;
            margin-left: 5px;
        }

        .share-button {
            display: inline-block;
            margin: 5px 0;
        }
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Compare Redshift Serverless and Athena performances by TPC-DS queries - sambaiz-net</title>
  <meta name="twitter:title" content="Compare Redshift Serverless and Athena performances by TPC-DS queries - sambaiz-net">
  <meta property='og:title' content="Compare Redshift Serverless and Athena performances by TPC-DS queries - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="Compare the runtime and the cost by executing TPC-DS queries for the data saved in S3 with json/parquet">
  <meta name="twitter:description" content="Compare the runtime and the cost by executing TPC-DS queries for the data saved in S3 with json/parquet">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/397/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/397/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/397/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/397/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Compare Redshift Serverless and Athena performances by TPC-DS queries",
    "datePublished": "2022-02-20T01:49:00JST",
    "dateModified": "2022-02-20T01:49:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "Compare the runtime and the cost by executing TPC-DS queries for the data saved in S3 with json/parquet"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/397/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.goodreads.com/sambaiz">
            <img src="/image/goodreads.svg" width="30px" height="30px" alt="goodreads">
          </a>
        </div>
        <div class="sns-item">
          <a href="https://filmarks.com/users/sambaiz" class="filmarks" aria-label="filmarks"></a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/tensorflow/">
            tensorflow</a>
          
          <a class="tag" href="/tags/ios/">
            ios</a>
          
          <a class="tag" href="/tags/lambda/">
            lambda</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Compare Redshift Serverless and Athena performances by TPC-DS queries</h1>
        <time>2022-02-20</time>
        <a class="tag" href='/en/tags/database/'>database</a><a class="tag" href='/en/tags/aws/'>aws</a><a class="tag" href='/en/tags/presto/'>presto</a>
      </div>
      <p><a href="https://www.sambaiz.net/en/article/392/">Redshift Serverless and other serverless aggregation services, run query with Glue Data Catalog - sambaiz-net</a></p>
<p>Compare the performance between Redshift Serverless (Preview) and Athena by queries of TPC-DS, which is a database benchmark.</p>
<blockquote>
<p>(PS: 2022-07-13) Following values were calculated at the rate at the time of preview. When it became <a href="https://aws.amazon.com/jp/blogs/aws/amazon-redshift-serverless-now-generally-available-with-new-capabilities/">GA</a>, the rate dropped by about 30%.</p>
</blockquote>
<p><a href="https://www.sambaiz.net/en/article/393/">Generate data with TPC-DS Connector for Glue - sambaiz-net</a></p>
<p>First, executed the following query to the json and parquet data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#6272a4">/* TPC-DS query96.tpl 0.1 */</span>  <span style="color:#ff79c6">count</span>(<span style="color:#ff79c6">*</span>) 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> store_sales
</span></span><span style="display:flex;"><span>    ,household_demographics 
</span></span><span style="display:flex;"><span>    ,time_dim, store
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">where</span> ss_sold_time_sk <span style="color:#ff79c6">=</span> time_dim.t_time_sk   
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> ss_hdemo_sk <span style="color:#ff79c6">=</span> household_demographics.hd_demo_sk 
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> ss_store_sk <span style="color:#ff79c6">=</span> s_store_sk
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> time_dim.t_hour <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> time_dim.t_minute <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> household_demographics.hd_dep_count <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> store.s_store_name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;ese&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">order</span> <span style="color:#ff79c6">by</span> <span style="color:#ff79c6">count</span>(<span style="color:#ff79c6">*</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">limit</span> <span style="color:#bd93f9">100</span>;
</span></span></code></pre></div><p>The result was as follows.</p>
<table>
<thead>
<tr>
<th>service</th>
<th>format</th>
<th>run time (sec)</th>
<th>cost (ap-northeast-1)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Athena</td>
<td>json</td>
<td>738.205</td>
<td>$0.94 (188.29 GB)</td>
</tr>
<tr>
<td>Redshift Serverless (Base RPU=128)</td>
<td>json</td>
<td>1051.927</td>
<td>$26.18</td>
</tr>
<tr>
<td>Redshift Serverless (Base RPU=256)</td>
<td>json</td>
<td>1052.061</td>
<td>$52.37</td>
</tr>
<tr>
<td>Athena</td>
<td>parquet</td>
<td>9.71</td>
<td>$0.027 (5.49 GB)</td>
</tr>
<tr>
<td>Redshift Serverless (Base RPU=32)</td>
<td>parquet</td>
<td>10.745</td>
<td>$0.07</td>
</tr>
<tr>
<td>Redshift Serverless (Base RPU=128)</td>
<td>parquet</td>
<td>5.831</td>
<td>$0.15</td>
</tr>
<tr>
<td>Redshift Serverless (Base RPU=256)</td>
<td>parquet</td>
<td>4.684</td>
<td>$0.23</td>
</tr>
</tbody>
</table>
<p>Costs were calculated with the rate of ap-northeast-1.</p>
<ul>
<li>Redshift Serverless: $0.70/RPU hour</li>
<li>Athena: $5/TB</li>
</ul>
<p>However, the computing usage for each query of Redshift Serverless cannot be obtained, so these costs are the approximate value of &ldquo;Base RPU * run time&rdquo;.</p>
<p>In json, Athena was faster, and Redshift Serverless doesn&rsquo;t get faster even if Base RPU was increased.
Most of the time may be spent on the loading part, which does not depend on computing resources.
Since Athena is charged by the amount of load, the cost is increased not so much even if it takes a long time, but Redshift Serverless is not.</p>
<p>In parquet, the cost of Athena could be reduced by the amount of load reduction.
Furthermore, the execution time was also significantly shortened, so the benefit of the cost reduction of Redshift Serverless was great.
It was even shorter when the Base RPU was increased, probably because the ratio of loading part was smaller than json.</p>
<p><a href="https://www.sambaiz.net/en/article/386/">Columnar format Parquet structure and read optimization - sambaiz-net</a></p>
<p>Executed other queries with parquet.</p>
<table>
<thead>
<tr>
<th>query</th>
<th>service</th>
<th>run time (sec)</th>
<th>cost (ap-northeast-1)</th>
</tr>
</thead>
<tbody>
<tr>
<td>query7.tpl 0.2</td>
<td>Athena</td>
<td>15.747</td>
<td>$0.20 (40.84 GB)</td>
</tr>
<tr>
<td>query7.tpl 0.2</td>
<td>Redshift Serverless (Base RPU=32)</td>
<td>31.432</td>
<td>$0.20</td>
</tr>
<tr>
<td>query75.tpl 0.3</td>
<td>Athena</td>
<td>34.847</td>
<td>$0.45 (90.73 GB)</td>
</tr>
<tr>
<td>query75.tpl 0.3</td>
<td>Redshift Serverless (Base RPU=32)</td>
<td>204.145</td>
<td>$1.27</td>
</tr>
<tr>
<td>query39.tpl 0.5</td>
<td>Athena</td>
<td>9.394</td>
<td>$0.0001 (261.39 MB)</td>
</tr>
<tr>
<td>query39.tpl 0.5</td>
<td>Redshift Serverless (Base RPU=32)</td>
<td>23.335</td>
<td>$0.15</td>
</tr>
<tr>
<td>query80a.tpl 0.6</td>
<td>Athena</td>
<td><strong>52.105</strong></td>
<td><strong>$0.99</strong> (198.92 GB)</td>
</tr>
<tr>
<td>query80a.tpl 0.6</td>
<td>Redshift Serverless (Base RPU=32)</td>
<td>114.645</td>
<td>$0.71</td>
</tr>
<tr>
<td>query80a.tpl 0.6</td>
<td>Redshift Serverless (Base RPU=64)</td>
<td><strong>39.244</strong></td>
<td><strong>$0.49</strong></td>
</tr>
<tr>
<td>query64.tpl 0.20</td>
<td>Athena</td>
<td>70.997</td>
<td>$0.66 (131.89 GB)</td>
</tr>
<tr>
<td>query64.tpl 0.20</td>
<td>Redshift Serverless (Base RPU=64)</td>
<td>126.752</td>
<td>$1.58</td>
</tr>
</tbody>
</table>
<p>At least at this scale, Athena seems to outperform overall in terms of cost, but in some cases, Redshift Serverless is faster and cheaper. I think it is good to try it when the amount of loading is not a few, and the query is complicated and seems to use computing resources well.</p>

    </div>
    <div class="share">
      <div class="cell">
        <div>share</div>
        <div>
          <a class="share-button" href='https://twitter.com/intent/tweet?url=https://www.sambaiz.net/en/article/397/&text=Compare%20Redshift%20Serverless%20and%20Athena%20performances%20by%20TPC-DS%20queries%20-%20sambaiz-net'>
            <img src="/image/twitter.png" width="40px" height="40px" alt="twitter">
          </a>
          <a href="https://b.hatena.ne.jp/entry/" class="share-button hatena-bookmark-button" data-hatena-bookmark-layout="touch" data-hatena-bookmark-width="40" data-hatena-bookmark-height="40" title="このエントリーをはてなブックマークに追加">
            <img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="40" height="40" style="border: none;" />
          </a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        </div>
      </div>
    </div>
  </article>
</div>

</div>
</body>

</html>