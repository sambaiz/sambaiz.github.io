<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Calculate partial sum with Segment Tree or Bineary Indexed Tree (BIT) - sambaiz-net</title>
  <meta name="twitter:title" content="Calculate partial sum with Segment Tree or Bineary Indexed Tree (BIT) - sambaiz-net">
  <meta property='og:title' content="Calculate partial sum with Segment Tree or Bineary Indexed Tree (BIT) - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="A complete binary tree which can calculate partial sum at O(log n) by having the calculation results in each partials as node">
  <meta name="twitter:description" content="A complete binary tree which can calculate partial sum at O(log n) by having the calculation results in each partials as node">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/406/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/406/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/406/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/406/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Calculate partial sum with Segment Tree or Bineary Indexed Tree (BIT)",
    "datePublished": "2022-05-29T19:18:00JST",
    "dateModified": "2022-05-29T19:18:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "A complete binary tree which can calculate partial sum at O(log n) by having the calculation results in each partials as node"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/406/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Calculate partial sum with Segment Tree or Bineary Indexed Tree (BIT)</h1>
        <time>2022-05-29</time>
        <a class="tag" href='/en/tags/algorithm/'>algorithm</a><a class="tag" href='/en/tags/c&#43;&#43;/'>c&#43;&#43;</a>
      </div>
      <h2 id="segment-tree">Segment Tree</h2>
<p>Segment Tree is a complete binary tree which can calculate partial sum at O(log n) by having the calculation results in each partials as node. In the following example, the calculated value is sum, but if it is the minimum value, <a href="https://en.wikipedia.org/wiki/Range_minimum_query">Range Minimum Query (RMQ)</a> can be solved and if it is the sorted list, merge sort is processed. When updating the value, recalculate in order from the bottom.</p>




<div class="img_container"><a href="/article/406/images/segtree.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/406/images/segtree_hu12221763136917695236.png" width="600" height="285" alt="Segment Tree">
</a></div>


<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;bits/stdc++.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#ff79c6">using</span> <span style="color:#ff79c6">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">template</span> <span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">typename</span> S, <span style="color:#ff79c6">typename</span> T<span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">SegmentTree</span> {
</span></span><span style="display:flex;"><span>  S default_value;
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">int</span> leaf_num <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>  vector<span style="color:#ff79c6">&lt;</span>S<span style="color:#ff79c6">&gt;</span> nodes;
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">/*
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         [0]
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        /   \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">      [1]   [2]
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">      / \   / \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     [3][4][5][6]
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">  */</span>
</span></span><span style="display:flex;"><span>  function<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>(<span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span>)<span style="color:#ff79c6">&gt;</span> calc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>  SegmentTree(vector<span style="color:#ff79c6">&lt;</span>S<span style="color:#ff79c6">&gt;</span> data, S default_value, function<span style="color:#ff79c6">&lt;</span>T(S, S)<span style="color:#ff79c6">&gt;</span> calc) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">while</span> (leaf_num <span style="color:#ff79c6">&lt;</span> data.size()) leaf_num <span style="color:#ff79c6">*=</span> <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>calc <span style="color:#ff79c6">=</span> calc;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>default_value <span style="color:#ff79c6">=</span> default_value;
</span></span><span style="display:flex;"><span>    nodes <span style="color:#ff79c6">=</span> vector<span style="color:#ff79c6">&lt;</span>S<span style="color:#ff79c6">&gt;</span>(<span style="color:#bd93f9">2</span> <span style="color:#ff79c6">*</span> data.size() <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>, default_value);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> data.size(); i<span style="color:#ff79c6">++</span>) update(i, data[i]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">update</span>(<span style="color:#8be9fd">int</span> idx, S value) {
</span></span><span style="display:flex;"><span>    idx <span style="color:#ff79c6">+=</span> leaf_num <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    nodes[idx] <span style="color:#ff79c6">=</span> value;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">while</span> (idx <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span>) {
</span></span><span style="display:flex;"><span>      idx <span style="color:#ff79c6">=</span> (idx <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">2</span>; <span style="color:#6272a4">// parent
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      nodes[idx] <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>calc(nodes[idx <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>], nodes[idx <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">2</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  T <span style="color:#50fa7b">query</span>(<span style="color:#8be9fd">int</span> from, <span style="color:#8be9fd">int</span> to, <span style="color:#8be9fd">int</span> node_idx<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>, <span style="color:#8be9fd">int</span> left<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>, <span style="color:#8be9fd">int</span> right<span style="color:#ff79c6">=-</span><span style="color:#bd93f9">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (right <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) right <span style="color:#ff79c6">=</span> leaf_num<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (right <span style="color:#ff79c6">&lt;</span> from <span style="color:#ff79c6">||</span> to <span style="color:#ff79c6">&lt;</span> left) <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>calc(default_value, default_value);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (from <span style="color:#ff79c6">&lt;=</span> left <span style="color:#ff79c6">&amp;&amp;</span> right <span style="color:#ff79c6">&lt;=</span> to) <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>calc(default_value, nodes[node_idx]);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>calc(
</span></span><span style="display:flex;"><span>        query(from, to, node_idx <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>, left, (left <span style="color:#ff79c6">+</span> right) <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">2</span>), <span style="color:#6272a4">// left child
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        query(from, to, node_idx <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">2</span>, (left <span style="color:#ff79c6">+</span> right) <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>, right) <span style="color:#6272a4">// right child
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>  SegmentTree<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> segtree({<span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">2</span>}, <span style="color:#bd93f9">0</span>, [](<span style="color:#8be9fd">int</span> a, <span style="color:#8be9fd">int</span> b) { <span style="color:#ff79c6">return</span> a <span style="color:#ff79c6">+</span> b; });
</span></span><span style="display:flex;"><span>  cout <span style="color:#ff79c6">&lt;&lt;</span> segtree.query(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 24
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  segtree.update(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">8</span>);
</span></span><span style="display:flex;"><span>  cout <span style="color:#ff79c6">&lt;&lt;</span> segtree.query(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 26
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span></code></pre></div><p>When updating range, if the length is m, it will be O(m log n), but it can be improved by storing the updating value of the range with the range in another Segment Tree and doing lazy evaluation.</p>




<div class="img_container"><a href="/article/406/images/lazyseg.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/406/images/lazyseg_hu9806495387317789204.png" width="600" height="275" alt="Lazy evaluation">
</a></div>


<h2 id="binary-indexed-tree-bit">Binary Indexed Tree (BIT)</h2>
<p>When calculating the partial sum with Segment Tree, the value of the child node on the right is included in the parent node so it can be omitted. Binary Indexed Tree is a tree indexed to the remaining nodes as follows, and the value can be updated or the sum from 0 to idx by adding or subtracting the last 1 bit in the binary representated index.
Although it is limited in what it can do compared to Segment Tree, it can be implemented more simply and faster.</p>




<div class="img_container"><a href="/article/406/images/bit.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/406/images/bit_hu1120103474646053104.png" width="600" height="300" alt="Binary Indexed Tree">
</a></div>


<p>The last 1 bit can be obtained with <code>x &amp; -x</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;bits/stdc++.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#ff79c6">using</span> <span style="color:#ff79c6">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">BinaryIndexedTree</span> {
</span></span><span style="display:flex;"><span>  vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> nodes;
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">/*
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         [4]
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        /   \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">      [2]    -
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">      / \   / \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     [1] - [3] -
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">  */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>  BinaryIndexedTree(vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> data) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>nodes <span style="color:#ff79c6">=</span> vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span>(data.size()<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span>(<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> data.size(); i<span style="color:#ff79c6">++</span>) <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>add(i, data[i]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">add</span>(<span style="color:#8be9fd">int</span> idx, <span style="color:#8be9fd">int</span> value) {
</span></span><span style="display:flex;"><span>    idx<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">while</span> (idx <span style="color:#ff79c6">&lt;</span> nodes.size()) {
</span></span><span style="display:flex;"><span>      nodes[idx] <span style="color:#ff79c6">+=</span> value;
</span></span><span style="display:flex;"><span>      idx <span style="color:#ff79c6">+=</span> idx <span style="color:#ff79c6">&amp;</span> <span style="color:#ff79c6">-</span>idx; <span style="color:#6272a4">// -----&gt;  e.g. 0001 &amp; 1001 = 0001
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">sum</span>(<span style="color:#8be9fd">int</span> to) {
</span></span><span style="display:flex;"><span>    to<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> ret <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">while</span> (to <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span>) {
</span></span><span style="display:flex;"><span>      ret <span style="color:#ff79c6">+=</span> nodes[to];
</span></span><span style="display:flex;"><span>      to <span style="color:#ff79c6">-=</span> to <span style="color:#ff79c6">&amp;</span> <span style="color:#ff79c6">-</span>to; <span style="color:#6272a4">// - - -&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> ret;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    BinaryIndexedTree bit({<span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">2</span>});
</span></span><span style="display:flex;"><span>    cout <span style="color:#ff79c6">&lt;&lt;</span> bit.sum(<span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 24
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    bit.add(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">2</span>);
</span></span><span style="display:flex;"><span>    cout <span style="color:#ff79c6">&lt;&lt;</span> bit.sum(<span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 26
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span></code></pre></div><h2 id="参考">参考</h2>
<p><a href="https://book.mynavi.jp/ec/products/detail/id=22672">プログラミングコンテストチャレンジブック [第2版]</a></p>
<p><a href="https://tsutaj.hatenablog.com/entry/2017/03/30/224339">遅延評価セグメント木をソラで書きたいあなたに - hogecoder</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>