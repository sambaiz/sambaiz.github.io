<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Implement Rabin–Karp algorithm in C&#43;&#43; - sambaiz-net</title>
  <meta name="twitter:title" content="Implement Rabin–Karp algorithm in C&#43;&#43; - sambaiz-net">
  <meta property='og:title' content="Implement Rabin–Karp algorithm in C&#43;&#43; - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="String-searching algorithm using rolling hash">
  <meta name="twitter:description" content="String-searching algorithm using rolling hash">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/387/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/387/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/387/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/387/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Implement Rabin–Karp algorithm in C++",
    "datePublished": "2021-12-04T22:38:00JST",
    "dateModified": "2021-12-04T22:38:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "String-searching algorithm using rolling hash"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/387/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Implement Rabin–Karp algorithm in C&#43;&#43;</h1>
        <time>2021-12-04</time>
        <a class="tag" href='/en/tags/algorithm/'>algorithm</a><a class="tag" href='/en/tags/c&#43;&#43;/'>c&#43;&#43;</a>
      </div>
      <p>Rabin–Karp algorithm is a string-searching algorithm using rolling hash.
Rolling hash can be made with O(1) by removing a first element from the previous hash and adding a next element to it.
There are various hash functions which can do it, but for example, when simply summing up character codes, the hashes will collide just because the same character is contained, so normally, the string is transformed to number as follows. Overflow can be avoided even with long strings by taking the modulo.</p>
<p><a href="https://www.sambaiz.net/article/321/">剰余を取った値の四則演算 - sambaiz-net</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include&lt;bits/stdc++.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#ff79c6">using</span> <span style="color:#ff79c6">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">rolling_hash</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">int</span> base <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">256</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">int</span> mod <span style="color:#ff79c6">=</span> pow(<span style="color:#bd93f9">10</span>, <span style="color:#bd93f9">9</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">7</span>; <span style="color:#6272a4">// prime modulus
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>    string str;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> window_length;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">long</span> tail_p; <span style="color:#6272a4">// = pow(base,window_length)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">long</span> current_hash <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> head_idx <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>    rolling_hash(string str, <span style="color:#8be9fd">int</span> window_length) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>str <span style="color:#ff79c6">=</span> str;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>window_length <span style="color:#ff79c6">=</span> window_length;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">long</span> p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> window_length <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>; i<span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">0</span>; i<span style="color:#ff79c6">--</span>) {
</span></span><span style="display:flex;"><span>            current_hash <span style="color:#ff79c6">=</span> (current_hash <span style="color:#ff79c6">+</span> ((str[i] <span style="color:#ff79c6">*</span> p) <span style="color:#ff79c6">%</span> mod)) <span style="color:#ff79c6">%</span> mod;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (i <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0</span>) p <span style="color:#ff79c6">=</span> (p <span style="color:#ff79c6">*</span> base) <span style="color:#ff79c6">%</span> mod;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>tail_p <span style="color:#ff79c6">=</span> p;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">get</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> current_hash;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//    a_0 * base^n + a_1 * base^n-1 + ... + a_n * base^0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// =&gt;                a_1 * base^n + ... + a_n * base^1 + a_n+1 * base^0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">roll</span>() {
</span></span><span style="display:flex;"><span>        head_idx<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>        current_hash <span style="color:#ff79c6">=</span> (current_hash <span style="color:#ff79c6">-</span> ((str[head_idx<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&gt;</span>tail_p) <span style="color:#ff79c6">%</span> mod)) <span style="color:#ff79c6">%</span> mod; <span style="color:#6272a4">// a_1 * base^n-1 + ... + a_n * base^0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#8be9fd">int</span> tail_idx <span style="color:#ff79c6">=</span> head_idx<span style="color:#ff79c6">+</span>window_length<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (tail_idx <span style="color:#ff79c6">&gt;=</span> str.length()) <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> out_of_range(<span style="color:#f1fa8c">&#34;the window is out of range&#34;</span>);
</span></span><span style="display:flex;"><span>        current_hash <span style="color:#ff79c6">=</span> (((current_hash <span style="color:#ff79c6">*</span> base) <span style="color:#ff79c6">%</span> mod) <span style="color:#ff79c6">+</span> str[tail_idx]) <span style="color:#ff79c6">%</span> mod; <span style="color:#6272a4">// a_1 * base^n + ... + a_n * base^n-1 + a_n+1 * base^0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>Rabin–Karp algorithm searches for a substring where this hash matches. Hashes can collide so string comparison is needed after that.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">index_of</span>(string str, string substr) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">auto</span> str_hash <span style="color:#ff79c6">=</span> rolling_hash(str, substr.length());
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">auto</span> substr_hash <span style="color:#ff79c6">=</span> rolling_hash(substr, substr.length());
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> str.length() <span style="color:#ff79c6">-</span> substr.length(); i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span>(str_hash.get() <span style="color:#ff79c6">==</span> substr_hash.get() <span style="color:#ff79c6">&amp;&amp;</span> str.substr(i, substr.length()) <span style="color:#ff79c6">==</span> substr) <span style="color:#ff79c6">return</span> i;
</span></span><span style="display:flex;"><span>        str_hash.roll();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>(<span style="color:#8be9fd">void</span>){
</span></span><span style="display:flex;"><span>    cout <span style="color:#ff79c6">&lt;&lt;</span> index_of(<span style="color:#f1fa8c">&#34;ABCDEF&#34;</span>, <span style="color:#f1fa8c">&#34;CDE&#34;</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    cout <span style="color:#ff79c6">&lt;&lt;</span> index_of(<span style="color:#f1fa8c">&#34;ABEF&#34;</span>, <span style="color:#f1fa8c">&#34;BCD&#34;</span>) <span style="color:#ff79c6">&lt;&lt;</span> endl; <span style="color:#6272a4">// -1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span></code></pre></div><p>Let n be length of whole string, and m be length of substring, this algorithm is O(n+m) on average,
but in the worst case where all hashes collide so string comparison is done every time, it is O(nm) same as brute force. When searching for multiple substrings, the execution time does not depend on the number so it is used to detect plagiarism.</p>
<h2 id="references">References</h2>
<p><a href="https://en.wikipedia.org/wiki/Rabin%E2%80%93Karp_algorithm">Rabin–Karp algorithm - Wikipedia</a></p>
<p><a href="https://book.mynavi.jp/ec/products/detail/id=22672">プログラミングコンテストチャレンジブック [第2版]</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>