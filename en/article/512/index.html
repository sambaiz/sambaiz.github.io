<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Model Layering in dbt&#39;s Best Practice Guides - sambaiz-net</title>
  <meta name="twitter:title" content="Model Layering in dbt&#39;s Best Practice Guides - sambaiz-net">
  <meta property='og:title' content="Model Layering in dbt&#39;s Best Practice Guides - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="There are Best practice guides that document how dbt Labs operates their dbt projects. Within these, How we structure our dbt projects outlines what to do and what not to do, along with the reasoning behind these decisions, so you don&#39;t have to spend decision-making resources on how to organize folders and name files">
  <meta name="twitter:description" content="There are Best practice guides that document how dbt Labs operates their dbt projects. Within these, How we structure our dbt projects outlines what to do and what not to do, along with the reasoning behind these decisions, so you don&#39;t have to spend decision-making resources on how to organize folders and name files">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/512/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/512/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/512/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/512/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Model Layering in dbt's Best Practice Guides",
    "datePublished": "2024-12-01T12:10:00JST",
    "dateModified": "2024-12-01T12:10:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "There are Best practice guides that document how dbt Labs operates their dbt projects. Within these, How we structure our dbt projects outlines what to do and what not to do, along with the reasoning behind these decisions, so you don't have to spend decision-making resources on how to organize folders and name files"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/512/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Model Layering in dbt&#39;s Best Practice Guides</h1>
        <time>2024-12-01</time>
        <a class="tag" href='/en/tags/dbt/'>dbt</a>
      </div>
      <p>There are <a href="https://docs.getdbt.com/best-practices">Best practice guides</a> that document how dbt Labs operates their dbt projects. Within these, <a href="https://docs.getdbt.com/best-practices/how-we-structure/1-guide-overview">How we structure our dbt projects</a> outlines what to do and what not to do, along with the reasoning behind these decisions, so you don&rsquo;t have to spend decision-making resources on how to organize folders and name files.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>├── models
</span></span><span style="display:flex;"><span>│   ├── intermediate
</span></span><span style="display:flex;"><span>│   │   └── finance
</span></span><span style="display:flex;"><span>│   │       ├── _int_finance__models.yml
</span></span><span style="display:flex;"><span>│   │       └── int_payments_pivoted_to_orders.sql
</span></span><span style="display:flex;"><span>│   ├── marts
</span></span><span style="display:flex;"><span>│   │   ├── finance
</span></span><span style="display:flex;"><span>│   │   │   ├── _finance__models.yml
</span></span><span style="display:flex;"><span>│   │   │   ├── orders.sql
</span></span><span style="display:flex;"><span>│   │   │   └── payments.sql
</span></span><span style="display:flex;"><span>│   │   └── marketing
</span></span><span style="display:flex;"><span>│   │       ├── _marketing__models.yml
</span></span><span style="display:flex;"><span>│   │       └── customers.sql
</span></span><span style="display:flex;"><span>│   ├── staging
</span></span><span style="display:flex;"><span>│   │   ├── jaffle_shop
</span></span><span style="display:flex;"><span>│   │   │   ├── _jaffle_shop__docs.md
</span></span><span style="display:flex;"><span>│   │   │   ├── _jaffle_shop__models.yml
</span></span><span style="display:flex;"><span>│   │   │   ├── _jaffle_shop__sources.yml
</span></span><span style="display:flex;"><span>│   │   │   ├── base
</span></span><span style="display:flex;"><span>│   │   │   │   ├── base_jaffle_shop__customers.sql
</span></span><span style="display:flex;"><span>│   │   │   │   └── base_jaffle_shop__deleted_customers.sql
</span></span><span style="display:flex;"><span>│   │   │   ├── stg_jaffle_shop__customers.sql
</span></span><span style="display:flex;"><span>│   │   │   └── stg_jaffle_shop__orders.sql
</span></span><span style="display:flex;"><span>│   │   └── stripe
</span></span><span style="display:flex;"><span>│   │       ├── _stripe__models.yml
</span></span><span style="display:flex;"><span>│   │       ├── _stripe__sources.yml
</span></span><span style="display:flex;"><span>│   │       └── stg_stripe__payments.sql
</span></span><span style="display:flex;"><span>│   └── utilities
</span></span><span style="display:flex;"><span>│       └── all_dates.sql
</span></span></code></pre></div><h2 id="staginghttpsdocsgetdbtcombest-practiceshow-we-structure2-staging"><a href="https://docs.getdbt.com/best-practices/how-we-structure/2-staging">staging</a></h2>
<p>This layer performs name changes, type and category conversions, but generally avoids JOINs and aggregations. It is materialized as views to always reference the most recent data.</p>
<p>Directories are organized at the system level where properties tend to be shared, rather than by data loading methods or business groups like finance and marketing.</p>
<p>File names follow patterns like <code>stg_[source]__[entity]s.sql</code>, making it clear where the model comes from without having to examine the tree structure.</p>
<p>Tables can be referred directly, but you can also refer to sources.yml with source() to reflect it in the document. This file and the base of models that rename columns can be automatically generated by codegen.</p>
<p><a href="https://www.sambaiz.net/en/article/513/">Automatically generate sources.yml, staging models, and schema.yml using dbt codegen - sambaiz-net</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#ff79c6">sources</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">name</span>: dbttest
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">tables</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">name</span>: my_first_dbt_model
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">name</span>: my_second_dbt_model
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># select * from {{ source(&#39;dbttest&#39;, &#39;my_first_dbt_model&#39;) }}</span>
</span></span></code></pre></div><h2 id="intermediatehttpsdocsgetdbtcombest-practiceshow-we-structure3-intermediate"><a href="https://docs.getdbt.com/best-practices/how-we-structure/3-intermediate">intermediate</a></h2>
<p>This layer has intermediate models combine staging models and perform complex transformations, existing as either views or <a href="https://docs.getdbt.com/docs/build/materializations#ephemeral">ephemeral</a> models. Ephemeral models generate common table expressions (CTE) and are embedded in the referencing models, which keeps the data warehouse simple, but makes troubleshooting slightly more difficult since you cannot query them directly.</p>
<p>Directories are organized at the business group level, and file names follow the pattern <code>int_[entity]s_[verb]s.sql</code> to make it clear what is happening.</p>
<h2 id="martshttpsdocsgetdbtcombest-practiceshow-we-structure4-marts"><a href="https://docs.getdbt.com/best-practices/how-we-structure/4-marts">marts</a></h2>
<p>This layer creates tables referenced by end users from staging and intermediate models. They are denormalized to save on heavy computational costs. When there are many JOINs, grouping them in intermediate models can make the concept clearer and more readable.</p>
<p>Directories are organized by business group or areas of interest, and file names are entity names such as customers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>$ cat dbt_project.yml
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">models</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">dbttest</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">staging</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">+materialized</span>: view
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">intermediate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">+materialized</span>: ephemeral
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">marts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">+materialized</span>: table
</span></span></code></pre></div>
    </div>
  </article>
</div>

</div>
</body>

</html>