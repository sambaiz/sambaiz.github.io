<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Querying Snowflake with the Spark Connector - sambaiz-net</title>
  <meta name="twitter:title" content="Querying Snowflake with the Spark Connector - sambaiz-net">
  <meta property='og:title' content="Querying Snowflake with the Spark Connector - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="To access Snowflake data from applications, you can use the Spark connector (which connects via JDBC) or the Snowpark API etc. In both cases, queries are basically lazily evaluated using Snowflake&#39;s compute resources, but operations that cannot be pushed down, such as Spark UDFs, are executed on the Spark cluster. In contrast, the Snowpark API guarantees that all processing is performed on the Snowflake side, so you don&#39;t need to manage a cluster, which is why it is recommended. However, if you need Spark to process large data outside of Snowflake, the Spark connector, which returns a Spark DataFrame, is convenient.">
  <meta name="twitter:description" content="To access Snowflake data from applications, you can use the Spark connector (which connects via JDBC) or the Snowpark API etc. In both cases, queries are basically lazily evaluated using Snowflake&#39;s compute resources, but operations that cannot be pushed down, such as Spark UDFs, are executed on the Spark cluster. In contrast, the Snowpark API guarantees that all processing is performed on the Snowflake side, so you don&#39;t need to manage a cluster, which is why it is recommended. However, if you need Spark to process large data outside of Snowflake, the Spark connector, which returns a Spark DataFrame, is convenient.">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/534/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/534/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/534/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/534/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Querying Snowflake with the Spark Connector",
    "datePublished": "2025-05-05T18:56:00JST",
    "dateModified": "2025-05-05T18:56:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "To access Snowflake data from applications, you can use the Spark connector (which connects via JDBC) or the Snowpark API etc. In both cases, queries are basically lazily evaluated using Snowflake's compute resources, but operations that cannot be pushed down, such as Spark UDFs, are executed on the Spark cluster. In contrast, the Snowpark API guarantees that all processing is performed on the Snowflake side, so you don't need to manage a cluster, which is why it is recommended. However, if you need Spark to process large data outside of Snowflake, the Spark connector, which returns a Spark DataFrame, is convenient."
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/534/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Querying Snowflake with the Spark Connector</h1>
        <time>2025-05-05</time>
        <a class="tag" href='/en/tags/spark/'>spark</a><a class="tag" href='/en/tags/snowflake/'>snowflake</a><a class="tag" href='/en/tags/scala/'>scala</a>
      </div>
      <p>To access Snowflake data from applications, you can use the <a href="https://docs.snowflake.com/en/user-guide/spark-connector">Spark connector</a> (which connects via JDBC) or the <a href="https://docs.snowflake.com/en/developer-guide/snowpark/index">Snowpark API</a> etc. In both cases, queries are basically lazily evaluated using Snowflake&rsquo;s compute resources, but operations that cannot be pushed down, such as <a href="https://docs.snowflake.com/en/user-guide/spark-connector-use#pushdown">Spark UDFs</a>, are executed on the Spark cluster. In contrast, the Snowpark API guarantees that all processing is performed on the Snowflake side, so you don&rsquo;t need to manage a cluster, which is why it is recommended. However, if you need Spark to process large data outside of Snowflake, the Spark connector, which returns a Spark DataFrame, is convenient.</p>
<p>Note that the Snowpark library currently does <a href="https://docs.snowflake.com/en/developer-guide/snowpark/scala/prerequisites">not support Scala 2.13</a>.</p>
<p><a href="https://docs.snowflake.com/en/user-guide/spark-connector-install">Install</a> spark-snowflake and a compatible version of snowflake-jdbc.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>libraryDependencies <span style="color:#ff79c6">++=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;net.snowflake&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#34;snowflake-jdbc&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#34;3.24.0&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;net.snowflake&#34;</span> <span style="color:#ff79c6">%%</span> <span style="color:#f1fa8c">&#34;spark-snowflake&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#34;3.1.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">)</span>
</span></span></code></pre></div><p>You can run queries by passing either a password or private key for authentication. The BEGIN/END PRIVATE KEY parts of the private key must be <a href="https://docs.snowflake.com/en/user-guide/spark-connector-use#using-key-pair-authentication-key-pair-rotation">removed</a>. Utils.runQuery() is concise but <a href="https://docs.snowflake.com/en/user-guide/spark-connector-use#executing-ddl-dml-sql-statements">does not return results</a>.</p>
<p><a href="https://www.sambaiz.net/en/article/524/">Running Terraform and Querying from Snowflake CLI and gosnowflake with Key Pair Authentication - sambaiz-net</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> net.snowflake.spark.snowflake.Utils
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> net.snowflake.spark.snowflake.Utils.SNOWFLAKE_SOURCE_NAME
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">val</span> keyPem <span style="color:#ff79c6">=</span> getPrivateKey<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">val</span> trimHeaderAndFooter<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Regex</span> <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;&#34;&#34;-----BEGIN PRIVATE KEY-----|-----END PRIVATE KEY-----|\s&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>r
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">var</span> sfOptions <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Map</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sfURL&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;*****.snowflakecomputing.com&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sfUser&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;ADMIN&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;pem_private_key&#34;</span> <span style="color:#ff79c6">-&gt;</span> trimHeaderAndFooter<span style="color:#ff79c6">.</span>replaceAllIn<span style="color:#ff79c6">(</span>keyPem<span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;&#34;</span><span style="color:#ff79c6">),</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sfDatabase&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;TEST_DB&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sfSchema&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;PUBLIC&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sfWarehouse&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;DEFAULT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">val</span> ddl <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    |create or replace table USERS (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    |  id    integer,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    |  name string
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    |);
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">Utils</span><span style="color:#ff79c6">.</span>runQuery<span style="color:#ff79c6">(</span>sfOptions<span style="color:#ff79c6">,</span> ddl<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#50fa7b">SNOWFLAKE_SOURCE_NAME</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>options<span style="color:#ff79c6">(</span>sfOptions<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;query&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;select * from users&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>load<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span></code></pre></div>
    </div>
  </article>
</div>

</div>
</body>

</html>