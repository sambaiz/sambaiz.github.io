<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Make EMR clusters&#39; scale-in faster with Task nodes - sambaiz-net</title>
  <meta name="twitter:title" content="Make EMR clusters&#39; scale-in faster with Task nodes - sambaiz-net">
  <meta property='og:title' content="Make EMR clusters&#39; scale-in faster with Task nodes - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="Core nodes need to be decommissioned and then terminated to prevent data loss, but replication bandwidth is limited to prevent spikes, so it takes time to scale in">
  <meta name="twitter:description" content="Core nodes need to be decommissioned and then terminated to prevent data loss, but replication bandwidth is limited to prevent spikes, so it takes time to scale in">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/445/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/445/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/445/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/445/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Make EMR clusters' scale-in faster with Task nodes",
    "datePublished": "2023-03-19T22:51:00JST",
    "dateModified": "2023-03-19T22:51:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "Core nodes need to be decommissioned and then terminated to prevent data loss, but replication bandwidth is limited to prevent spikes, so it takes time to scale in"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/445/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag" href="/tags/linux/">
            linux</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Make EMR clusters&#39; scale-in faster with Task nodes</h1>
        <time>2023-03-19</time>
        <a class="tag" href='/en/tags/aws/'>aws</a><a class="tag" href='/en/tags/spark/'>spark</a><a class="tag" href='/en/tags/etl/'>etl</a><a class="tag" href='/en/tags/hadoop/'>hadoop</a>
      </div>
      <p>EMR cluster <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-master-core-task-nodes.html">consists</a> of a Master (primary) node and Core nodes and Task nodes.</p>
<p><a href="https://www.sambaiz.net/article/427/">How Hadoop YARN allocates resources to applications and check how much resources are allocated - sambaiz-net</a></p>
<p>Resources of both core nodes and task nodes are used to run tasks, but core nodes are HDFS&rsquo;s DataNode while task nodes aren&rsquo;t.
Therefore, core nodes need to be decommissioned and then terminated to prevent data loss, but replication bandwidth is limited to prevent spikes, so <a href="https://aws.amazon.com/jp/blogs/big-data/best-practices-for-resizing-and-automatic-scaling-in-amazon-emr/">it takes time</a> to scale in.</p>
<p><a href="https://www.sambaiz.net/article/126/">What is HDFS(Hadoop Distributed File System) - sambaiz-net</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ sudo -u hdfs hdfs dfsadmin -report
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Live datanodes <span style="color:#ff79c6">(</span>11<span style="color:#ff79c6">)</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Name: 172.31.32.80:9866 <span style="color:#ff79c6">(</span>ip-172-31-32-80.ap-northeast-1.compute.internal<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>Hostname: ip-172-31-32-80.ap-northeast-1.compute.internal
</span></span><span style="display:flex;"><span>Decommission Status : Decommission in progress
</span></span><span style="display:flex;"><span>Configured Capacity: <span style="color:#bd93f9">62245027840</span> <span style="color:#ff79c6">(</span>57.97 GB<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>DFS Used: <span style="color:#bd93f9">11104256</span> <span style="color:#ff79c6">(</span>10.59 MB<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>Non DFS Used: <span style="color:#bd93f9">208084992</span> <span style="color:#ff79c6">(</span>198.45 MB<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>DFS Remaining: <span style="color:#bd93f9">62025838592</span> <span style="color:#ff79c6">(</span>57.77 GB<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>DFS Used%: 0.02%
</span></span><span style="display:flex;"><span>DFS Remaining%: 99.65%
</span></span><span style="display:flex;"><span>Configured Cache Capacity: <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">(</span><span style="color:#bd93f9">0</span> B<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>Cache Used: <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">(</span><span style="color:#bd93f9">0</span> B<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>Cache Remaining: <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">(</span><span style="color:#bd93f9">0</span> B<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>Cache Used%: 100.00%
</span></span><span style="display:flex;"><span>Cache Remaining%: 0.00%
</span></span><span style="display:flex;"><span>Xceivers: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>Last contact: Sun Mar <span style="color:#bd93f9">19</span> 05:49:14 UTC <span style="color:#bd93f9">2023</span>
</span></span><span style="display:flex;"><span>Last Block Report: Sun Mar <span style="color:#bd93f9">19</span> 05:27:53 UTC <span style="color:#bd93f9">2023</span>
</span></span><span style="display:flex;"><span>Num of Blocks: <span style="color:#bd93f9">106</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>If your cluster consists of only Core nodes, most of the HDFS capacity may not be used.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ sudo -u hdfs hdfs dfs -du -h /
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">0</span>        <span style="color:#bd93f9">0</span>        /user
</span></span><span style="display:flex;"><span>12.6 M   12.6 M   /var
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo -u hdfs hdfs dfs -du -h /var/log
</span></span><span style="display:flex;"><span>7.6 M  7.6 M  /var/log/hadoop-yarn
</span></span><span style="display:flex;"><span>5.0 M  5.0 M  /var/log/spark
</span></span></code></pre></div><p>I try to compare the time to scale in when core nodes are scaled out and when task nodes are scaled out.
There is a whole code on <a href="https://github.com/sambaiz/emr-core-task-node-scale-in-speed-test">GitHub</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#ff79c6">for</span> i in <span style="color:#f1fa8c">`</span>seq <span style="color:#bd93f9">1</span> 100<span style="color:#f1fa8c">`</span>; <span style="color:#ff79c6">do</span>
</span></span><span style="display:flex;"><span>  aws emr add-steps --cluster-id <span style="color:#8be9fd;font-style:italic">$CLUSTER_ID</span> --steps <span style="color:#8be9fd;font-style:italic">Type</span><span style="color:#ff79c6">=</span>Spark,Name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Spark app </span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">i</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>,ActionOnFailure<span style="color:#ff79c6">=</span>CONTINUE,Args<span style="color:#ff79c6">=[</span>--class,org.apache.spark.examples.SparkPi,/usr/lib/spark/examples/jars/spark-examples.jar,100<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">done</span>
</span></span></code></pre></div><h2 id="when-core-nodes-are-scaled">When core nodes are scaled</h2>
<p>First, Scale out Core nodes from 2 to 10.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  instances<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>    masterInstanceFleet<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      targetOnDemandCapacity: <span style="color:#8be9fd">1</span>,
</span></span><span style="display:flex;"><span>      instanceTypeConfigs<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          instanceType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;m6g.xlarge&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    coreInstanceFleet<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      targetOnDemandCapacity: <span style="color:#8be9fd">2</span>,
</span></span><span style="display:flex;"><span>      instanceTypeConfigs<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          instanceType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;m6g.xlarge&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  managedScalingPolicy<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>    computeLimits<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      maximumCapacityUnits: <span style="color:#8be9fd">10</span>,
</span></span><span style="display:flex;"><span>      minimumCapacityUnits: <span style="color:#8be9fd">2</span>,
</span></span><span style="display:flex;"><span>      unitType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;InstanceFleetUnits&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  }, 
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It takes about 14 minutes to scale in after all steps are completed.</p>




<div class="img_container"><a href="/article/445/images/core.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/445/images/core_hu8775916300919611596.png" width="600" height="284" alt="Changes in the number of instances when Core nodes are scaled">
</a></div>


<h2 id="when-task-nodes-are-scaled">When task nodes are scaled</h2>
<p>Next, add Task nodes and prevent Core nodes from scaling out.
Unlike Core nodes, there is almost no problem even if they suddenly shut down, so you can reduce the cost with Spot Instances, but this time, I run with on-demand instances to make reproduction easy.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  instances<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>    masterInstanceFleet<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      targetOnDemandCapacity: <span style="color:#8be9fd">1</span>,
</span></span><span style="display:flex;"><span>        instanceTypeConfigs<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          instanceType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;m6g.xlarge&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    coreInstanceFleet<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      targetOnDemandCapacity: <span style="color:#8be9fd">1</span>,
</span></span><span style="display:flex;"><span>        instanceTypeConfigs<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          instanceType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;m6g.xlarge&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex; background-color:#3d3f4a"><span>    taskInstanceFleets<span style="color:#ff79c6">:</span> [{
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Task nodes&#39;</span>,
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      targetSpotCapacity: <span style="color:#8be9fd">1</span>,
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      instanceTypeConfigs<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex; background-color:#3d3f4a"><span>        {
</span></span><span style="display:flex; background-color:#3d3f4a"><span>          instanceType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;m6g.xlarge&#39;</span>,
</span></span><span style="display:flex; background-color:#3d3f4a"><span>        },
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      ],
</span></span><span style="display:flex; background-color:#3d3f4a"><span>    }],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  managedScalingPolicy<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>    computeLimits<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      maximumCapacityUnits: <span style="color:#8be9fd">10</span>,
</span></span><span style="display:flex; background-color:#3d3f4a"><span>        maximumCoreCapacityUnits: <span style="color:#8be9fd">1</span>,
</span></span><span style="display:flex;"><span>        minimumCapacityUnits: <span style="color:#8be9fd">2</span>,
</span></span><span style="display:flex;"><span>        unitType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;InstanceFleetUnits&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It takes about 6 minutes to scale in.</p>




<div class="img_container"><a href="/article/445/images/task.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/445/images/task_hu4121747442024595201.png" width="600" height="283" alt="Changes in the number of instances when Task nodes are scaled">
</a></div>


<p>Since EMR 6.x, YARN&rsquo;s node label feature is <a href="https://aws.amazon.com/premiumsupport/knowledge-center/emr-configure-node-labeling-yarn/?nc1=h_ls">disabled by default</a>, and ApplicationMaster is executed on even Task nodes, so I drastically reduced the resources and number of Core nodes, but the CPU resources became insufficient, and as a result the task execution was significantly slowed down.
You would be better to monitor it and decide values with a margin.
Plus, the <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-storage.html#emr-plan-storage-ebs-storage-default">default storage size</a> depends on the instance type, so if you set a small instance type, you should also set the EBS size explicitly or tasks will fail instantly with no space left on device.</p>

    </div>
  </article>
</div>

</div>
</body>

</html>