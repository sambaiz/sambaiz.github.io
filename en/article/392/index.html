<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Redshift Serverless and other serverless ETL services, run query with Glue Data Catalog - sambaiz-net</title>
  <meta name="twitter:title" content="Redshift Serverless and other serverless ETL services, run query with Glue Data Catalog - sambaiz-net">
  <meta property='og:title' content="Redshift Serverless and other serverless ETL services, run query with Glue Data Catalog - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="Use Redshift, a petabyte-scale DWH without launching an instance">
  <meta name="twitter:description" content="Use Redshift, a petabyte-scale DWH without launching an instance">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/en/article/392/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/392/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/392/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/392/" />
  
  
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Redshift Serverless and other serverless ETL services, run query with Glue Data Catalog",
    "datePublished": "2021-12-26T22:03:00JST",
    "dateModified": "2021-12-26T22:03:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "Use Redshift, a petabyte-scale DWH without launching an instance"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/article/392/">日本語</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/en/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Redshift Serverless and other serverless ETL services, run query with Glue Data Catalog</h1>
        <time>2021-12-26</time>
        <a class="tag" href='/en/tags/aws/'>aws</a><a class="tag" href='/en/tags/etl/'>etl</a><a class="tag" href='/en/tags/spark/'>spark</a><a class="tag" href='/en/tags/presto/'>presto</a>
      </div>
      <h2 id="redshift-serverless">Redshift Serverless</h2>
<p><a href="https://aws.amazon.com/jp/redshift/redshift-serverless/">Redshift Serverless</a> is a new feature that can use Redshift, a petabyte-scale DWH without launching an instance, announced at this year&rsquo;s re:Invent.
It is available existing features such as <a href="https://docs.aws.amazon.com/redshift/latest/dg/c-using-spectrum.html">Redshift Spectrum</a>, refer to S3 directly, <a href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/federated-overview.html">Federated Query</a> to RDS, and <a href="https://docs.aws.amazon.com/redshift/latest/dg/machine_learning.html">Redshift ML</a>.
I&rsquo;m happy with this update as it is costly to keep the instance running for occasional usage such as analytics.</p>
<p>The <a href="https://aws.amazon.com/redshift/pricing">cost</a> is charged for at least 1 minute <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-serverless.html#serverless-considerations">RPU</a> time and storage. RPU is a resource unit that contains 2vCPU and 16GiB memory and scales automatically.
The rate is <strong>$0.45/RPU hour</strong> in Oregon, whereas Tokyo is set relatively high at <strong>$0.70/RPU hour</strong>.
Since dc2.large (2vCPU, 15 GiB memory) instance is <strong>$0.314/hour</strong> on-demand in Tokyo, if the resource usage is not over 40% on average due to like infrequent use or irregularity, it seems that the cost can be suppressed.
If RI is applied to the maximum, the rate becomes <strong>$0.110/hour</strong> so the threshold drop to 15%, but there is also an operational advantage that you do not have to worry about the scale. In addition, there is no charge for the load amount of Redshift Spectrum.</p>
<blockquote>
<p>(PS: 2022-07-13) When it became <a href="https://aws.amazon.com/jp/blogs/aws/amazon-redshift-serverless-now-generally-available-with-new-capabilities/">GA</a>, the price dropped to <strong>$0.36/RPU hour</strong> in Oregon and <strong>$0.36/RPU hour</strong> in Tokyo.</p>
</blockquote>
<h2 id="other-serverless-etl-services">Other serverless ETL services</h2>
<p>There are other services that can perform queries on serverless such as Athena, a Presto&rsquo;s managed service, and Glue, a Spark&rsquo;s managed service.
The former can easily execute queries and charge by load amount is easy to understand, but there are <a href="https://docs.aws.amazon.com/athena/latest/ug/service-limits.html">limit</a> of execution time and concurrent execution, and the latter can perform heavy aggregation, but it is not very suitable for ad hoc execution because it is necessary to create a job.</p>
<p>Since both of them supports <a href="https://cwiki.apache.org/confluence/display/hive/design">Hive Metastore</a> so can refer the schema of Glue Data Catalog, the Hive Metastore <a href="https://github.com/awslabs/aws-glue-data-catalog-client-for-apache-hive-metastore">compatible</a> service, they can be used properly according to the purpose, but there are differences in the syntax that is available, and even if the same query can be executed, different results may be returned, so be careful when it ports.</p>
<p><a href="https://www.sambaiz.net/en/article/370/">Athena (Presto) and Glue (Spark) can return different values when running the same query - sambaiz-net</a></p>
<p>There are connectors for not only RDS but DynamoDB and Redis etc., and other data sources can be connected by using a custom connector.</p>
<p><a href="https://www.sambaiz.net/en/article/391/">Generate data with TPC-DS Connector in Athena&rsquo;s Federated Query - sambaiz-net</a></p>
<p><a href="https://www.sambaiz.net/article/372/">GlueのカスタムコネクタでBigQueryに接続する - sambaiz-net</a></p>




<div class="img_container"><a href="/article/392/images/redshift-glue-athena.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/392/images/redshift-glue-athena_hu10210905118956830696.png" width="464" height="370" alt="Redshift, Glue and Athena with Glue Data Catalog">
</a></div>


<p>There is also <a href="https://aws.amazon.com/emr/serverless/">EMR Serverless</a> announced at re:Invent this year.
If the data size is too large, OOM or &ldquo;No space left on device&rdquo; can occur due to heavy transformation or repartition(), but Glue cannot be scaled up, so it may be physically difficult to resolve the problem. In this case, EMR may be suitable.</p>
<p><a href="https://www.sambaiz.net/en/article/409/">Launch an EMR cluster with AWS CLI and run Spark applications - sambaiz-net</a></p>
<p>In third party services, there is <a href="https://www.snowflake.com/">Snowflake</a>, SaaS <a href="https://docs.snowflake.com/ja/user-guide/intro-cloud-platforms.html">hosted on each cloud</a>. I often hear some cases of migrating from Redshift to Snowflake due to cost and ease of scale. However, now that Redshift Serverless is now available, it may affect technology selection.
The <a href="https://www.snowflake.com/pricing/pricing-guide/">cost</a> is charged for Snowflake Credit and storage. The rate depends on the plan.</p>
<p><a href="https://cloud.google.com/bigquery-omni/docs/introduction">BigQuery Omni</a> that the query engine runs on the multi-cloud with <a href="https://cloud.google.com/anthos">Anthos</a> became <a href="https://cloud.google.com/blog/products/data-analytics/analyze-data-across-clouds-with-bigquery-omni">GA</a> in October. <a href="https://cloud.google.com/bigquery-omni/docs/locations">Supported regions</a> are few yet, and the <a href="https://cloud.google.com/bigquery/pricing#bqomni">cost</a> is not pay-as-you-go so I don&rsquo;t image to use same as other services, but it&rsquo;s a long-awaited feature that executes BigQuery queries on AWS without transferring data.</p>
<h2 id="query-the-table-in-glue-data-catalog">Query the table in Glue Data Catalog</h2>
<p>Create a database and table in Data Catalog and a role to access it with CDK.</p>
<p><a href="https://www.sambaiz.net/article/357/">CDKでGlue Data CatalogのDatabase,Table,Partition,Crawlerを作成する - sambaiz-net</a></p>
<p>CDK v2 has become stable now as announced at re:Invent, so I write it in v2.
The package @aws-cdk/aws-xxx for each service has been merged into aws-cdk-lib, but alpha features are isolated under the name that the previous one with -alpha suffix.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ npx aws-cdk@2.x init app --language typescript
</span></span><span style="display:flex;"><span>$ npm install --save aws-cdk-lib
</span></span><span style="display:flex;"><span>$ npm install --save @aws-cdk/aws-glue-alpha
</span></span></code></pre></div><p>The role used by Redshift Serverless is <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-serverless.html#serverless-endpoint-iam-role">required</a> to contain redshift.amazonaws.com and redshift-serverless.amazonaws.com principal.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;display:grid;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#ff79c6">const</span> db <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Database(<span style="color:#ff79c6">this</span>, <span style="color:#f1fa8c">&#39;Database&#39;</span>, {
</span></span><span style="display:flex;"><span>  databaseName<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;test_db&#34;</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> bucket <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Bucket(<span style="color:#ff79c6">this</span>, <span style="color:#f1fa8c">&#39;Bucket&#39;</span>, {
</span></span><span style="display:flex;"><span>  bucketName<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">`redshift-serverless-test-</span><span style="color:#f1fa8c">${</span><span style="color:#ff79c6">this</span>.account<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">-</span><span style="color:#f1fa8c">${</span><span style="color:#ff79c6">this</span>.region<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">new</span> BucketDeployment(<span style="color:#ff79c6">this</span>, <span style="color:#f1fa8c">&#39;DeployWebsite&#39;</span>, {
</span></span><span style="display:flex;"><span>  sources<span style="color:#ff79c6">:</span> [Source.asset(<span style="color:#f1fa8c">&#39;./data&#39;</span>)],
</span></span><span style="display:flex;"><span>  destinationBucket: <span style="color:#8be9fd">bucket</span>,
</span></span><span style="display:flex;"><span>  destinationKeyPrefix<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;test_table/&#39;</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> table <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Table(<span style="color:#ff79c6">this</span>, <span style="color:#f1fa8c">&#39;TestTable&#39;</span>, {
</span></span><span style="display:flex;"><span>  tableName<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;test_table&#34;</span>,
</span></span><span style="display:flex;"><span>  database: <span style="color:#8be9fd">db</span>,
</span></span><span style="display:flex;"><span>  columns<span style="color:#ff79c6">:</span> [{
</span></span><span style="display:flex;"><span>    name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;id&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">type</span><span style="color:#ff79c6">:</span> Schema.BIG_INT,
</span></span><span style="display:flex;"><span>  }],
</span></span><span style="display:flex;"><span>  dataFormat: <span style="color:#8be9fd">DataFormat.JSON</span>,
</span></span><span style="display:flex;"><span>  bucket: <span style="color:#8be9fd">bucket</span>,
</span></span><span style="display:flex;"><span>  s3Prefix<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;test_table/&#34;</span>,
</span></span><span style="display:flex;"><span>  compressed: <span style="color:#8be9fd">false</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> role <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Role(<span style="color:#ff79c6">this</span>, <span style="color:#f1fa8c">&#39;SchemaRole&#39;</span>, {
</span></span><span style="display:flex;"><span>    assumedBy: <span style="color:#8be9fd">new</span> CompositePrincipal(
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      <span style="color:#ff79c6">new</span> ServicePrincipal(<span style="color:#f1fa8c">&#39;redshift.amazonaws.com&#39;</span>),
</span></span><span style="display:flex; background-color:#3d3f4a"><span>      <span style="color:#ff79c6">new</span> ServicePrincipal(<span style="color:#f1fa8c">&#39;redshift-serverless.amazonaws.com&#39;</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  role.addToPolicy(<span style="color:#ff79c6">new</span> PolicyStatement({
</span></span><span style="display:flex;"><span>    resources<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex;"><span>      db.databaseArn,
</span></span><span style="display:flex;"><span>      db.catalogArn,
</span></span><span style="display:flex;"><span>      table.tableArn
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    actions<span style="color:#ff79c6">:</span> [<span style="color:#f1fa8c">&#39;glue:Get*&#39;</span>],
</span></span><span style="display:flex;"><span>  }))
</span></span><span style="display:flex;"><span>  role.addToPolicy(<span style="color:#ff79c6">new</span> PolicyStatement({
</span></span><span style="display:flex;"><span>    resources<span style="color:#ff79c6">:</span> [
</span></span><span style="display:flex;"><span>      bucket.bucketArn,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">`</span><span style="color:#f1fa8c">${</span>bucket.bucketArn<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/*`</span>,
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    actions<span style="color:#ff79c6">:</span> [<span style="color:#f1fa8c">&#39;s3:Get*&#39;</span>, <span style="color:#f1fa8c">&#39;s3:List*&#39;</span>],
</span></span><span style="display:flex;"><span>  }))
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>Associate the role to a serverless endpoint to enable to use when creating a schema.</p>




<div class="img_container"><a href="/article/392/images/associate-iam-role.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/392/images/associate-iam-role_hu11553577016517191788.png" width="540" height="370" alt="Associate a role to an endpoint">
</a></div>


<p>After clicking &ldquo;Serverless&rdquo; in the resource list and connecting to it, create an external schema in Redshift specifying the database in Data Catalog and the role.</p>




<div class="img_container"><a href="/article/392/images/create-schema.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/392/images/create-schema_hu14168355160847722704.png" width="289" height="370" alt="Create a schema">
</a></div>


<p>Now, you can query the table in Data Catalog.
If the table is not displayed in the resource list, check if the role has the policy to get the table.</p>




<div class="img_container"><a href="/article/392/images/query-result.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/392/images/query-result_hu3169156002693096174.png" width="578" height="227" alt="Query result">
</a></div>


<p>The same query can be executed on Athena that references Data Catalog. It does not need to create a Schema.</p>




<div class="img_container"><a href="/article/392/images/athena-query-result.png">
    <img style="max-width: 100%; width: auto; height: auto;" src="/article/392/images/athena-query-result_hu14178355876198819622.png" width="401" height="370" alt="Query result on Athena">
</a></div>


<p><a href="https://www.sambaiz.net/en/article/397/">Compare Redshift Serverless and Athena performances by TPC-DS queries - sambaiz-net</a></p>
<h2 id="references">References</h2>
<p><a href="https://developers.cyberagent.co.jp/blog/archives/32123/">Redshift から Snowflake に移行しました | CyberAgent Developers Blog</a></p>
<p><a href="https://speakerdeck.com/jozono/redshift-evolution-2021">Amazon Redshift の 進化の歴史とこれから/redshift-evolution-2021 - Speaker Deck</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>