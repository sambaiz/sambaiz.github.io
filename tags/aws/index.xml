<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>sambaiz-net</title>
    <link>http://sambaiz.net/tags/aws/index.xml</link>
    <language>ja</language>
    <author>sambaiz</author>
    <rights>(C) 2017</rights>
    <updated>0001-01-01 00:00:00 &#43;0000 UTC</updated>

    
      
        <item>
          <title>fluentdã®Aggregatorã‚’ELBã§è² è·åˆ†æ•£ã—ã€Blue/Green Deploymentã™ã‚‹</title>
          <link>http://sambaiz.net/article/113/</link>
          <pubDate>Sun, 25 Jun 2017 00:35:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/113/</guid>
          <description>

&lt;h2 id=&#34;elbã§ã®è² è·åˆ†æ•£&#34;&gt;ELBã§ã®è² è·åˆ†æ•£&lt;/h2&gt;

&lt;p&gt;Beanstalkã§Aggregatrorã‚’ç«‹ã¡ä¸Šã’ãŸã€‚TCPã®24224(è¨­å®šã«ã‚ˆã‚‹)ãŒ
é€šã‚‹ã‚ˆã†ã«EC2,ELBã®SGã¨ãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒã‚ã£ã¦ã€
ELBã®SGã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã®è¨­å®šãŒè¦‹è½ã¨ã•ã‚ŒãŒã¡ã€‚ELBã®ã‚¯ãƒ­ã‚¹ã‚¾ãƒ¼ãƒ³åˆ†æ•£ã¯æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãšã€ELBã«3å°ã€ãã‚Œãã‚Œåˆ¥ã®AZ(1b, 1c, 1d)ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ãƒ­ã‚°ã‚’é€ã‚Šå§‹ã‚ã‚‹ã¨ãã‚Œãã‚Œå‡ç­‰ã«ãƒ­ã‚°ãŒå±Šã„ãŸã€‚
ãã®çŠ¶æ…‹ã‹ã‚‰4å°(1b * 2, 1c, 1d)ã«ã™ã‚‹ã¨ã€2ã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹(1b, 1c)ã®ã¿ã«å‡ç­‰ã«ãƒ­ã‚°ãŒå±Šãã‚ˆã†ã«ãªã£ãŸã€‚
4å°ã«ãªã‚‹ã¨(1b, 1c)ã¨(1b, 1d)ã«åˆ†ã‘ã‚‰ã‚Œã¦ELBã®ãƒãƒ¼ãƒ‰ãŒãã‚Œã‚‰ã®çµ„ã«ç´ã¥ã„ãŸã¨ã„ã†ã“ã¨ã ã¨æ€ã†ã€‚
å„ãƒãƒ¼ãƒ‰ã«ã¯DNSãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚å®Ÿéš›restartã™ã‚‹ã¨ä»Šåº¦ã¯åˆ¥ã®çµ„ã®æ–¹ã«é€ã‚‰ã‚ŒãŸã€‚&lt;/p&gt;

&lt;p&gt;ã§ã¯ã€ãªãœä¸€åº¦é€ã‚Šå§‹ã‚ã‚‹ã¨åŒã˜æ–¹ã«ã—ã‹é£›ã°ãªã„ã‹ã¨ã„ã†ã¨ã€forwardãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®&lt;a href=&#34;http://docs.fluentd.org/v0.12/articles/out_forward#expirednscache&#34;&gt;expire_dns_cache&lt;/a&gt;ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§nilã«ãªã£ã¦ã„ã¦ã€
heartbeatãŒå±Šã„ã¦ã„ã‚‹é–“ã¯&lt;a href=&#34;https://github.com/fluent/fluentd/blob/v0.14.18/lib/fluent/plugin/out_forward.rb#L688&#34;&gt;ç„¡æœŸé™ã«DNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹&lt;/a&gt;ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€‚ã“ã‚Œã«0(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãªã„)ã‹ç§’æ•°ã‚’æŒ‡å®šã™ã‚‹ã¨ã€
ãã®é–“éš”ã§ä»–ã®çµ„ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚‚ãƒ­ã‚°ãŒå±Šãã‚ˆã†ã«ãªã£ãŸã€‚
&lt;code&gt;expire_dns_cache&lt;/code&gt;ã—ãªãã¦ã‚‚è¤‡æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã•ã‚Œã‚‹ãŸã‚å…¨ä½“ã§ã„ãˆã°åˆ†æ•£ã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;elbã§ã®heartbeat&#34;&gt;ELBã§ã®heartbeat&lt;/h2&gt;

&lt;p&gt;ELBé…ä¸‹ã®EC2ã‚’å…¨ã¦è½ã¨ã—ã¦ã‚‚&lt;a href=&#34;https://github.com/fluent/fluentd/blob/v0.14.18/lib/fluent/plugin/out_forward.rb#L665&#34;&gt;heartbeat&lt;/a&gt;ã«å¤±æ•—ã—ãªã„ãŸã‚ã€standyã«ç§»è¡Œã›ãšELBã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ãƒ­ã‚°ãŒãƒ­ã‚¹ãƒˆã—ã¦ã—ã¾ã£ãŸã€‚
ãƒ­ã‚°ã«ã‚‚å‡ºãšã€ä»¥ä¸‹ã®ã‚ˆã†ã«active-standbyã®è¨­å®šã‚’ã—ã¦ã‚‚standbyã«ç§»è¡Œã—ãªã„ã€‚
å…¨ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåŒæ™‚ã«è½ã¡ã‚‹ã¨ã„ã†ã®ã¯æ»…å¤šã«èµ·ããªã„ã ã‚ã†ã‘ã©ã€å°‘ãªãã¨ã‚‚æ¤œçŸ¥ã§ãã‚‹ã‚ˆã†ã«ã¯ã—ã¦ãŠãã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;server&amp;gt;
    name td1
    host autoscale-td1.us-east-1.elasticbeanstalk.com
    port 24224
&amp;lt;/server&amp;gt;
&amp;lt;server&amp;gt;
    name td2
    host autoscale-td2.us-east-1.elasticbeanstalk.com
    port 24224
    standby
&amp;lt;/server&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;blue-green-deployment&#34;&gt;Blue/Green Deployment&lt;/h2&gt;

&lt;p&gt;Blue-Green Deploymentã¨ã„ã†ã®ã¯ã€2ã¤ã®ç³»ã‚’ç”¨æ„ã—ã€activeã§ãªã„æ–¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€
ã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦åæ˜ ã•ã›ã‚‹ã‚‚ã®ã€‚ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã§å•é¡ŒãŒèµ·ããŸéš›ã«ã‚‚ã™ãã«åˆ‡ã‚Šæˆ»ã™ã“ã¨ãŒã§ãã‚‹ã€‚
ã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦å‘ãå…ˆã‚’å¤‰ãˆã‚‹ã«ã¯&lt;code&gt;expire_dns_cache&lt;/code&gt;ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://dev.classmethod.jp/cloud/elb-configuration-guide-1&#34;&gt;AWS ELBã®ç¤¾å†…å‘ã‘æ§‹æˆã‚¬ã‚¤ãƒ‰ã‚’å…¬é–‹ã—ã¦ã¿ã‚‹ è² è·åˆ†æ•£ç·¨ â€“ Cross-Zone Routingã‚’è¸ã¾ãˆã¦ ï½œ Developers.IO&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>fluentdã§Kinesis streamsã«é€ã‚‹ã¨ãã®æ€§èƒ½ç¢ºèª</title>
          <link>http://sambaiz.net/article/108/</link>
          <pubDate>Mon, 05 Jun 2017 23:48:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/108/</guid>
          <description>

&lt;h2 id=&#34;localã§ã®streamsã¨producerã®benchmark&#34;&gt;localã§ã®streamsã¨producerã®benchmark&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/awslabs/aws-fluent-plugin-kinesis&#34;&gt;aws-fluent-plugin-kinesis&lt;/a&gt;ã®
&lt;code&gt;make benchmark&lt;/code&gt;ã¯localã«DummyServerã‚’&lt;a href=&#34;https://github.com/awslabs/aws-fluent-plugin-kinesis/blob/v1.1.3/benchmark/task.rake#L18&#34;&gt;ç«‹ã¡ä¸Šã’ã¦&lt;/a&gt;é€ã£ã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ç©ºã§ã‚‚ã„ã„ã®ã§roleã‚’ã¤ã‘ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git clone https://github.com/awslabs/aws-fluent-plugin-kinesis.git
$ cd aws-fluent-plugin-kinesis
$ yum install -y ruby-devel gcc
$ echo &#39;gem &amp;quot;io-console&amp;quot;&#39; &amp;gt;&amp;gt; Gemfile
$ make
$ make benchmark
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;RATEã‚’æŒ‡å®šã—ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§&lt;a href=&#34;https://github.com/awslabs/aws-fluent-plugin-kinesis/blob/v1.1.3/benchmark/task.rake#L19&#34;&gt;ç§’é–“1000ãƒ¬ã‚³ãƒ¼ãƒ‰&lt;/a&gt;ãŒé€ã‚‰ã‚Œã‚‹è¨­å®šã€‚
fluentdã‚’èµ·å‹•ã—ã¦ã‹ã‚‰10ç§’å¾Œã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’killã—ã€ãã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ãªã©ã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;t2.microã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(RATE=1000)ã§å®Ÿè¡Œã—ãŸçµæœãŒã“ã‚Œã€‚
å›ºã‚ã‚‹åˆ†producerã®æ–¹ã¯ã‚„ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè½ã¡ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bundle exec rake benchmark TYPE=streams
Results: requets: 20, raw_records: 9400, records: 9400
bundle exec rake benchmark TYPE=producer
Results: requets: 14, raw_records: 1005, records: 8900
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;RATE=3000ã®ã¨ãã€‚producerã§ã¯raw_recordsãŒ1/100ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¯1/5ã€‚
streamsã ã¨ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’å¢—ã‚„ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚‹ã‘ã©ã€producerã®æ–¹ã¯å½“åˆ†å¤§ä¸ˆå¤«ãã†ã ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bundle exec rake benchmark TYPE=streams
Results: requets: 57, raw_records: 27600, records: 27600
bundle exec rake benchmark TYPE=producer
Results: requets: 12, raw_records: 241, records: 25200
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;RATE=10000ã®ã¨ãã€‚raw_records, requestã®åœ§ç¸®ç‡ã¯ã•ã‚‰ã«ä¸ŠãŒã‚Šã€
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å·®ãŒå¤§ãããªã£ã¦ãã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bundle exec rake benchmark TYPE=streams
Results: requets: 177, raw_records: 88000, records: 88000
bundle exec rake benchmark TYPE=producer
Results: requets: 26, raw_records: 385, records: 75000
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å®Ÿéš›ã«kinesis-streamsã«é€ã£ã¦ã¿ã‚‹&#34;&gt;å®Ÿéš›ã«kinesis streamsã«é€ã£ã¦ã¿ã‚‹&lt;/h2&gt;

&lt;p&gt;ap-northeast-1ã§ã‚·ãƒ£ãƒ¼ãƒ‰ã¯3ã®Kinesis streamsã«t2.microã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹1å°ã‹ã‚‰é€ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;source&amp;gt;
  @type dummy
  dummy {&amp;quot;hello&amp;quot;:&amp;quot;world&amp;quot;}
  tag dummy
  rate 1000
&amp;lt;/source&amp;gt;

&amp;lt;source&amp;gt;
  @type monitor_agent
  bind 0.0.0.0
  port 24220
&amp;lt;/source&amp;gt;

&amp;lt;match **&amp;gt;
  @type kinesis_streams
  region ap-northeast-1
  stream_name test

  flush_interval 1
  buffer_chunk_limit 1m
  try_flush_interval 0.1
  queued_chunk_flush_interval 0.01
  num_threads 15
&amp;lt;/match&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç§’é–“3000ã¾ã§ã¯ã»ã¨ã‚“ã©ã‚­ãƒ¥ãƒ¼ã«ãŸã¾ã‚‰ãšé€ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl localhost:24220/api/plugins.json | jq
{
  ...
  &amp;quot;plugins&amp;quot;: [
    {
      &amp;quot;plugin_id&amp;quot;: &amp;quot;object:3fc0dfac66a8&amp;quot;,
      &amp;quot;plugin_category&amp;quot;: &amp;quot;output&amp;quot;,
      &amp;quot;type&amp;quot;: &amp;quot;kinesis_streams&amp;quot;,
      ...
      &amp;quot;buffer_queue_length&amp;quot;: 0,
      &amp;quot;buffer_total_queued_size&amp;quot;: 17500,
      &amp;quot;retry_count&amp;quot;: 0,
      &amp;quot;retry&amp;quot;: {}
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;4000ã«ã™ã‚‹ã¨ãã®ã†ã¡retryãŒç™ºç”Ÿã—ã¦ã—ã¾ã†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  ...
  &amp;quot;plugins&amp;quot;: [
    {
      &amp;quot;plugin_id&amp;quot;: &amp;quot;object:3fc0dfac66a8&amp;quot;,
      &amp;quot;plugin_category&amp;quot;: &amp;quot;output&amp;quot;,
      &amp;quot;type&amp;quot;: &amp;quot;kinesis_streams&amp;quot;,
      ...
     &amp;quot;buffer_queue_length&amp;quot;: 60,
      &amp;quot;buffer_total_queued_size&amp;quot;: 56544178,
      &amp;quot;retry_count&amp;quot;: 5,
      &amp;quot;retry&amp;quot;: {
        &amp;quot;steps&amp;quot;: 5,
        &amp;quot;next_time&amp;quot;: &amp;quot;2017-06-05 14:05:38 +0000&amp;quot;
      }
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãŸã—ã‹ã«ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãŒè¶…éã—ã¦ã„ã‚‹ã€‚ã‚¹ãƒšãƒƒã‚¯é€šã‚Šã ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/108.png&#34; alt=&#34;æ›¸ãè¾¼ã¿ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®è¶…é&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ¬¡ã«30ã‚·ãƒ£ãƒ¼ãƒ‰ã«ã—ã¦ã¿ã‚‹ã€‚ä¸€åº¦ã«ã‚·ãƒ£ãƒ¼ãƒ‰æ•°ã¯å€ã‹ã‚‰åŠåˆ†ã«ã—ã‹ã§ããªã„ã®ã§ä½œã‚Šç›´ã—ã€‚&lt;/p&gt;

&lt;p&gt;ã“ã‚Œã«ç§’é–“30000ã‚’é€ã£ã¦ã¿ã‚‹ã¨ã€ã‚­ãƒ¥ãƒ¼ã«ã„ãã‚‰ã‹æºœã¾ã£ãŸã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  ...
  &amp;quot;plugins&amp;quot;: [
    {
      &amp;quot;plugin_id&amp;quot;: &amp;quot;object:3fc0dfac66a8&amp;quot;,
      &amp;quot;plugin_category&amp;quot;: &amp;quot;output&amp;quot;,
      &amp;quot;type&amp;quot;: &amp;quot;kinesis_streams&amp;quot;,
      ...
      &amp;quot;buffer_queue_length&amp;quot;: 7,
      &amp;quot;buffer_total_queued_size&amp;quot;: 7752600,
      &amp;quot;retry_count&amp;quot;: 0,
      &amp;quot;retry&amp;quot;: {}
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã•ã‚‰ã«å€ã«ã—ã¦60ã‚·ãƒ£ãƒ¼ãƒ‰ã€‚ã“ã‚Œã«ç§’é–“60000ã§é€ã£ã¦ã¿ã‚‹ã€‚ã‚­ãƒ¥ãƒ¼ã«æºœã¾ã‚‹ã‚‚ã®ã®å¢—ãˆç¶šã‘ã¯ã—ãªã„ã®ã§ãªã‚“ã¨ã‹é€ã‚Œã¦ãã†ã ã€‚
td-agentã®ãƒ—ãƒ­ã‚»ã‚¹ãŒCPUã‚’99%ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ã“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã¯ã“ã®è¾ºãŒé™ç•Œã‹ã‚‚ã—ã‚Œãªã„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  ...
  &amp;quot;plugins&amp;quot;: [
    {
      &amp;quot;plugin_id&amp;quot;: &amp;quot;object:3fc0dfac66a8&amp;quot;,
      &amp;quot;plugin_category&amp;quot;: &amp;quot;output&amp;quot;,
      &amp;quot;type&amp;quot;: &amp;quot;kinesis_streams&amp;quot;,
      ...
      &amp;quot;buffer_queue_length&amp;quot;: 15,
      &amp;quot;buffer_total_queued_size&amp;quot;: 16105807,
      &amp;quot;retry_count&amp;quot;: 0,
      &amp;quot;retry&amp;quot;: {}
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã¤ã„ã§ã«us-east-1ã«ã‚‚30ã‚·ãƒ£ãƒ¼ãƒ‰ã®Streamsã‚’ä½œæˆã—ã¦30000é€ã£ã¦ã¿ãŸã¨ã“ã‚ã€ã‚­ãƒ¥ãƒ¼ã«æºœã¾ã‚‹é‡ãŒæ ¼æ®µã«å¢—ãˆãŸã€‚
æ—©ãFirehoseã‚„AnalyticsãŒæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚‚æ¥ã¦ã»ã—ã„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  ...
  &amp;quot;plugins&amp;quot;: [
    {
      &amp;quot;plugin_id&amp;quot;: &amp;quot;object:3fc0dfac66a8&amp;quot;,
      &amp;quot;plugin_category&amp;quot;: &amp;quot;output&amp;quot;,
      &amp;quot;type&amp;quot;: &amp;quot;kinesis_streams&amp;quot;,
      ...
      &amp;quot;buffer_queue_length&amp;quot;: 50,
      &amp;quot;buffer_total_queued_size&amp;quot;: 52432436,
      &amp;quot;retry_count&amp;quot;: 0,
      &amp;quot;retry&amp;quot;: {}
  ]
}
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Beanstalkã§ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒAMIã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ç•°ãªã‚‹åŸå› </title>
          <link>http://sambaiz.net/article/106/</link>
          <pubDate>Sun, 04 Jun 2017 23:40:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/106/</guid>
          <description>

&lt;h2 id=&#34;user-dataã¨ã¯-http-docs-aws-amazon-com-ja-jp-awsec2-latest-userguide-user-data-html&#34;&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/user-data.html&#34;&gt;User-Dataã¨ã¯&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã«ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ°ã‚‰ã›ãŸã‚Šcloud-initãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’é©ç”¨ã§ãã‚‹æ©Ÿèƒ½ã€‚
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ã®è¨­å®šã®ã€é«˜åº¦ãªè©³ç´°ã®ã¨ã“ã‚ã‹ã‚‰è¨­å®šã§ãã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;beanstalkã§ã®user-data&#34;&gt;Beanstalkã§ã®User-Data&lt;/h2&gt;

&lt;p&gt;å®Ÿã¯Beanstalkã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã¦ã€CloudFormationã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;quot;    /bin/bash /tmp/ebbootstrap.sh &amp;quot;,

...

&amp;quot;Fn::FindInMap&amp;quot;: [
    &amp;quot;AWSEBOptions&amp;quot;,
    &amp;quot;options&amp;quot;,
    &amp;quot;UserDataScript&amp;quot;
]
&amp;quot; &amp;gt; /tmp/ebbootstrap.sh &amp;quot;,

...

&amp;quot;AWSEBOptions&amp;quot;: {
    &amp;quot;options&amp;quot;: {
        &amp;quot;UserDataScript&amp;quot;: &amp;quot;https://s3-ap-northeast-1.amazonaws.com/elasticbeanstalk-env-resources-ap-northeast-1/stalks/eb_node_js_4.0.1.90.2/lib/UserDataScript.sh&amp;quot;,
        &amp;quot;guid&amp;quot;: &amp;quot;f08557fc43ac&amp;quot;,
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã®shellã®ä¸­ã§ã¯ã€æ™‚è¨ˆã‚’åŒæœŸã•ã›ãŸã‚Šã€awsebãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ãŸã‚Šã™ã‚‹ã»ã‹ã«ã€
éBeanstalk AMI(is_baked=false)ã§ã¯yum updateãŒèµ°ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚
ãã®ãŸã‚ã€AMIã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨Beanstalkã§ç«‹ã¡ä¸ŠãŒã£ãŸã¨ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GUID=$7

function update_yum_packages
{
  if is_baked update_yum_packages_$GUID; then
    log yum update has already been done.
  else
    log Updating yum packages.
    yum --exclude=aws-cfn-bootstrap update -y || echo Warning: cannot update yum packages. Continue...
    mark_installed update_yum_packages_$GUID

    # Update system-release RPM package will reset the .repo files
    # Update the mirror list again after yum update
    update_mirror_list

    log Completed updating yum packages. 
  fi
}

function is_baked
{
	if [[ -f /etc/elasticbeanstalk/baking_manifest/$1 ]]; then
    true
	else
    false
	fi
}

function mark_installed
{
    mkdir -p /etc/elasticbeanstalk/baking_manifest/
    echo `date -u` &amp;gt; /etc/elasticbeanstalk/baking_manifest/$1-manifest
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Beanstalk AMIã§ã®ãƒ­ã‚°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cat /var/log/messages | grep yum
[eb-cfn-init]: yum repo has already been locked to f08557fc43ac.
[eb-cfn-init]: yum update has already been done.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;éBeanstalk AMIã§ã®ãƒ­ã‚°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cat /var/log/messages | grep yum
[eb-cfn-init]: Completed yum repo version locking.
[eb-cfn-init]: Updating yum packages.
yum[1597]: Updated: *****
...
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã§ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›</title>
          <link>http://sambaiz.net/article/89/</link>
          <pubDate>Tue, 28 Mar 2017 21:36:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/89/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;https://github.com/bnoordhuis/node-iconv&#34;&gt;node-iconv&lt;/a&gt;ã‚’ä½¿ã†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm install iconv
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SHIFT_JISã‹ã‚‰UTF-8ã¸ã®å¤‰æ›ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const Iconv  = require(&#39;iconv&#39;).Iconv;

const before = new Buffer([
    0x8b, 0x8d, 
    0x8e, 0x4d, 
    0x26,
    0x82, 0xb2,
    0x94, 0xd1
]);

const iconv = new Iconv(&#39;SHIFT_JIS&#39;, &#39;UTF-8&#39;);
console.log(`before: ${before.toString(&#39;hex&#39;)} ${before.toString()}`)
const after = iconv.convert(before);
console.log(`after:  ${after.toString(&#39;hex&#39;)} ${after.toString()}`);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;before: 8b8d8e4d2682b294d1 ï¿½ï¿½ï¿½M&amp;amp;ï¿½ï¿½ï¿½ï¿½
after:  e7899be79abf26e38194e9a3af ç‰›çš¿&amp;amp;ã”é£¯
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã¯å¤‰æ›å¾Œã«è¡¨ã›ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚
ä¾‹ãˆã°ã€UTF-8ã‹ã‚‰SHIFT_JISã¸ã®å¤‰æ›ã§ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ğŸšã‚’æ¸¡ã™ã¨å¤‰æ›ã§ããšã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;throw errnoException(&#39;EILSEQ&#39;, &#39;Illegal character sequence.&#39;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;//IGNORE&lt;/code&gt;ã‚’&lt;a href=&#34;https://www.npmjs.com/package/iconv#dealing-with-untranslatable-characters&#34;&gt;ä»˜ã‘ã‚‹&lt;/a&gt;ã“ã¨ã§
ãã®ã‚ˆã†ãªæ–‡å­—ãŒã‚ã£ãŸå ´åˆã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ã‚ˆã†ã«ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const Iconv  = require(&#39;iconv&#39;).Iconv;

const before = &amp;quot;ç‰›çš¿&amp;amp;ğŸš&amp;quot;;

const iconv = new Iconv(&#39;UTF-8&#39;, &#39;SHIFT_JIS//IGNORE&#39;);
console.log(`before: ${new Buffer(before).toString(&#39;hex&#39;)} ${before.toString()}`)
const conv = iconv.convert(before);
const iconv2 = new Iconv(&#39;SHIFT_JIS&#39;, &#39;UTF-8&#39;);
const after = iconv2.convert(conv);
console.log(`after:  ${after.toString(&#39;hex&#39;)} ${after.toString()}`);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¤‰æ›ã§ããªã„ã‚‚ã®ã¯ç„¡è¦–ã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;before: e7899be79abf26f09f8d9a ç‰›çš¿&amp;amp;ğŸš
after:  e7899be79abf26 ç‰›çš¿&amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;lambdaã§ã¯&#34;&gt;Lambdaã§ã¯&lt;/h2&gt;

&lt;p&gt;Lambdaã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹iconvã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;return new Promise((resolve, reject) =&amp;gt; {
    let filePath = &amp;quot;/tmp/shiftjis&amp;quot;;
    fs.writeFileSync(filePath, shiftjis);
    var exec = require(&#39;child_process&#39;).exec;
    var cmd = `iconv -c -f sjis -t utf-8 ${filePath}`;
    var child = exec(cmd, (err, stdout, stderr) =&amp;gt; {
      if (err) reject(err);
      else resolve(stdout);
    });
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.bokukoko.info/entry/2015/08/30/AWS_Lambda%E5%86%85%E3%81%A7%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95&#34;&gt;AWS Lambdaå†…ã§æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›ã™ã‚‹æ–¹æ³• - ãƒœã‚¯ã‚³ã‚³&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Fluentdã¨KPL(Kinesis Producer Library)ã§ãƒ­ã‚°ã‚’ã¾ã¨ã‚ã¦ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’ç¨¼ã</title>
          <link>http://sambaiz.net/article/84/</link>
          <pubDate>Wed, 15 Mar 2017 23:00:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/84/</guid>
          <description>

&lt;h2 id=&#34;kpl-kinesis-producer-library-ã¨ã¯&#34;&gt;KPL(Kinesis Producer Library)ã¨ã¯&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/streams/latest/dev/developing-producers-with-kpl.html&#34;&gt;Developing Amazon Kinesis Streams Producers Using the Amazon Kinesis Producer Library - Amazon Kinesis Streams&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Kinesisã«é€ã‚‹ã¨ãã€è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã—ã¦ãã‚ŒãŸã‚Šã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã¦ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’å‘ä¸Šã—ã¦ãã‚ŒãŸã‚Šã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚Protobufã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚
æ™®é€šã«é€ã‚‹ã¨ã©ã‚“ãªã«å°ã•ãã¦ã‚‚ã‚·ãƒ£ãƒ¼ãƒ‰*1000ãƒ¬ã‚³ãƒ¼ãƒ‰/ç§’ã—ã‹æœ€å¤§ã§PUTã§ããªã„ã®ã‚’ã€KPLã‚’ä½¿ã£ã¦ã¾ã¨ã‚ã‚‹ã“ã¨ã§å¢—ã‚„ã™ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;fluentdã§é€ã‚‹&#34;&gt;fluentdã§é€ã‚‹&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/awslabs/aws-fluent-plugin-kinesis&#34;&gt;aws-fluent-plugin-kinesis&lt;/a&gt;ã§&lt;code&gt;kinesis_producer&lt;/code&gt;ã‚’æŒ‡å®šã™ã‚‹ã¨KPLã‚’ä½¿ã£ã¦é€ä¿¡ã™ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;&amp;lt;kinesis_producer&amp;gt;&lt;/code&gt;ã®ä¸­ã«KPLã®è¨­å®šã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;kinesis_producer&amp;gt;
    record_max_buffered_time 10
&amp;lt;/kinesis_producer&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/awslabs/amazon-kinesis-producer/blob/v0.10.2/java/amazon-kinesis-producer-sample/default_config.properties#L239&#34;&gt;record_max_bufferd_time&lt;/a&gt;
ã¯ãƒãƒƒãƒ•ã‚¡ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ãŒé€ã‚‰ã‚Œã‚‹ã¾ã§ã®æœ€å¤§æ™‚é–“(ms)ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯100msã€‚ã“ã®æ™‚é–“ãŒçµŒã¤ã‹ã€ä»–ã®ãƒªãƒŸãƒƒãƒˆã«å½“ãŸã£ãŸã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯é€ã‚‰ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/awslabs/amazon-kinesis-producer/blob/v0.10.2/java/amazon-kinesis-producer-sample/default_config.properties#L30&#34;&gt;AggregationMaxCount&lt;/a&gt;: ä¸€ã¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¾ã¨ã‚ã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/awslabs/amazon-kinesis-producer/blob/v0.10.2/java/amazon-kinesis-producer-sample/default_config.properties#L44&#34;&gt;AggregationMaxSize&lt;/a&gt;: ã¾ã¨ã‚ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®æœ€å¤§ãƒã‚¤ãƒˆæ•°&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/awslabs/amazon-kinesis-producer/blob/v0.10.2/java/amazon-kinesis-producer-sample/default_config.properties#L54&#34;&gt;CollectionMaxCount&lt;/a&gt;: PutRecordsã§é€ã‚‹æœ€å¤§ã‚¢ã‚¤ãƒ†ãƒ æ•°&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/awslabs/amazon-kinesis-producer/blob/v0.10.2/java/amazon-kinesis-producer-sample/default_config.properties#L67&#34;&gt;CollectionMaxSize&lt;/a&gt;: PutRecordsã§é€ã‚‹ãƒ‡ãƒ¼ã‚¿é‡&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;CloudWatchã«é€ã‚‹&lt;a href=&#34;https://github.com/awslabs/amazon-kinesis-producer/blob/v0.10.2/java/amazon-kinesis-producer-sample/default_config.properties#L158&#34;&gt;metrics_level&lt;/a&gt;ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§detailedã«ãªã£ã¦ã„ã¦ã€
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‹ã‚‰streamåã§æ¤œç´¢ã™ã‚‹ã¨
&lt;code&gt;KinesisProducerLibrary&lt;/code&gt;ã«&lt;code&gt;UserRecordsPerKinesisRecord&lt;/code&gt;ã‚„ã€&lt;code&gt;UserRecordsDataPut&lt;/code&gt;ã€&lt;code&gt;BufferingTime&lt;/code&gt;ã€&lt;code&gt;RequestTime&lt;/code&gt;ãªã©ã„ã‚ã„ã‚è¡¨ç¤ºã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ã¨ã‚Šã‚ãˆãšè©¦ã—ã«ã“ã‚“ãªè¨­å®šã§é€ã£ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;match hoge.log&amp;gt;
  @type kinesis_producer
  region ap-northeast-1
  stream_name teststream
  include_time_key true

  flush_interval 1
  buffer_chunk_limit 1m
  try_flush_interval 0.1
  queued_chunk_flush_interval 0.01
  num_threads 15
&amp;lt;/match&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;lambdaã§èª­ã‚€&#34;&gt;Lambdaã§èª­ã‚€&lt;/h2&gt;

&lt;p&gt;ã¾ã¨ã‚ã‚‰ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’&lt;a href=&#34;https://github.com/awslabs/kinesis-aggregation&#34;&gt;kinesis-aggregation&lt;/a&gt;ã§åˆ†è§£ã—ã¦èª­ã‚€ã€‚
ä»Šå›ã¯&lt;a href=&#34;https://github.com/awslabs/kinesis-aggregation/tree/master/node&#34;&gt;Node.js&lt;/a&gt;ã§ã‚„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm install --save aws-kinesis-agg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã¯&lt;a href=&#34;https://github.com/awslabs/kinesis-aggregation/issues/16&#34;&gt;ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æƒ…å ±ãŒå¤ã&lt;/a&gt;ã¦ã€
é–¢æ•°ã®å¼•æ•°ãŒè¶³ã‚Šãªã„ã“ã¨ã€‚ç¬¬äºŒå¼•æ•°ã®computeChecksumsãŒæŠœã‘ã¦ã„ã‚‹ã®ã§æ°—ä»˜ã‹ãªã„ã¨ä¸€ã¤ãšã¤ãšã‚Œã¦ã„ãã“ã¨ã«ãªã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&#39;use strict&#39;;

const agg = require(&#39;aws-kinesis-agg&#39;);

exports.handler = (event, context, callback) =&amp;gt; {
    Promise.all(
        event.Records.map(
            (record) =&amp;gt; deaggregate(record)
        )
    ).then(
        (records) =&amp;gt; {
            // Lambdaã®Node.jsã¯ã¾ã 4.3ãªã®ã§Spread operatorãŒä½¿ãˆãªã„ãƒ»ãƒ»ãƒ»
            // const message = `${[].concat(...records).length} came in`; 
            let sumCount = 0;
            records.forEach((r) =&amp;gt; sumCount += r.length);
            const message = `${records.length} aggregated records and ${sumCount} records come in`; 
            console.log(message);
            callback(null, message);
        },
        (err) =&amp;gt; callback(err)
    );
};

function deaggregate(record){
    return new Promise((resolve, reject) =&amp;gt; {
        agg.deaggregateSync(record.kinesis, true, (err, userRecords) =&amp;gt; {
            if (err) {
                reject(err);
            } else {
                resolve(userRecords);
            }
        });
    });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;175ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ10ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¾ã¨ã‚ã‚‰ã‚ŒãŸã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;10 aggregated records and 175 records come in
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://dev.classmethod.jp/cloud/aws/high-throughput-messaging-system-with-kinesis-kpl-fluentd-lambda/&#34;&gt;Kinesis Producer Library(KPL)ã¨fluentdã¨Lambdaã‚’é€£æºã—ã¦Kinesisã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’ä¸Šã’ã‚‹ ï½œ Developers.IO&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>fluentdã§Kinesis Streamsã«é€ã£ã¦Lambdaã§èª­ã‚“ã§S3ã«ä¿å­˜ã™ã‚‹</title>
          <link>http://sambaiz.net/article/73/</link>
          <pubDate>Sun, 26 Feb 2017 18:56:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/73/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;https://github.com/awslabs/aws-fluent-plugin-kinesis&#34;&gt;aws-fluent-plugin-kinesis&lt;/a&gt;ã§Kinesis Streamsã«é€ã‚Šã€Lambdaã§èª­ã‚“ã§S3ã«ä¿å­˜ã™ã‚‹ã€‚
è¦ã™ã‚‹ã«Firehoseã®ã‚ˆã†ãªã“ã¨ã‚’ã‚„ã‚ŠãŸã„ã®ã ã‘ã‚Œã©Tokyoãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¾ã æ¥ãªã„ã®ã§è‡ªåˆ†ã§ã‚„ã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;fluentdã§é€ã‚‹&#34;&gt;fluentdã§é€ã‚‹&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;$ td-agent-gem install fluent-plugin-kinesis
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;try_flush_interval&lt;/code&gt;ã¨&lt;code&gt;queued_chunk_flush_interval&lt;/code&gt;ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯è¼‰ã£ã¦ã„ãªã„ãŒã€
ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã«ã‚ˆã‚‹ã¨ãã‚Œãã‚Œqueueã«æ¬¡ã®chunkãŒãªã„ã¨ãã¨ã‚ã‚‹ã¨ãã®flushã™ã‚‹é–“éš”ã€‚
ã„ãšã‚Œã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1ã ãŒã€ã“ã‚Œã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã‚‚ã£ã¨é »ç¹ã«åãå‡ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã‚‰ã—ã„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/sonots/fluentd-scr/blob/master/02_out_forward_buffered.md&#34;&gt;Fluentd ã® out_forward ã¨ BufferedOutput&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ã‚ã¨ã‚·ãƒ£ãƒ¼ãƒ‰ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ãŸã‚ã®&lt;a href=&#34;https://github.com/awslabs/aws-fluent-plugin-kinesis#partition_key&#34;&gt;partition_key&lt;/a&gt;
ã‚’æŒ‡å®šã§ãã‚‹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ©ãƒ³ãƒ€ãƒ ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;source&amp;gt;
  @type tail
  path /var/log/td-agent/hoge.log
  pos_file /etc/td-agent/log.pos
  tag hoge.log
  format json

  time_key timestamp
  # 2017-01-01T01:01:01+0900
  time_format %Y-%m-%dT%H:%M:%S%z
&amp;lt;/source&amp;gt;

&amp;lt;match hoge.log&amp;gt;
  @type kinesis_streams
  region ap-northeast-1
  stream_name teststream
  include_time_key true

  flush_interval 1
  buffer_chunk_limit 1m
  try_flush_interval 0.1
  queued_chunk_flush_interval 0.01
  num_threads 15
&amp;lt;/match&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã„ãã¤ã‹é€ã£ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;for i in `seq 1 1000`
do
  echo &#39;{&amp;quot;hoge&amp;quot;: &amp;quot;fuga&amp;quot;, &amp;quot;timestamp&amp;quot;: &amp;quot;2017-01-01T01:01:01+0900&amp;quot;}&#39; &amp;gt;&amp;gt; /var/log/td-agent/hoge.log
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;kinesisã®ã‚·ãƒ£ãƒ¼ãƒ‰ãŒè¶³ã‚Šãªã„ã¨è©°ã¾ã£ã¦ã—ã¾ã†ã®ã§æ³¨æ„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://sambaiz.net/article/84/&#34;&gt;Fluentdã¨KPL(Kinesis Producer Library)ã§ãƒ­ã‚°ã‚’ã¾ã¨ã‚ã¦ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’ç¨¼ã - sambaiz.net&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;lambdaã§èª­ã‚€&#34;&gt;Lambdaã§èª­ã‚€&lt;/h2&gt;

&lt;p&gt;Lambdaã®ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®šã§Kinesisã‚’é¸ã¶ã¨ã€ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚„é–‹å§‹ä½ç½®ã‚’è¨­å®šã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/73-lambda-kinesis.png&#34; alt=&#34;ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®š&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ã‚³ãƒ¼ãƒ‰ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&#39;use strict&#39;;

const zlib = require(&#39;zlib&#39;);
const aws = require(&#39;aws-sdk&#39;);
const s3 = new aws.S3({ apiVersion: &#39;2006-03-01&#39; });
const BUCKET_NAME = process.env.BUCKET_NAME; // ç’°å¢ƒå¤‰æ•°ã§è¨­å®šã™ã‚‹

exports.handler = (event, context, callback) =&amp;gt; {

    const data = event.Records.map((record) =&amp;gt; new Buffer(record.kinesis.data, &#39;base64&#39;).toString()).join(&amp;quot;\n&amp;quot;);
    const key = new Date().toISOString();
    
    putS3(key, data, true).then(
        (data) =&amp;gt; callback(null, `Successfully processed ${event.Records.length} records.`),
        (err) =&amp;gt; callback(err, null)
    );
};

function putS3(key, data, gzip){    
    return new Promise((resolve, reject) =&amp;gt; {
        
        const params = {
            Bucket: BUCKET_NAME,
            Key: key
        };

        if(gzip){
            params.Body = zlib.gzipSync(data);
            params.ContentEncoding = &amp;quot;gzip&amp;quot;;
        }else{
            params.Body = data;
        }
        
        s3.putObject(params, (err, data) =&amp;gt; {
            if (err) reject(err);
            else resolve(data);
        });
    });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãƒˆãƒªã‚¬ãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¦S3ã«ä¿å­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>AWSã®AssumeRole</title>
          <link>http://sambaiz.net/article/72/</link>
          <pubDate>Sat, 25 Feb 2017 20:40:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/72/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_temp.html&#34;&gt;AWS Security Token Service&lt;/a&gt;ã«ã‚ˆã‚‹ã€
RoleArn(&lt;code&gt;arn:aws:iam::&amp;lt;account id&amp;gt;:role/&amp;lt;role name&amp;gt;&lt;/code&gt;)ã‹ã‚‰ä¸€æ™‚çš„ãªCredentialã‚’å–å¾—ã™ã‚‹ä»•çµ„ã¿ã€‚
å‰ã‚‚ã£ã¦ç™ºè¡Œã—ãŸAPIã‚­ãƒ¼ã¨ã¯é•ã„ã€æœ‰åŠ¹æœŸé™ãŒå­˜åœ¨ã™ã‚‹ãŸã‚ç¶šã‘ã¦å‘¼ã¶å ´åˆã¯å¤±åŠ¹ã™ã‚‹å‰ã«å†ç™ºè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ã§ã¯RoleArnã‚’çŸ¥ã£ã¦ã„ãŸã‚‰èª°ã§ã‚‚å–å¾—ã§ãã‚‹ã‹ã¨ã„ã†ã¨ã€ã‚‚ã¡ã‚ã‚“ãã†ã§ã¯ãªãã€
ãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼é–¢ä¿‚ã€&lt;code&gt;&amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot;&lt;/code&gt;ã®Principalã®ã¨ã“ã‚ã§ä¿¡é ¼ã™ã‚‹å¯¾è±¡ã‚’è¨­å®šã™ã‚‹ã€‚
ä¾‹ãˆã°ã€&lt;code&gt;Service&lt;/code&gt;ã§&lt;code&gt;ec2.amazonaws.com&lt;/code&gt;ã‚’æŒ‡å®šã—ã¦EC2ãŒAssumeRoleã™ã‚‹ã®ã‚’è¨±å¯ã—ãŸã‚Šã€
&lt;code&gt;AWS&lt;/code&gt;ã§(ä»–ã®)ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŒ‡å®šã—ã¦ãã®APIã‚­ãƒ¼ã§ã“ã®Roleã®Credentialã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã‚Šã¨ã„ã£ãŸæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Principal&amp;quot;: {
        &amp;quot;Service&amp;quot;: &amp;quot;ec2.amazonaws.com&amp;quot;
      },
      &amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot;
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;EC2ã«ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã¨ã€å®Ÿã¯ãã®ãƒ­ãƒ¼ãƒ«ã«ã¤ã„ã¦AssumeRoleã—ã¦è‡ªå‹•ã§Credentialã‚’å–å¾—ã—ã¦ã„ã‚‹ã€‚
EC2ã«ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã«ã¯ãƒ­ãƒ¼ãƒ«ã¨ã¯åˆ¥ã«
&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html&#34;&gt;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ&lt;/a&gt;
ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§EC2ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚’ä½œã‚‹ã¨åŒåã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ã§ä½œæˆã•ã‚Œã‚‹ã€‚
ã•ã‚‰ã«ã€AssumeRoleã®Serviceã¨ã—ã¦&lt;code&gt;ec2.amazonaws.com&lt;/code&gt;ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl http://169.254.169.254/latest/meta-data/iam/info
{
  &amp;quot;Code&amp;quot; : &amp;quot;Success&amp;quot;,
  &amp;quot;LastUpdated&amp;quot; : &amp;quot;2017-02-25T10:56:33Z&amp;quot;,
  &amp;quot;InstanceProfileArn&amp;quot; : &amp;quot;arn:aws:iam::*****:instance-profile/assume_role_test&amp;quot;,
  &amp;quot;InstanceProfileId&amp;quot; : &amp;quot;*****&amp;quot;
}

$ curl http://169.254.169.254/latest/meta-data/iam/security-credentials/assume_role_test
{
  &amp;quot;Code&amp;quot; : &amp;quot;Success&amp;quot;,
  &amp;quot;LastUpdated&amp;quot; : &amp;quot;2017-02-25T10:56:23Z&amp;quot;,
  &amp;quot;Type&amp;quot; : &amp;quot;AWS-HMAC&amp;quot;,
  &amp;quot;AccessKeyId&amp;quot; : &amp;quot;*****&amp;quot;,
  &amp;quot;SecretAccessKey&amp;quot; : &amp;quot;*****&amp;quot;,
  &amp;quot;Token&amp;quot; : &amp;quot;*****&amp;quot;,
  &amp;quot;Expiration&amp;quot; : &amp;quot;2017-02-25T17:26:07Z&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://dev.classmethod.jp/cloud/aws/iam-role-and-assumerole/&#34;&gt;IAMãƒ­ãƒ¼ãƒ«å¾¹åº•ç†è§£ ã€œ AssumeRoleã®æ­£ä½“ ï½œ Developers.IO&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_temp_use-resources.html&#34;&gt;ä¸€æ™‚çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ AWS ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ - AWS Identity and Access Management&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>ELBã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¨surge queue</title>
          <link>http://sambaiz.net/article/68/</link>
          <pubDate>Tue, 21 Feb 2017 19:48:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/68/</guid>
          <description>

&lt;p&gt;ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã ã‘ã§ã¯ãªãELBè‡ªä½“ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã€å†…éƒ¨nodeæ•°ã¯digã§èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
ã“ã®nodeæ•°ã¯è‡ªåˆ†ã§ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ããšã€åŸºæœ¬çš„ã«æ„è­˜ã™ã‚‹ã“ã¨ã¯ãªã„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ dig ****.ap-northeast-1.elb.amazonaws.com

;; ANSWER SECTION:
*****.elb.amazonaws.com. 60 IN A xxx.xxx.xxx.xxx
*****.elb.amazonaws.com. 60 IN A yyy.yyy.yyy.yyy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;nodeãŒå¢—ãˆã‚‹ã®ã«ã¯ã‚ã‚‹ç¨‹åº¦æ™‚é–“ãŒã‹ã‹ã‚‹ã®ã§ã€
ã‚¢ã‚¯ã‚»ã‚¹ãŒæ€¥å¢—(5åˆ†é–“ã§50%ä»¥ä¸Šã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¢—åŠ ãŒ&lt;a href=&#34;http://aws.typepad.com/sajp/2015/05/aws-black-belt-elb.html&#34;&gt;ç›®å®‰&lt;/a&gt;)
ã—ãŸã‚‰æŒããã‚Œãšã€503ã‚’è¿”ã™ã“ã¨ãŒã‚ã‚‹ã€‚
å‰ã‚‚ã£ã¦å¤šé‡ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ¥ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã¦ã€
&lt;a href=&#34;https://aws.amazon.com/jp/premiumsupport/signup/&#34;&gt;AWSã‚µãƒãƒ¼ãƒˆ&lt;/a&gt;ãŒBusinessä»¥ä¸Šãªã‚‰
pre-warmingç”³è«‹ã™ã‚‹ã“ã¨ã§nodeãŒå¢—ãˆãŸçŠ¶æ…‹ã§å¾…ã¡æ§‹ãˆã‚‰ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã§ããªã„å ´åˆã€ELBã®surge queueã«æºœã¾ã£ã¦ã„ãã€‚
ã“ã®æ•°ã¯CloudWatchã®SurgeQueueLength(ã‚­ãƒ¥ãƒ¼é•·ã®æ€¥å¢—)ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç¢ºèªã§ãã‚‹ã€‚
ã¾ãŸã€SurgeQueueLengthã®æœ€å¤§å€¤1024ã‚’è¶…ãˆã‚‹ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ‹’å¦ã•ã‚Œã€ãã®æ•°ã¯SpoiloverCount(éå‰°æ•°)ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å‡ºã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://dev.classmethod.jp/cloud/aws/elb-and-cloudwatch-metrics-in-depth/&#34;&gt;ELBã®æŒ™å‹•ã¨CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®èª­ã¿æ–¹ã‚’å¾¹åº•çš„ã«ç†è§£ã™ã‚‹ ï½œ Developers.IO&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/premiumsupport/knowledge-center/elb-latency-troubleshooting/&#34;&gt;Elastic Load Balancing ã§ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Kinesis Streams/Firehose/Analyticsã‚’è©¦ã™</title>
          <link>http://sambaiz.net/article/67/</link>
          <pubDate>Mon, 20 Feb 2017 21:15:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/67/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/&#34;&gt;https://aws.amazon.com/jp/kinesis/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã‚µãƒ¼ãƒ“ã‚¹ç¾¤ã€‚
ã„ã¾ã®ã¨ã“ã‚Tokyoãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯Kinesis Streamsã—ã‹ä½¿ãˆãªã„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;kinesis-firehose-https-aws-amazon-com-jp-kinesis-firehose&#34;&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/firehose/&#34;&gt;Kinesis Firehose&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;AWSã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«é€ã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€‚è‡ªåˆ†ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚€å‡¦ç†ã‚’æ›¸ã‹ãªãã¦ã‚ˆãã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚‚å‹æ‰‹ã«ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ç°¡å˜ã«ä½¿ãˆã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/firehose/faqs/&#34;&gt;https://aws.amazon.com/jp/kinesis/firehose/faqs/&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Q: é€ä¿¡å…ˆã¨ã¯ä½•ã§ã™ã‹?
é€ä¿¡å…ˆã¯ãƒ‡ãƒ¼ã‚¿ãŒé…ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã§ã™ã€‚Amazon Kinesis Firehose ã§ã¯ã€
ç¾åœ¨é€ä¿¡å…ˆã¨ã—ã¦ Amazon S3ã€Amazon Redshiftã€Amazon Elasticsearch Service ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/firehose/pricing/&#34;&gt;æ–™é‡‘&lt;/a&gt;ã¯å–ã‚Šè¾¼ã¾ã‚ŒãŸãƒ‡ãƒ¼ã‚¿é‡ã«ã‚ˆã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå›ã¯S3ã«é€ã£ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/64-create-firehose.png&#34; alt=&#34;firehoseä½œæˆ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ§ç¸®æ–¹æ³•ã‚’è¨­å®šã—ãŸã‚Šã€Lambdaã‚’å™›ã¾ã›ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/64-create-firehose2.png&#34; alt=&#34;firehoseä½œæˆ2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;StatusãŒActiveã«ãªã£ãŸã‚‰&lt;a href=&#34;http://docs.aws.amazon.com/firehose/latest/dev/writing-with-agents.html&#34;&gt;Kinesis Agent&lt;/a&gt;ã§é€ã£ã¦ã¿ã‚‹ã€‚
CloudWatchã¨Firehoseã«Putã™ã‚‹æ¨©é™ãŒå¿…è¦ã€‚Firehoseã¯kinesis:ã§ã¯ãªãfirehose:ãªã®ã§æ³¨æ„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo yum install â€“y aws-kinesis-agent
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;/etc/aws-kinesis/agent.json&lt;/code&gt;ã‚’ç·¨é›†ã™ã‚‹ã€‚ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯
&lt;a href=&#34;https://docs.aws.amazon.com/ja_jp/general/latest/gr/rande.html#fh_region&#34;&gt;ã“ã“&lt;/a&gt;
ã«ã‚ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
    &amp;quot;awsAccessKeyId&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;awsSecretAccessKey&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;firehose.endpoint&amp;quot;: &amp;quot;https://firehose.us-east-1.amazonaws.com&amp;quot;, 
    &amp;quot;flows&amp;quot;: [
        {
            &amp;quot;filePattern&amp;quot;: &amp;quot;/tmp/hoge.log&amp;quot;, 
            &amp;quot;deliveryStream&amp;quot;: &amp;quot;hogefugastream&amp;quot;
        }
    ] 
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ sudo service aws-kinesis-agent start
$ sudo chkconfig aws-kinesis-agent on
$ echo &amp;quot;aaa&amp;quot; &amp;gt;&amp;gt; /tmp/hoge.log
$ tail /var/log/aws-kinesis-agent/aws-kinesis-agent.log
com.amazon.kinesis.streaming.agent.Agent [INFO] Agent: Progress: 2 records parsed (168 bytes), 
and 2 records sent successfully to destinations. Uptime: 300044ms
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;S3ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã®ã‚’ç¢ºèªã€‚&lt;/p&gt;

&lt;h3 id=&#34;kinesis-streams-https-aws-amazon-com-jp-kinesis-streams&#34;&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/streams/&#34;&gt;Kinesis Streams&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;ç”¨é€”ã‚’åˆ¶é™ã—ãªã„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒæœŸé–“ã®é–“ã€ä½•åº¦ã§ã‚‚èª­ã‚€ã“ã¨ãŒã§ãã‚‹ã®ã§ã€
ã¨ã‚Šã‚ãˆãšå¿…è¦ãªã ã‘ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’å¢—ã‚„ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ãŠã‘ã°ã©ã†ã«ã‹ãªã‚‹ã€‚
ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†å´ã¯ãã‚Œãã‚Œç‹¬ç«‹ã«å¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å¿…è¦ãªã ã‘pullã™ã‚‹ãŸã‚ã€ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹ã«ã‚ãŸã£ã¦ãã®å…ˆã¯åˆ¥ã«è€ƒãˆã‚‹ã“ã¨ãŒã§ãã€
é«˜è² è·ãªã‚·ã‚¹ãƒ†ãƒ ã®log aggregatorã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/streams/pricing/&#34;&gt;æ–™é‡‘&lt;/a&gt;ã¯&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ™‚é–“å˜ä½ã®ã‚·ãƒ£ãƒ¼ãƒ‰é€Ÿåº¦ï¼š 1ã‚·ãƒ£ãƒ¼ãƒ‰ã¯æœ€å¤§1000ä»¶/ç§’ã®1MB/ç§’ã®å…¥åŠ›ã¨2MB/ç§’ã®å‡ºåŠ›èƒ½åŠ›ãŒã‚ã‚‹ã€‚&lt;/li&gt;
&lt;li&gt;PUTãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆ: è¿½åŠ ã™ã‚‹25KBã®ãƒãƒ£ãƒ³ã‚¯ã®æ•°ã€‚5KBã§ã‚‚1ãƒãƒ£ãƒ³ã‚¯ã€‚&lt;/li&gt;
&lt;li&gt;ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§24æ™‚é–“ã€‚7æ—¥ã¾ã§å»¶é•·å¯èƒ½ã€‚ã‚·ãƒ£ãƒ¼ãƒ‰æ™‚é–“ã”ã¨ã«èª²é‡‘ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ã«ã‚ˆã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ã‚¹ãƒˆãƒªãƒ¼ãƒ ä½œæˆæ™‚ã¯ã‚·ãƒ£ãƒ¼ãƒ‰æ•°ã‚’å…¥ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/64-create-streams.png&#34; alt=&#34;streamsä½œæˆ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Firehoseã¨åŒã˜ãKinesis Agentã§é€ã£ã¦ã¿ã‚‹ã€‚
ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯&lt;a href=&#34;https://docs.aws.amazon.com/ja_jp/general/latest/gr/rande.html#ak_region&#34;&gt;ã“ã“&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
    &amp;quot;awsAccessKeyId&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;awsSecretAccessKey&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;kinesis.endpoint&amp;quot;: &amp;quot;https://kinesis.us-east-1.amazonaws.com&amp;quot;, 
    &amp;quot;flows&amp;quot;: [
        {
            &amp;quot;filePattern&amp;quot;: &amp;quot;/tmp/hoge.log&amp;quot;, 
            &amp;quot;kinesisStream&amp;quot;: &amp;quot;fugafugastream&amp;quot;
        }
    ] 
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;aws-cliã§ãƒ‡ãƒ¼ã‚¿ã‚’&lt;a href=&#34;https://docs.aws.amazon.com/ja_jp/streams/latest/dev/fundamental-stream.html#get-records&#34;&gt;å–å¾—ã™ã‚‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãšã€ã‚·ãƒ£ãƒ¼ãƒ‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’å–å¾—ã™ã‚‹ã€‚æœ‰åŠ¹æ™‚é–“ã¯300ç§’ã€‚
&lt;a href=&#34;http://docs.aws.amazon.com/kinesis/latest/APIReference/API_GetShardIterator.html#API_GetShardIterator_RequestSyntax&#34;&gt;TRIM_HORIZON&lt;/a&gt;
ã§æœ€ã‚‚å¤ã„æ–¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãã€‚SequenceNumberã‚’æŒ‡å®šã—ã¦é€”ä¸­ã‹ã‚‰èª­ã‚€ã“ã¨ã‚‚ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aws kinesis get-shard-iterator --shard-id shardId-000000000000 --shard-iterator-type TRIM_HORIZON --stream-name fugafugastream
{
    &amp;quot;ShardIterator&amp;quot;: &amp;quot;AAAAAAAAAAFjKI0neNqY2N5HzGljYFCzoFqpQsdncdC6xE+ylnqvZpmusNfyViY3hBSS8WQXa67gvtkF0f2eKzxQ/Fd7SXZG8Inkb8l1UDF5t+jHgErA28gVSWyT4uYxTzzbnhm9AhcbztyQrjqehYcjEfpWIz5XmhY9K3Kjp0Crygy+OYNSS5PoQFcB1PZ7xMFE8zLTxJXLv1ANRu0Q+1m/JFxKQ3WS&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã®ã‚·ãƒ£ãƒ¼ãƒ‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦get-recordsã™ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ã¯Base64ã§å…¥ã£ã¦ã„ã‚‹ã®ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ç¢ºèªã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aws kinesis get-records --shard-iterator AAAAAAAAAAFjKI0neNqY2N5HzGljYFCzoFqpQsdncdC6xE+ylnqvZpmusNfyViY3hBSS8WQXa67gvtkF0f2eKzxQ/Fd7SXZG8Inkb8l1UDF5t+jHgErA28gVSWyT4uYxTzzbnhm9AhcbztyQrjqehYcjEfpWIz5XmhY9K3Kjp0Crygy+OYNSS5PoQFcB1PZ7xMFE8zLTxJXLv1ANRu0Q+1m/JFxKQ3WS
{
    &amp;quot;Records&amp;quot;: [
        {
            &amp;quot;Data&amp;quot;: &amp;quot;YWFhCg==&amp;quot;, 
            &amp;quot;PartitionKey&amp;quot;: &amp;quot;999679.8130737302&amp;quot;, 
            &amp;quot;ApproximateArrivalTimestamp&amp;quot;: 1487082145.518, 
            &amp;quot;SequenceNumber&amp;quot;: &amp;quot;49570460043263608661463102123405561406360875697772167170&amp;quot;
        }, 
        ...
    ], 
    &amp;quot;NextShardIterator&amp;quot;: &amp;quot;AAAAAAAAAAE08GRdLF1d76L1wCyLIiuAgpSEkKZSkUEO0VdUt3EOfdm1oOSXA1Xc4+tJPkSmB8g5NaQqDPRS/67u5IXermTUiAj6g2lgvDCGCqWFcYMAxIwIKZjKluCPQjL9kRaUqfVAaElRoKjp4Gv7JmuBDjKpxsbF2yk4uJJDAcevqH/VVkala8UbdhTweGyFgf9VhP/ljzXlrqkZ8wbD0eFwtZ3x&amp;quot;, 
    &amp;quot;MillisBehindLatest&amp;quot;: 0
}

$ echo &amp;quot;YWFhCg==&amp;quot; | base64 -d
aaa
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;kinesis-analytics-https-aws-amazon-com-jp-kinesis-analytics&#34;&gt;&lt;a href=&#34;https://aws.amazon.com/jp/kinesis/analytics/&#34;&gt;Kinesis Analytics&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Sourceã¨ãªã‚‹Kinesis Streamsã‹ã€Firehoseã‚’æŒ‡å®šã—ã€SQLã‚’å®Ÿè¡Œã§ãã‚‹ã€‚ãã—ã¦å¿…è¦ãªã‚‰æ¬¡ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/64-create-analytics.png&#34; alt=&#34;analyticsä½œæˆ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä»Šå›ã¯Sourceã¨ã—ã¦jsonã§æ ªä¾¡ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹Demo streamã‚’ä½¿ã†ã€‚
ã„ãã¤ã‹SQLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ã€ãã®ä¸­ã®Continuous Filterã‚’é¸æŠã€‚
Streamã«å…¥ã£ã¦ããŸã‚‚ã®ã‚’TECHã§çµã£ã¦å‡ºåŠ›ã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-- ** Continuous Filter ** 
-- Performs a continuous filter based on a WHERE condition.
--          .----------.   .----------.   .----------.              
--          |  SOURCE  |   |  INSERT  |   |  DESTIN. |              
-- Source--&amp;gt;|  STREAM  |--&amp;gt;| &amp;amp; SELECT |--&amp;gt;|  STREAM  |--&amp;gt;Destination
--          |          |   |  (PUMP)  |   |          |              
--          &#39;----------&#39;   &#39;----------&#39;   &#39;----------&#39;               
-- STREAM (in-application): a continuously updated entity that you can SELECT from and INSERT into like a TABLE
-- PUMP: an entity used to continuously &#39;SELECT ... FROM&#39; a source STREAM, and INSERT SQL results into an output STREAM
-- Create output stream, which can be used to send to a destination
CREATE OR REPLACE STREAM &amp;quot;DESTINATION_SQL_STREAM&amp;quot; (ticker_symbol VARCHAR(4), sector VARCHAR(12), change REAL, price REAL);
-- Create pump to insert into output 
CREATE OR REPLACE PUMP &amp;quot;STREAM_PUMP&amp;quot; AS INSERT INTO &amp;quot;DESTINATION_SQL_STREAM&amp;quot;
-- Select all columns from source stream
SELECT STREAM ticker_symbol, sector, change, price
FROM &amp;quot;SOURCE_SQL_STREAM_001&amp;quot;
-- LIKE compares a string to a string pattern (_ matches all char, % matches substring)
-- SIMILAR TO compares string to a regex, may use ESCAPE
WHERE sector SIMILAR TO &#39;%TECH%&#39;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/64-run-analytics.png&#34; alt=&#34;analyticså®Ÿè¡Œ&#34; /&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Goã§DynamoDBã‚’ä½¿ã†</title>
          <link>http://sambaiz.net/article/63/</link>
          <pubDate>Sun, 12 Feb 2017 23:15:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/63/</guid>
          <description>

&lt;h2 id=&#34;ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹&#34;&gt;ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹&lt;/h2&gt;

&lt;h3 id=&#34;ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼&#34;&gt;ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/GuidelinesForTables.html&#34;&gt;ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ“ä½œã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ - Amazon DynamoDB&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼(ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ¼)ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ãƒˆã‚­ãƒ¼(ãƒ¬ãƒ³ã‚¸ã‚­ãƒ¼)ã‚’è¨­å®šã™ã‚‹ã€‚
DynamoDBã¯ã“ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã«åŸºã¥ã„ã¦ã€è¤‡æ•°ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«åˆ†æ•£ã—ã¦ä¿å­˜ã™ã‚‹ã€‚
ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ€§èƒ½ã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³é–“ã§å‡ç­‰ã«ä½¿ã‚ã‚Œã‚‹ã®ã§ã€
ã‚½ãƒ¼ãƒˆã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹å ´åˆã«ã“ã‚Œã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€
ã‚ã‚‹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé›†ä¸­ã—ãªã„ã‚ˆã†ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã«ç‰¹å®šã®å€¤ã°ã‹ã‚Šé›†ä¸­ã—ãªã„ã‚ˆã†ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’
é¸ã¶å¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹&#34;&gt;ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹&lt;/h3&gt;

&lt;p&gt;ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(GSI)ã¨
ã‚½ãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(LSI)ãŒã‚ã‚‹ã€‚
å°„å½±ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é¸æŠã§ãã€ã“ã“ã«å«ã¾ã‚Œãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯è¿”ã•ãªã„ã€‚
ãŸã ã—ã€ã™ã¹ã¦ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«æ›¸ãè¾¼ã‚€ã®ã¯ã‚³ã‚¹ãƒˆãŒé«˜ã„ã®ã§ãªã‚‹ã¹ãçµã‚‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ-http-docs-aws-amazon-com-ja-jp-amazondynamodb-latest-developerguide-limits-html-limits-capacity-units-provisioned-throughpu&#34;&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/Limits.html#limits-capacity-units-provisioned-throughpu&#34;&gt;ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ&lt;/a&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;1èª­ã¿è¾¼ã¿ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ: 4kbã‚’è¶…ãˆãªã„ãƒ‡ãƒ¼ã‚¿ã‚’1ç§’ã«1~2å›(æ•´åˆæ€§ã«ã‚ˆã‚‹)èª­ã¿è¾¼ã‚ã‚‹&lt;/li&gt;
&lt;li&gt;1æ›¸ãè¾¼ã¿ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ: 1kbã‚’è¶…ãˆãªã„ãƒ‡ãƒ¼ã‚¿ã‚’1ç§’ã«1å›æ›¸ãè¾¼ã‚ã‚‹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ãƒ¦ãƒ‹ãƒƒãƒˆã«å¿œã˜ã¦1æ™‚é–“ã‚ãŸã‚Šã§&lt;a href=&#34;https://aws.amazon.com/jp/dynamodb/pricing/&#34;&gt;èª²é‡‘&lt;/a&gt;ã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;æœªä½¿ç”¨ã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãŒã‚ã‚‹å ´åˆã€æœ€å¤§5åˆ†ä¿æŒã—ã¦&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/GuidelinesForTables.html#GuidelinesForTables.Bursting&#34;&gt;ãƒãƒ¼ã‚¹ãƒˆã«å‚™ãˆã¦ãã‚Œã‚‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;èª­ã¿æ›¸ãã™ã‚‹&#34;&gt;èª­ã¿æ›¸ãã™ã‚‹&lt;/h2&gt;

&lt;p&gt;aws-sdk-goã‚’ç›´æ¥ä½¿ã£ã¦ã‚‚ã„ã„ã‘ã©ã€ç°¡å˜ã«æ‰±ãˆã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼
&lt;a href=&#34;https://github.com/guregu/dynamo&#34;&gt;guregu/dynamo&lt;/a&gt;
ã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;type Data struct {
	ID   int64 `dynamo:&amp;quot;id&amp;quot;`
	Name string
	Age  int
}

db := dynamo.New(session.New(), &amp;amp;aws.Config{Region: aws.String(&amp;quot;ap-northeast-1&amp;quot;)})
table := db.Table(&amp;quot;testtable&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;create-update&#34;&gt;Create &amp;amp; Update&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;d := Data{ID: 1, Name: &amp;quot;hogefuga&amp;quot;, Age: 123}
if err := table.Put(d).Run(); err != nil {
    return err
}

if err := table.Update(&amp;quot;id&amp;quot;, 1).Set(&amp;quot;name&amp;quot;, &amp;quot;fugafuga&amp;quot;).Run(); err != nil {
    return err
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;get&#34;&gt;Get&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;var data Data
// çµæœæ•´åˆæ€§ãŒã‚ã‚‹èª­ã¿è¾¼ã¿(1ç§’ã«2å›/ãƒ¦ãƒ‹ãƒƒãƒˆ)ã€€.Consistent(true)ã§å¼·ã„æ•´åˆæ€§ã®ã‚ã‚‹èª­ã¿è¾¼ã¿(1ç§’ã«1å›/ãƒ¦ãƒ‹ãƒƒãƒˆ)ã«ã§ãã‚‹
if err := table.Get(&amp;quot;id&amp;quot;, 1).One(&amp;amp;data); err != nil {
    return err
}
fmt.Println(data)

if err := table.Get(&amp;quot;id&amp;quot;, 2).One(&amp;amp;data); err != nil {
    return err // dynamo: no item found
}
fmt.Println(data)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.slideshare.net/AmazonWebServicesJapan/20150805-aws-blackbeltdynamodb&#34;&gt;AWS Black Belt Tech ã‚·ãƒªãƒ¼ã‚º 2015 - Amazon DynamoDB&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢</title>
          <link>http://sambaiz.net/article/58/</link>
          <pubDate>Mon, 06 Feb 2017 21:52:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/58/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/InstanceStorage.html&#34;&gt;http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/InstanceStorage.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;EC2ã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã«ã‚ˆã£ã¦ã¯EBSã«åŠ ãˆã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ãŒä½¿ãˆã‚‹ã€‚ã—ã‹ã‚‚è¿½åŠ æ–™é‡‘ãªã—ã€‚
å¯¾è±¡ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒ&amp;rdquo;EBSã®ã¿&amp;rdquo;ã§ãªã„ã‚‚ã®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/jp/ec2/instance-types/&#34;&gt;https://aws.amazon.com/jp/ec2/instance-types/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåœæ­¢ã—ãŸã‚Šã€éšœå®³ãŒèµ·ãã‚‹ã¨æ¶ˆãˆã‚‹ä¸€æ™‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€‚å†èµ·å‹•ã§ã¯æ¶ˆãˆãªã„ã€‚
ãƒ›ã‚¹ãƒˆã«ç‰©ç†çš„ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒãƒƒãƒ•ã‚¡ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã©ã®é »ç¹ã«èª­ã¿æ›¸ãã•ã‚Œã€æ¶ˆãˆã¦ã‚‚ã„ã„ãƒ‡ãƒ¼ã‚¿ã«æœ€é©ã€‚
ä»–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚å®¹é‡ã‚„æ€§èƒ½ã‚‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã«ä¾å­˜ã™ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/add-instance-store-volumes.html&#34;&gt;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®è¿½åŠ &lt;/a&gt;ã¯
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®èµ·å‹•æ™‚ã«ã€æ–°ã—ã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’è¿½åŠ ã—ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã«ã™ã‚‹ã“ã¨ã§è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå›ã¯SSDã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸1 x 4ã®m3.mediumã§è©¦ã™ã€‚ã“ã‚Œã¯4gbã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒä¸€ã¤è¿½åŠ ã§ãã‚‹ã¨ã„ã†æ„å‘³ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãšã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã‚’è¿½åŠ ã—ã¦ãªã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€‚
lsblkã¨ã„ã†ã®ã¯list block devicesã®ç•¥ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ df -h
ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹   ã‚µã‚¤ã‚º  ä½¿ç”¨  æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½®
/dev/xvda1       7.8G  1.2G  6.6G   15% /
...
$ dd if=/dev/zero of=hoge bs=1M count=1000
$ ls -sh
åˆè¨ˆ 1001M
1001M hoge

$ df -h
ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹   ã‚µã‚¤ã‚º  ä½¿ç”¨  æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½®
/dev/xvda1       7.8G  2.2G  5.6G   28% /
...

$ lsblk
NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvda    202:0    0   8G  0 disk 
â””â”€xvda1 202:1    0   8G  0 part /
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãã‚Œã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢(/dev/xvdb)ã‚’è¿½åŠ ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ df -h
ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹   ã‚µã‚¤ã‚º  ä½¿ç”¨  æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½®
/dev/xvda1       7.8G  1.2G  6.6G   15% /
/dev/xvdb        4.0G   73M  3.7G    2% /media/ephemeral0

$ lsblk
NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvda    202:0    0   8G  0 disk 
â””â”€xvda1 202:1    0   8G  0 part /
xvdb    202:16   0   4G  0 disk /media/ephemeral0

$ dd if=/dev/zero of=/media/ephemeral0/hoge bs=1M count=1000
$ df -h
ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹   ã‚µã‚¤ã‚º  ä½¿ç”¨  æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½®
/dev/xvda1       7.8G  1.2G  6.6G   15% /
/dev/xvdb        4.0G  1.1G  2.7G   29% /media/ephemeral0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.slideshare.net/imaifactory/ephemeral-ssd&#34;&gt;EC2ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ã‚™ã¨ã‚™ã†ä½¿ã†? -Instance Storageã‚’ï§¤è§£ã—ã¦é«˜é€ŸIOã‚’ä¸Šæ‰‹ã«æ´»ç”¨!-&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>è¤‡æ•°EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦vegetaã§è² è·è©¦é¨“ã™ã‚‹</title>
          <link>http://sambaiz.net/article/43/</link>
          <pubDate>Sun, 18 Dec 2016 20:52:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/43/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;https://github.com/tsenart/vegeta&#34;&gt;vegeta&lt;/a&gt;ã§è² è·ã‚’ã‹ã‘ã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ&#34;&gt;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ&lt;/h2&gt;

&lt;p&gt;ã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã€‚ &lt;a href=&#34;https://github.com/sambaiz/loadtest&#34;&gt;sambaiz/loadtest&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ã¾ãšã‚­ãƒ¼ãƒšã‚¢ã‚’ä½œæˆã—ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ã€å…¨ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§å¾…ã¤ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;aws ec2 create-key-pair --key-name LoadTestKeyPare --query &#39;KeyMaterial&#39; --output text &amp;gt; LoadTestKeyPare.pem
chmod 400 LoadTestKeyPare.pem
aws ec2 run-instances --image-id $AMI_ID --count $INSTANCE_NUM --instance-type t2.micro --key-name LoadTestKeyPare --security-group-ids $SECURITY_GROUP_IDS --subnet-id $SUBNET_ID
...
aws ec2 wait instance-status-ok --instance-ids $INSTANCE_IDS
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã®AMIã¯äº‹å‰ã«Packerã§ã¤ãã£ãŸã‚‚ã®ã€‚vegetaã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã®ä¸Šé™ã‚’å¢—ã‚„ã—ã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;variables&amp;quot;: {
    &amp;quot;aws_access_key&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;aws_secret_key&amp;quot;: &amp;quot;&amp;quot;
  },
  &amp;quot;builders&amp;quot;: [{
    &amp;quot;type&amp;quot;: &amp;quot;amazon-ebs&amp;quot;,
    &amp;quot;access_key&amp;quot;: &amp;quot;{{user `aws_access_key`}}&amp;quot;,
    &amp;quot;secret_key&amp;quot;: &amp;quot;{{user `aws_secret_key`}}&amp;quot;,
    &amp;quot;region&amp;quot;: &amp;quot;ap-northeast-1&amp;quot;,
    &amp;quot;source_ami&amp;quot;: &amp;quot;ami-0c11b26d&amp;quot;,
    &amp;quot;instance_type&amp;quot;: &amp;quot;t2.micro&amp;quot;,
    &amp;quot;ssh_username&amp;quot;: &amp;quot;ec2-user&amp;quot;,
    &amp;quot;ami_name&amp;quot;: &amp;quot;loadtest {{timestamp}}&amp;quot;
  }],
  &amp;quot;provisioners&amp;quot;: [{
    &amp;quot;type&amp;quot;: &amp;quot;shell&amp;quot;,
    &amp;quot;inline&amp;quot;: [
      &amp;quot;wget https://github.com/tsenart/vegeta/releases/download/v6.1.1/vegeta-v6.1.1-linux-amd64.tar.gz&amp;quot;,
      &amp;quot;sudo tar xzf vegeta-v6.1.1-linux-amd64.tar.gz -C /usr/local/bin/&amp;quot;,
      &amp;quot;sudo sh -c \&amp;quot;echo &#39;* hard nofile 65536&#39; &amp;gt;&amp;gt; /etc/security/limits.conf\&amp;quot;&amp;quot;,
      &amp;quot;sudo sh -c \&amp;quot;echo &#39;* soft nofile 65536&#39; &amp;gt;&amp;gt; /etc/security/limits.conf\&amp;quot;&amp;quot;
    ]
  }]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç«‹ã¡ä¸ŠãŒã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦&lt;a href=&#34;https://code.google.com/p/pdsh/&#34;&gt;pdsh&lt;/a&gt;ã§
å„ãƒã‚·ãƒ³ã§vegetaã‚’å®Ÿè¡Œã•ã›($VEGETA_CMD)ã€çµæœã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é›†ã‚ã¦reportã®inputsã§æŒ‡å®šã™ã‚‹ã¨
ã¾ã¨ã‚ã¦ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pdsh -l ec2-user -w `echo &amp;quot;$PUBLIC_DNS_NAMES&amp;quot; |  paste -d, -s -` &amp;quot;$VEGETA_CMD &amp;gt; result.bin&amp;quot;

for machine in $PUBLIC_DNS_NAMES; do
  scp -i ./LoadTestKeyPare.pem -oStrictHostKeyChecking=no ec2-user@$machine:~/result.bin $machine
done

vegeta report -inputs=`echo $PUBLIC_DNS_NAMES |  paste -d, -s -`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;çµ‚ã‚ã£ãŸã‚‰å¾Œç‰‡ä»˜ã‘ã‚’ã™ã‚‹ã€‚trapã§Ctrl+Cç­‰ã§ã®çµ‚äº†æ™‚ã‚‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ®‹ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cleanup() {
  echo &amp;quot;---- Clean up ----&amp;quot;
  aws ec2 terminate-instances --instance-ids $INSTANCE_IDS
  aws ec2 delete-key-pair --key-name LoadTestKeyPare
  rm -f LoadTestKeyPare.pem
  rm $PUBLIC_DNS_NAMES
}
trap cleanup EXIT SIGHUP SIGINT SIGQUIT SIGTERM
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å®Ÿè¡Œã™ã‚‹&#34;&gt;å®Ÿè¡Œã™ã‚‹&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;$ brew install awscli pdsh jq vegeta packer
$ aws configure
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã‚“ãªæ„Ÿã˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ(sample/sample.sh)ã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/bash

export INSTANCE_NUM=3

export AMI_ID=ami-*****
export SECURITY_GROUP_IDS=sg-*****
export SUBNET_ID=subnet-*****

export RESOURCES_DIR=res

# https://github.com/tsenart/vegeta#attack
export VEGETA_CMD=&#39;vegeta attack -targets=res/targets.txt -rate=1000 -duration=10s&#39;

sh run.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;sample/res/targets.txt&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GET http://example.com/

POST http://example.com/
@res/post.json
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;çµæœ&#34;&gt;çµæœ&lt;/h2&gt;

&lt;p&gt;ä½•ã‚‚æŒ‡å®šã—ãªã„ã¨ã“ã‚“ãªæ„Ÿã˜(-reporter=text)ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Requests      [total, rate]            10000, 1000.10
Duration      [total, attack, wait]    10.011642793s, 9.998999835s, 12.642958ms
Latencies     [mean, 50, 95, 99, max]  14.781775ms, 4.262304ms, 68.475899ms, 97.492882ms, 1.096072997s
Bytes In      [total, mean]            15285000, 1528.50
Bytes Out     [total, mean]            110000, 11.00
Success       [ratio]                  100.00%
Status Codes  [code:count]             200:10000  
Error Set:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»–ã«ã‚‚jsonã ã£ãŸã‚Šã€plotã‚’æŒ‡å®šã™ã‚‹ã¨ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã®ã‚°ãƒ©ãƒ•ã®htmlãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://sambaiz.net/images/43_plot.jpg&#34; alt=&#34;ã‚°ãƒ©ãƒ•&#34; /&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Packerã§AMIã‚’ä½œã‚‹</title>
          <link>http://sambaiz.net/article/24/</link>
          <pubDate>Tue, 18 Oct 2016 22:37:00 &#43;0900</pubDate>
          <author></author>
          <guid>http://sambaiz.net/article/24/</guid>
          <description>&lt;p&gt;&lt;a href=&#34;https://www.packer.io/&#34;&gt;https://www.packer.io/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ã„ã‚ã‚“ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã€‚
ã“ã‚Œã§fluentdã®ãƒ­ã‚°ã‚µãƒ¼ãƒãƒ¼ã®AMIã‚’ä½œã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ brew install packer # mac
$ packer -v
0.10.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;code&gt;variables&lt;/code&gt;ã®å€¤ã¯&lt;code&gt;{{user ... }}&lt;/code&gt;ã®ã¨ã“ã‚ã§ä½¿ã‚ã‚Œã‚‹ã€‚
&lt;code&gt;builders&lt;/code&gt;ã«ä½œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æƒ…å ±ã‚’æ›¸ã„ã¦ã€&lt;code&gt;provisioners&lt;/code&gt;ã§ç’°å¢ƒã‚’ä½œã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;provisioners&lt;/code&gt;ã«ã¯chefã‚„ansibleãªã©ã‚‚æŒ‡å®šã§ãã‚‹ãŒã€
ç¶™ãè¶³ã—ç¶™ãè¶³ã—ã§ç§˜ä¼ã®ã‚¿ãƒ¬åŒ–ã—ãŸAMIã‚‚æœ€åˆã¯ã€&lt;/p&gt;

&lt;p&gt;ã€Œã‚³ãƒãƒ³ãƒ‰ã„ãã¤ã‹å®Ÿè¡Œã™ã‚‹ã ã‘ãªã®ã§ã¨ã‚Šã‚ãˆãšæ‰‹ä½œæ¥­ã§ä½œã£ãŸã€å¾Œã§ãªã‚“ã¨ã‹ã™ã‚‹ã€&lt;/p&gt;

&lt;p&gt;ãªã‚“ã¦ã‚‚ã®ã‚‚ã‚ã£ãŸã‚Šã—ã¦ã€
ãã†ã„ã†ã‚‚ã®ã¯ç„¡ç†ã«chefãªã©ã§å§‹ã‚ãšã€æ‰‹è»½ã«shellã§packer buildã™ã‚‹ã¨ã„ã„ã¨æ€ã†ã€‚
æ‰‹ä½œæ¥­ã‚ˆã‚Šã‚‚æ¥½ã ã—ã€ã‚½ãƒ¼ã‚¹ãŒåˆ¥ã«ã‚ã‚‹ã®ã§ä½¿ã‚ã‚Œã¦ã„ãªã„AMIã‚’æ¶ˆã™ã®ã‚‚ç°¡å˜ã ã€‚&lt;/p&gt;

&lt;p&gt;fileã§ã¯permissionãŒãªã„ã¨ã“ã‚ã«ç½®ãã“ã¨ãŒã§ããªã„ã®ã§ã€ä¸€æ—¦ç½®ã„ã¦shellã§ç§»å‹•ã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;variables&amp;quot;: {
    &amp;quot;aws_access_key&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;aws_secret_key&amp;quot;: &amp;quot;&amp;quot;
  },
  &amp;quot;builders&amp;quot;: [{
    &amp;quot;type&amp;quot;: &amp;quot;amazon-ebs&amp;quot;,
    &amp;quot;access_key&amp;quot;: &amp;quot;{{user `aws_access_key`}}&amp;quot;,
    &amp;quot;secret_key&amp;quot;: &amp;quot;{{user `aws_secret_key`}}&amp;quot;,
    &amp;quot;region&amp;quot;: &amp;quot;ap-northeast-1&amp;quot;,
    &amp;quot;source_ami&amp;quot;: &amp;quot;ami-1a15c77b&amp;quot;,
    &amp;quot;instance_type&amp;quot;: &amp;quot;t2.small&amp;quot;,
    &amp;quot;ssh_username&amp;quot;: &amp;quot;ec2-user&amp;quot;,
    &amp;quot;ami_name&amp;quot;: &amp;quot;fluentd-logserver {{timestamp}}&amp;quot;
  }],
  &amp;quot;provisioners&amp;quot;: [{
    &amp;quot;type&amp;quot;: &amp;quot;file&amp;quot;,
    &amp;quot;source&amp;quot;: &amp;quot;td-agent.conf&amp;quot;,
    &amp;quot;destination&amp;quot;: &amp;quot;/home/ec2-user/td-agent.conf&amp;quot;
  },
  {
    &amp;quot;type&amp;quot;: &amp;quot;shell&amp;quot;,
    &amp;quot;inline&amp;quot;: [
      &amp;quot;curl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh&amp;quot;,
      &amp;quot;sudo mv /home/ec2-user/td-agent.conf /etc/td-agent/td-agent.conf&amp;quot;,
      &amp;quot;sudo /etc/init.d/td-agent restart&amp;quot;
    ]
  }]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ packer validate fluentd-logserver.json
Template validated successfully.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;buildã®ã¨ã&lt;code&gt;-var&lt;/code&gt;ã§variablesã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ packer build \
    -var &#39;aws_access_key=YOUR ACCESS KEY&#39; \
    -var &#39;aws_secret_key=YOUR SECRET KEY&#39; \
    fluentd-logserver.json
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨å®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã€AMIã‚’ä½œæˆã—å§‹ã‚ã‚‹ã€‚&lt;/p&gt;
</description>
        </item>
      
    

  </channel>
</rss>
