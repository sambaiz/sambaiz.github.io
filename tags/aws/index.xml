<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Aws on sambaiz-net</title>
    <link>https://www.sambaiz.net/tags/aws/</link>
    <description>Recent content in Aws on sambaiz-net</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>sambaiz-net</copyright>
    <lastBuildDate>Sun, 03 Feb 2019 17:31:00 +0900</lastBuildDate>
    
	<atom:link href="https://www.sambaiz.net/tags/aws/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Serverless Frameworkã§VPCã‚’ä½œæˆã—ã¦Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—Aurora Serverlessã‚’ä½¿ã†</title>
      <link>https://www.sambaiz.net/article/206/</link>
      <pubDate>Sun, 03 Feb 2019 17:31:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/206/</guid>
      <description>Aurora Serverlessã¯ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹Auroraã§ã€ ä½¿ã£ãŸAurora Capacity Unit (ACU)ã«ã‚ˆã£ã¦æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€ ä½¿ç”¨é »åº¦ãŒå°‘ãªã‹ã£ãŸã‚Šå¤‰å‹•ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦å®‰ãRDBã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¦ã‚‹ã¨æœ€ä½ã§ã‚‚æœˆ3000å††ãã‚‰ã„ã‹ã‹ã‚‹ãŒã€Serverlessã ã¨ã»ã¨ã‚“ã©ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åˆ†ã‹ã‚‰é‹ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¦è¶£å‘³ã§ã‚‚ä½¿ã„ã‚„ã™ã„ã€‚ ãŸã ã—Lambdaã¨åŒæ§˜ã«å¸¸ã«åŒç­‰ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ã£ã¦ã„ã‚‹çŠ¶æ…‹ã ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨æ¯”ã¹ã¦å‰²é«˜ã«ãªã‚‹ã€‚
ä»Šå›ã¯Lambdaã§ä½¿ã†ã€‚ Serverlessã¨åå‰ã«ã¯ä»˜ã„ã¦ã„ã‚‹ãŒç”¨é€”ã¨ã—ã¦ã¯Lambdaã«é™ã‚‰ãšã€ ã‚€ã—ã‚ã‚³ãƒ³ãƒ†ãƒŠã®æ•°ãŒå®¹æ˜“ã«å¢—ãˆå¾—ã‚‹Lambdaã¯åŒæ™‚æ¥ç¶šæ•°ãŒå•é¡Œã«ãªã‚‹RDBã¨ä¸€èˆ¬ã«ç›¸æ€§ãŒè‰¯ããªã„ã€‚ ç¾åœ¨Betaã®ã€ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’å¼µã‚‰ãšã«HTTPSã§ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã‚‰ã‚Œã‚‹Data APIã¯ã“ã®å•é¡Œã‚’è§£æ¶ˆã™ã‚‹ã¨æ€ã‚ã‚Œã‚‹ãŒã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå¼µã‚Œãªã‹ã£ãŸã‚Šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µã‚¤ã‚ºã«åˆ¶é™ãŒã‚ã‚‹ã‚ˆã†ã ã€‚ä»Šå›ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã‹ã‚‰åˆæœŸã‚¯ã‚¨ãƒªã‚’æµã™ãŸã‚ã«Data APIã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã€‚
ä»–ã®é¸æŠè‚¢ã¨ã—ã¦ã€DynamoDBã¯ç¾çŠ¶æœ€æœ‰åŠ›ã§æœ€è¿‘ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸãŒSQLã®ã‚ˆã†ã«æŸ”è»Ÿãªã‚¯ã‚¨ãƒªã¯æŠ•ã’ã‚‰ã‚Œãªã„ã€‚ Athenaã¯ã‚¯ã‚¨ãƒªã¯æŠ•ã’ã‚‰ã‚Œã‚‹ãŒãã“ãã“æ™‚é–“ãŒã‹ã‹ã‚‹ã—ã€INSERTã¯ã§ããšã‚¯ã‚¨ãƒªã”ã¨ã«æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ã€‚
Serverless Frameworkã‚’ä½¿ã£ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚ãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã“ã€‚
Serverless Frameworkã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ - sambaiz-net
VPCã®ä½œæˆ Aurora Serverlessã®åˆ¶é™ã®ä¸€ã¤ã¨ã—ã¦VPCå†…ã‹ã‚‰ã—ã‹æ¥ç¶šã—ã‹ã§ããªã„ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã€‚ã¨ã„ã†ã“ã¨ã§VPCã‹ã‚‰ä½œæˆã—ã¦ã„ãã€‚ä»¥å‰Terraformã§ä½œã£ãŸã®ã¨åŒã˜ãƒªã‚½ãƒ¼ã‚¹ã‚’CloudFormationã§ä½œã‚‹ã€‚
Terraformã§VPCã‚’ç®¡ç†ã™ã‚‹moduleã‚’ä½œã‚‹ - sambaiz-net
Lambdaã‚’VPCå†…ã§å‹•ã‹ã™ã¨ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«ENIã‚‚ä½œæˆã™ã‚‹ãŸã‚ç«‹ã¡ä¸ŠãŒã‚Šã®éš›æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚å¿…è¦ãªã‚‰å®šæœŸçš„ã«å‘¼ã³å‡ºã—ã¦å‰Šé™¤ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚ ã¾ãŸã€ä»Šå›ã¯ãƒ†ã‚¹ãƒˆã®ãŸã‚/24ã§VPCã‚’åˆ‡ã£ã¦ã„ã‚‹ãŒã€å°ã•ã„ã¨ENIã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ¯æ¸‡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
 VPC  TestVPC: Type: AWS::EC2::VPC Properties: CidrBlock: 172.32.0.0/24 Tags: - Key: Name Value: test-vpc   Subnet  Aurora Serverlessã®ãŸã‚ã«å°‘ãªãã¨ã‚‚2ã¤ã®ã‚µãƒ–ãƒãƒƒãƒˆãŒå¿…è¦ã€‚
TestPublicSubnet: Type: AWS::EC2::Subnet Properties: VpcId: !Ref TestVPC CidrBlock: 172.32.0.0/25 AvailabilityZone: us-east-1d Tags: - Key: Name Value: test-public-subnet1 TestPrivateSubnet1: Type: AWS::EC2::Subnet Properties: VpcId: !</description>
    </item>
    
    <item>
      <title>AWS Systems Manager (SSM)ã®Parameter Storeã«èªè¨¼æƒ…å ±ã‚’ç½®ãå‚ç…§ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/204/</link>
      <pubDate>Mon, 07 Jan 2019 23:50:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/204/</guid>
      <description>DBã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„APIãƒˆãƒ¼ã‚¯ãƒ³ã¨ã„ã£ãŸèªè¨¼æƒ…å ±ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã«æ›¸ãã¨OSSåŒ–ãªã©å…¬é–‹ç¯„å›²ã‚’åºƒã’ã‚‹ã¨ãã«ã‚„ã‚„å›°ã‚‹ã—æ¼ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚‹ã®ã§ãªã‚‹ã¹ãé¿ã‘ãŸã„ã€‚ ãã“ã§SSMã®Parameter Storeã«å€¤ã‚’ç½®ãã€å®Ÿè¡Œæ™‚ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«å‚ç…§ã™ã‚‹ã€‚
SSMã®Parameter Storeã¨Secrets Manager Systems Manager (SSM)ã¯AWSã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã‚Šæ“ä½œã‚’è‡ªå‹•åŒ–ã—ãŸã‚Šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ç¾¤ã§ã€ è¨­å®šã‚’æŒã¤Parameter Storeã¯ãã®ä¸€ã¤ã€‚å€¤ã¯æš—å·åŒ–ã—ã¦æŒã¤ã“ã¨ã‚‚ã§ãã‚‹ã€‚ æ–™é‡‘ã¯ã‹ã‹ã‚‰ãªã„ã€‚
SSMã®Parameter Storeã¨ä¼¼ãŸã‚ˆã†ãªåˆ¥ã®AWSã®ã‚µãƒ¼ãƒ“ã‚¹ã« Secrets Managerã¨ã„ã†ã®ãŒã‚ã£ã¦ã€ ã“ã¡ã‚‰ã¯Lambdaã«ã‚ˆã£ã¦å®šæœŸçš„ã«æ–°ã—ã„å€¤ã‚’ç”Ÿæˆã—ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ç‰¹ã«RDSãªã‚‰è‡ªå‰ã®é–¢æ•°ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ã‚‚ãªã„ã€‚ ãŸã ã—æ–™é‡‘ãŒã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä»¶æ•°($0.4/æœˆ)ã¨APIã‚³ãƒ¼ãƒ«($0.05/10000å›)ã§ã‹ã‹ã‚‹ã€‚
ä»Šã¯Paramter Storeã¨Secrets ManagerãŒçµ±åˆã•ã‚Œã¦ã„ã¦ã€Parameter Storeã®APIã§ã©ã¡ã‚‰ã‚‚å‚ç…§ã§ãã‚‹ã‚ˆã†ã ã€‚ ä»Šå›ã¯ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã—ãªã„ã®ã§å˜ç´”ã«æ–™é‡‘ãŒã‹ã‹ã‚‰ãªã„Parameter Storeã®æ–¹ã«æ›¸ãè¾¼ã‚€ã“ã¨ã«ã™ã‚‹ã€‚ ãŸã ã—ã€Parameter Storeã¯ç¾çŠ¶ä¸€åº¦ã«å¤§é‡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé£›ã¶ã‚ˆã†ãªä½¿ã„æ–¹ã‚’ã™ã‚‹ã¨Rate exceededã«ãªã£ã¦ã—ã¾ã†å•é¡ŒãŒã‚ã‚‹ã€‚
å®Ÿè¡Œæ™‚ã®å€¤å–å¾— å®Ÿè¡Œæ™‚ã«å€¤ã‚’å–å¾—ã™ã‚‹ã®ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚
package main import ( &amp;quot;fmt&amp;quot; &amp;quot;github.com/aws/aws-sdk-go/aws&amp;quot; &amp;quot;github.com/aws/aws-sdk-go/aws/awserr&amp;quot; &amp;quot;github.com/aws/aws-sdk-go/aws/session&amp;quot; &amp;quot;github.com/aws/aws-sdk-go/service/ssm&amp;quot; ) type Parameter struct { ssm *ssm.SSM } func newParameter(sess *session.Session) *Parameter { return &amp;amp;Parameter{ ssm: ssm.New(sess), } } func (s *Parameter) Get(name string, decrypt bool) (string, error) { param, err := s.</description>
    </item>
    
    <item>
      <title>AWS Glueã§CSVã‚’åŠ å·¥ã—Parquetã«å¤‰æ›ã—ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚ŠAthenaã§å‚ç…§ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/203/</link>
      <pubDate>Tue, 01 Jan 2019 17:50:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/203/</guid>
      <description>AWS Glueã¯ãƒãƒãƒ¼ã‚¸ãƒ‰ãªETL(Extract/Transform/Load)ã‚µãƒ¼ãƒ“ã‚¹ã§ã€Sparkã‚’ä½¿ã£ã¦S3ãªã©ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿åŠ å·¥ã—ã¦å¤‰æ›å‡ºåŠ›ã—ãŸã‚Šã€Athenaã‚„Redshift Spectrumã§å‚ç…§ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã‚’æä¾›ã™ã‚‹ã€‚ ä»Šå›ã¯S3ã®CSVã‚’èª­ã¿è¾¼ã‚“ã§åŠ å·¥ã—ã€åˆ—æŒ‡å‘ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆParquetã«å¤‰æ›ã—ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã£ã¦å‡ºåŠ›ã€ãã®å¾Œã‚¯ãƒ­ãƒ¼ãƒ©ã‚’å›ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦Athenaã§å‚ç…§ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
æ–™é‡‘ã¯ã‚¸ãƒ§ãƒ–ãŒDPU(4vCPU/16GBãƒ¡ãƒ¢ãƒª)æ™‚é–“ã‚ãŸã‚Š$0.44(æœ€ä½2DPU/10åˆ†)ã‹ã‹ã‚‹ã€‚ ã¾ãŸã€ã‚¯ãƒ­ãƒ¼ãƒ©ã‚‚åŒæ§˜ã«DPUã§èª²é‡‘ã•ã‚Œã‚‹ã€‚
é–‹ç™ºç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ã‚¸ãƒ§ãƒ–ã®ç«‹ã¡ä¸ŠãŒã‚Šã«ã‚„ã‚„æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚é–‹ç™ºç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç«‹ã¡ä¸Šã’ã¦ãŠãã¨DPUãŒç¢ºä¿ã•ã‚Œã¦åŠ¹ç‡ã‚ˆãé–‹ç™ºã§ãã‚‹ã€‚ ç«‹ã¡ä¸Šã’ã¦ã„ã‚‹é–“ã®DPUã®æ–™é‡‘ãŒã‹ã‹ã‚‹ã€‚ã¤ã¾ã‚Šãšã£ã¨ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ç¶šã‘ã¦ã„ã‚‹ã‚ˆã†ãªã‚‚ã®ã§çµæ§‹é«˜ãã¤ãã®ã§çµ‚ã‚ã£ãŸã‚‰é–‰ã˜ã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚
ãƒ­ãƒ¼ã‚«ãƒ«ã‚„EC2ã‹ã‚‰è‡ªåˆ†ã§é–‹ç™ºç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«sshã—ã¦Notebookã‚’ç«‹ã¦ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ãŒã€ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ç«‹ã¡ä¸Šã’ãŸNotebookã¯æœ€åˆã‹ã‚‰ã¤ãªãŒã£ã¦ã„ã¦éµã®ç™»éŒ²ã‚‚å¿…è¦ãªãã¦æ¥½ã€‚
ssh -i private-key-file-path -NTL 9007:169.254.76.1:9007 glue@dev-endpoint-public-dns  Notebookã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨Cloudwatch Logsã¾ã‚ã‚Šã«åŠ ãˆã¦Glueã®DevEndpointã¨Assetã®å–å¾—æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã€‚
{ &amp;quot;Action&amp;quot;: [ &amp;quot;s3:ListBucket&amp;quot; ], &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;, &amp;quot;Resource&amp;quot;: [ &amp;quot;arn:aws:s3:::aws-glue-jes-prod-us-east-1-assets&amp;quot; ] } { &amp;quot;Action&amp;quot;: [ &amp;quot;s3:GetObject&amp;quot; ], &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;, &amp;quot;Resource&amp;quot;: [ &amp;quot;arn:aws:s3:::aws-glue-jes-prod-us-east-1-assets*&amp;quot; ] } { &amp;quot;Action&amp;quot;: [ &amp;quot;glue:UpdateDevEndpoint&amp;quot;, &amp;quot;glue:GetDevEndpoint&amp;quot;, &amp;quot;glue:GetDevEndpoints&amp;quot; ], &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;, &amp;quot;Resource&amp;quot;: [ &amp;quot;arn:aws:glue:us-east-1:*****:devEndpoint/test*&amp;quot; ] }  ãŸã¾ã«ç«‹ã¡ä¸Šã’ã«å¤±æ•—ã—ãŸã‚Šæ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã§å®Ÿè¡Œã§ããªã„ã“ã¨ãŒã‚ã£ãŸãŒã€ç«‹ã¡ä¸Šã’ç›´ã—ãŸã‚‰ã†ã¾ãã„ã£ãŸã€‚
The code failed because of a fatal error: Error sending http request and maximum retry encountered.</description>
    </item>
    
    <item>
      <title>Fargateã§ECSã‚’ä½¿ã†</title>
      <link>https://www.sambaiz.net/article/196/</link>
      <pubDate>Fri, 09 Nov 2018 00:30:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/196/</guid>
      <description>ECSã¯AWSã®ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€‚ ã‚¯ãƒ©ã‚¹ã‚¿ã¯EC2ä¸Šã«ç«‹ã¦ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ãŒã€ãã®å ´åˆAuto Scalingã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­å®šã‚„ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³æ™‚ã®drainãªã©ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ Fargateã§èµ·å‹•ã™ã‚‹ã¨ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§å®Ÿè¡Œã§ãã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ç®¡ç†ãŒå¿…è¦ãŒãªããªã‚‹ã€‚ æ–™é‡‘ã¯å‰²ã‚Šå½“ã¦ãŸvCPUã¨ãƒ¡ãƒ¢ãƒªã«ã‚ˆã£ã¦ã€æœ€ä½1åˆ†ã®1ç§’å˜ä½ã§èª²é‡‘ã•ã‚Œã‚‹ã€‚ Lambdaã¨åŒã˜ããƒªã‚½ãƒ¼ã‚¹ã‚ãŸã‚Šã§ã„ã†ã¨ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã®EC2ã¨æ¯”è¼ƒã—ã¦å‰²é«˜ã€‚ãŸã ã—æŸ”è»Ÿã«ãƒªã‚½ãƒ¼ã‚¹ãŒæŒ‡å®šã§ãã‚‹åˆ†ã„ãã‚‰ã‹å·®ã¯ç¸®ã¾ã‚‹ã€‚
ç‰¹ã«ãƒãƒƒãƒå‡¦ç†ã®ã‚ˆã†ã«å¸¸ã«ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ãªã„Taskã¯éƒ½åº¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã®ã‚‚é¢å€’ãªã®ã§è‰¯ã„ã¨æ€ã†ã€‚ Lambdaã¨æ¯”è¼ƒã™ã‚‹ã¨ã€å®Ÿè¡Œç’°å¢ƒã‚’è‡ªç”±ã«ä½œã‚Œã‚‹ã®ã¨å®Ÿè¡Œæ™‚é–“ã«åˆ¶é™ãŒãªã„ã¨ã„ã†ã¨ã“ã‚ãŒè‰¯ã„ãŒã€ Taskã‚’ä½œã‚‹ãƒˆãƒªã‚¬ãƒ¼ã¯ç¾çŠ¶cronã ã‘ãªã®ã§ãã‚Œä»¥å¤–ã®ã‚¤ãƒ™ãƒ³ãƒˆã§å®Ÿè¡Œã—ãŸã„å ´åˆã¯Lambdaã¨çµ„ã¿åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
AWSã«ã¯Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’ç«‹ã¦ã‚‰ã‚Œã‚‹EKSã‚‚ã‚ã‚‹ãŒã€ã“ã¡ã‚‰ã¯ã¾ã Fargateã«å¯¾å¿œã—ã¦ã„ãªã„ã€‚ ã‚‚ã—ã‹ã—ãŸã‚‰ä»Šæœˆæœ«ã®re:Inventã§ä½•ã‹ç™ºè¡¨ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚
Clusterã®ä½œæˆ ã¾ãšã¯Clusterã‚’ä½œæˆã™ã‚‹ã€‚
$ aws ecs create-cluster --cluster-name test  Taskã®ç™»éŒ² ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚„å‰²ã‚Šå½“ã¦ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¨ã„ã£ãŸContainer definition ã‚’å«ã‚€Task definitionã‚’æ›¸ãã€‚ Fargateã®å ´åˆnetworkModeã¯awsvpcå›ºå®šã«ãªã‚‹ã€‚
{ &amp;quot;family&amp;quot;: &amp;quot;test-task&amp;quot;, &amp;quot;networkMode&amp;quot;: &amp;quot;awsvpc&amp;quot;, &amp;quot;containerDefinitions&amp;quot;: [ { &amp;quot;name&amp;quot;: &amp;quot;nginx&amp;quot;, &amp;quot;image&amp;quot;: &amp;quot;nginx:1.15&amp;quot;, &amp;quot;portMappings&amp;quot;: [ { &amp;quot;containerPort&amp;quot;: 80, &amp;quot;hostPort&amp;quot;: 80, &amp;quot;protocol&amp;quot;: &amp;quot;tcp&amp;quot; } ], &amp;quot;essential&amp;quot;: true } ], &amp;quot;requiresCompatibilities&amp;quot;: [ &amp;quot;FARGATE&amp;quot; ], &amp;quot;cpu&amp;quot;: &amp;quot;256&amp;quot;, &amp;quot;memory&amp;quot;: &amp;quot;512&amp;quot; }  Taskã‚’ç™»éŒ²ã™ã‚‹ã€‚
$ aws ecs register-task-definition --cli-input-json file://$(pwd)/task.</description>
    </item>
    
    <item>
      <title>Macã§ã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ãƒ¡ãƒ¢</title>
      <link>https://www.sambaiz.net/article/163/</link>
      <pubDate>Sat, 14 Apr 2018 14:22:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/163/</guid>
      <description>æ–°ã—ã„MBPã‚’è²·ã£ãŸã®ã§é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã§ã‚„ã£ãŸã“ã¨ã‚’æ®‹ã—ã¦ãŠã
è¨­å®š  ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‹ã‚‰3æœ¬æŒ‡ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ ãƒ›ãƒƒãƒˆã‚³ãƒ¼ãƒŠãƒ¼ã®å·¦ä¸Šã«LaunchPadã€å³ä¸Šã«ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã‚‹ ç”»é¢ã‚’ãªã‚‹ã¹ãåºƒãä½¿ã†ãŸã‚ã«Dockã¯å·¦ã«ç½®ã„ã¦è‡ªå‹•çš„ã«éš ã™  bash_profile ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ä»¥å¤–ã§æŒã£ã¦ããŸãƒã‚¤ãƒŠãƒªã¯${HOME}/binã«ç½®ãã“ã¨ã«ã™ã‚‹ã€‚
touch ~/.bash_profile mkdir ${HOME}/bin echo &amp;quot;export PATH=\$PATH:${HOME}/bin&amp;quot; &amp;gt;&amp;gt; ~/.bash_profile  HomeBrew &amp;amp; Cask /usr/bin/ruby -e &amp;quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&amp;quot; brew tap caskroom/cask  ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³/ã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Xcodeã¨Unityã¨LINEã¯æ‰‹å‹•ã§å…¥ã‚Œã‚‹ã€‚
brew cask install google-chrome kap visual-studio-code slack kindle brew install jq gibo mysql wget  Git git config --global user.name sambaiz git config --global user.email godgourd@gmail.com  Docker &amp;amp; K8s brew cask install docker virtualbox minikube brew install docker kubernetes-helm  fish bashå‰æã§æ›¸ã‹ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚å¤šã„ã®ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã«ã¯ã—ãªã„ã€‚</description>
    </item>
    
    <item>
      <title>Cognito UserPoolã¨API Gatewayã§èªè¨¼ä»˜ãAPIã‚’ç«‹ã¦ã‚‹</title>
      <link>https://www.sambaiz.net/article/157/</link>
      <pubDate>Sun, 25 Feb 2018 23:46:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/157/</guid>
      <description>UserPoolã‚’ä½œæˆã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã¯ã“ã‚“ãªæ„Ÿã˜ã€‚ å¿…é ˆé …ç›®ã‚„ã€ç¢ºèªãƒ¡ãƒ¼ãƒ«ã®æ–‡é¢ãªã©ã‚’è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã€ ç™»éŒ²æ™‚ãªã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§Lambdaã‚’ç™ºç«ã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚
ä½œæˆã—ãŸUserPoolã«ã‚¢ãƒ—ãƒªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚ ãƒ–ãƒ©ã‚¦ã‚¶ã§ä½¿ã†ã®ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ãªã—ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ amazon-cognito-identity-jsã‚’ä½¿ã†ã€‚
ä¾å­˜ã™ã‚‹jsã‚’æŒã£ã¦ãã‚‹ã€‚
$ wget https://raw.githubusercontent.com/aws/amazon-cognito-identity-js/master/dist/amazon-cognito-identity.min.js $ wget https://raw.githubusercontent.com/aws/amazon-cognito-identity-js/master/dist/aws-cognito-sdk.min.js  Sign Upã‹ã‚‰APIã‚’å‘¼ã¶ã¨ã“ã‚ã¾ã§ã®ãƒœã‚¿ãƒ³ã‚’ä¸¦ã¹ãŸã€‚ SignInã™ã‚‹ã¨OIDCæ¨™æº–ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒãã®ãƒšãƒ¼ã‚¸ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®Local Storageã«æ›¸ã‹ã‚Œã‚‹ã€‚
OpenID Connectã®IDãƒˆãƒ¼ã‚¯ãƒ³ã®å†…å®¹ã¨æ¤œè¨¼ - sambaiz-net
CognitoIdentityServiceProvider.&amp;lt;clientId&amp;gt;.&amp;lt;name&amp;gt;.idToken CognitoIdentityServiceProvider.&amp;lt;clientId&amp;gt;.&amp;lt;name&amp;gt;.accessToken CognitoIdentityServiceProvider.&amp;lt;clientId&amp;gt;.&amp;lt;name&amp;gt;.refreshToken CognitoIdentityServiceProvider.&amp;lt;clientId&amp;gt;.&amp;lt;name&amp;gt;.clockDrift CognitoIdentityServiceProvider.&amp;lt;clientId&amp;gt;.LastAuthUser  APIã‚’å‘¼ã¶ã¨ãã¯idTokenã‚’Authorization Headerã«ä¹—ã›ã‚‹ã€‚
&amp;lt;button id=&amp;quot;signUp&amp;quot;&amp;gt;Sign Up&amp;lt;/button&amp;gt; &amp;lt;p&amp;gt;&amp;lt;label&amp;gt;Code:&amp;lt;input type=&amp;quot;text&amp;quot; id=&amp;quot;code&amp;quot;&amp;gt;&amp;lt;/label&amp;gt;&amp;lt;/p&amp;gt; &amp;lt;button id=&amp;quot;confirm&amp;quot;&amp;gt;Confirm&amp;lt;/button&amp;gt; &amp;lt;button id=&amp;quot;signIn&amp;quot;&amp;gt;Sign In&amp;lt;/button&amp;gt; &amp;lt;button id=&amp;quot;whoAmI&amp;quot;&amp;gt;Who am I?&amp;lt;/button&amp;gt; &amp;lt;button id=&amp;quot;requestAPI&amp;quot;&amp;gt;Request API with token&amp;lt;/button&amp;gt; &amp;lt;button id=&amp;quot;signOut&amp;quot;&amp;gt;Sign Out&amp;lt;/button&amp;gt; &amp;lt;script src=&amp;quot;aws-cognito-sdk.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script src=&amp;quot;amazon-cognito-identity.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script&amp;gt; const USER_NAME = &amp;quot;*****&amp;quot;; const USER_PASSWORD = &amp;quot;*****&amp;quot;; const USER_EMAIL = &amp;quot;*****&amp;quot;; class CognitoUserPoolAuth { constructor(UserPoolId, clientId, apiEndpoint) { const poolData = { UserPoolId : UserPoolId, ClientId : clientId }; this.</description>
    </item>
    
    <item>
      <title>Serverless Frameworkã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/155/</link>
      <pubDate>Sun, 11 Feb 2018 23:20:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/155/</guid>
      <description>Serverless Frameworkã§Lambda Functionã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚ ApexãŒåŸºæœ¬çš„ã«Functionè‡ªä½“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‹ã—ãªã„ã®ã«å¯¾ã—ã¦ã€ã“ã¡ã‚‰ã¯eventã®è¨­å®šãªã©ã‚‚è«¸ã€…ã‚„ã£ã¦ãã‚Œã¦å¼·ã„ã€‚
Apexã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ - sambaiz-net
$ npm install -g serverless $ serverless version 1.26.0  Apexã§ã¯Functionã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚ŒãŸãŒã€Serverlessã§ã¯Serviceã”ã¨ã«ä½œã‚‰ã‚Œã€ ä¸€ã¤ã®Serviceå†…ã§è¤‡æ•°ã®Functionã‚’å®šç¾©ã§ãã‚‹ã€‚handlerã¯åŒã˜ã§ã‚‚ç•°ãªã£ã¦ã„ã¦ã‚‚ã‚ˆã„ã€‚
Apexã®å½¢å¼ã®å ´åˆã€å…±é€šã®å‡¦ç†ã‚’Webpackãªã©ã§å„Functionã«æŒã£ã¦æ¥ãŸã‚Šã€ åŒã˜ã‚ˆã†ãªå‡¦ç†ã®è¤‡æ•°ã®Functionã‚’ç«‹ã¦ã‚‹éš›ã¯ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸãŒã€ ã“ã¡ã‚‰ã¯å¿…è¦æœ€å°é™ã®å¤‰æ›´ã§ãã‚Œã‚‰ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚
templateã‹ã‚‰Serviceã‚’createã™ã‚‹ã€‚
$ serverless create --template aws-nodejs --path testservice $ ls testservice/ handler.js	serverless.yml  è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«serverless.yml ã«ã¯Lambdaã®åŸºæœ¬çš„ãªã‚‚ã®ã®ã»ã‹ã«ã€VPCã‚„eventã€IAM Roleãªã©ã‚‚æ›¸ã‘ã¦ã€ã“ã‚Œã‚‰ã¯deployæ™‚ã«ä½œã‚‰ã‚Œã‚‹CloudFormationã®stackã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã‚‹ã€‚å¿…è¦ãªã‚‰ç”Ÿã®CloudFormationã®è¨­å®šã‚‚æ›¸ã‘ã‚‹ã€‚
Apexã§ã‚‚Terraformã«ã‚ˆã£ã¦ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãŒã€æ›¸ãã®ã¯ã“ã¡ã‚‰ã®æ–¹ãŒã¯ã‚‹ã‹ã«æ¥½ã€‚
Apexã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸLambdaã®ãƒˆãƒªã‚¬ãƒ¼ã‚’Terraformã§ç®¡ç†ã™ã‚‹ - sambaiz-net
$ cat sesrverless.yml service: testservice provider: name: aws profile: foobar region: ap-northeast-1 runtime: nodejs6.10 memorySize: 512 timeout: 10 functions: hello: handler: handler.hello events: - http: path: hello/world method: get cors: true  deployã™ã‚‹ã¨{service}-{stage}-{function}ã®FunctionãŒä½œã‚‰ã‚Œã‚‹ã€‚ ä»Šå›ã®å ´åˆã¯testservice-prd-testã€‚stageã‚’ymlã§ã‚‚æŒ‡å®šã—ãªã‹ã£ãŸå ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®devã«ãªã‚‹ã€‚</description>
    </item>
    
    <item>
      <title>Datadogã®Lambda Integrationã§æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’é€ã£ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é£›ã°ã™</title>
      <link>https://www.sambaiz.net/article/152/</link>
      <pubDate>Mon, 05 Feb 2018 23:55:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/152/</guid>
      <description>æœ€è¿‘æœãŒå¯’ãã¦å¸ƒå›£ã‹ã‚‰å‡ºã‚‹ã®ãŒã¤ã‚‰ã„ã€‚é›¨ã‚„é›ªãŒé™ã£ã¦ã„ãŸã‚‰å°šæ›´ã®ã“ã¨ã€ãã‚Œãªã‚‰ãã‚Œã§ç¾çŠ¶ã‚’æŠŠæ¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ ãã“ã§ã€ç„¡æ–™ã‹ã‚‰ä½¿ãˆã‚‹æ°—è±¡API OpenWeatherMapã®ãƒ‡ãƒ¼ã‚¿ã‚’datadogã«é€ã£ã¦ã€ç‰¹ã«å¯’ã„æ—¥ã‚„é›¨é›ªãŒé™ã‚‹ã‚ˆã†ãªæœã«ã¯ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é£›ã°ã™ã“ã¨ã«ã—ãŸã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç«‹ã£ã¦ã„ãŸã‚‰DataDog Agentã®DogStatsDçµŒç”±ã§é€ã‚‹ã“ã¨ãŒã§ãã€ ãã†ã§ãªã‘ã‚Œã°é€šå¸¸ã¯APIã‚’å‘¼ã¶ã“ã¨ã«ãªã‚‹ã‚“ã ã‘ã©ã€Lambdaã§ã¯ã€AWS Integrationã‚’è¨­å®šã™ã‚‹ã¨æœ‰åŠ¹ã«ãªã‚‹Lambda Integrationã«ã‚ˆã£ã¦ MONITORING|unix_epoch_timestamp|value|metric_type|my.metric.name|#tag1:value,tag2ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§console.logã™ã‚‹ã ã‘ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒé€ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚
const axios = require(&#39;axios&#39;); const CITY = &#39;Shibuya&#39;; const API_KEY = &#39;*****&#39;; const WEATHER_API = `http://api.openweathermap.org/data/2.5/weather?q=${CITY}&amp;amp;units=metric&amp;amp;appid=${API_KEY}`; const METRIC_COUNTER = &#39;counter&#39;; const METRIC_GAUGE = &#39;gauge&#39;; const monitor = (metricName, metricType, value, tags) =&amp;gt; { const unixEpochTimestamp = Math.floor(new Date().getTime()); console.log(`MONITORING|${unixEpochTimestamp}|${value}|${metricType}|${metricName}|#${tags.join(&#39;,&#39;)}`); }; exports.handler = async (event, context, callback) =&amp;gt; { const data = (await axios.get(WEATHER_API)).data const namePrefix = &#39;livinginfo.weather&#39; monitor(`${namePrefix}.temperature`, METRIC_GAUGE, data.main.temp, []) monitor(`${namePrefix}.</description>
    </item>
    
    <item>
      <title>Athenaã®migrationã‚„partitionã™ã‚‹athena-adminã‚’ä½œã£ãŸ</title>
      <link>https://www.sambaiz.net/article/145/</link>
      <pubDate>Sun, 24 Dec 2017 23:31:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/145/</guid>
      <description>https://github.com/sambaiz/athena-admin
Athenaã¯S3ã‚’ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰ãªãƒ‡ãƒ¼ã‚¿åˆ†æåŸºç›¤ã€‚Prestoãƒ™ãƒ¼ã‚¹ã§æ¨™æº–SQLã‚’å®Ÿè¡Œã§ãã‚‹ã€‚
æ–™é‡‘ã¯ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸãƒ‡ãƒ¼ã‚¿é‡ã«ã‹ã‹ã‚Šã€$5/TBã€‚1MBåˆ‡ã‚Šä¸Šã’ã§ã€10MBä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã¯10MBã«ãªã‚‹ã€‚ ãƒ‡ãƒ¼ã‚¿é‡ã«å¯¾ã—ã¦ã‹ãªã‚Šå®‰ãä½¿ãˆã‚‹ã‚‚ã®ã®ã€ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã—ã¾ã†ã¨BigQueryã¨åŒæ§˜ã«ãŠé‡‘ãŒæº¶ã‘ã¦ã—ã¾ã†ã®ã§ã€å¤§æŠµã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚‹ã“ã¨ã«ãªã‚‹ã®ã ã‘ã©éƒ½åº¦locationã‚’æŒ‡å®šã—ã¦ADD PARTITIONã‚’å®Ÿè¡Œã™ã‚‹ã®ã¯å¤§å¤‰ã€‚ã•ã‚‰ã«ã‚¹ã‚­ãƒ¼ãƒã‚’å¤‰æ›´ã™ã‚‹ã®ã«ã‚‚ALTER TABLE ADD COLUMNSãªã©ã¯ãªã„ã®ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚Šç›´ã™ã“ã¨ã«ãªã‚‹ãŒã€å½“ç„¶ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚‚å…¨éƒ¨ä½œã‚Šç›´ã™ã“ã¨ã«ãªã‚‹ã€‚
ã§ã¯ã©ã†ã—ã‚ˆã†ã‚‚ãªã„ã‹ã¨ã„ã†ã¨MSCK REPAIR TABLEã¨ã„ã†ã®ãŒã‚ã£ã¦ã€ ã“ã‚Œã¯S3ã®Objectã®dt=YYYY-MM-DDã®ã‚ˆã†ãªkey=valueã®prefixã‚’èªè­˜ã—ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ã‚‚ã®ã€‚ä½œã‚Šç›´ã™éš›ã‚‚ã“ã‚Œ1ã‚¯ã‚¨ãƒªã§çµ‚ã‚ã‚‹ã€‚ãã‚Œãªã‚‰æœ€åˆã‹ã‚‰ãã†ã„ã†é¢¨ã«ç½®ã‘ã°ã‚ˆã„ã®ã§ã¯ã¨ã„ã†ã¨ã“ã‚ã ã‘ã©ã€å‹æ‰‹ã«YYYY/MM/DD/HHã®prefixã‚’ä»˜ã‘ã¦ã—ã¾ã†Firehoseã®ã‚ˆã†ãªã®ã‚‚ã‚ã‚‹ã€‚
ä»Šå›ä½œã£ãŸathena-adminã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€ ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®key=valueã®prefixãŒä»˜ãã‚ˆã†ã«ç½®ãæ›ãˆãŸã‚Šã€å¤‰æ›´ãŒã‚ã£ãŸã‚‰migrationã™ã‚‹ã€‚ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹ã ã‘ã§åŸºæœ¬çš„ã«ã©ã†ã«ã‹ãªã‚‹ã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚Œã°ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®å¤‰æ›´ã‚’è¿½ã†ã“ã¨ãŒã§ãã‚‹ã€‚
{ &amp;quot;general&amp;quot;: { &amp;quot;athenaRegion&amp;quot;: &amp;quot;ap-northeast-1&amp;quot;, &amp;quot;databaseName&amp;quot;: &amp;quot;aaaa&amp;quot;, &amp;quot;saveDefinitionLocation&amp;quot;: &amp;quot;s3://saveDefinitionBucket/aaaa.json&amp;quot; }, &amp;quot;tables&amp;quot;: { &amp;quot;sample_data&amp;quot;: { &amp;quot;columns&amp;quot;: { &amp;quot;user_id&amp;quot;: &amp;quot;int&amp;quot;, &amp;quot;value&amp;quot;: { &amp;quot;score&amp;quot;: &amp;quot;int&amp;quot;, &amp;quot;category&amp;quot;: &amp;quot;string&amp;quot; } /* &amp;quot;struct&amp;lt;score:int,category:string&amp;gt;&amp;quot; ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã‚‹ */ }, &amp;quot;srcLocation&amp;quot;: &amp;quot;s3://src/location/&amp;quot;, &amp;quot;partition&amp;quot;: { &amp;quot;prePartitionLocation&amp;quot;: &amp;quot;s3://pre/partition/&amp;quot;, /* optional */ &amp;quot;regexp&amp;quot;: &amp;quot;(\\d{4})/(\\d{2})/(\\d{2})/&amp;quot;, /* optional */ &amp;quot;keys&amp;quot;: [ { &amp;quot;name&amp;quot;: &amp;quot;dt&amp;quot;, &amp;quot;type&amp;quot;: &amp;quot;string&amp;quot;, &amp;quot;format&amp;quot;: &amp;quot;{1}-{2}-{3}&amp;quot;, /* optional */ } ] } } } }  ä½¿ã„æ–¹ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚ä½¿ã„æ–¹ã«ã‚ˆã£ã¦ã¯migrate()ã ã‘å‘¼ã¶ã“ã¨ã‚‚ã‚ã‚‹ã¨æ€ã†ã€‚ replaceObjects()ã«ã¯matchedHandlerã¨ã„ã†ã®ã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã¦ã€ UTCã‹ã‚‰JSTã«å¤‰æ›ã™ã‚‹ã¨ã„ã£ãŸã“ã¨ã‚‚ã§ãã‚‹ã€‚</description>
    </item>
    
    <item>
      <title>Apexã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸLambdaã®ãƒˆãƒªã‚¬ãƒ¼ã‚’Terraformã§ç®¡ç†ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/144/</link>
      <pubDate>Sun, 12 Nov 2017 22:23:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/144/</guid>
      <description>Apexã§functionã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ãƒˆãƒªã‚¬ãƒ¼ãŒç™»éŒ²ã•ã‚Œãªã„ã®ã§ã‚ã¨ã§è¿½åŠ ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ ã“ã‚Œã‚’æ‰‹ä½œæ¥­ã§è¡Œã†ã“ã¨ã‚‚ã§ãã‚‹ã®ã ã‘ã©ã€ã›ã£ã‹ããªã®ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ä¸€ç·’ã«ç®¡ç†ã—ãŸã„ã€‚ ãã‚“ãªã¨ãã®ãŸã‚ã«terraformã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ©ãƒƒãƒ—ã—ãŸapex infraãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚
Terraformã§VPCã‚’ç®¡ç†ã™ã‚‹moduleã‚’ä½œã‚‹ - sambaiz-net
functionsã¨åŒåˆ—ã«infrastructureãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦tfãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã€‚ ãã®ä¸‹ã«ç’°å¢ƒã”ã¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¦ã€ãã®å ´åˆã¯--envã§æŒ‡å®šã—ãŸç’°å¢ƒã®ã‚‚ã®ãŒä½¿ã‚ã‚Œã‚‹ã€‚
- functions - infrastructure main.tf variables.tf - modules - cloudwatch_schedule main.tf variables.tf project.json  functionã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ãã®ARNãŒå¤‰æ•°ã§å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
$ apex list --tfvars apex_function_hello=&amp;quot;arn:aws:lambda:ap-northeast-1:*****:function:usetf_hello&amp;quot;  ä»Šå›è¨­å®šã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã¯Cloudwatch Eventã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã€‚ä½œæˆã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
 aws_cloudwatch_event_ruleã§ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ«(ä»Šå›ã¯schedule)ã‚’ä½œæˆ aws_cloudwatch_event_targetã§ãƒ«ãƒ¼ãƒ«ã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ(ä»Šå›ã¯Lambda)ã‚’è¨­å®š aws_lambda_permissionã§ãƒ«ãƒ¼ãƒ«ã«å¯¾è±¡Lambdaã‚’invokeã™ã‚‹æ¨©é™ã‚’ä»˜ã‘ã‚‹  $ cat infrastructure/modules/cloudwatch_schefule/variables.tf variable &amp;quot;lambda_function_name&amp;quot; {} variable &amp;quot;lambda_function_arn&amp;quot; {} variable &amp;quot;schedule_expression&amp;quot; { description = &amp;quot;cloudwatch schedule expression e.g. \&amp;quot;cron(0/5 * * * ? *)\&amp;quot;&amp;quot; } $ cat infrastructure/modules/cloudwatch_schefule/main.tf resource &amp;quot;aws_cloudwatch_event_rule&amp;quot; &amp;quot;lambda&amp;quot; { name = &amp;quot;lambda_rule_${var.</description>
    </item>
    
    <item>
      <title>Redashã§ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/141/</link>
      <pubDate>Mon, 23 Oct 2017 23:59:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/141/</guid>
      <description>Redashã¯OSSã®ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ã€‚ BIãƒ„ãƒ¼ãƒ«ã®ã‚ˆã†ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰ãˆãªãŒã‚‰æŒ‡æ¨™ã‚’æ¢ã£ã¦ã„ãã¨ã„ã†ã‚ˆã‚Šã¯ã€åˆ†ã‹ã£ã¦ã„ã‚‹æŒ‡æ¨™ã‚’è¦‹ã‚‹ã®ã«ä½¿ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚ æ¯”è¼ƒçš„æ©Ÿèƒ½ãŒå°‘ãªã„åˆ†å‡¦ç†ãŒã‚ã‹ã‚Šã‚„ã™ãã€ ã‚¯ã‚¨ãƒªãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œãªã„ãŸã‚æ™‚é–“ãŒã‹ã‹ã‚‹ã‚‚ã®ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã‚ã‚‹ç¨‹åº¦æ°—ã¥ã‘ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã†ã€‚
docker-composeã§ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‘ã©ã€ AWSã®å„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«AMIãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ãã‚Œã§ç«‹ã¡ä¸Šã’ã‚‹ã€‚
sshã§å…¥ã£ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªã®ã‚’å¿…è¦ã«å¿œã˜ã¦è¨­å®šã™ã‚‹ã€‚ ãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚‹å ´åˆã¯SESã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’Verifyã—ã¦ã‚„ã‚‹ã®ãŒç°¡å˜ã€‚ GSuiteã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€OAuthã®ClientIDã€Secretã‚’ç™ºè¡Œã—ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç™»éŒ²ã™ã‚‹ã¨ãã‚Œã§èªè¨¼ã§ãã‚‹ã€‚
$ ssh ubuntu@***** $ sudo vi /opt/redash/.env export REDASH_MAIL_SERVER=&amp;quot;email-smtp.us-east-1.amazonaws.com&amp;quot; export REDASH_MAIL_USE_TLS=&amp;quot;true&amp;quot; export REDASH_MAIL_USERNAME=&amp;quot;*****&amp;quot; export REDASH_MAIL_PASSWORD=&amp;quot;*****&amp;quot; export REDASH_MAIL_DEFAULT_SENDER=&amp;quot;*****&amp;quot; # Email address to send from export REDASH_GOOGLE_CLIENT_ID=&amp;quot;&amp;quot; export REDASH_GOOGLE_CLIENT_SECRET=&amp;quot;&amp;quot; $ cd /opt/redash/current $ sudo -u redash bin/run ./manage.py org set_google_apps_domains {{domains}} $ sudo supervisorctl restart all  HTTPSå¯¾å¿œã™ã‚‹ã®ã«/etc/nginx/sites-available/redashã‚’ç·¨é›†ã™ã‚‹ã€‚crtã¨keyã®å ´æ‰€ã¯å¤‰ãˆã‚‹ã€‚
upstream rd_servers { server 127.0.0.1:5000; } server { server_tokens off; listen 80 default; access_log /var/log/nginx/rd.access.log; gzip on; gzip_types *; gzip_proxied any; location /ping { proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_pass http://rd_servers; } location / { return 301 https://$host$request_uri; } } server { listen 443 ssl; # Make sure to set paths to your certificate .</description>
    </item>
    
    <item>
      <title>Apexã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/140/</link>
      <pubDate>Sun, 22 Oct 2017 16:06:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/140/</guid>
      <description>Apexã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚ ã¨ã¦ã‚‚ç°¡å˜ã«ä½¿ãˆã‚‹ã—ã€å¤‰ãªã“ã¨ã‚‚ã—ãªã„ã®ã§è‰¯ã„æ„Ÿã˜ã€‚
Serverless Frameworkã ã¨eventã®è¨­å®šã¾ã§ã‚«ãƒãƒ¼ã§ãã¦ã‚ˆã‚Šä¾¿åˆ©ã€‚
Serverless Frameworkã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ - sambaiz-net
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚
$ curl https://raw.githubusercontent.com/apex/apex/master/install.sh | sh   IAMFullAccess AWSLambdaFullAccess  ã‚’ä»˜ã‘ãŸIAMã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²ã—ã¦ãŠãã€‚
$ aws configure --profile apex $ aws configure list --profile apex Name Value Type Location ---- ----- ---- -------- profile apex manual --profile access_key ****************OVGQ shared-credentials-file secret_key ****************oi5t shared-credentials-file region ap-northeast-1 config-file ~/.aws/config  apex initã—ã¦nameã¨descriptionã‚’å…¥ã‚Œã‚‹ã¨IAMãŒç™»éŒ²ã•ã‚Œã€ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒä½œã‚‰ã‚Œã‚‹ã€‚
$ apex init --profile apex Project name: try-apex Project description: test [+] creating IAM try-apex_lambda_function role [+] creating IAM try-apex_lambda_logs policy [+] attaching policy to lambda_function role.</description>
    </item>
    
    <item>
      <title>Lambdaä¸Šã§Puppeteer/Headless Chromeã‚’å‹•ã‹ã™Starter Kitã‚’ä½œã£ãŸ</title>
      <link>https://www.sambaiz.net/article/132/</link>
      <pubDate>Sun, 10 Sep 2017 23:45:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/132/</guid>
      <description>Puppeteerã§Headless Chromeã‚’å‹•ã‹ã™ã‚³ãƒ¼ãƒ‰ã‚’ Lambdaä¸Šã§å‹•ã‹ã™Starter Kitã‚’ä½œã£ãŸã€‚
puppeteer-lambda-starter-kit
Chromeã®æº–å‚™ Puppeteerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è½ã¨ã—ã¦ãã‚‹Chromeã‚’Lambdaä¸Šã§å‹•ã‹ãã†ã¨ã—ã¦ã‚‚ Lambdaã«ãªã„shared libraryã«ä¾å­˜ã—ã¦ã„ã‚‹ãŸã‚å¤±æ•—ã™ã‚‹ã€‚
error while loading shared libraries: libpangocairo-1.0.so.0: cannot open shared object file: No such file or directory  Lambdaä¸Šã§Headless Chromeã‚’å‹•ã‹ã™ä¾‹ãŒãªã„ã‹èª¿ã¹ãŸã‚‰serverless-chromeã¨ã„ã†ã®ãŒã‚ã£ã¦ã€ Headlessç”¨ã®è¨­å®šã§Chromeã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ãŸã€‚ ã»ã‹ã«ã¯chromelessã¨ã„ã†ã®ã‚‚ã‚ã‚‹ã‘ã© ã“ã‚Œã¯serverless-chromeã« ä¾å­˜ã—ã¦ã„ã‚‹ã€‚ æœ€å°æ§‹æˆã§Puppeteerã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§ã€ä»Šå›ã¯ã“ã‚Œã‚‰ã‚’ä½¿ã‚ãšä¸€ã‹ã‚‰ä½œã‚‹ã“ã¨ã«ã—ãŸã€‚
serverless-chromeã«ã‚‚ãƒ“ãƒ«ãƒ‰ã—ãŸã‚‚ã®ãŒç½®ã„ã¦ã‚ã‚‹ãŒã€å°‘ã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã‚ˆã†ã ã£ãŸã®ã§æœ€æ–°ç‰ˆã§ãƒ“ãƒ«ãƒ‰ã—ãŸã€‚ åŸºæœ¬çš„ã«ã¯æ›¸ã„ã¦ã‚ã‚‹ é€šã‚Šã‚„ã‚Œã°ã†ã¾ãã„ãã€‚ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã®shared memoryã¨ã—ã¦/dev/shmã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã‚’ã€/tmpã«ç½®ãæ›ãˆã‚‹ ã‚ˆã†ã«ã—ãªã„ã¨ã€å®Ÿè¡Œæ™‚ã®page.goto()ã§Failed Provisional Load: ***, error_code: -12ã«ãªã‚‹ã€‚
ãƒ“ãƒ«ãƒ‰ã—ãŸheadless_shellã«ã¯å•é¡Œã«ãªã£ãŸä¾å­˜ã¯å«ã¾ã‚Œã¦ã„ãªã„ã‚ˆã†ã ã€‚
$ ldd headless_shell linux-vdso.so.1 =&amp;gt; (0x00007ffcb6fed000) libpthread.so.0 =&amp;gt; /lib64/libpthread.so.0 (0x00007f5f17dbe000) libdl.so.2 =&amp;gt; /lib64/libdl.so.2 (0x00007f5f17bba000) librt.so.1 =&amp;gt; /lib64/librt.so.1 (0x00007f5f179b1000) libnss3.so =&amp;gt; /usr/lib64/libnss3.so (0x00007f5f17692000) libnssutil3.so =&amp;gt; /usr/lib64/libnssutil3.so (0x00007f5f17466000) libsmime3.</description>
    </item>
    
    <item>
      <title>Terraformã§VPCã‚’ç®¡ç†ã™ã‚‹moduleã‚’ä½œã‚‹</title>
      <link>https://www.sambaiz.net/article/121/</link>
      <pubDate>Sun, 23 Jul 2017 02:54:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/121/</guid>
      <description>Terraform
$ brew install terraform $ terraform -v Terraform v0.9.11  Terraformã®è¨­å®šè¦ç´  provider IaaS(e.g. AWS)ã€PaaS(e.g. Heroku)ã€SaaS(e.g. CloudFlare)ãªã©ã€‚
AWS Providerã¯ã“ã‚“ãªæ„Ÿã˜ã€‚ ã“ã“ã«ç›´æ¥access_keyã‚„secret_keyã‚’æ›¸ãã“ã¨ã‚‚ã§ãã‚‹ã‘ã©ã€èª¤ã£ã¦å…¬é–‹ã•ã‚Œã¦ã—ã¾ã‚ãªã„ã‚ˆã†ã«ç’°å¢ƒå¤‰æ•°ã‹ variableã§æ¸¡ã™ã€‚
provider &amp;quot;aws&amp;quot; { # access_key = &amp;quot;${var.access_key}&amp;quot; # secret_key = &amp;quot;${var.secret_key}&amp;quot; region = &amp;quot;us-east-1&amp;quot; }  $ export AWS_ACCESS_KEY_ID=&amp;quot;anaccesskey&amp;quot; $ export AWS_SECRET_ACCESS_KEY=&amp;quot;asecretkey&amp;quot;  varibale CLIã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã€‚typeã«ã¯stringã®ã»ã‹ã«mapã‚„listã‚’æ¸¡ã™ã“ã¨ãŒã§ãã€ ä½•ã‚‚æ¸¡ã•ãªã„ã¨defaultå€¤ã®ã‚‚ã®ãŒã€ãã‚Œã‚‚ãªã‘ã‚Œã°stringã«ãªã‚‹ã€‚
variable &amp;quot;key&amp;quot; { type = &amp;quot;string&amp;quot; default = &amp;quot;value&amp;quot; description = &amp;quot;description&amp;quot; }  å€¤ã‚’æ¸¡ã™æ–¹æ³•ã¯TF_VAR_ã‚’prefixã¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã€-varã€-var-fileãŒã‚ã‚‹ã€‚ ã¾ãŸã€moduleã®inputã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã€‚
$ export TF_VAR_somelist=&#39;[&amp;quot;ami-abc123&amp;quot;, &amp;quot;ami-bcd234&amp;quot;]&#39; $ terraform apply -var foo=bar -var foo=baz $ terraform apply -var-file=foo.</description>
    </item>
    
    <item>
      <title>fluentdã®Aggregatorã‚’ELBã§è² è·åˆ†æ•£ã—ã€Blue/Green Deploymentã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/113/</link>
      <pubDate>Sun, 25 Jun 2017 00:35:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/113/</guid>
      <description>ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®èª¿æ•´ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã€Beanstalkã§Aggregatorã‚’ç«‹ã¡ä¸Šã’ãŸã€‚
è² è·åˆ†æ•£ TCPã®24224(è¨­å®šã«ã‚ˆã‚‹)ãŒé€šã‚‹ã‚ˆã†ã«EC2,ELBã®SGã¨ãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒã‚ã£ã¦ã€ ELBã®SGã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã®è¨­å®šãŒè¦‹è½ã¨ã•ã‚ŒãŒã¡ã€‚ELBã®ã‚¯ãƒ­ã‚¹ã‚¾ãƒ¼ãƒ³åˆ†æ•£ã¯æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã€‚
ã¾ãšã€ELBã«3å°ã€ãã‚Œãã‚Œåˆ¥ã®AZ(1b, 1c, 1d)ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ãƒ­ã‚°ã‚’é€ã‚Šå§‹ã‚ã‚‹ã¨ãã‚Œãã‚Œå‡ç­‰ã«ãƒ­ã‚°ãŒå±Šã„ãŸã€‚ ãã®çŠ¶æ…‹ã‹ã‚‰4å°(1b * 2, 1c, 1d)ã«ã™ã‚‹ã¨ã€2ã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹(1b, 1c)ã®ã¿ã«å‡ç­‰ã«ãƒ­ã‚°ãŒå±Šãã‚ˆã†ã«ãªã£ãŸã€‚ 4å°ã«ãªã‚‹ã¨(1b, 1c)ã¨(1b, 1d)ã«åˆ†ã‘ã‚‰ã‚Œã¦ELBã®ãƒãƒ¼ãƒ‰ãŒãã‚Œã‚‰ã®çµ„ã«ç´ã¥ã„ãŸã¨ã„ã†ã“ã¨ã ã¨æ€ã†ã€‚ å„ãƒãƒ¼ãƒ‰ã«ã¯DNSãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚å®Ÿéš›restartã™ã‚‹ã¨ä»Šåº¦ã¯åˆ¥ã®çµ„ã®æ–¹ã«é€ã‚‰ã‚ŒãŸã€‚
ã§ã¯ã€ãªãœä¸€åº¦é€ã‚Šå§‹ã‚ã‚‹ã¨åŒã˜æ–¹ã«ã—ã‹é£›ã°ãªã„ã‹ã¨ã„ã†ã¨ã€forwardãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®expire_dns_cacheãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§nilã«ãªã£ã¦ã„ã¦ã€ heartbeatãŒå±Šã„ã¦ã„ã‚‹é–“ã¯ç„¡æœŸé™ã«DNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€‚ã“ã‚Œã«0(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãªã„)ã‹ç§’æ•°ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ ãã®é–“éš”ã§ä»–ã®çµ„ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚‚ãƒ­ã‚°ãŒå±Šãã‚ˆã†ã«ãªã£ãŸã€‚ expire_dns_cacheã—ãªãã¦ã‚‚è¤‡æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã•ã‚Œã‚‹ãŸã‚å…¨ä½“ã§ã„ãˆã°åˆ†æ•£ã•ã‚Œã‚‹ã€‚
heartbeat ELBé…ä¸‹ã®EC2ã‚’å…¨ã¦è½ã¨ã—ã¦ã‚‚heartbeatã«å¤±æ•—ã—ãªã„ãŸã‚ã€standyã«ç§»è¡Œã›ãšELBã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ãƒ­ã‚°ãŒãƒ­ã‚¹ãƒˆã—ã¦ã—ã¾ã†ã‚ˆã†ã ã€‚ ãƒ­ã‚°ã«ã‚‚å‡ºãšã€ä»¥ä¸‹ã®ã‚ˆã†ã«active-standbyã®è¨­å®šã‚’ã—ã¦ã‚‚standbyã«ç§»è¡Œã—ãªã„ã€‚ å…¨ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåŒæ™‚ã«è½ã¡ã‚‹ã¨ã„ã†ã®ã¯æ»…å¤šã«èµ·ããªã„ã ã‚ã†ã‘ã©ã€å°‘ãªãã¨ã‚‚æ¤œçŸ¥ã§ãã‚‹ã‚ˆã†ã«ã¯ã—ã¦ãŠãã€‚
&amp;lt;server&amp;gt; name td1 host autoscale-td1.us-east-1.elasticbeanstalk.com port 24224 &amp;lt;/server&amp;gt; &amp;lt;server&amp;gt; name td2 host autoscale-td2.us-east-1.elasticbeanstalk.com port 24224 standby &amp;lt;/server&amp;gt;  Blue/Green Deployment Blue-Green Deploymentã¨ã„ã†ã®ã¯ã€2ã¤ã®ç³»ã‚’ç”¨æ„ã—ã€activeã§ãªã„æ–¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€ ã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦åæ˜ ã•ã›ã‚‹ã‚‚ã®ã€‚ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã§å•é¡ŒãŒèµ·ããŸéš›ã«ã‚‚ã™ãã«åˆ‡ã‚Šæˆ»ã™ã“ã¨ãŒã§ãã‚‹ã€‚ ã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦å‘ãå…ˆã‚’å¤‰ãˆã‚‹ã«ã¯expire_dns_cacheã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
Auto Scaling å¢—ãˆã‚‹ã®ã¯ã„ã„ã¨ã—ã¦æ¸›ã‚‹ã¨ãã«ã€ é€ã‚Šå…ˆã§ä¸€æ™‚çš„ã«éšœå®³ãŒèµ·ãã¦ã„ãŸã‚Šã™ã‚‹ã¨ãƒãƒƒãƒ•ã‚¡ã‚’flushã§ããšã«ãƒ­ã‚°ãŒãƒ­ã‚¹ãƒˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ ãã‚Œã§ã„ã†ã¨ãƒ­ã‚°ã®é€ã‚Šå…ƒã§ã‚‚åŒã˜ã“ã¨ãŒèµ·ã“ã‚Šã†ã‚‹ã‚“ã ã‘ã©ã€é€šå¸¸Aggregatorã«ã—ã‹é€ã‚‰ãªã„ã®ã§æ¯”è¼ƒçš„å•é¡Œã«ãªã‚Šã«ãã„ã€‚
ã“ã‚Œã‚’é¿ã‘ãŸã„å ´åˆã€Auto Scalingã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­å®šã§ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã‹ã‚‰ä¿è­·ã‚’æœ‰åŠ¹ã«ã—ã¦ ã“ã‚Œã‹ã‚‰ç«‹ã¡ä¸ŠãŒã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã—ãªãã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ ãã‚Œã¾ã§ã«ç«‹ã¡ä¸ŠãŒã£ã¦ã„ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯é©ç”¨ã•ã‚Œãªã„ã®ã§æ³¨æ„ã€‚
ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã—ãªã„ã¨ã„ã†ã“ã¨ã¯æœ€å¤§ã®å°æ•°ã§æ­¢ã¾ã£ã¦ã—ã¾ã†ã®ã§ã€ ãƒ”ãƒ¼ã‚¯ã‚’éããŸã‚‰ã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦ãƒãƒƒãƒ•ã‚¡ãŒå…¨ã¦æƒã‘ãŸã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰Terminateã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ ã“ã‚Œã‚’æ—¥å¸¸çš„ã«ã‚„ã‚‹ã®ã¯é¢å€’ãªã®ã§ã€å®Ÿéš›ã¯äºˆæœŸã—ãªã„æµé‡ã®å¢—åŠ ã«å‚™ãˆã¦ä¸€å¿œè¨­å®šã—ã¦ãŠãã€ æ™®æ®µã¯ã—ãã„å€¤ã«ã²ã£ã‹ã‹ã‚‰ãªã„ã‚ˆã†ãªæœ€ä½å°æ•°ã§å¾…ã¡æ§‹ãˆã¦ãŠãã“ã¨ã«ã™ã‚‹ã‹ãªã€‚
ã‚ã¨ã¯ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã£ã¦æ½°ã•ã‚Œã‚‹å¯èƒ½æ€§ã¯ãªãã‚‚ãªã„ã‘ã©ã€ãã‚Œã¯ã‚‚ã†ã‚„ã‚€ãªã—ãƒ»ãƒ»ãƒ»ã€‚
å‚è€ƒ AWS ELBã®ç¤¾å†…å‘ã‘æ§‹æˆã‚¬ã‚¤ãƒ‰ã‚’å…¬é–‹ã—ã¦ã¿ã‚‹ è² è·åˆ†æ•£ç·¨ â€“ Cross-Zone Routingã‚’è¸ã¾ãˆã¦ ï½œ Developers.</description>
    </item>
    
    <item>
      <title>fluentdã§Kinesis streamsã«é€ã‚‹ã¨ãã®æ€§èƒ½ç¢ºèª</title>
      <link>https://www.sambaiz.net/article/108/</link>
      <pubDate>Mon, 05 Jun 2017 23:48:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/108/</guid>
      <description>localã§ã®streamsã¨producerã®benchmark aws-fluent-plugin-kinesisã® make benchmarkã¯localã«DummyServerã‚’ç«‹ã¡ä¸Šã’ã¦é€ã£ã¦ã„ã‚‹ã€‚
ç©ºã§ã‚‚ã„ã„ã®ã§roleã‚’ã¤ã‘ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚
$ git clone https://github.com/awslabs/aws-fluent-plugin-kinesis.git $ cd aws-fluent-plugin-kinesis $ yum install -y ruby-devel gcc $ echo &#39;gem &amp;quot;io-console&amp;quot;&#39; &amp;gt;&amp;gt; Gemfile $ make $ make benchmark  RATEã‚’æŒ‡å®šã—ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç§’é–“1000ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒé€ã‚‰ã‚Œã‚‹è¨­å®šã€‚ fluentdã‚’èµ·å‹•ã—ã¦ã‹ã‚‰10ç§’å¾Œã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’killã—ã€ãã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ãªã©ã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ã€‚
t2.microã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(RATE=1000)ã§å®Ÿè¡Œã—ãŸçµæœãŒã“ã‚Œã€‚ å›ºã‚ã‚‹åˆ†producerã®æ–¹ã¯ã‚„ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè½ã¡ã‚‹ã€‚
bundle exec rake benchmark TYPE=streams Results: requets: 20, raw_records: 9400, records: 9400 bundle exec rake benchmark TYPE=producer Results: requets: 14, raw_records: 1005, records: 8900  RATE=3000ã®ã¨ãã€‚producerã§ã¯raw_recordsãŒ1/100ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¯1/5ã€‚ streamsã ã¨ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’å¢—ã‚„ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚‹ã‘ã©ã€producerã®æ–¹ã¯å½“åˆ†å¤§ä¸ˆå¤«ãã†ã ã€‚
bundle exec rake benchmark TYPE=streams Results: requets: 57, raw_records: 27600, records: 27600 bundle exec rake benchmark TYPE=producer Results: requets: 12, raw_records: 241, records: 25200  RATE=10000ã®ã¨ãã€‚raw_records, requestã®åœ§ç¸®ç‡ã¯ã•ã‚‰ã«ä¸ŠãŒã‚Šã€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å·®ãŒå¤§ãããªã£ã¦ãã¦ã„ã‚‹ã€‚</description>
    </item>
    
    <item>
      <title>Beanstalkã§ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒAMIã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ç•°ãªã‚‹åŸå› </title>
      <link>https://www.sambaiz.net/article/106/</link>
      <pubDate>Sun, 04 Jun 2017 23:40:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/106/</guid>
      <description>User-Dataã¨ã¯ EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã«ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ°ã‚‰ã›ãŸã‚Šcloud-initãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’é©ç”¨ã§ãã‚‹æ©Ÿèƒ½ã€‚ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ã®è¨­å®šã®ã€é«˜åº¦ãªè©³ç´°ã®ã¨ã“ã‚ã‹ã‚‰è¨­å®šã§ãã‚‹ã€‚
Beanstalkã§ã®User-Data å®Ÿã¯Beanstalkã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã¦ã€CloudFormationã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚
&amp;quot; /bin/bash /tmp/ebbootstrap.sh &amp;quot;, ... &amp;quot;Fn::FindInMap&amp;quot;: [ &amp;quot;AWSEBOptions&amp;quot;, &amp;quot;options&amp;quot;, &amp;quot;UserDataScript&amp;quot; ] &amp;quot; &amp;gt; /tmp/ebbootstrap.sh &amp;quot;, ... &amp;quot;AWSEBOptions&amp;quot;: { &amp;quot;options&amp;quot;: { &amp;quot;UserDataScript&amp;quot;: &amp;quot;https://s3-ap-northeast-1.amazonaws.com/elasticbeanstalk-env-resources-ap-northeast-1/stalks/eb_node_js_4.0.1.90.2/lib/UserDataScript.sh&amp;quot;, &amp;quot;guid&amp;quot;: &amp;quot;f08557fc43ac&amp;quot;, } }  ã“ã®shellã®ä¸­ã§ã¯ã€æ™‚è¨ˆã‚’åŒæœŸã•ã›ãŸã‚Šã€awsebãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ãŸã‚Šã™ã‚‹ã»ã‹ã«ã€ éBeanstalk AMI(is_baked=false)ã§ã¯yum updateãŒèµ°ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ ãã®ãŸã‚ã€AMIã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨Beanstalkã§ç«‹ã¡ä¸ŠãŒã£ãŸã¨ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã†ã ã€‚
GUID=$7 function update_yum_packages { if is_baked update_yum_packages_$GUID; then log yum update has already been done. else log Updating yum packages. yum --exclude=aws-cfn-bootstrap update -y || echo Warning: cannot update yum packages. Continue... mark_installed update_yum_packages_$GUID # Update system-release RPM package will reset the .</description>
    </item>
    
    <item>
      <title>Node.jsã§ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›</title>
      <link>https://www.sambaiz.net/article/89/</link>
      <pubDate>Tue, 28 Mar 2017 21:36:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/89/</guid>
      <description>node-iconvã‚’ä½¿ã†ã€‚
$ npm install iconv  SHIFT_JISã‹ã‚‰UTF-8ã¸ã®å¤‰æ›ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚
const Iconv = require(&#39;iconv&#39;).Iconv; const before = new Buffer([ 0x8b, 0x8d, 0x8e, 0x4d, 0x26, 0x82, 0xb2, 0x94, 0xd1 ]); const iconv = new Iconv(&#39;SHIFT_JIS&#39;, &#39;UTF-8&#39;); console.log(`before: ${before.toString(&#39;hex&#39;)} ${before.toString()}`) const after = iconv.convert(before); console.log(`after: ${after.toString(&#39;hex&#39;)} ${after.toString()}`);  before: 8b8d8e4d2682b294d1 ï¿½ï¿½ï¿½M&amp;amp;ï¿½ï¿½ï¿½ï¿½ after: e7899be79abf26e38194e9a3af ç‰›çš¿&amp;amp;ã”é£¯  æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã¯å¤‰æ›å¾Œã«è¡¨ã›ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚ ä¾‹ãˆã°ã€UTF-8ã‹ã‚‰SHIFT_JISã¸ã®å¤‰æ›ã§ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ğŸšã‚’æ¸¡ã™ã¨å¤‰æ›ã§ããšã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
throw errnoException(&#39;EILSEQ&#39;, &#39;Illegal character sequence.&#39;);  //IGNOREã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ ãã®ã‚ˆã†ãªæ–‡å­—ãŒã‚ã£ãŸå ´åˆã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ã‚ˆã†ã«ã§ãã‚‹ã€‚
const Iconv = require(&#39;iconv&#39;).Iconv; const before = &amp;quot;ç‰›çš¿&amp;amp;ğŸš&amp;quot;; const iconv = new Iconv(&#39;UTF-8&#39;, &#39;SHIFT_JIS//IGNORE&#39;); console.</description>
    </item>
    
    <item>
      <title>Fluentdã¨KPL(Kinesis Producer Library)ã§ãƒ­ã‚°ã‚’ã¾ã¨ã‚ã¦ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’ç¨¼ã</title>
      <link>https://www.sambaiz.net/article/84/</link>
      <pubDate>Wed, 15 Mar 2017 23:00:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/84/</guid>
      <description>KPL(Kinesis Producer Library)ã¨ã¯ Developing Amazon Kinesis Streams Producers Using the Amazon Kinesis Producer Library - Amazon Kinesis Streams
Kinesisã«é€ã‚‹ã¨ãã€è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã—ã¦ãã‚ŒãŸã‚Šã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã¦ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’å‘ä¸Šã—ã¦ãã‚ŒãŸã‚Šã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚Protobufã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚ æ™®é€šã«é€ã‚‹ã¨ã©ã‚“ãªã«å°ã•ãã¦ã‚‚ã‚·ãƒ£ãƒ¼ãƒ‰*1000ãƒ¬ã‚³ãƒ¼ãƒ‰/ç§’ã—ã‹æœ€å¤§ã§PUTã§ããªã„ã®ã‚’ã€KPLã‚’ä½¿ã£ã¦ã¾ã¨ã‚ã‚‹ã“ã¨ã§å¢—ã‚„ã™ã“ã¨ãŒã§ãã‚‹ã€‚
fluentdã§é€ã‚‹ aws-fluent-plugin-kinesisã§kinesis_producerã‚’æŒ‡å®šã™ã‚‹ã¨KPLã‚’ä½¿ã£ã¦é€ä¿¡ã™ã‚‹ã€‚
&amp;lt;kinesis_producer&amp;gt;ã®ä¸­ã«KPLã®è¨­å®šã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹ã€‚
&amp;lt;kinesis_producer&amp;gt; record_max_buffered_time 10 &amp;lt;/kinesis_producer&amp;gt;  record_max_bufferd_time ã¯ãƒãƒƒãƒ•ã‚¡ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ãŒé€ã‚‰ã‚Œã‚‹ã¾ã§ã®æœ€å¤§æ™‚é–“(ms)ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯100msã€‚ã“ã®æ™‚é–“ãŒçµŒã¤ã‹ã€ä»–ã®ãƒªãƒŸãƒƒãƒˆã«å½“ãŸã£ãŸã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯é€ã‚‰ã‚Œã‚‹ã€‚
 AggregationMaxCount: ä¸€ã¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¾ã¨ã‚ã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° AggregationMaxSize: ã¾ã¨ã‚ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®æœ€å¤§ãƒã‚¤ãƒˆæ•° CollectionMaxCount: PutRecordsã§é€ã‚‹æœ€å¤§ã‚¢ã‚¤ãƒ†ãƒ æ•° CollectionMaxSize: PutRecordsã§é€ã‚‹ãƒ‡ãƒ¼ã‚¿é‡  CloudWatchã«é€ã‚‹metrics_levelã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§detailedã«ãªã£ã¦ã„ã¦ã€ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‹ã‚‰streamåã§æ¤œç´¢ã™ã‚‹ã¨ KinesisProducerLibraryã«UserRecordsPerKinesisRecordã‚„ã€UserRecordsDataPutã€BufferingTimeã€RequestTimeãªã©ã„ã‚ã„ã‚è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
ã¨ã‚Šã‚ãˆãšè©¦ã—ã«ã“ã‚“ãªè¨­å®šã§é€ã£ã¦ã¿ã‚‹ã€‚
&amp;lt;match hoge.log&amp;gt; @type kinesis_producer region ap-northeast-1 stream_name teststream include_time_key true flush_interval 1 buffer_chunk_limit 1m try_flush_interval 0.1 queued_chunk_flush_interval 0.01 num_threads 15 &amp;lt;/match&amp;gt;  Lambdaã§èª­ã‚€ ã¾ã¨ã‚ã‚‰ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’kinesis-aggregationã§åˆ†è§£ã—ã¦èª­ã‚€ã€‚ ä»Šå›ã¯Node.jsã§ã‚„ã‚‹ã€‚</description>
    </item>
    
    <item>
      <title>fluentdã§Kinesis Streamsã«é€ã£ã¦Lambdaã§èª­ã‚“ã§S3ã«ä¿å­˜ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/73/</link>
      <pubDate>Sun, 26 Feb 2017 18:56:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/73/</guid>
      <description>aws-fluent-plugin-kinesisã§Kinesis Streamsã«é€ã‚Šã€Lambdaã§èª­ã‚“ã§S3ã«ä¿å­˜ã™ã‚‹ã€‚ è¦ã™ã‚‹ã«Firehoseã®ã‚ˆã†ãªã“ã¨ã‚’ã‚„ã‚ŠãŸã„ã®ã ã‘ã‚Œã©Tokyoãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¾ã æ¥ãªã„ã®ã§è‡ªåˆ†ã§ã‚„ã‚‹ã€‚
fluentdã§é€ã‚‹ $ td-agent-gem install fluent-plugin-kinesis  try_flush_intervalã¨queued_chunk_flush_intervalã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯è¼‰ã£ã¦ã„ãªã„ãŒã€ ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã«ã‚ˆã‚‹ã¨ãã‚Œãã‚Œqueueã«æ¬¡ã®chunkãŒãªã„ã¨ãã¨ã‚ã‚‹ã¨ãã®flushã™ã‚‹é–“éš”ã€‚ ã„ãšã‚Œã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1ã ãŒã€ã“ã‚Œã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã‚‚ã£ã¨é »ç¹ã«åãå‡ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã‚‰ã—ã„ã€‚
Fluentd ã® out_forward ã¨ BufferedOutput
ã‚ã¨ã‚·ãƒ£ãƒ¼ãƒ‰ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ãŸã‚ã®partition_key ã‚’æŒ‡å®šã§ãã‚‹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ©ãƒ³ãƒ€ãƒ ã€‚
&amp;lt;source&amp;gt; @type tail path /var/log/td-agent/hoge.log pos_file /etc/td-agent/log.pos tag hoge.log format json time_key timestamp # 2017-01-01T01:01:01+0900 time_format %Y-%m-%dT%H:%M:%S%z &amp;lt;/source&amp;gt; &amp;lt;match hoge.log&amp;gt; @type kinesis_streams region ap-northeast-1 stream_name teststream include_time_key true flush_interval 1 buffer_chunk_limit 1m try_flush_interval 0.1 queued_chunk_flush_interval 0.01 num_threads 15 &amp;lt;/match&amp;gt;  ã„ãã¤ã‹é€ã£ã¦ã¿ã‚‹ã€‚
for i in `seq 1 1000` do echo &#39;{&amp;quot;hoge&amp;quot;: &amp;quot;fuga&amp;quot;, &amp;quot;timestamp&amp;quot;: &amp;quot;2017-01-01T01:01:01+0900&amp;quot;}&#39; &amp;gt;&amp;gt; /var/log/td-agent/hoge.</description>
    </item>
    
    <item>
      <title>AWSã®AssumeRole</title>
      <link>https://www.sambaiz.net/article/72/</link>
      <pubDate>Sat, 25 Feb 2017 20:40:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/72/</guid>
      <description>AWS Security Token Serviceã«ã‚ˆã‚‹ã€ RoleArn(arn:aws:iam::&amp;lt;account id&amp;gt;:role/&amp;lt;role name&amp;gt;)ã‹ã‚‰ä¸€æ™‚çš„ãªCredentialã‚’å–å¾—ã™ã‚‹ä»•çµ„ã¿ã€‚ å‰ã‚‚ã£ã¦ç™ºè¡Œã—ãŸAPIã‚­ãƒ¼ã¨ã¯é•ã„ã€æœ‰åŠ¹æœŸé™ãŒå­˜åœ¨ã™ã‚‹ãŸã‚ç¶šã‘ã¦å‘¼ã¶å ´åˆã¯å¤±åŠ¹ã™ã‚‹å‰ã«å†ç™ºè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
ã§ã¯RoleArnã‚’çŸ¥ã£ã¦ã„ãŸã‚‰èª°ã§ã‚‚å–å¾—ã§ãã‚‹ã‹ã¨ã„ã†ã¨ã€ã‚‚ã¡ã‚ã‚“ãã†ã§ã¯ãªãã€ ãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼é–¢ä¿‚ã€&amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot;ã®Principalã®ã¨ã“ã‚ã§ä¿¡é ¼ã™ã‚‹å¯¾è±¡ã‚’è¨­å®šã™ã‚‹ã€‚ ä¾‹ãˆã°ã€Serviceã§ec2.amazonaws.comã‚’æŒ‡å®šã—ã¦EC2ãŒAssumeRoleã™ã‚‹ã®ã‚’è¨±å¯ã—ãŸã‚Šã€ AWSã§(ä»–ã®)ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŒ‡å®šã—ã¦ãã®APIã‚­ãƒ¼ã§ã“ã®Roleã®Credentialã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã‚Šã¨ã„ã£ãŸæ„Ÿã˜ã€‚
{ &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;, &amp;quot;Statement&amp;quot;: [ { &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;, &amp;quot;Principal&amp;quot;: { &amp;quot;Service&amp;quot;: &amp;quot;ec2.amazonaws.com&amp;quot; }, &amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot; } ] }  EC2ã«ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã¨ã€å®Ÿã¯ãã®ãƒ­ãƒ¼ãƒ«ã«ã¤ã„ã¦AssumeRoleã—ã¦è‡ªå‹•ã§Credentialã‚’å–å¾—ã—ã¦ã„ã‚‹ã€‚ EC2ã«ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã«ã¯ãƒ­ãƒ¼ãƒ«ã¨ã¯åˆ¥ã« ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§EC2ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚’ä½œã‚‹ã¨åŒåã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ã§ä½œæˆã•ã‚Œã‚‹ã€‚ ã•ã‚‰ã«ã€AssumeRoleã®Serviceã¨ã—ã¦ec2.amazonaws.comãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚
$ curl http://169.254.169.254/latest/meta-data/iam/info { &amp;quot;Code&amp;quot; : &amp;quot;Success&amp;quot;, &amp;quot;LastUpdated&amp;quot; : &amp;quot;2017-02-25T10:56:33Z&amp;quot;, &amp;quot;InstanceProfileArn&amp;quot; : &amp;quot;arn:aws:iam::*****:instance-profile/assume_role_test&amp;quot;, &amp;quot;InstanceProfileId&amp;quot; : &amp;quot;*****&amp;quot; } $ curl http://169.254.169.254/latest/meta-data/iam/security-credentials/assume_role_test { &amp;quot;Code&amp;quot; : &amp;quot;Success&amp;quot;, &amp;quot;LastUpdated&amp;quot; : &amp;quot;2017-02-25T10:56:23Z&amp;quot;, &amp;quot;Type&amp;quot; : &amp;quot;AWS-HMAC&amp;quot;, &amp;quot;AccessKeyId&amp;quot; : &amp;quot;*****&amp;quot;, &amp;quot;SecretAccessKey&amp;quot; : &amp;quot;*****&amp;quot;, &amp;quot;Token&amp;quot; : &amp;quot;*****&amp;quot;, &amp;quot;Expiration&amp;quot; : &amp;quot;2017-02-25T17:26:07Z&amp;quot; }  å‚è€ƒ IAMãƒ­ãƒ¼ãƒ«å¾¹åº•ç†è§£ ã€œ AssumeRoleã®æ­£ä½“ ï½œ Developers.</description>
    </item>
    
    <item>
      <title>ELBã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¨surge queue</title>
      <link>https://www.sambaiz.net/article/68/</link>
      <pubDate>Tue, 21 Feb 2017 19:48:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/68/</guid>
      <description>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã ã‘ã§ã¯ãªãELBè‡ªä½“ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã€å†…éƒ¨nodeæ•°ã¯digã§èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ ã“ã®nodeæ•°ã¯è‡ªåˆ†ã§ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ããšã€åŸºæœ¬çš„ã«æ„è­˜ã™ã‚‹ã“ã¨ã¯ãªã„ã€‚
$ dig ****.ap-northeast-1.elb.amazonaws.com ;; ANSWER SECTION: *****.elb.amazonaws.com. 60 IN A xxx.xxx.xxx.xxx *****.elb.amazonaws.com. 60 IN A yyy.yyy.yyy.yyy  nodeãŒå¢—ãˆã‚‹ã®ã«ã¯ã‚ã‚‹ç¨‹åº¦æ™‚é–“ãŒã‹ã‹ã‚‹ã®ã§ã€ ã‚¢ã‚¯ã‚»ã‚¹ãŒæ€¥å¢—(5åˆ†é–“ã§50%ä»¥ä¸Šã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¢—åŠ ãŒç›®å®‰) ã—ãŸã‚‰æŒããã‚Œãšã€503ã‚’è¿”ã™ã“ã¨ãŒã‚ã‚‹ã€‚ å‰ã‚‚ã£ã¦å¤šé‡ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ¥ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã¦ã€ AWSã‚µãƒãƒ¼ãƒˆãŒBusinessä»¥ä¸Šãªã‚‰ pre-warmingç”³è«‹ã™ã‚‹ã“ã¨ã§nodeãŒå¢—ãˆãŸçŠ¶æ…‹ã§å¾…ã¡æ§‹ãˆã‚‰ã‚Œã‚‹ã€‚
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã§ããªã„å ´åˆã€ELBã®surge queueã«æºœã¾ã£ã¦ã„ãã€‚ ã“ã®æ•°ã¯CloudWatchã®SurgeQueueLength(ã‚­ãƒ¥ãƒ¼é•·ã®æ€¥å¢—)ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç¢ºèªã§ãã‚‹ã€‚ ã¾ãŸã€SurgeQueueLengthã®æœ€å¤§å€¤1024ã‚’è¶…ãˆã‚‹ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ‹’å¦ã•ã‚Œã€ãã®æ•°ã¯SpoiloverCount(éå‰°æ•°)ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å‡ºã‚‹ã€‚
å‚è€ƒ ELBã®æŒ™å‹•ã¨CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®èª­ã¿æ–¹ã‚’å¾¹åº•çš„ã«ç†è§£ã™ã‚‹ ï½œ Developers.IO
Elastic Load Balancing ã§ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</description>
    </item>
    
    <item>
      <title>Kinesis Streams/Firehose/Analyticsã‚’è©¦ã™</title>
      <link>https://www.sambaiz.net/article/67/</link>
      <pubDate>Mon, 20 Feb 2017 21:15:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/67/</guid>
      <description>https://aws.amazon.com/jp/kinesis/
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã‚µãƒ¼ãƒ“ã‚¹ç¾¤ã€‚ ã„ã¾ã®ã¨ã“ã‚Tokyoãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯Kinesis Streamsã—ã‹ä½¿ãˆãªã„ã€‚
Kinesis Firehose AWSã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«é€ã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€‚è‡ªåˆ†ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚€å‡¦ç†ã‚’æ›¸ã‹ãªãã¦ã‚ˆãã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚‚å‹æ‰‹ã«ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ç°¡å˜ã«ä½¿ãˆã‚‹ã€‚
https://aws.amazon.com/jp/kinesis/firehose/faqs/
Q: é€ä¿¡å…ˆã¨ã¯ä½•ã§ã™ã‹? é€ä¿¡å…ˆã¯ãƒ‡ãƒ¼ã‚¿ãŒé…ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã§ã™ã€‚Amazon Kinesis Firehose ã§ã¯ã€ ç¾åœ¨é€ä¿¡å…ˆã¨ã—ã¦ Amazon S3ã€Amazon Redshiftã€Amazon Elasticsearch Service ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚  æ–™é‡‘ã¯å–ã‚Šè¾¼ã¾ã‚ŒãŸãƒ‡ãƒ¼ã‚¿é‡ã«ã‚ˆã‚‹ã€‚ ä¸€è¦‹ãã‚“ãªã«é«˜ããªã‚‰ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ãŒã€5KBå˜ä½ã§åˆ‡ã‚Šä¸Šã’ã‚‰ã‚Œã‚‹ã®ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚ºãŒå°ã•ãã¦æ•°ãŒå¤šã„å ´åˆã«æ³¨æ„ãŒå¿…è¦ã€‚
ä»Šå›ã¯S3ã«é€ã£ã¦ã¿ã‚‹ã€‚
åœ§ç¸®æ–¹æ³•ã‚’è¨­å®šã—ãŸã‚Šã€Lambdaã‚’å™›ã¾ã›ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
StatusãŒActiveã«ãªã£ãŸã‚‰Kinesis Agentã§é€ã£ã¦ã¿ã‚‹ã€‚ CloudWatchã¨Firehoseã«Putã™ã‚‹æ¨©é™ãŒå¿…è¦ã€‚Firehoseã¯kinesis:ã§ã¯ãªãfirehose:ãªã®ã§æ³¨æ„ã€‚
$ sudo yum install â€“y aws-kinesis-agent  /etc/aws-kinesis/agent.jsonã‚’ç·¨é›†ã™ã‚‹ã€‚ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ ã“ã“ ã«ã‚ã‚‹ã€‚
{ &amp;quot;awsAccessKeyId&amp;quot;: &amp;quot;&amp;quot;, &amp;quot;awsSecretAccessKey&amp;quot;: &amp;quot;&amp;quot;, &amp;quot;firehose.endpoint&amp;quot;: &amp;quot;https://firehose.us-east-1.amazonaws.com&amp;quot;, &amp;quot;flows&amp;quot;: [ { &amp;quot;filePattern&amp;quot;: &amp;quot;/tmp/hoge.log&amp;quot;, &amp;quot;deliveryStream&amp;quot;: &amp;quot;hogefugastream&amp;quot; } ] }  $ sudo service aws-kinesis-agent start $ sudo chkconfig aws-kinesis-agent on $ echo &amp;quot;aaa&amp;quot; &amp;gt;&amp;gt; /tmp/hoge.</description>
    </item>
    
    <item>
      <title>Goã§DynamoDBã‚’ä½¿ã†</title>
      <link>https://www.sambaiz.net/article/63/</link>
      <pubDate>Sun, 12 Feb 2017 23:15:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/63/</guid>
      <description>ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ“ä½œã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ - Amazon DynamoDB
ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼(ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ¼)ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ãƒˆã‚­ãƒ¼(ãƒ¬ãƒ³ã‚¸ã‚­ãƒ¼)ã‚’è¨­å®šã™ã‚‹ã€‚ DynamoDBã¯ã“ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã«åŸºã¥ã„ã¦ã€è¤‡æ•°ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«åˆ†æ•£ã—ã¦ä¿å­˜ã™ã‚‹ã€‚ ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ€§èƒ½ã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³é–“ã§å‡ç­‰ã«ä½¿ã‚ã‚Œã‚‹ã®ã§ã€ ã‚½ãƒ¼ãƒˆã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹å ´åˆã«ã“ã‚Œã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€ ã‚ã‚‹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé›†ä¸­ã—ãªã„ã‚ˆã†ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã«ç‰¹å®šã®å€¤ã°ã‹ã‚Šé›†ä¸­ã—ãªã„ã‚ˆã†ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ é¸ã¶å¿…è¦ãŒã‚ã‚‹ã€‚
ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(GSI)ã¨ ã‚½ãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(LSI)ãŒã‚ã‚‹ã€‚ å°„å½±ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é¸æŠã§ãã€ã“ã“ã«å«ã¾ã‚Œãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯è¿”ã•ãªã„ã€‚ ãŸã ã—ã€ã™ã¹ã¦ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«æ›¸ãè¾¼ã‚€ã®ã¯ã‚³ã‚¹ãƒˆãŒé«˜ã„ã®ã§ãªã‚‹ã¹ãçµã‚‹ã€‚
ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ  1èª­ã¿è¾¼ã¿ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ: 4kbã‚’è¶…ãˆãªã„ãƒ‡ãƒ¼ã‚¿ã‚’1ç§’ã«1~2å›(æ•´åˆæ€§ã«ã‚ˆã‚‹)èª­ã¿è¾¼ã‚ã‚‹ 1æ›¸ãè¾¼ã¿ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ¦ãƒ‹ãƒƒãƒˆ: 1kbã‚’è¶…ãˆãªã„ãƒ‡ãƒ¼ã‚¿ã‚’1ç§’ã«1å›æ›¸ãè¾¼ã‚ã‚‹  ãƒ¦ãƒ‹ãƒƒãƒˆã«å¿œã˜ã¦1æ™‚é–“ã‚ãŸã‚Šã§èª²é‡‘ã•ã‚Œã‚‹ã€‚
æœªä½¿ç”¨ã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãŒã‚ã‚‹å ´åˆã€æœ€å¤§5åˆ†ä¿æŒã—ã¦ãƒãƒ¼ã‚¹ãƒˆã«å‚™ãˆã¦ãã‚Œã‚‹ã€‚
èª­ã¿æ›¸ãã™ã‚‹ aws-sdk-goã‚’ç›´æ¥ä½¿ã£ã¦ã‚‚ã„ã„ã‘ã©ã€ç°¡å˜ã«æ‰±ãˆã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ guregu/dynamo ã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã€‚
type Data struct { ID int64 `dynamo:&amp;quot;id&amp;quot;` Name string Age int } db := dynamo.New(session.New(), &amp;amp;aws.Config{Region: aws.String(&amp;quot;ap-northeast-1&amp;quot;)}) table := db.Table(&amp;quot;testtable&amp;quot;)  Create &amp;amp; Update d := Data{ID: 1, Name: &amp;quot;hogefuga&amp;quot;, Age: 123} if err := table.Put(d).Run(); err != nil { return err } if err := table.</description>
    </item>
    
    <item>
      <title>EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢</title>
      <link>https://www.sambaiz.net/article/58/</link>
      <pubDate>Mon, 06 Feb 2017 21:52:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/58/</guid>
      <description>http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/InstanceStorage.html
EC2ã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã«ã‚ˆã£ã¦ã¯EBSã«åŠ ãˆã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ãŒä½¿ãˆã‚‹ã€‚ã—ã‹ã‚‚è¿½åŠ æ–™é‡‘ãªã—ã€‚ å¯¾è±¡ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒ&amp;rdquo;EBSã®ã¿&amp;rdquo;ã§ãªã„ã‚‚ã®ã€‚
https://aws.amazon.com/jp/ec2/instance-types/
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåœæ­¢ã—ãŸã‚Šã€éšœå®³ãŒèµ·ãã‚‹ã¨æ¶ˆãˆã‚‹ä¸€æ™‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€‚å†èµ·å‹•ã§ã¯æ¶ˆãˆãªã„ã€‚ ãƒ›ã‚¹ãƒˆã«ç‰©ç†çš„ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒãƒƒãƒ•ã‚¡ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã©ã®é »ç¹ã«èª­ã¿æ›¸ãã•ã‚Œã€æ¶ˆãˆã¦ã‚‚ã„ã„ãƒ‡ãƒ¼ã‚¿ã«æœ€é©ã€‚ ä»–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚å®¹é‡ã‚„æ€§èƒ½ã‚‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã«ä¾å­˜ã™ã‚‹ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®è¿½åŠ ã¯ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®èµ·å‹•æ™‚ã«ã€æ–°ã—ã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’è¿½åŠ ã—ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã«ã™ã‚‹ã“ã¨ã§è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚
ä»Šå›ã¯SSDã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸1 x 4ã®m3.mediumã§è©¦ã™ã€‚ã“ã‚Œã¯4gbã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒä¸€ã¤è¿½åŠ ã§ãã‚‹ã¨ã„ã†æ„å‘³ã€‚
ã¾ãšã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã‚’è¿½åŠ ã—ã¦ãªã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€‚ lsblkã¨ã„ã†ã®ã¯list block devicesã®ç•¥ã€‚
$ df -h ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ ã‚µã‚¤ã‚º ä½¿ç”¨ æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½® /dev/xvda1 7.8G 1.2G 6.6G 15% / ... $ dd if=/dev/zero of=hoge bs=1M count=1000 $ ls -sh åˆè¨ˆ 1001M 1001M hoge $ df -h ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ ã‚µã‚¤ã‚º ä½¿ç”¨ æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½® /dev/xvda1 7.8G 2.2G 5.6G 28% / ... $ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT xvda 202:0 0 8G 0 disk â””â”€xvda1 202:1 0 8G 0 part /  ãã‚Œã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¹ãƒˆã‚¢(/dev/xvdb)ã‚’è¿½åŠ ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€‚</description>
    </item>
    
    <item>
      <title>è¤‡æ•°EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦vegetaã§è² è·è©¦é¨“ã™ã‚‹</title>
      <link>https://www.sambaiz.net/article/43/</link>
      <pubDate>Sun, 18 Dec 2016 20:52:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/43/</guid>
      <description>vegetaã§è² è·ã‚’ã‹ã‘ã‚‹ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã€‚ sambaiz/loadtest
ã¾ãšã‚­ãƒ¼ãƒšã‚¢ã‚’ä½œæˆã—ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ã€å…¨ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§å¾…ã¤ã€‚
aws ec2 create-key-pair --key-name LoadTestKeyPare --query &#39;KeyMaterial&#39; --output text &amp;gt; LoadTestKeyPare.pem chmod 400 LoadTestKeyPare.pem aws ec2 run-instances --image-id $AMI_ID --count $INSTANCE_NUM --instance-type t2.micro --key-name LoadTestKeyPare --security-group-ids $SECURITY_GROUP_IDS --subnet-id $SUBNET_ID ... aws ec2 wait instance-status-ok --instance-ids $INSTANCE_IDS  ã“ã®AMIã¯äº‹å‰ã«Packerã§ã¤ãã£ãŸã‚‚ã®ã€‚vegetaã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã®ä¸Šé™ã‚’å¢—ã‚„ã—ã¦ã„ã‚‹ã€‚
{ &amp;quot;variables&amp;quot;: { &amp;quot;aws_access_key&amp;quot;: &amp;quot;&amp;quot;, &amp;quot;aws_secret_key&amp;quot;: &amp;quot;&amp;quot; }, &amp;quot;builders&amp;quot;: [{ &amp;quot;type&amp;quot;: &amp;quot;amazon-ebs&amp;quot;, &amp;quot;access_key&amp;quot;: &amp;quot;{{user `aws_access_key`}}&amp;quot;, &amp;quot;secret_key&amp;quot;: &amp;quot;{{user `aws_secret_key`}}&amp;quot;, &amp;quot;region&amp;quot;: &amp;quot;ap-northeast-1&amp;quot;, &amp;quot;source_ami&amp;quot;: &amp;quot;ami-0c11b26d&amp;quot;, &amp;quot;instance_type&amp;quot;: &amp;quot;t2.micro&amp;quot;, &amp;quot;ssh_username&amp;quot;: &amp;quot;ec2-user&amp;quot;, &amp;quot;ami_name&amp;quot;: &amp;quot;loadtest {{timestamp}}&amp;quot; }], &amp;quot;provisioners&amp;quot;: [{ &amp;quot;type&amp;quot;: &amp;quot;shell&amp;quot;, &amp;quot;inline&amp;quot;: [ &amp;quot;wget https://github.</description>
    </item>
    
    <item>
      <title>Packerã§AMIã‚’ä½œã‚‹</title>
      <link>https://www.sambaiz.net/article/24/</link>
      <pubDate>Tue, 18 Oct 2016 22:37:00 +0900</pubDate>
      
      <guid>https://www.sambaiz.net/article/24/</guid>
      <description>https://www.packer.io/
ã„ã‚ã‚“ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã€‚ ã“ã‚Œã§fluentdã®ãƒ­ã‚°ã‚µãƒ¼ãƒãƒ¼ã®AMIã‚’ä½œã‚‹ã€‚
$ brew install packer # mac $ packer -v 0.10.1  è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚variablesã®å€¤ã¯{{user ... }}ã®ã¨ã“ã‚ã§ä½¿ã‚ã‚Œã‚‹ã€‚ buildersã«ä½œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æƒ…å ±ã‚’æ›¸ã„ã¦ã€provisionersã§ç’°å¢ƒã‚’ä½œã‚‹ã€‚
provisionersã«ã¯chefã‚„ansibleãªã©ã‚‚æŒ‡å®šã§ãã‚‹ãŒã€ ç¶™ãè¶³ã—ç¶™ãè¶³ã—ã§ç§˜ä¼ã®ã‚¿ãƒ¬åŒ–ã—ãŸAMIã‚‚æœ€åˆã¯ã€
ã€Œã‚³ãƒãƒ³ãƒ‰ã„ãã¤ã‹å®Ÿè¡Œã™ã‚‹ã ã‘ãªã®ã§ã¨ã‚Šã‚ãˆãšæ‰‹ä½œæ¥­ã§ä½œã£ãŸã€å¾Œã§ãªã‚“ã¨ã‹ã™ã‚‹ã€
ãªã‚“ã¦ã‚‚ã®ã‚‚ã‚ã£ãŸã‚Šã—ã¦ã€ ãã†ã„ã†ã‚‚ã®ã¯ç„¡ç†ã«chefãªã©ã§å§‹ã‚ãšã€æ‰‹è»½ã«shellã§packer buildã™ã‚‹ã¨ã„ã„ã¨æ€ã†ã€‚ æ‰‹ä½œæ¥­ã‚ˆã‚Šã‚‚æ¥½ã ã—ã€ã‚½ãƒ¼ã‚¹ãŒåˆ¥ã«ã‚ã‚‹ã®ã§ä½¿ã‚ã‚Œã¦ã„ãªã„AMIã‚’æ¶ˆã™ã®ã‚‚ç°¡å˜ã ã€‚
fileã§ã¯permissionãŒãªã„ã¨ã“ã‚ã«ç½®ãã“ã¨ãŒã§ããªã„ã®ã§ã€ä¸€æ—¦ç½®ã„ã¦shellã§ç§»å‹•ã™ã‚‹ã€‚
{ &amp;quot;variables&amp;quot;: { &amp;quot;aws_access_key&amp;quot;: &amp;quot;&amp;quot;, &amp;quot;aws_secret_key&amp;quot;: &amp;quot;&amp;quot; }, &amp;quot;builders&amp;quot;: [{ &amp;quot;type&amp;quot;: &amp;quot;amazon-ebs&amp;quot;, &amp;quot;access_key&amp;quot;: &amp;quot;{{user `aws_access_key`}}&amp;quot;, &amp;quot;secret_key&amp;quot;: &amp;quot;{{user `aws_secret_key`}}&amp;quot;, &amp;quot;region&amp;quot;: &amp;quot;ap-northeast-1&amp;quot;, &amp;quot;source_ami&amp;quot;: &amp;quot;ami-1a15c77b&amp;quot;, &amp;quot;instance_type&amp;quot;: &amp;quot;t2.small&amp;quot;, &amp;quot;ssh_username&amp;quot;: &amp;quot;ec2-user&amp;quot;, &amp;quot;ami_name&amp;quot;: &amp;quot;fluentd-logserver {{timestamp}}&amp;quot; }], &amp;quot;provisioners&amp;quot;: [{ &amp;quot;type&amp;quot;: &amp;quot;file&amp;quot;, &amp;quot;source&amp;quot;: &amp;quot;td-agent.conf&amp;quot;, &amp;quot;destination&amp;quot;: &amp;quot;/home/ec2-user/td-agent.conf&amp;quot; }, { &amp;quot;type&amp;quot;: &amp;quot;shell&amp;quot;, &amp;quot;inline&amp;quot;: [ &amp;quot;curl -L https://toolbelt.</description>
    </item>
    
  </channel>
</rss>