<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>sambaiz-net</title>
    <link>https://www.sambaiz.net/tags/d3.js/index.xml</link>
    <language>ja</language>
    <author>sambaiz</author>
    <rights>(C) 2017</rights>
    <updated>0001-01-01 00:00:00 &#43;0000 UTC</updated>

    
      
        <item>
          <title>d3.jsで折れ線グラフを書くコードを読む</title>
          <link>https://www.sambaiz.net/article/31/</link>
          <pubDate>Thu, 03 Nov 2016 00:15:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/31/</guid>
          <description>&lt;p&gt;&lt;a href=&#34;http://bl.ocks.org/mbostock/3883245&#34;&gt;http://bl.ocks.org/mbostock/3883245&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CSSと&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;style&amp;gt;

.axis--x path {
  display: none;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

&amp;lt;/style&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;グラフを書くsvgとd3.js。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;svg width=&amp;quot;960&amp;quot; height=&amp;quot;500&amp;quot;&amp;gt;&amp;lt;/svg&amp;gt;
&amp;lt;script src=&amp;quot;https://d3js.org/d3.v4.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;var svg = d3.select(&amp;quot;svg&amp;quot;),
    margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = +svg.attr(&amp;quot;width&amp;quot;) - margin.left - margin.right,
    height = +svg.attr(&amp;quot;height&amp;quot;) - margin.top - margin.bottom,
    g = svg.append(&amp;quot;g&amp;quot;).attr(&amp;quot;transform&amp;quot;, &amp;quot;translate(&amp;quot; + margin.left + &amp;quot;,&amp;quot; + margin.top + &amp;quot;)&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;d3.select&lt;/code&gt;でsvg要素を選択。widthとheightを取得したり、中にg(グループ)を入れてtransformでmarginを作っている。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;svg width=&amp;quot;960&amp;quot; height=&amp;quot;500&amp;quot;&amp;gt;&amp;lt;g transform=&amp;quot;translate(50,20)&amp;quot;&amp;gt;&amp;lt;/g&amp;gt;&amp;lt;/svg&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;svg.attr&lt;/code&gt;の前に+を付けるとnullの場合でも数値として扱える。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt; +null
0
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;var parseTime = d3.timeParse(&amp;quot;%d-%b-%y&amp;quot;);

var x = d3.scaleTime()
    .rangeRound([0, width]);

var y = d3.scaleLinear()
    .rangeRound([height, 0]);

var line = d3.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.close); });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;d3.scaleTime()&lt;/code&gt;や&lt;code&gt;d3.scaleLinear()&lt;/code&gt;は&lt;code&gt;domain&lt;/code&gt;で値域を指定し、&lt;code&gt;range&lt;/code&gt;の範囲にマッピングさせる。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt; d3.scaleLinear().rangeRound([0, 100]).domain([0, 66525])(33262)
50
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;d3.line()&lt;/code&gt;で点を結ぶ。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt; d3.line()
  .x(function(d) { return d.a; })
  .y(function(d) { return d.b; })([{a: 10, b: 20},{a: 20, b:10}])
M10,20L20,10
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;d3.tsv(&amp;quot;data.tsv&amp;quot;, function(d) {
  d.date = parseTime(d.date);
  d.close = +d.close;
  return d;
}, function(error, data) {
  if (error) throw error;

  x.domain(d3.extent(data, function(d) { return d.date; }));
  y.domain(d3.extent(data, function(d) { return d.close; }));

  g.append(&amp;quot;g&amp;quot;)
      .attr(&amp;quot;class&amp;quot;, &amp;quot;axis axis--x&amp;quot;)
      .attr(&amp;quot;transform&amp;quot;, &amp;quot;translate(0,&amp;quot; + height + &amp;quot;)&amp;quot;)
      .call(d3.axisBottom(x));

  g.append(&amp;quot;g&amp;quot;)
      .attr(&amp;quot;class&amp;quot;, &amp;quot;axis axis--y&amp;quot;)
      .call(d3.axisLeft(y))
    .append(&amp;quot;text&amp;quot;)
      .attr(&amp;quot;fill&amp;quot;, &amp;quot;#000&amp;quot;)
      .attr(&amp;quot;transform&amp;quot;, &amp;quot;rotate(-90)&amp;quot;)
      .attr(&amp;quot;y&amp;quot;, 6)
      .attr(&amp;quot;dy&amp;quot;, &amp;quot;0.71em&amp;quot;)
      .style(&amp;quot;text-anchor&amp;quot;, &amp;quot;end&amp;quot;)
      .text(&amp;quot;Price ($)&amp;quot;);

  g.append(&amp;quot;path&amp;quot;)
      .datum(data)
      .attr(&amp;quot;class&amp;quot;, &amp;quot;line&amp;quot;)
      .attr(&amp;quot;d&amp;quot;, line);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;tsvを読んで加工した後、&lt;code&gt;d3.extent&lt;/code&gt;で[最小値, 最大値]の配列を作ってdomainに渡す。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;console.log(d3.extent([4, 1, 2, 4, 9, 3], function(d){ return d }))
[1, 9]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あと縦軸と横軸を書いてパスを書く。&lt;/p&gt;

&lt;p&gt;`&lt;/p&gt;
</description>
        </item>
      
    

  </channel>
</rss>
