<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>sambaiz-net</title>
    <link>https://www.sambaiz.net/tags/node.js/index.xml</link>
    <language>ja</language>
    <author>sambaiz</author>
    <rights>(C) 2017</rights>
    <updated>0001-01-01 00:00:00 &#43;0000 UTC</updated>

    
      
        <item>
          <title>Apexã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹</title>
          <link>https://www.sambaiz.net/article/140/</link>
          <pubDate>Sun, 22 Oct 2017 16:06:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/140/</guid>
          <description>&lt;p&gt;&lt;a href=&#34;https://github.com/apex/apex&#34;&gt;Apex&lt;/a&gt;ã§Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚
ã¨ã¦ã‚‚ç°¡å˜ã«ä½¿ãˆã‚‹ã—ã€å¤‰ãªã“ã¨ã‚‚ã—ãªã„ã®ã§è‰¯ã„æ„Ÿã˜ã€‚&lt;/p&gt;

&lt;p&gt;ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl https://raw.githubusercontent.com/apex/apex/master/install.sh | sh
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;IAMFullAccess&lt;/li&gt;
&lt;li&gt;AWSLambdaFullAccess&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ã‚’ä»˜ã‘ãŸIAMã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²ã—ã¦ãŠãã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aws configure --profile apex
$ aws configure list --profile apex
      Name                    Value             Type    Location
      ----                    -----             ----    --------
   profile                     apex           manual    --profile
access_key     ****************OVGQ shared-credentials-file    
secret_key     ****************oi5t shared-credentials-file    
    region           ap-northeast-1      config-file    ~/.aws/config
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;apex init&lt;/code&gt;ã—ã¦nameã¨descriptionã‚’å…¥ã‚Œã‚‹ã¨IAMãŒç™»éŒ²ã•ã‚Œã€
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒä½œã‚‰ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ apex init --profile apex
Project name: try-apex
Project description: test  
[+] creating IAM try-apex_lambda_function role
[+] creating IAM try-apex_lambda_logs policy
[+] attaching policy to lambda_function role.
[+] creating ./project.json
[+] creating ./functions
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;package.jsonã§ç’°å¢ƒå¤‰æ•°ãªã©ã®è¨­å®šãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ls -R
functions	project.json

./functions:
hello

./functions/hello:
index.js

$ cat project.json 
{
  &amp;quot;name&amp;quot;: &amp;quot;try-apex&amp;quot;,
  &amp;quot;description&amp;quot;: &amp;quot;test&amp;quot;,
  &amp;quot;memory&amp;quot;: 128,
  &amp;quot;timeout&amp;quot;: 5,
  &amp;quot;role&amp;quot;: &amp;quot;arn:aws:iam::524580158183:role/try-apex_lambda_function&amp;quot;,
  &amp;quot;environment&amp;quot;: {}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;apex deploy&lt;/code&gt;ã™ã‚‹ã¨lambdaãŒä½œã‚‰ã‚Œã‚‹ã€‚&lt;code&gt;--dry-run&lt;/code&gt;ã‚‚ã§ãã‚‹ã€‚
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã®ã§&lt;code&gt;rollback&lt;/code&gt;ã‚‚ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ apex deploy hello --profile apex
   â€¢ creating function         env= function=hello
   â€¢ created alias current     env= function=hello version=1
   â€¢ function created          env= function=hello name=try-apex_hello version=1

$ apex list

  hello
    runtime: nodejs6.10
    memory: 128mb
    timeout: 5s
    role: arn:aws:iam::*****:role/try-apex_lambda_function
    handler: index.handle
    arn: arn:aws:lambda:ap-northeast-1:*****:function:try-apex_hello:current
    aliases: current@v1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã¯ã“ã“ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç¢ºèªã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://www.sambaiz.net/images/140.png&#34; alt=&#34;ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç¢ºèª&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;apex invoke&lt;/code&gt;ã§å®Ÿè¡Œã€‚æ¨™æº–å…¥åŠ›ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¸¡ã›ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ apex invoke hello
{&amp;quot;hello&amp;quot;:&amp;quot;world&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã‚ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯.apexignoreã«æ›¸ãã€‚&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã®ã‚³ãƒ¼ãƒ‰ã‚’Prettierã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ESLintã«ã‹ã‘ã‚‹</title>
          <link>https://www.sambaiz.net/article/139/</link>
          <pubDate>Thu, 19 Oct 2017 00:35:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/139/</guid>
          <description>&lt;p&gt;&lt;a href=&#34;https://github.com/prettier/prettier&#34;&gt;Prettier&lt;/a&gt;ã¯JSã‚„TSã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã§ã€
Reactã‚„Babelã€Yarnãªã©ã®é–‹ç™ºã«ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå›ã¯Prettierã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸã‚‚ã®ã‚’
&lt;code&gt;eslint --fix&lt;/code&gt;ã™ã‚‹&lt;a href=&#34;https://github.com/prettier/prettier-eslint-cli&#34;&gt;prettier-eslint-cli&lt;/a&gt;ã‚’ä½¿ã†ã€‚å½¹å‰²ãŒè¢«ã£ã¦ã„ã‚‹ã‘ã©Prettierã¯&lt;code&gt;eslint --fix&lt;/code&gt;ã‚ˆã‚Šã‚‚å¼·åŠ›ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ãã‚Œã‚‹ã‚ˆã†ã ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git init
$ yarn add --dev eslint eslint-config-google prettier-eslint-cli husky lint-staged
$ cat .eslintrc.js 
module.exports = {
    &amp;quot;extends&amp;quot;: &amp;quot;google&amp;quot;,
    &amp;quot;parserOptions&amp;quot;: {
    	&amp;quot;ecmaVersion&amp;quot;: 2017,
    }
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã‚Œã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cat src/main.js
/**
 * hoge function
 */
function hoge() {

  const f = (aaaaaaaaaaaaaaa, bbbbbbbbbb, ccccccccc, dddddddddddd, eeeeeeeeeeeeee) =&amp;gt;
    console.log(&#39;a&#39;);


  f(1, 2, 3, 4, 5);
}


hoge();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Prettierã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«&lt;a href=&#34;https://github.com/okonet/lint-staged&#34;&gt;lint-staged&lt;/a&gt;ã‚’ä½¿ã†ã¨Commitæ™‚ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã€Lintã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;precommit&amp;quot;: &amp;quot;lint-staged&amp;quot;,
    &amp;quot;lint&amp;quot;: &amp;quot;eslint src&amp;quot;,
    &amp;quot;format&amp;quot;: &amp;quot;prettier-eslint --write \&amp;quot;src/**/*.js\&amp;quot;&amp;quot;
  },
  &amp;quot;lint-staged&amp;quot;: {
    &amp;quot;*.js&amp;quot;: [
      &amp;quot;prettier-eslint --write&amp;quot;,
      &amp;quot;eslint&amp;quot;,
      &amp;quot;git add&amp;quot;
    ]
  },
  &amp;quot;devDependencies&amp;quot;: {
    &amp;quot;eslint&amp;quot;: &amp;quot;^4.9.0&amp;quot;,
    &amp;quot;eslint-config-google&amp;quot;: &amp;quot;^0.9.1&amp;quot;,
    &amp;quot;husky&amp;quot;: &amp;quot;^0.14.3&amp;quot;,
    &amp;quot;lint-staged&amp;quot;: &amp;quot;^4.2.3&amp;quot;,
    &amp;quot;prettier-eslint-cli&amp;quot;: &amp;quot;^4.4.0&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ git commit -m &amp;quot;test&amp;quot;
husky &amp;gt; npm run -s precommit (node v8.2.1)

 âœ” Running tasks for *.js
[master e325ea3] test

$ cat src/main.js 
/**
 * hoge function
 */
function hoge() {
  const f = (
    aaaaaaaaaaaaaaa,
    bbbbbbbbbb,
    ccccccccc,
    dddddddddddd,
    eeeeeeeeeeeeee
  ) =&amp;gt; console.log(&#39;a&#39;);

  f(1, 2, 3, 4, 5);
}

hoge();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Prettierã¯&lt;code&gt;eslint --fix&lt;/code&gt;ã§ä¿®æ­£ã•ã‚Œãªã„max-lenã‚‚è‰¯ã„æ„Ÿã˜ã«ã—ã¦ãã‚Œã‚‹ã€‚
ãªã®ã§ESLintã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«é–¢ã™ã‚‹ã¨ã“ã‚ã¯ã»ã¨ã‚“ã©ä¿®æ­£ã„ã‚‰ãªã„ã¯ãšã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git commit -m &amp;quot;test&amp;quot;
husky &amp;gt; npm run -s precommit (node v8.2.1)

 â¯ Running tasks for *.js
   âœ– eslint --fix
     git add
âœ– eslint --fix found some errors. Please fix them and try committing again.

***/src/main.js
  5:1  error  Line 5 exceeds the maximum line length of 80  max-len

âœ– 1 problem (1 error, 0 warnings)
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Lambdaä¸Šã§Puppeteer/Headless Chromeã‚’å‹•ã‹ã™Starter Kitã‚’ä½œã£ãŸ</title>
          <link>https://www.sambaiz.net/article/132/</link>
          <pubDate>Sun, 10 Sep 2017 23:45:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/132/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;https://github.com/GoogleChrome/puppeteer&#34;&gt;Puppeteer&lt;/a&gt;ã§Headless Chromeã‚’å‹•ã‹ã™ã‚³ãƒ¼ãƒ‰ã‚’
Lambdaä¸Šã§å‹•ã‹ã™Starter Kitã‚’ä½œã£ãŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/sambaiz/puppeteer-lambda-starter-kit&#34;&gt;puppeteer-lambda-starter-kit&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;chromeã®æº–å‚™&#34;&gt;Chromeã®æº–å‚™&lt;/h2&gt;

&lt;p&gt;Puppeteerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è½ã¨ã—ã¦ãã‚‹Chromeã‚’Lambdaä¸Šã§å‹•ã‹ãã†ã¨ã—ã¦ã‚‚
Lambdaã«ãªã„shared libraryã«ä¾å­˜ã—ã¦ã„ã‚‹ãŸã‚å¤±æ•—ã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;error while loading shared libraries: libpangocairo-1.0.so.0: cannot open shared object file: No such file or directory
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lambdaä¸Šã§Headless Chromeã‚’å‹•ã‹ã™ä¾‹ãŒãªã„ã‹èª¿ã¹ãŸã‚‰&lt;a href=&#34;https://github.com/adieuadieu/serverless-chrome&#34;&gt;serverless-chrome&lt;/a&gt;ã¨ã„ã†ã®ãŒã‚ã£ã¦ã€
Headlessç”¨ã®è¨­å®šã§Chromeã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ãŸã€‚
ã»ã‹ã«ã¯&lt;a href=&#34;https://github.com/graphcool/chromeless&#34;&gt;chromeless&lt;/a&gt;ã¨ã„ã†ã®ã‚‚ã‚ã‚‹ã‘ã©
ã“ã‚Œã¯serverless-chromeã«
&lt;a href=&#34;https://github.com/graphcool/chromeless/blob/master/serverless/serverless.yml#L46&#34;&gt;ä¾å­˜ã—ã¦ã„ã‚‹&lt;/a&gt;ã€‚
æœ€å°æ§‹æˆã§Puppeteerã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§ã€ä»Šå›ã¯ã“ã‚Œã‚‰ã‚’ä½¿ã‚ãšä¸€ã‹ã‚‰ä½œã‚‹ã“ã¨ã«ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;serverless-chromeã«ã‚‚ãƒ“ãƒ«ãƒ‰ã—ãŸã‚‚ã®ãŒç½®ã„ã¦ã‚ã‚‹ãŒã€å°‘ã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã‚ˆã†ã ã£ãŸã®ã§æœ€æ–°ç‰ˆã§ãƒ“ãƒ«ãƒ‰ã—ãŸã€‚
åŸºæœ¬çš„ã«ã¯&lt;a href=&#34;https://github.com/adieuadieu/serverless-chrome/tree/master/chrome&#34;&gt;æ›¸ã„ã¦ã‚ã‚‹&lt;/a&gt;
é€šã‚Šã‚„ã‚Œã°ã†ã¾ãã„ãã€‚ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã®shared memoryã¨ã—ã¦/dev/shmã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã‚’ã€/tmpã«&lt;a href=&#34;https://github.com/sambaiz/puppeteer-lambda-starter-kit/blob/master/chrome/buildChrome.sh#L20&#34;&gt;ç½®ãæ›ãˆã‚‹&lt;/a&gt;
ã‚ˆã†ã«ã—ãªã„ã¨ã€å®Ÿè¡Œæ™‚ã®&lt;code&gt;page.goto()&lt;/code&gt;ã§&lt;code&gt;Failed Provisional Load: ***, error_code: -12&lt;/code&gt;ã«ãªã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ãƒ“ãƒ«ãƒ‰ã—ãŸheadless_shellã«ã¯å•é¡Œã«ãªã£ãŸä¾å­˜ã¯å«ã¾ã‚Œã¦ã„ãªã„ã‚ˆã†ã ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ldd headless_shell 
	linux-vdso.so.1 =&amp;gt;  (0x00007ffcb6fed000)
	libpthread.so.0 =&amp;gt; /lib64/libpthread.so.0 (0x00007f5f17dbe000)
	libdl.so.2 =&amp;gt; /lib64/libdl.so.2 (0x00007f5f17bba000)
	librt.so.1 =&amp;gt; /lib64/librt.so.1 (0x00007f5f179b1000)
	libnss3.so =&amp;gt; /usr/lib64/libnss3.so (0x00007f5f17692000)
	libnssutil3.so =&amp;gt; /usr/lib64/libnssutil3.so (0x00007f5f17466000)
	libsmime3.so =&amp;gt; /usr/lib64/libsmime3.so (0x00007f5f1723e000)
	libnspr4.so =&amp;gt; /lib64/libnspr4.so (0x00007f5f17001000)
	libexpat.so.1 =&amp;gt; /lib64/libexpat.so.1 (0x00007f5f16dd8000)
	libfontconfig.so.1 =&amp;gt; not found
	libfreetype.so.6 =&amp;gt; /usr/lib64/libfreetype.so.6 (0x00007f5f16b3b000)
	libm.so.6 =&amp;gt; /lib64/libm.so.6 (0x00007f5f16839000)
	libstdc++.so.6 =&amp;gt; /usr/lib64/libstdc++.so.6 (0x00007f5f16533000)
	libgcc_s.so.1 =&amp;gt; /lib64/libgcc_s.so.1 (0x00007f5f1631d000)
	libc.so.6 =&amp;gt; /lib64/libc.so.6 (0x00007f5f15f5b000)
	/lib64/ld-linux-x86-64.so.2 (0x000055ba0af5e000)
	libplc4.so =&amp;gt; /lib64/libplc4.so (0x00007f5f15d55000)
	libplds4.so =&amp;gt; /lib64/libplds4.so (0x00007f5f15b51000)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Puppetterã§è½ã¨ã—ã¦ãã‚‹æ™®é€šã®Chromeã¯&lt;a href=&#34;http://docs.aws.amazon.com/lambda/latest/dg/limits.html&#34;&gt;Lambdaã®åˆ¶é™&lt;/a&gt;ã®50MBã‚’è¶…ãˆã¦ã„ãŸãŒã€
ãƒ“ãƒ«ãƒ‰ã—ãŸã‚‚ã®ã¯ãã‚Šãã‚Šè¶…ãˆã¦ã„ãªã„ã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
Puppeteerã®Chromeã¯ç’°å¢ƒå¤‰æ•°&lt;code&gt;PUPPETEER_SKIP_CHROMIUM_DOWNLOAD&lt;/code&gt;ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§&lt;a href=&#34;https://github.com/GoogleChrome/puppeteer/blob/2817130fe099a7431e98c20ce1f44c6e547d4ca9/docs/api.md#puppeteer&#34;&gt;å«ã‚ãªã„ã‚ˆã†ã«ã§ãã‚‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ã¯50MBã‚’è¶…ãˆã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚‹ã®ã§ã€
ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã‚ãš&lt;a href=&#34;https://github.com/sambaiz/puppeteer-lambda-starter-kit/blob/v0.9.0/src/util.js#L62&#34;&gt;S3ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰&lt;/a&gt;ã§ãã‚‹ã‚ˆã†ã«ã‚‚ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;ã„ãšã‚Œã®å ´åˆã‚‚æœ€çµ‚çš„ãªç½®ãå…ˆã¯Lambdaã§å”¯ä¸€æ›¸ãè¾¼ã‚ã‚‹&lt;code&gt;/tmp&lt;/code&gt;ã«ãªã‚‹ã€‚
ã“ã®é ˜åŸŸã¯512MBã¾ã§ä½¿ãˆã‚‹ã®ã§å±•é–‹ã—ã¦ã‚‚ã¾ã ä½™è£•ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Error: EROFS: read-only file system, open &#39;node_modules/puppeteer/.local-chromium&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;chromeã®launchæ™‚ã®option&#34;&gt;Chromeã®Launchæ™‚ã®Option&lt;/h2&gt;

&lt;p&gt;ã„ã‚ã„ã‚è©¦ã—ãŸçµæœã€æœ€ä½é™å¿…è¦ã ã£ãŸã®ã¯ã“ã®ã‚ãŸã‚Šã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;exports.launchOptionForLambda = [
    // error when launch(); No usable sandbox! Update your kernel
    &#39;--no-sandbox&#39;,
    // error when launch(); Failed to load libosmesa.so
    &#39;--disable-gpu&#39;, 
    // freeze when newPage()
    &#39;--single-process&#39;
];
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã‚¨ãƒ©ãƒ¼ã¯åˆ†ã‹ã‚Šã¥ã‚‰ã„ã‚‚ã®ãŒå¤šãã€ã¨ãã«ã¯ã‚¨ãƒ©ãƒ¼ã™ã‚‰å‡ºãšã«æ­¢ã¾ã£ã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚‹ã€‚
ãƒ‡ãƒãƒƒã‚°ã®éš›ã¯dumpioã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const browser = await puppeteer.launch({
    ...
    dumpio: !!util.DEBUG,
});  
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;babel&#34;&gt;Babel&lt;/h2&gt;

&lt;p&gt;ç¾åœ¨ã®Lambdaã®Nodeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯v6.10.3ã€‚
&lt;a href=&#34;http://node.green/&#34;&gt;node.green&lt;/a&gt;ã«ã‚ˆã‚‹ã¨ES2015ã¯99%å¯¾å¿œã—ã¦ã„ã¦ã€ES2016ã‚‚ã¹ãä¹—æ¼”ç®—å­(2 ** 3 = 8)ä»¥å¤–ã¯å¯¾å¿œã—ã¦ã„ã‚‹ãŒã€ES2017ã®async/awaitã¯7.6ã‹ã‚‰ãªã®ã§ã€8ç³»ã«å¯¾å¿œã™ã‚‹ã¾ã§ã¯babelã«ã‹ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
ã¡ãªã¿ã«Puppeteerã¯6.4ä»¥é™ã§&lt;a href=&#34;https://github.com/GoogleChrome/puppeteer/tree/master/utils/node6-transform&#34;&gt;å‹•ã&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ yarn add --dev babel-cli babel-preset-env
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/babel/babel-preset-env&#34;&gt;babel-preset-env&lt;/a&gt;
.babelrcã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cat .babelrc
{
  &amp;quot;presets&amp;quot;: [
    [&amp;quot;env&amp;quot;, {
      &amp;quot;targets&amp;quot;: {
        &amp;quot;node&amp;quot;: &amp;quot;6.10&amp;quot;
      }
    }]
  ]
}
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Headless Chromeã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</title>
          <link>https://www.sambaiz.net/article/131/</link>
          <pubDate>Sun, 03 Sep 2017 18:51:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/131/</guid>
          <description>&lt;p&gt;&lt;a href=&#34;https://chromedevtools.github.io/devtools-protocol/&#34;&gt;Chrome DevTools Protocol&lt;/a&gt;ã«
Experimentalã ã‘ã©&lt;a href=&#34;https://chromedevtools.github.io/devtools-protocol/tot/Page#method-setDownloadBehavior&#34;&gt;Page.setDownloadBehavior&lt;/a&gt;
ã¨ã„ã†ã®ãŒã‚ã£ãŸã®ã§ã€ã“ã‚Œã‚’å‘¼ã‚“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ãŸã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå›ã¯å…¬å¼ã®DevToolsã®Node APIã€&lt;a href=&#34;https://github.com/GoogleChrome/puppeteer&#34;&gt;Puppeteer&lt;/a&gt;ã‚’ä½¿ã†ã‘ã©ã€
setDownloadBehaviorã‚’é€ã‚‹APIã¯ã¾ã &lt;a href=&#34;https://github.com/GoogleChrome/puppeteer/blob/64124df62f4e81999fe1a0ab45c6fb9718a0e413/lib/Page.js#L29&#34;&gt;ãªã&lt;/a&gt;ã€ç›´æ¥clientã‚’å–ã£ã¦sendã™ã‚‹ã®ã§ä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚ã‚„ã‚‹ã“ã¨ã¯å¤‰ã‚ã‚‰ãªã„ã¨æ€ã†ã€‚
Puppeteerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®éš›ã«Chromiumã‚‚å…¥ã‚‹ã€‚setDownloadBehaviorã¯ç¾è¡ŒChromeã®60ã§ã¯&lt;a href=&#34;https://bugs.chromium.org/p/chromium/issues/detail?id=696481&#34;&gt;å¯¾å¿œã—ã¦ã„ãªã„&lt;/a&gt;ã‚ˆã†ã ã‘ã©ã€62ãŒå…¥ã£ãŸã®ã§ãªã‚“ã¨ã‹ãªã‚Šãã†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ yarn add puppeteer
$ find . -name &amp;quot;*chrome*&amp;quot;
./node_modules/puppeteer/.local-chromium/mac-497674/chrome-mac
./node_modules/puppeteer/.local-chromium/mac-497674/chrome-mac/Chromium.app/Contents/Versions/62.0.3198.0/Chromium Framework.framework/Versions/A/Resources/chrome_100_percent.pak
./node_modules/puppeteer/.local-chromium/mac-497674/chrome-mac/Chromium.app/Contents/Versions/62.0.3198.0/Chromium Framework.framework/Versions/A/Resources/chrome_200_percent.pak
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã¡ãªã¿ã«ã€ã“ã®Chromeã‚’Lambdaä¸Šã§å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨å¤±æ•—ã™ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/132/&#34;&gt;Lambdaä¸Šã§Puppeteer/Headless Chromeã‚’å‹•ã‹ã™Starter Kitã‚’ä½œã£ãŸ&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Chromeã§Chromeã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const puppeteer = require(&#39;puppeteer&#39;),
      fs        = require(&#39;fs&#39;);

const headless     = true,
      downloadPath = &#39;./Download&#39;;

(async () =&amp;gt; {
  const browser = await puppeteer.launch({headless: headless});
  
  const page = await browser.newPage();
  await page._client.send(
    &#39;Page.setDownloadBehavior&#39;,
    {behavior : &#39;allow&#39;, downloadPath: downloadPath}
  );

  await page.goto(&#39;https://www.google.co.jp/chrome/browser/desktop/index.html&#39;, {waitUntil: &#39;networkidle&#39;});
  await page.click(&#39;a.download-button&#39;);  /* Chromeã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰         */
  await page.click(&#39;button#eula-accept&#39;); /* åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« */

  await waitDownloadComplete(downloadPath)
        .catch((err) =&amp;gt; console.error(err));
 
  console.log(&#39;finished&#39;);
  browser.close();  
})();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã‹ã©ã†ã‹ã¯.crdownloadã®ã‚ã‚Šãªã—ã§åˆ¤å®šã—ã¦ã„ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const waitDownloadComplete = async (path, waitTimeSpanMs = 1000, timeoutMs = 60 * 1000) =&amp;gt; {
  return new Promise((resolve, reject) =&amp;gt; {

    const wait = (waitTimeSpanMs, totalWaitTimeMs) =&amp;gt; setTimeout(
      () =&amp;gt; isDownloadComplete(path).then(
        (completed) =&amp;gt; {
          if (completed) { 
            resolve();
          } else {

            const nextTotalTime = totalWaitTimeMs + waitTimeSpanMs;
            if (nextTotalTime &amp;gt;= timeoutMs) {
              reject(&#39;timeout&#39;);
            }

            const nextSpan = Math.min(
              waitTimeSpanMs,
              timeoutMs - nextTotalTime
            );
            wait(nextSpan, nextTotalTime);
          }           
        }
      ).catch(
        (err) =&amp;gt; { reject(err); }
      ),
      waitTimeSpanMs
    );
    
    wait(waitTimeSpanMs, 0);
  }); 
}

const isDownloadComplete = async (path) =&amp;gt; {
  return new Promise((resolve, reject) =&amp;gt; {
    fs.readdir(path, (err, files) =&amp;gt; {
      if (err) {
        reject(err);
      } else {
        if (files.length === 0) {
          resolve(false);
          return;
        }
        for(let file of files){

          // .crdownloadãŒã‚ã‚Œã°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ã®ã‚‚ã®ãŒã‚ã‚‹
          if (/.*\.crdownload$/.test(file)) { 
            resolve(false);
            return;
          }
        }
        resolve(true);
      }
    });
  });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Headlessã ã¨ä½•ã‚‚ã§ã¦ã“ãªã„ã®ã§ã†ã¾ãã„ã£ãŸã‹è‰¯ãã‚ã‹ã‚‰ãªã„ã‘ã©ã€
æŒ‡å®šã—ãŸãƒ‘ã‚¹ã‚’è¦‹ã«ã„ã£ãŸã‚‰ã¡ã‚ƒã‚“ã¨ä¿å­˜ã•ã‚Œã¦ã„ãŸã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;æ©Ÿèƒ½çš„ã«ã¯è¿‘ã„ç«‹ã¡ä½ç½®ã®&lt;a href=&#34;http://www.nightmarejs.org/&#34;&gt;NightmareJS&lt;/a&gt;ã®æ–¹ã‚‚ã€
v1ã®&lt;a href=&#34;http://phantomjs.org/&#34;&gt;PhantomJS&lt;/a&gt;ã€ç¾è¡Œv2ã®&lt;a href=&#34;https://electron.atom.io/&#34;&gt;Electron&lt;/a&gt;ã‚’çµŒã¦
v3ã§ã¯Headless Chromeã«&lt;a href=&#34;https://github.com/segmentio/nightmare/issues/1092&#34;&gt;ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„&lt;/a&gt;ã€‚
é€Ÿã„ã—ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒãªã„ã®ã§&lt;a href=&#34;https://en.wikipedia.org/wiki/Xvfb&#34;&gt;xvfb(X virtual framebuffer)&lt;/a&gt;ã‚‚&lt;a href=&#34;https://developers.google.com/web/updates/2017/04/headless-chrome&#34;&gt;å¿…è¦ãªã„&lt;/a&gt;ã—è‰¯ã•ãã†ãªã‚“ã ã‘ã©ã€
ç¾åœ¨ã®Chrome DevTools Protocolã§ã¯Nightmareã®æ—¢å­˜APIã‚’ã‚µãƒãƒ¼ãƒˆã§ããªã‹ã£ãŸã‚Šã€
Puppeteerã¨ã®ä½ã¿åˆ†ã‘ã¯ã©ã†ã™ã‚‹ã®ã£ã¦è©±ã«ãªã£ã¦ã„ã‚‹ã¿ãŸã„ã ã€‚&lt;/p&gt;

&lt;p&gt;ç¾çŠ¶Nightmareè‡ªä½“ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã¯å«ã¾ã‚Œã¦ã„ãªã„ãŒã€
Electronã®&lt;a href=&#34;https://github.com/electron/electron/blob/master/docs-translations/jp/api/download-item.md&#34;&gt;will-download&lt;/a&gt;ã‚¤ãƒ™ãƒ³ãƒˆã‚’
ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹
&lt;a href=&#34;https://github.com/rosshinkley/nightmare-download-manager&#34;&gt;nightmare-download-manager&lt;/a&gt;ã‚„
&lt;a href=&#34;https://github.com/rosshinkley/nightmare-inline-download&#34;&gt;nightmare-inline-download&lt;/a&gt;
ã¨ã„ã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚‹ã€‚&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã‚’TypeScriptã§æ›¸ã</title>
          <link>https://www.sambaiz.net/article/123/</link>
          <pubDate>Sat, 29 Jul 2017 19:34:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/123/</guid>
          <description>

&lt;p&gt;å…¬å¼ã®&lt;a href=&#34;https://github.com/Microsoft/TypeScript-Node-Starter&#34;&gt;TypeScript-Node-Starter&lt;/a&gt;ã‹ã‚‰å§‹ã‚ã¦ã‚‚ã„ã„ã‘ã©ã€ä¾å­˜ãŒå°‘ã—ä½™åˆ†ãªã®ã§ä¸€ã‹ã‚‰ä½œã‚‹ã“ã¨ã«ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;ã‚³ãƒ¼ãƒ‰ã¯&lt;a href=&#34;https://github.com/sambaiz/typescript-nodejs-sample&#34;&gt;ã“ã“&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ yarn add --dev typescript tslint tslint-microsoft-contrib jest ts-jest @types/jest
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;package-json&#34;&gt;package.json&lt;/h2&gt;

&lt;p&gt;scriptsã¨ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯&lt;a href=&#34;https://facebook.github.io/jest/&#34;&gt;Jest&lt;/a&gt;ã®è¨­å®šã‚’è¿½åŠ ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;devDependencies&amp;quot;: {
    ...
    &amp;quot;typescript&amp;quot;: &amp;quot;^2.4.2&amp;quot;
  },
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;start&amp;quot;: &amp;quot;npm run build &amp;amp;&amp;amp; node dist/app.js&amp;quot;,
    &amp;quot;build&amp;quot;: &amp;quot;npm run lint &amp;amp;&amp;amp; tsc&amp;quot;,
    &amp;quot;test&amp;quot;: &amp;quot;jest --forceExit&amp;quot;,
    &amp;quot;lint&amp;quot;: &amp;quot;tslint -c tslint.json -p tsconfig.json --type-check&amp;quot;
  },
  &amp;quot;jest&amp;quot;: {
    &amp;quot;transform&amp;quot;: {
      &amp;quot;^.+\\.ts$&amp;quot;: &amp;quot;./node_modules/ts-jest/preprocessor.js&amp;quot;
    },
    &amp;quot;testRegex&amp;quot;: &amp;quot;/test/.*\\.test\\.(ts|js)$&amp;quot;,
    &amp;quot;moduleFileExtensions&amp;quot;: [
      &amp;quot;ts&amp;quot;,
      &amp;quot;js&amp;quot;
    ],
    &amp;quot;testEnvironment&amp;quot;: &amp;quot;node&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;tsconfig-json-https-www-typescriptlang-org-docs-handbook-tsconfig-json-html&#34;&gt;&lt;a href=&#34;https://www.typescriptlang.org/docs/handbook/tsconfig-json.html&#34;&gt;tsconfig.json&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;å…¬å¼ã®ãã®ã¾ã¾ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
    &amp;quot;compilerOptions&amp;quot;: {
        &amp;quot;module&amp;quot;: &amp;quot;commonjs&amp;quot;,
        &amp;quot;target&amp;quot;: &amp;quot;es6&amp;quot;,
        &amp;quot;noImplicitAny&amp;quot;: true,
        &amp;quot;moduleResolution&amp;quot;: &amp;quot;node&amp;quot;,
        &amp;quot;sourceMap&amp;quot;: true,
        &amp;quot;outDir&amp;quot;: &amp;quot;dist&amp;quot;,
        &amp;quot;baseUrl&amp;quot;: &amp;quot;.&amp;quot;,
        &amp;quot;paths&amp;quot;: {
            &amp;quot;*&amp;quot;: [
                &amp;quot;node_modules/*&amp;quot;,
                &amp;quot;src/types/*&amp;quot;
            ]
        }
    },
    &amp;quot;include&amp;quot;: [
        &amp;quot;src/**/*&amp;quot;
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;tslint-json-https-palantir-github-io-tslint-usage-tslint-json&#34;&gt;&lt;a href=&#34;https://palantir.github.io/tslint/usage/tslint-json/&#34;&gt;tslint.json&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;MSã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã«ã™ã‚‹ã€‚
çµæ§‹å³ã—ãã¦&lt;code&gt;console.log&lt;/code&gt;ãªã‚“ã‹ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã§å¿…è¦ã«å¿œã˜ã¦ruleã‚’è¿½åŠ ã™ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
    &amp;quot;extends&amp;quot;: &amp;quot;tslint-microsoft-contrib&amp;quot;,
    &amp;quot;rules&amp;quot;: {
        &amp;quot;no-console&amp;quot;: [&amp;quot;&amp;quot;],
        &amp;quot;no-relative-imports&amp;quot;: false,
        &amp;quot;no-http-string&amp;quot;: false,
        &amp;quot;no-backbone-get-set-outside-model&amp;quot;: false
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ä½¿ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«&#34;&gt;ä½¿ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«&lt;/h2&gt;

&lt;p&gt;æœ¬ä½“ã¨å‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥å‰ã¯å‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã£ã¦ãã‚‹ã®ã«tsdã¨ã‹typingsãŒä½¿ã‚ã‚Œã¦ã„ãŸã‘ã©
ä»Šã¯&lt;a href=&#34;https://github.com/DefinitelyTyped/DefinitelyTyped&#34;&gt;DefinelyTyped&lt;/a&gt;ã®å†…å®¹ãŒ
npmã®@types/~ã«&lt;a href=&#34;https://github.com/Microsoft/types-publisher&#34;&gt;ä¸ŠãŒã‚‹&lt;/a&gt;ã‚ˆã†ã«ãªã£ãŸã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ yarn add express
$ yarn add --dev @types/express
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã&#34;&gt;ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã&lt;/h2&gt;

&lt;p&gt;VSCodeã ã£ãŸã‚‰tslintãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‹ã®ã§å…¥ã‚Œã‚‹ã€‚tsã¨tslintã‚’global installã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import * as express from &#39;express&#39;;

/**
 * GET /echo
 * Return a string same as &amp;quot;say&amp;quot; query param.
 */
export function echoApi(req: express.Request, res: express.Response): void {

    const query: { say: string } = &amp;lt;{ say: string }&amp;gt; req.query;
    if (query.say === undefined) {
        res.send(echo(query.say));
    } else {
        res.status(400).send(&#39;&amp;quot;say&amp;quot; query param is required&#39;);
    }
}

/**
 * return a string same as input
 * @param say input (= output)
 */
export function echo(say: string): string {
    return say;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ãƒ†ã‚¹ãƒˆã‚’æ›¸ã&#34;&gt;ãƒ†ã‚¹ãƒˆã‚’æ›¸ã&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/visionmedia/superagent&#34;&gt;superagent&lt;/a&gt;ã‚’ä½¿ã£ã¦
HTTPã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†&lt;a href=&#34;https://github.com/visionmedia/supertest&#34;&gt;supertest&lt;/a&gt;ã‚’ä½¿ã†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ yarn add --dev supertest @types/supertest
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;import * as supertest from &#39;supertest&#39;;
import { app } from &#39;../src/app&#39;;
import { echo } from &#39;../src/echo&#39;;

let request: supertest.SuperTest&amp;lt;supertest.Test&amp;gt;;
beforeAll(() =&amp;gt; {
  request = supertest(app);
});

/**
 * integration test
 */
describe(&#39;GET /echo&#39;, () =&amp;gt; {
  it(&#39;should return a string same as &amp;quot;say&amp;quot; query param&#39;, (): {} =&amp;gt; {
    const say: string = &#39;Aa 1ã‚&#39;;

    return request
    .get(&#39;/echo&#39;)
    .query({ say: say })
    .expect(200, say);
  });

  it(&#39;is bad request that &amp;quot;say&amp;quot; query param is not given&#39;, (): {} =&amp;gt; {
    return request
    .get(&#39;/echo&#39;)
    .expect(400);
  });
});

/**
 * unit test
 */
describe(&#39;echo&#39;, () =&amp;gt; {
  it(&#39;should return a string same as input&#39;, () =&amp;gt; {
    const say: string = &#39;Aa 1ã‚&#39;;
    expect(echo(say)).toBe(say);
  });
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;requestã—ãŸã®ã‚’returnã™ã‚‹ã®ã‚’å¿˜ã‚Œã‚‹ã¨ãƒ†ã‚¹ãƒˆãŒç„¡æ¡ä»¶ã§é€šã£ã¦ã—ã¾ã†ã®ã§æ³¨æ„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm test
...
 PASS  test/echo.test.ts
  GET /echo
    âœ“ should return a string same as &amp;quot;say&amp;quot; query param (34ms)
    âœ“ is bad request that &amp;quot;say&amp;quot; query param is not given (4ms)
  echo
    âœ“ should return a string same as input (1ms)

Test Suites: 1 passed, 1 total
Tests:       3 passed, 3 total
Snapshots:   0 total
Time:        1.601s, estimated 2s
Ran all test suites.
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã®Stream API</title>
          <link>https://www.sambaiz.net/article/96/</link>
          <pubDate>Sat, 22 Apr 2017 19:06:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/96/</guid>
          <description>

&lt;h2 id=&#34;stream-apiã¨ã¯-https-nodejs-org-docs-v7-9-0-api-stream-html&#34;&gt;&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html&#34;&gt;Stream APIã¨ã¯&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Nodeã§Streamãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ã®ã‚‚ã®ã€‚
ä¾‹ãˆã°ã‚µã‚¤ã‚ºãŒå¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¥å‡ºåŠ›ã‚’Streamã¨ã—ã¦æ‰±ã†ã“ã¨ã§ãƒãƒƒãƒ•ã‚¡ã‚’æœ€å°é™ã«ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;Streamã¯&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/events.html&#34;&gt;EventEmitter&lt;/a&gt;ã§ã€
Readable streamã‚„Writable streamã€Readableã¨Writableã‚’åˆã‚ã›ãŸDuplex streamã¨
Readã—ãŸã‚‚ã®ã‚’åŠ å·¥ã—ã¦Writeã™ã‚‹Transform streamã®ç¨®é¡ãŒã‚ã‚Šã€
ãã‚Œãã‚Œç‰¹å®šã®é–¢æ•°ãŒ&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_api_for_stream_implementers&#34;&gt;å®Ÿè£…&lt;/a&gt;ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;readable-stream-https-nodejs-org-docs-v7-9-0-api-stream-html-stream-readable-streams&#34;&gt;&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_readable_streams&#34;&gt;Readable stream&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Readable streamã«ã¯&lt;code&gt;flowing&lt;/code&gt;ã¨&lt;code&gt;paused&lt;/code&gt;ã®
&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_two_modes&#34;&gt;äºŒã¤ã®ãƒ¢ãƒ¼ãƒ‰&lt;/a&gt;ãŒã‚ã‚‹ã€‚
æœ€åˆã¯&lt;code&gt;paused&lt;/code&gt;ãƒ¢ãƒ¼ãƒ‰ã§ã€readableã«ãªã£ã¦ã‹ã‚‰read()ã™ã‚‹ã“ã¨ã§èª­ã‚€ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
let readable = fs.createReadStream(&#39;sample.txt&#39;);
var i = 0;
readable.on(&#39;readable&#39;, () =&amp;gt; {
  let chunk;
  while (null !== (chunk = readable.read(10))) {
    console.log(`${i++}: ${chunk}`);
  }
});
dable.on(&#39;end&#39;, () =&amp;gt; {
  console.log(&#39;end&#39;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ cat sample.txt
abcdefghijklmnopqrstuvwxyz
1234567890
ã‚ã„ã†ãˆãŠ

$ node main.js
0: abcdefghij
1: klmnopqrst
2: uvwxyz
123
3: 4567890
ã‚ã„
4: ã†ãˆãŠ

end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;dataã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã‹ã€å¾Œã§æ›¸ãpipeã‚’ä½¿ã†ã¨&lt;code&gt;flowing&lt;/code&gt;ãƒ¢ãƒ¼ãƒ‰ã«ãªã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
let readable = fs.createReadStream(&#39;sample.txt&#39;);
var i = 0;
readable.on(&#39;data&#39;, (chunk) =&amp;gt; {
  console.log(`${i++}: ${chunk}`);
});
readable.on(&#39;end&#39;, () =&amp;gt; {
  console.log(&#39;end&#39;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;0: abcdefghijklmnopqrstuvwxyz
1234567890
ã‚ã„ã†ãˆãŠ

end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
let readable = fs.createReadStream(&#39;error.txt&#39;);
readable.on(&#39;data&#39;, (chunk) =&amp;gt; {
  console.log(`${i++}: ${chunk}`);
});
readable.on(&#39;error&#39;, (error) =&amp;gt; {
  console.log(error);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ node main.js
{ Error: ENOENT: no such file or directory, open &#39;error.txt&#39;
    at Error (native) errno: -2, code: &#39;ENOENT&#39;, syscall: &#39;open&#39;, path: &#39;error.txt&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;å®Ÿè£…-https-nodejs-org-docs-v7-9-0-api-stream-html-stream-implementing-a-readable-stream&#34;&gt;&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_implementing_a_readable_stream&#34;&gt;å®Ÿè£…&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;å®Ÿè£…ã™ã‚‹é–¢æ•°ã¯&lt;code&gt;_read&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const Readable = require(&#39;stream&#39;).Readable;

class Random extends Readable {
  constructor(opt) {
    super(opt); 
  }
  
  _read() {
    
    // error handling
    // if(err){ 
    //   this.emit(&#39;error&#39;, err)
    //   return
    // }
    
    this.push(Math.random()+&#39;&#39;);
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;writable-stream-https-nodejs-org-docs-v7-9-0-api-stream-html-stream-class-stream-writable&#34;&gt;&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_class_stream_writable&#34;&gt;Writable stream&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;output.txtã«å‡ºåŠ›ã™ã‚‹Writable streamã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;let writable = fs.createWriteStream(&#39;output.txt&#39;)

writable.write(&#39;hoge\n&#39;);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ cat output.txt
hoge
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…¥åŠ›ã®æµé‡ãŒå¤šãã€Writable streamã®ãƒãƒƒãƒ•ã‚¡ãŒ&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_constructor_new_stream_writable_options&#34;&gt;highWaterMark&lt;/a&gt;ã‚’è¶…ãˆã¦ã—ã¾ã†ã¨ã€write()ã¯falseã‚’è¿”ã™ã€‚ãã®ã¾ã¾æ›¸ãè¾¼ã¿ç¶šã‘ã‚‹ã¨ãƒ¡ãƒ¢ãƒªã‚’é£Ÿã„ã¤ã¶ã—ã¦ã—ã¾ã†ã®ã§ã€
å…¨ã¦ã®ãƒãƒƒãƒ•ã‚¡ãŒæŒã‘ã¦&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_event_drain&#34;&gt;drain&lt;/a&gt;ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã¾ã§æ›¸ãè¾¼ã¿ã‚’æ­¢ã‚ã¦back-pressureã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
ãŸã ã—ã€pipeã‚’ä½¿ã†å ´åˆã“ã®ã‚ãŸã‚Šã¯ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ã€ã‚ã¾ã‚Šæ°—ã«ã™ã‚‹ã“ã¨ã¯ãªã„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å®Ÿè£…-https-nodejs-org-docs-v7-9-0-api-stream-html-stream-implementing-a-writable-stream&#34;&gt;&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_implementing_a_writable_stream&#34;&gt;å®Ÿè£…&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;å®Ÿè£…ã™ã‚‹é–¢æ•°ã¯&lt;code&gt;_write&lt;/code&gt;ã¨ã€ãƒãƒƒãƒ•ã‚¡ã•ã‚Œã¦ã„ã‚‹chunkã‚’ã¾ã¨ã‚ã¦æ‰±ã†ãªã‚‰&lt;code&gt;_writev&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const Writable = require(&#39;stream&#39;).Writable;

class DummyWritable extends Writable {
  constructor(opt) {
    super(opt);
  }

  _write(chunk, encoding, callback) {
    const chunkStr = chunk.toString()
    if (chunkStr == &#39;this is error&#39;) {
      callback(new Error(&#39;chunk is invalid&#39;));
    } else {
      console.log(chunkStr);
      callback();
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;pipe-https-nodejs-org-docs-v7-9-0-api-stream-html-stream-readable-pipe-destination-options&#34;&gt;&lt;a href=&#34;https://nodejs.org/docs/v7.9.0/api/stream.html#stream_readable_pipe_destination_options&#34;&gt;pipe&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Readable streamã‚’Writable streamã¨ã¤ãªã’ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
let readable = fs.createReadStream(&#39;sample.txt&#39;);
let writable = fs.createWriteStream(&#39;output.txt&#39;);
readable.pipe(writable);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ cat output.txt
abcdefghijklmnopqrstuvwxyz
1234567890
ã‚ã„ã†ãˆãŠ
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„ã™ã¹ããªã®ã¯ã€pipeã—ãŸã‚‚ã®ã‚’ã¾ã¨ã‚ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã“ã¨ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
let readable = fs.createReadStream(&#39;error.txt&#39;);
let writable = fs.createWriteStream(&#39;output.txt&#39;);
let piped = readable.pipe(writable);

piped.on(&#39;error&#39;, (error) =&amp;gt; {
  console.log(error);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;events.js:160
      throw er; // Unhandled &#39;error&#39; event
      ^

Error: ENOENT: no such file or directory, open &#39;error.txt&#39;
    at Error (native)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é¢å€’ã ã‘ã©ã€æ¯åº¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
let readable = fs.createReadStream(&#39;error.txt&#39;);
let writable = fs.createWriteStream(&#39;output.txt&#39;);
const errorHandling = (err) =&amp;gt; { console.log(err) }
let piped = readable.on(&#39;error&#39;, errorHandling).pipe(writable);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;pipeã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ã“ã‚“ãªé¢¨ã«csvã‚’fetchã—ã¦åŠ å·¥ã—ã€æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰ãˆã¦å‡ºåŠ›ã™ã‚‹ã¨ã„ã£ãŸã“ã¨ã‚‚Streamã§ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fetch = require(&#39;node-fetch&#39;);
const Iconv = require(&#39;iconv&#39;).Iconv;
const iconv = new Iconv(&#39;UTF-8&#39;, &#39;SHIFT_JIS//IGNORE&#39;);
const csv = require(&#39;csv&#39;);
const fs = require(&#39;fs&#39;);

const errorHandling = (err) =&amp;gt; { console.log(err); };

const outputFile = fs.createWriteStream(&#39;output.csv&#39;);

fetch(&#39;http://example.com/test.csv&#39;).then((res) =&amp;gt; {

  res.body
  .pipe(csv.parse({columns : true}))
  .on(&#39;error&#39;, errorHandling)
  .pipe(csv.transform(function(record){
    if(record[&#39;hoge&#39;] &amp;lt; 100000){
      return null;
    }
    return record;
  }))
  .on(&#39;error&#39;, errorHandling)
  .pipe(csv.stringify({header: true}))
  .on(&#39;error&#39;, errorHandling)
  .pipe(iconv)
  .on(&#39;error&#39;, errorHandling)
  .pipe(outputFile)
  .on(&#39;error&#39;, errorHandling);

}).then(() =&amp;gt; console.log(&amp;quot;done&amp;quot;)).catch((err) =&amp;gt; console.log(err));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;pipeã§ã¯ãªã„ã‘ã©ã€readlineã®createInterfaceã«å…¥åŠ›ã¨å‡ºåŠ›ã®Streamã‚’æ¸¡ã™ã¨ã€
è¡Œã”ã¨ã«å‡¦ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
const readline = require(&#39;readline&#39;);

let readable = fs.createReadStream(&#39;sample.txt&#39;);
const rl = readline.createInterface({
  input: readable,
  output: process.stdout
});
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;abcdefghijklmnopqrstuvwxyz
1234567890
ã‚ã„ã†ãˆãŠ
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;rxjsã§æ‰±ã†&#34;&gt;RxJSã§æ‰±ã†&lt;/h2&gt;

&lt;p&gt;Streamã¯EventEmitterãªã®ã§RxJSã®fromEvent()ã§Observableã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚ã§ãã‚‹ã€‚ãŸã ã—&lt;a href=&#34;https://github.com/ReactiveX/rxjs&#34;&gt;v5&lt;/a&gt;ã«ã¯pipeãŒãªã„(v4ã«ã¯&lt;a href=&#34;https://github.com/Reactive-Extensions/RxJS/blob/8fa95ac884181fb6cbff8ce7c1d669ffb190f5e4/src/core/linq/observable/pipe.js#L6&#34;&gt;ã‚ã‚‹&lt;/a&gt;)ã®ã§ã€pipeã™ã‚‹å ´åˆã¯è‡ªåˆ†ã§Subscribeã—ã¦writeã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.sambaiz.net/article/85/&#34;&gt;RxJSã§Rxã‚’ã¯ã˜ã‚ã‚‹ - sambaiz.net&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const fs = require(&#39;fs&#39;);
const Rx = require(&#39;rxjs/Rx&#39;);
const writable = fs.createWriteStream(&#39;output.txt&#39;)

Rx.Observable.fromEvent(process.stdin, &#39;data&#39;)
.map((v) =&amp;gt; `- ${v}`)
.subscribe((v) =&amp;gt; write(v));

function write(v){
  // TODO: back-pressure
  writable.write(v);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ node main.js 
aiueo
kakikukeko
^C

$ cat output.txt 
- aiueo
- kakikukeko
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Nightmareã§ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹</title>
          <link>https://www.sambaiz.net/article/90/</link>
          <pubDate>Wed, 29 Mar 2017 23:18:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/90/</guid>
          <description>&lt;p&gt;æœ€è¿‘ã€&lt;a href=&#34;http://postwash.net/&#34;&gt;POSTWASH&lt;/a&gt;ã¨ã„ã†æ´—æ¿¯ä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚
å°‚ç”¨ã®ã‚«ãƒãƒ³ã«è©°ã‚ã¦é›†è·ã«ããŸäººã«æ¸¡ã™ã¨ã€ãã‚Œã„ã«ç•³ã¾ã‚ŒãŸæ´—æ¿¯ã‚‚ã®ãŒå±Šãä¾¿åˆ©ãªã‚µãƒ¼ãƒ“ã‚¹ã ã€‚
æ³¨æ–‡æ™‚ã«ã¯Webã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é›†è·ã€é…é”æ™‚é–“ã‚„æ”¯æ‰•ã„æ–¹æ³•ãªã©ã‚’é¸ã¶å¿…è¦ãŒã‚ã‚‹ã‚“ã ã‘ã©ã€æ¯é€±ã®ã“ã¨ãªã®ã§ã“ã‚Œã‚’è‡ªå‹•åŒ–ã—ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;ãƒ–ãƒ©ã‚¦ã‚¶ã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹ã®ã«&lt;a href=&#34;https://github.com/segmentio/nightmare&#34;&gt;Nightmare&lt;/a&gt;ã‚’ä½¿ã†ã€‚
&lt;a href=&#34;https://electron.atom.io/&#34;&gt;Electron&lt;/a&gt;ã‚’ä½¿ã£ã¦ã„ã¦ã€&lt;a href=&#34;http://phantomjs.org/&#34;&gt;PahntomJS&lt;/a&gt;ã‚ˆã‚Š2å€ãã‚‰ã„é€Ÿãã€ç°¡æ½”ã«æ›¸ã‘ã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm install nightmare
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;Nightmare()&lt;/code&gt;ã®å¼•æ•°ã«&lt;code&gt;show: true&lt;/code&gt;ã‚’æ¸¡ã™ã¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã„ã¦å®Ÿè¡Œã—å§‹ã‚ã‚‹ã€‚
ã“ã‚Œã§ç¢ºèªç”»é¢ã¾ã§ã„ãã®ã§ã‚ã¨ã¯æ³¨æ–‡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã€‚
ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‰ã˜ãªã„ã‚ˆã†ã«æœ€å¾Œã«&lt;code&gt;nightmare.end()&lt;/code&gt;ã‚’å‘¼ã‚“ã§ã„ãªã„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const co = require(&#39;co&#39;);
const moment = require(&#39;moment&#39;)
const jst = +9
const Nightmare = require(&#39;nightmare&#39;);		
const nightmare = Nightmare({ 
  show: true,
  waitTimeout: 3000,
  gotoTimeout: 3000
});
const loginID = process.env.LOGIN_ID;
const loginPassword = process.env.LOGIN_PASSWORD;

moment.locale(&#39;ja&#39;);
const now = moment().utcOffset(jst)
const dayAfterTomorrow = now.add(2, &#39;days&#39;).format(&amp;quot;YYYYå¹´MæœˆDæ—¥(ddd)&amp;quot;);
const nextWeek = now.add(7, &#39;days&#39;).format(&amp;quot;YYYYå¹´MæœˆDæ—¥(ddd)&amp;quot;)
console.log(`${dayAfterTomorrow}~${nextWeek}`);

// IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã¦ãƒ­ã‚°ã‚¤ãƒ³
const login = () =&amp;gt; nightmare
  .goto(&#39;https://sv359.xserver.jp/~postwash/postwash.net/accounts/&#39;)
  .type(&#39;#loginid&#39;, loginID)
  .insert(&#39;#loginpw&#39;, loginPassword) // .insert() is faster than .type() but does not trigger the keyboard events.
  .click(&#39;#submit&#39;)
  .wait(&#39;#yokoso&#39;)
  .evaluate(() =&amp;gt; document.querySelector(&#39;#yokoso h5&#39;).textContent);

// æ³¨æ–‡ãƒ•ã‚©ãƒ¼ãƒ ã‚’åŸ‹ã‚ã¦ã„ã
const order = () =&amp;gt; nightmare
  .goto(&#39;https://sv359.xserver.jp/~postwash/postwash.net/mypage/order.html&#39;)
  .wait(&#39;#item\\[4\\]&#39;)
  .check(&#39;#item\\[4\\]&#39;)
  .insert(&#39;#itemnum\\[4\\]&#39;, &#39;1&#39;)
  .select(&#39;#pickup_date_request&#39;, dayAfterTomorrow)
  .select(&#39;#pickup_time_request&#39;, &#39;åˆå‰ä¸­ï¼ˆ8æ™‚ï½12æ™‚ï¼‰&#39;)
  .wait(500) // #delivery_date_request ãŒåˆ‡ã‚Šæ›¿ã‚ã£ã¦ã—ã¾ã†ã®ã§å°‘ã—å¾…ã¤
  .select(&#39;#delivery_date_request&#39;, nextWeek)
  .select(&#39;#delivery_time_request&#39;, &#39;åˆå‰ä¸­ï¼ˆ8æ™‚ï½12æ™‚ï¼‰&#39;)
  .select(&#39;#payment&#39;, &#39;ä»£é‡‘å¼•æ›&#39;)
  .check(&#39;#agreement&#39;)
  .click(&#39;#submit&#39;)

co(function *(){
    yield login().then(
        (result) =&amp;gt; console.log(result), // ã‚ˆã†ã“ã
        (err) =&amp;gt; console.log(err)
    );
    yield order();
    // yield nightmare.end();
});
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã§ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›</title>
          <link>https://www.sambaiz.net/article/89/</link>
          <pubDate>Tue, 28 Mar 2017 21:36:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/89/</guid>
          <description>

&lt;p&gt;&lt;a href=&#34;https://github.com/bnoordhuis/node-iconv&#34;&gt;node-iconv&lt;/a&gt;ã‚’ä½¿ã†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm install iconv
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SHIFT_JISã‹ã‚‰UTF-8ã¸ã®å¤‰æ›ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const Iconv  = require(&#39;iconv&#39;).Iconv;

const before = new Buffer([
    0x8b, 0x8d, 
    0x8e, 0x4d, 
    0x26,
    0x82, 0xb2,
    0x94, 0xd1
]);

const iconv = new Iconv(&#39;SHIFT_JIS&#39;, &#39;UTF-8&#39;);
console.log(`before: ${before.toString(&#39;hex&#39;)} ${before.toString()}`)
const after = iconv.convert(before);
console.log(`after:  ${after.toString(&#39;hex&#39;)} ${after.toString()}`);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;before: 8b8d8e4d2682b294d1 ï¿½ï¿½ï¿½M&amp;amp;ï¿½ï¿½ï¿½ï¿½
after:  e7899be79abf26e38194e9a3af ç‰›çš¿&amp;amp;ã”é£¯
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã¯å¤‰æ›å¾Œã«è¡¨ã›ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚
ä¾‹ãˆã°ã€UTF-8ã‹ã‚‰SHIFT_JISã¸ã®å¤‰æ›ã§ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ğŸšã‚’æ¸¡ã™ã¨å¤‰æ›ã§ããšã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;throw errnoException(&#39;EILSEQ&#39;, &#39;Illegal character sequence.&#39;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;//IGNORE&lt;/code&gt;ã‚’&lt;a href=&#34;https://www.npmjs.com/package/iconv#dealing-with-untranslatable-characters&#34;&gt;ä»˜ã‘ã‚‹&lt;/a&gt;ã“ã¨ã§
ãã®ã‚ˆã†ãªæ–‡å­—ãŒã‚ã£ãŸå ´åˆã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ã‚ˆã†ã«ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const Iconv  = require(&#39;iconv&#39;).Iconv;

const before = &amp;quot;ç‰›çš¿&amp;amp;ğŸš&amp;quot;;

const iconv = new Iconv(&#39;UTF-8&#39;, &#39;SHIFT_JIS//IGNORE&#39;);
console.log(`before: ${new Buffer(before).toString(&#39;hex&#39;)} ${before.toString()}`)
const conv = iconv.convert(before);
const iconv2 = new Iconv(&#39;SHIFT_JIS&#39;, &#39;UTF-8&#39;);
const after = iconv2.convert(conv);
console.log(`after:  ${after.toString(&#39;hex&#39;)} ${after.toString()}`);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¤‰æ›ã§ããªã„ã‚‚ã®ã¯ç„¡è¦–ã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;before: e7899be79abf26f09f8d9a ç‰›çš¿&amp;amp;ğŸš
after:  e7899be79abf26 ç‰›çš¿&amp;amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;lambdaã§ã¯&#34;&gt;Lambdaã§ã¯&lt;/h2&gt;

&lt;p&gt;Lambdaã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹iconvã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;return new Promise((resolve, reject) =&amp;gt; {
    let filePath = &amp;quot;/tmp/shiftjis&amp;quot;;
    fs.writeFileSync(filePath, shiftjis);
    var exec = require(&#39;child_process&#39;).exec;
    var cmd = `iconv -c -f sjis -t utf-8 ${filePath}`;
    var child = exec(cmd, (err, stdout, stderr) =&amp;gt; {
      if (err) reject(err);
      else resolve(stdout);
    });
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.bokukoko.info/entry/2015/08/30/AWS_Lambda%E5%86%85%E3%81%A7%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95&#34;&gt;AWS Lambdaå†…ã§æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›ã™ã‚‹æ–¹æ³• - ãƒœã‚¯ã‚³ã‚³&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã§Dateã‚’ä»»æ„ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ–‡å­—åˆ—ã«ã™ã‚‹</title>
          <link>https://www.sambaiz.net/article/79/</link>
          <pubDate>Mon, 06 Mar 2017 20:18:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/79/</guid>
          <description>&lt;p&gt;&lt;a href=&#34;http://momentjs.com/&#34;&gt;Moment.js&lt;/a&gt;ã‚’ä½¿ã†ã€‚
ç›¸å¯¾æ™‚é–“(&lt;code&gt;5 years ago&lt;/code&gt;)ã‚’å‡ºã—ãŸã‚Šã€æ—¥ä»˜ã®è¨ˆç®—(&lt;code&gt;add(3, &#39;days&#39;)&lt;/code&gt;)ã‚‚ã§ãã‚‹ä¾¿åˆ©ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ä½¿ãˆã‚‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm install moment
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;const moment = require(&#39;moment&#39;)
const jst = +9
let now = moment().utcOffset(jst).format(&amp;quot;YYYY-MM-DD HH:mm:ss.SSSZ&amp;quot;);
console.log(now);
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†</title>
          <link>https://www.sambaiz.net/article/8/</link>
          <pubDate>Fri, 15 Jul 2016 19:20:00 &#43;0900</pubDate>
          <author></author>
          <guid>https://www.sambaiz.net/article/8/</guid>
          <description>

&lt;h2 id=&#34;nvm-https-github-com-creationix-nvm&#34;&gt;&lt;a href=&#34;https://github.com/creationix/nvm&#34;&gt;nvm&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;å¤§ä½“ã“ã‚Œã‚’ä½¿ã£ã¦ãŠã‘ã°ã‚ˆã•ãã†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.1/install.sh | bash
$ nvm install node
$ node -v
v7.7.2

$ nvm install 6
$ node -v
v6.10.0

$ nvm ls
        v6.10.0
-&amp;gt;       v7.7.2
default -&amp;gt; node (-&amp;gt; v7.7.2)
node -&amp;gt; stable (-&amp;gt; v7.7.2) (default)
stable -&amp;gt; 7.7 (-&amp;gt; v7.7.2) (default)
iojs -&amp;gt; N/A (default)
lts/* -&amp;gt; lts/boron (-&amp;gt; v6.10.0)
lts/argon -&amp;gt; v4.8.0 (-&amp;gt; N/A)
lts/boron -&amp;gt; v6.10.0

$ nvm use node
Now using node v7.7.2 (npm v4.1.2)

$ nvm use 6
Now using node v6.10.0 (npm v3.10.10)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;n-https-github-com-tj-n&#34;&gt;&lt;a href=&#34;https://github.com/tj/n&#34;&gt;n&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;ã™ã§ã«nodeãŒå…¥ã£ã¦ã„ã‚‹ãªã‚‰ã“ã£ã¡ã‚’ä½¿ã†ã“ã¨ã‚‚ã§ãã‚‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;n latest&lt;/code&gt;, &lt;code&gt;n stable&lt;/code&gt;, &lt;code&gt;n lts&lt;/code&gt;ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã€‚
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹å ´åˆã€&lt;code&gt;n &amp;lt;version&amp;gt;&lt;/code&gt;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€&lt;code&gt;n&lt;/code&gt;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸€è¦§ã‹ã‚‰é¸æŠã§ãã‚‹ã€‚
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å‰Šé™¤ã¯&lt;code&gt;n - &amp;lt;version&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ npm install -g n
$ n stable
$ node -v
v6.2.2
&lt;/code&gt;&lt;/pre&gt;
</description>
        </item>
      
    

  </channel>
</rss>
