<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 32px;
        height: 32px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-end: 0.4rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>モンテカルロ木探索 (MCTS) でどうぶつしょうぎのゲームAIを作る - sambaiz-net</title>
  <meta name="twitter:title" content="モンテカルロ木探索 (MCTS) でどうぶつしょうぎのゲームAIを作る - sambaiz-net">
  <meta property='og:title' content="モンテカルロ木探索 (MCTS) でどうぶつしょうぎのゲームAIを作る - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="モンテカルロ木探索 (Monte Carlo Tree Search; MCTS) は AlphaGo などのゲームAIで最適な行動を探索するのに用いられているアルゴリズム">
  <meta name="twitter:description" content="モンテカルロ木探索 (Monte Carlo Tree Search; MCTS) は AlphaGo などのゲームAIで最適な行動を探索するのに用いられているアルゴリズム">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/article/515/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  
  
  <link rel="alternate" hreflang="ja" href="https://www.sambaiz.net/article/515/" />
  
  <link rel="alternate" hreflang="x-default" href="https://www.sambaiz.net/article/515/" />
  
  
  <link rel="alternate" hreflang="en" href="https://www.sambaiz.net/en/article/515/" />
  
  
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
  <style>
    .katex-display { margin: 1.5rem 0; }
  </style>
  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "モンテカルロ木探索 (MCTS) でどうぶつしょうぎのゲームAIを作る",
    "datePublished": "2024-12-12T01:30:00JST",
    "dateModified": "2024-12-12T01:30:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "モンテカルロ木探索 (Monte Carlo Tree Search; MCTS) は AlphaGo などのゲームAIで最適な行動を探索するのに用いられているアルゴリズム"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
      <ul>
          
          <li>
              <a href="https://www.sambaiz.net/en/article/515/">English</a>
          </li>
          
      </ul>
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.google.com/maps/contrib/102687103399829824749/photos">
            <img src="/image/googlemaps.svg" width="30px" height="30px" alt="google maps">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://boardgamearena.com/player?id=83835726">
            <img src="/image/boardgamearena.webp" width="30px" height="30px" alt="board game arena">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/etl/">
            etl</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag" href="/tags/spark/">
            spark</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>モンテカルロ木探索 (MCTS) でどうぶつしょうぎのゲームAIを作る</h1>
        <time>2024-12-12</time>
        <a class="tag" href='/tags/algorithm/'>algorithm</a><a class="tag" href='/tags/machinelearning/'>machinelearning</a><a class="tag" href='/tags/golang/'>golang</a>
      </div>
      <p>モンテカルロ木探索 (Monte Carlo Tree Search; MCTS) は AlphaGo などのゲームAIで最適な行動を探索するのに用いられているアルゴリズム。同種のアルゴリズムとしては、相手が(自分にとって)最悪の手を常に打つと仮定したときの最良の手を網羅的に探索する Mini-Max 法や、それを枝刈りすることで効率化した αβ 法がある。これらの手法が途中盤面の評価値を与えてやる必要があるのに対して、モンテカルロ木探索はランダムにゲームを進めた結果の勝ち負けをもって評価することができる。</p>
<h2 id="ゲームの実装">ゲームの実装</h2>
<p>まずシミュレーションのためのゲームを実装した。全体のコードは <a href="https://github.com/sambaiz/doubutsu_shogi_mcts/blob/main/doubutsushogi/doubutsushogi.go">GitHub</a> にある。
どうぶつしょうぎは自分の駒を動かすほか、通常の将棋と同じく取った駒を置くこともでき、最終的に相手のライオンを取るか、自分のライオンを相手陣の最奥まで動かすと勝ちとなる。ひよこのみ最奥まで動かすとにわとりに成ることができる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (b <span style="color:#ff79c6">*</span>Board) <span style="color:#50fa7b">IsGameOver</span>() (<span style="color:#8be9fd">bool</span>, player) {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> p1Lion, p2Lion <span style="color:#8be9fd">bool</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> row <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; row &lt; <span style="color:#bd93f9">4</span>; row<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> col <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; col &lt; <span style="color:#bd93f9">3</span>; col<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>			square <span style="color:#ff79c6">:=</span> b.squares[row][col]
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> square.piece <span style="color:#ff79c6">==</span> lion {
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> square.player <span style="color:#ff79c6">==</span> Player1 {
</span></span><span style="display:flex;"><span>					p1Lion = <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>					<span style="color:#6272a4">// 自分のライオンを相手陣の1段目に移動させる「トライ」
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>					<span style="color:#ff79c6">if</span> row <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>						<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>, Player1
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>				} <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> square.player <span style="color:#ff79c6">==</span> Player2 {
</span></span><span style="display:flex;"><span>					p2Lion = <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">if</span> row <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">3</span> {
</span></span><span style="display:flex;"><span>						<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>, Player2
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 相手のライオンを取る「キャッチ」
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">if</span> !p1Lion {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>, Player2
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> !p2Lion {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>, Player1
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>, none
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (b <span style="color:#ff79c6">*</span>Board) <span style="color:#50fa7b">GetAllValidMoves</span>() []Move {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> allMoves []Move
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 持ち駒を出す場合
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">for</span> _, piece <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> b.captured[b.turnPlayer] {
</span></span><span style="display:flex;"><span>		drops <span style="color:#ff79c6">:=</span> b.<span style="color:#50fa7b">getValidDrops</span>(piece)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> _, drop <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> drops {
</span></span><span style="display:flex;"><span>			nextBoard <span style="color:#ff79c6">:=</span> b.<span style="color:#50fa7b">ApplyMove</span>(drop)
</span></span><span style="display:flex;"><span>			<span style="color:#6272a4">// 千日手（手番が全く同じ状態が3回現れる）は除く
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>			<span style="color:#ff79c6">if</span> nextBoard.occurrences[nextBoard.<span style="color:#50fa7b">String</span>()] &lt; <span style="color:#bd93f9">4</span> {
</span></span><span style="display:flex;"><span>				allMoves = <span style="color:#8be9fd;font-style:italic">append</span>(allMoves, drop)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 盤面の駒を移動する場合
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">for</span> row <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; row &lt; <span style="color:#bd93f9">4</span>; row<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> col <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; col &lt; <span style="color:#bd93f9">3</span>; col<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>			square <span style="color:#ff79c6">:=</span> b.squares[row][col]
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> square.player <span style="color:#ff79c6">==</span> b.turnPlayer {
</span></span><span style="display:flex;"><span>				moves <span style="color:#ff79c6">:=</span> b.<span style="color:#50fa7b">getValidMoves</span>(row, col)
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">for</span> _, move <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> moves {
</span></span><span style="display:flex;"><span>					nextBoard <span style="color:#ff79c6">:=</span> b.<span style="color:#50fa7b">ApplyMove</span>(move)
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">if</span> nextBoard.occurrences[nextBoard.<span style="color:#50fa7b">String</span>()] &lt; <span style="color:#bd93f9">4</span> {
</span></span><span style="display:flex;"><span>						allMoves = <span style="color:#8be9fd;font-style:italic">append</span>(allMoves, move)
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> allMoves
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (b <span style="color:#ff79c6">*</span>Board) <span style="color:#50fa7b">getValidDrops</span>(piece piece) []Move {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> drops []Move
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> row <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; row &lt; <span style="color:#bd93f9">4</span>; row<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> col <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; col &lt; <span style="color:#bd93f9">3</span>; col<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> b.squares[row][col].piece <span style="color:#ff79c6">==</span> empty {
</span></span><span style="display:flex;"><span>				drops = <span style="color:#8be9fd;font-style:italic">append</span>(drops, Move{<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, row, col, piece})
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> drops
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (b <span style="color:#ff79c6">*</span>Board) <span style="color:#50fa7b">getValidMoves</span>(row, col <span style="color:#8be9fd">int</span>) []Move {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> moves []Move
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> row &lt; <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">||</span> row <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">||</span> col &lt; <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">||</span> col <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">3</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> moves
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	square <span style="color:#ff79c6">:=</span> b.squares[row][col]
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> square.piece <span style="color:#ff79c6">==</span> empty {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> moves
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	addIfValid <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">func</span>(toRow, toCol <span style="color:#8be9fd">int</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> toRow <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> toRow &lt; <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">&amp;&amp;</span> toCol <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> toCol &lt; <span style="color:#bd93f9">3</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> b.squares[toRow][toCol].player <span style="color:#ff79c6">!=</span> square.player {
</span></span><span style="display:flex;"><span>				moves = <span style="color:#8be9fd;font-style:italic">append</span>(moves, Move{row, col, toRow, toCol, empty})
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">switch</span> square.piece {
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 隣接する8マスのいずれかに進むことができる。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">case</span> lion:
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> drow <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>; drow <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">1</span>; drow<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">for</span> dcol <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>; dcol <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">1</span>; dcol<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> drow <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> dcol <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">continue</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				<span style="color:#50fa7b">addIfValid</span>(row<span style="color:#ff79c6">+</span>drow, col<span style="color:#ff79c6">+</span>dcol)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 斜めの4マスのいずれかに進むことができる
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">case</span> elephant:
</span></span><span style="display:flex;"><span>		directions <span style="color:#ff79c6">:=</span> [][<span style="color:#bd93f9">2</span>]<span style="color:#8be9fd">int</span>{{<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>}, {<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1</span>}, {<span style="color:#bd93f9">1</span>, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>}, {<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1</span>}}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> _, d <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> directions {
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">addIfValid</span>(row<span style="color:#ff79c6">+</span>d[<span style="color:#bd93f9">0</span>], col<span style="color:#ff79c6">+</span>d[<span style="color:#bd93f9">1</span>])
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 縦・横の4マスのいずれかに進むことができる
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">case</span> giraffe:
</span></span><span style="display:flex;"><span>		directions <span style="color:#ff79c6">:=</span> [][<span style="color:#bd93f9">2</span>]<span style="color:#8be9fd">int</span>{{<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>}, {<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>}, {<span style="color:#bd93f9">0</span>, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>}, {<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">1</span>}}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> _, d <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> directions {
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">addIfValid</span>(row<span style="color:#ff79c6">+</span>d[<span style="color:#bd93f9">0</span>], col<span style="color:#ff79c6">+</span>d[<span style="color:#bd93f9">1</span>])
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 前の1マスにのみ進むことができる。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">case</span> chick:
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> square.player <span style="color:#ff79c6">==</span> Player1 {
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">addIfValid</span>(row<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, col)
</span></span><span style="display:flex;"><span>		} <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">addIfValid</span>(row<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>, col)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 斜め後ろ以外の6マスのいずれかに進むことができる。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">case</span> chicken:
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> drow <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>; drow <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">1</span>; drow<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">for</span> dcol <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>; dcol <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">1</span>; dcol<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> drow <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> dcol <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">continue</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> (square.player <span style="color:#ff79c6">==</span> Player1 <span style="color:#ff79c6">&amp;&amp;</span> drow <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">||</span>
</span></span><span style="display:flex;"><span>					(square.player <span style="color:#ff79c6">==</span> Player2 <span style="color:#ff79c6">&amp;&amp;</span> drow <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) {
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">continue</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				<span style="color:#50fa7b">addIfValid</span>(row<span style="color:#ff79c6">+</span>drow, col<span style="color:#ff79c6">+</span>dcol)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> moves
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (b <span style="color:#ff79c6">*</span>Board) <span style="color:#50fa7b">Play</span>(chooseMove <span style="color:#8be9fd;font-style:italic">func</span>(Board) Move) <span style="color:#ff79c6">*</span>Board {
</span></span><span style="display:flex;"><span>	currentBoard <span style="color:#ff79c6">:=</span> b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> gameover, _ <span style="color:#ff79c6">:=</span> currentBoard.<span style="color:#50fa7b">IsGameOver</span>(); gameover {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> currentBoard
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		currentBoard = currentBoard.<span style="color:#50fa7b">ApplyMove</span>(<span style="color:#50fa7b">chooseMove</span>(<span style="color:#ff79c6">*</span>currentBoard))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>お互いランダムに動かす場合、勝敗はほぼ50%となった。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>$ cat main.<span style="color:#ff79c6">go</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ds <span style="color:#f1fa8c">&#34;github.com/sambaiz/doubutsu_shogi/doubutsushogi&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>	board <span style="color:#ff79c6">:=</span> ds.<span style="color:#50fa7b">NewBoard</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	randomMove <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">func</span>(b ds.Board) ds.Move {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#50fa7b">Println</span>(b)
</span></span><span style="display:flex;"><span>		moves <span style="color:#ff79c6">:=</span> b.<span style="color:#50fa7b">GetAllValidMoves</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> moves[rand.<span style="color:#50fa7b">Intn</span>(<span style="color:#8be9fd;font-style:italic">len</span>(moves))]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	endBoard <span style="color:#ff79c6">:=</span> board.<span style="color:#50fa7b">Play</span>(randomMove)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#50fa7b">Println</span>(endBoard)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	_, winPlayer <span style="color:#ff79c6">:=</span> endBoard.<span style="color:#50fa7b">IsGameOver</span>()
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;Player%d win!\n&#34;</span>, winPlayer)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ff79c6">go</span> run main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span>G <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#bd93f9">1</span>L <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: 
</span></span><span style="display:flex;"><span>Player2 has: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player1&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span>G <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>C <span style="color:#bd93f9">1</span>L 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: 
</span></span><span style="display:flex;"><span>Player2 has: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player2&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span>G <span style="color:#bd93f9">2</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>C <span style="color:#bd93f9">1</span>L 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: 
</span></span><span style="display:flex;"><span>Player2 has: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player1&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span>G <span style="color:#bd93f9">2</span>C <span style="color:#bd93f9">1</span>L 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: 
</span></span><span style="display:flex;"><span>Player2 has: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player2&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>C <span style="color:#bd93f9">1</span>L 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span>G <span style="color:#bd93f9">1</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: 
</span></span><span style="display:flex;"><span>Player2 has: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player1&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>L <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span>G <span style="color:#bd93f9">1</span>C <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: C 
</span></span><span style="display:flex;"><span>Player2 has: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player2&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>L <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>G <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: C 
</span></span><span style="display:flex;"><span>Player2 has: C 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player1&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>L <span style="color:#bd93f9">2</span>E 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#ff79c6">--</span> <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">--</span> <span style="color:#bd93f9">2</span>G <span style="color:#ff79c6">--</span> 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>E <span style="color:#ff79c6">--</span> <span style="color:#bd93f9">1</span>G 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 has: L C 
</span></span><span style="display:flex;"><span>Player2 has: C 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span> Player2&#39;s turn <span style="color:#ff79c6">-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Player1 win!
</span></span></code></pre></div><h2 id="モンテカルロ木探索の実装">モンテカルロ木探索の実装</h2>
<p>モンテカルロ木探索は最も評価値の高い葉を選び、そこからランダムにゲームを進め、その結果によって評価値を更新し一定回数探索した葉から木を拡張する、というのを繰り返す。評価関数としてはバンディットアルゴリズムの UCB1 ベースの UCT (Upper Confidence Bound for Trees) が用いられる。Q_i がそのノードの合計報酬、n_i がそのノードの探索回数、N_i が親ノードの探索回数。C は調整用のパラメータで、\sqrt{2} とすることが多い。</p>
<p>$$ UCT = \frac{Q_i}{n_i} + C\sqrt{\frac{\ln{N}}{n_i}} $$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> mcts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;math&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ds <span style="color:#f1fa8c">&#34;github.com/sambaiz/doubutsu_shogi/doubutsushogi&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> Node <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	board      <span style="color:#ff79c6">*</span>ds.Board
</span></span><span style="display:flex;"><span>	move       <span style="color:#ff79c6">*</span>ds.Move
</span></span><span style="display:flex;"><span>	totalScore <span style="color:#8be9fd">float64</span>
</span></span><span style="display:flex;"><span>	visitCount <span style="color:#8be9fd">int64</span>
</span></span><span style="display:flex;"><span>	parent     <span style="color:#ff79c6">*</span>Node
</span></span><span style="display:flex;"><span>	children   []<span style="color:#ff79c6">*</span>Node
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">NewNode</span>(board <span style="color:#ff79c6">*</span>ds.Board, move <span style="color:#ff79c6">*</span>ds.Move, parent <span style="color:#ff79c6">*</span>Node) <span style="color:#ff79c6">*</span>Node {
</span></span><span style="display:flex;"><span>	root <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>Node{
</span></span><span style="display:flex;"><span>		board:  board,
</span></span><span style="display:flex;"><span>		move:   move,
</span></span><span style="display:flex;"><span>		parent: parent,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	childMoves <span style="color:#ff79c6">:=</span> board.<span style="color:#50fa7b">GetAllValidMoves</span>()
</span></span><span style="display:flex;"><span>	root.children = <span style="color:#8be9fd;font-style:italic">make</span>([]<span style="color:#ff79c6">*</span>Node, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(childMoves))
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> _, childMove <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> childMoves {
</span></span><span style="display:flex;"><span>		root.children = <span style="color:#8be9fd;font-style:italic">append</span>(root.children, <span style="color:#ff79c6">&amp;</span>Node{
</span></span><span style="display:flex;"><span>			board:  board.<span style="color:#50fa7b">ApplyMove</span>(childMove),
</span></span><span style="display:flex;"><span>			move:   <span style="color:#ff79c6">&amp;</span>childMove,
</span></span><span style="display:flex;"><span>			parent: root,
</span></span><span style="display:flex;"><span>		})
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> root
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">String</span>() <span style="color:#8be9fd">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> sb strings.Builder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> n.board <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		sb.<span style="color:#50fa7b">WriteString</span>(fmt.<span style="color:#50fa7b">Sprintf</span>(<span style="color:#f1fa8c">&#34;Board:\n%s\n&#34;</span>, n.board.<span style="color:#50fa7b">String</span>()))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> n.move <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		sb.<span style="color:#50fa7b">WriteString</span>(fmt.<span style="color:#50fa7b">Sprintf</span>(<span style="color:#f1fa8c">&#34;Move:\n%s\n&#34;</span>, n.move.<span style="color:#50fa7b">String</span>()))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> sb.<span style="color:#50fa7b">String</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">PrettyString</span>(prefix <span style="color:#8be9fd">string</span>) <span style="color:#8be9fd">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> sb strings.Builder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> n.move <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		sb.<span style="color:#50fa7b">WriteString</span>(fmt.<span style="color:#50fa7b">Sprintf</span>(<span style="color:#f1fa8c">&#34;%s├──%s [%f/%d/%d]\n&#34;</span>, prefix, n.move.<span style="color:#50fa7b">String</span>(), n.<span style="color:#50fa7b">calculateScore</span>(), <span style="color:#8be9fd;font-style:italic">int</span>(n.totalScore), n.visitCount))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> _, child <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> n.children {
</span></span><span style="display:flex;"><span>		newPrefix <span style="color:#ff79c6">:=</span> prefix
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> n.move <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			newPrefix <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;│   &#34;</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		sb.<span style="color:#50fa7b">WriteString</span>(child.<span style="color:#50fa7b">PrettyString</span>(newPrefix))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> sb.<span style="color:#50fa7b">String</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">SelectBestChild</span>() <span style="color:#ff79c6">*</span>Node {
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(n.children) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	maxScore <span style="color:#ff79c6">:=</span> math.<span style="color:#50fa7b">Inf</span>(<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">var</span> bestChild <span style="color:#ff79c6">*</span>Node
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> _, child <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> n.children {
</span></span><span style="display:flex;"><span>		score <span style="color:#ff79c6">:=</span> child.<span style="color:#50fa7b">calculateScore</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> score &gt; maxScore {
</span></span><span style="display:flex;"><span>			maxScore = score
</span></span><span style="display:flex;"><span>			bestChild = child
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> bestChild
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">SelectRandomChild</span>() <span style="color:#ff79c6">*</span>Node {
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(n.children) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> n.children[rand.<span style="color:#50fa7b">Intn</span>(<span style="color:#8be9fd;font-style:italic">len</span>(n.children))]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">calculateScore</span>() <span style="color:#8be9fd">float64</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> n.visitCount <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> math.<span style="color:#50fa7b">Inf</span>(<span style="color:#bd93f9">1</span>) <span style="color:#6272a4">// デフォルト値
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	exploitation <span style="color:#ff79c6">:=</span> n.totalScore <span style="color:#ff79c6">/</span> <span style="color:#8be9fd;font-style:italic">float64</span>(n.visitCount)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	exploration <span style="color:#ff79c6">:=</span> math.<span style="color:#50fa7b">Sqrt</span>(<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">*</span> math.<span style="color:#50fa7b">Sqrt</span>(
</span></span><span style="display:flex;"><span>		math.<span style="color:#50fa7b">Log</span>(<span style="color:#8be9fd;font-style:italic">float64</span>(n.parent.visitCount))<span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">float64</span>(n.visitCount),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> exploitation <span style="color:#ff79c6">+</span> exploration
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 相手 + 自分の手番で最大2レベル増えます
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">Expand</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> gameover, _ <span style="color:#ff79c6">:=</span> n.board.<span style="color:#50fa7b">IsGameOver</span>(); gameover {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	moves <span style="color:#ff79c6">:=</span> n.board.<span style="color:#50fa7b">GetAllValidMoves</span>()
</span></span><span style="display:flex;"><span>	n.children = <span style="color:#8be9fd;font-style:italic">make</span>([]<span style="color:#ff79c6">*</span>Node, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(moves))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> _, move <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> moves {
</span></span><span style="display:flex;"><span>		childNode <span style="color:#ff79c6">:=</span> <span style="color:#50fa7b">NewNode</span>(n.board.<span style="color:#50fa7b">ApplyMove</span>(move), <span style="color:#ff79c6">&amp;</span>move, n)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> gameover, _ <span style="color:#ff79c6">:=</span> childNode.board.<span style="color:#50fa7b">IsGameOver</span>(); gameover {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">continue</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		n.children = <span style="color:#8be9fd;font-style:italic">append</span>(n.children, childNode)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">const</span> EXPANSION_THRESHOLD = <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (n <span style="color:#ff79c6">*</span>Node) <span style="color:#50fa7b">SimulateAndExpand</span>() <span style="color:#8be9fd">bool</span> {
</span></span><span style="display:flex;"><span>	board <span style="color:#ff79c6">:=</span> n.board
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	randomMove <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">func</span>(b ds.Board) ds.Move {
</span></span><span style="display:flex;"><span>		moves <span style="color:#ff79c6">:=</span> b.<span style="color:#50fa7b">GetAllValidMoves</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> moves[rand.<span style="color:#50fa7b">Intn</span>(<span style="color:#8be9fd;font-style:italic">len</span>(moves))]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	endBoard <span style="color:#ff79c6">:=</span> board.<span style="color:#50fa7b">Play</span>(randomMove)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	_, winPlayer <span style="color:#ff79c6">:=</span> endBoard.<span style="color:#50fa7b">IsGameOver</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// Backpropagation
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> n <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">break</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		n.visitCount <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> winPlayer <span style="color:#ff79c6">!=</span> n.board.<span style="color:#50fa7b">TurnPlayer</span>() {
</span></span><span style="display:flex;"><span>			n.totalScore <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(n.children) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> n.visitCount <span style="color:#ff79c6">&gt;=</span> EXPANSION_THRESHOLD {
</span></span><span style="display:flex;"><span>			n.<span style="color:#50fa7b">Expand</span>()
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		n = n.parent
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> winPlayer <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>200000 ループほどでランダム相手に 99 % 勝てるようになり、全勝も観測された。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>$ cat main.<span style="color:#ff79c6">go</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ds <span style="color:#f1fa8c">&#34;github.com/sambaiz/doubutsu_shogi/doubutsushogi&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;github.com/sambaiz/doubutsu_shogi/mcts&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>	board <span style="color:#ff79c6">:=</span> ds.<span style="color:#50fa7b">NewBoard</span>()
</span></span><span style="display:flex;"><span>	rootNode <span style="color:#ff79c6">:=</span> mcts.<span style="color:#50fa7b">NewNode</span>(board, <span style="color:#ff79c6">nil</span>, <span style="color:#ff79c6">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">1000</span>; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>		winCount <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> j <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; j &lt; <span style="color:#bd93f9">1000</span>; j<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span>			selectedNode <span style="color:#ff79c6">:=</span> rootNode
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">for</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#6272a4">// Player 1 は最もスコアが高いノードを選ぶ
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>				nextNode <span style="color:#ff79c6">:=</span> selectedNode.<span style="color:#50fa7b">SelectBestChild</span>()
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> nextNode <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">break</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				selectedNode = nextNode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				<span style="color:#6272a4">// Player 2 はランダムに選ぶ
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>				nextNode = selectedNode.<span style="color:#50fa7b">SelectRandomChild</span>()
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> nextNode <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">break</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				selectedNode = nextNode
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> selectedNode.<span style="color:#50fa7b">SimulateAndExpand</span>() {
</span></span><span style="display:flex;"><span>				winCount<span style="color:#ff79c6">++</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> i<span style="color:#ff79c6">%</span><span style="color:#bd93f9">100</span> <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span> {
</span></span><span style="display:flex;"><span>			fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;%d: win rate: %.1f%%\n&#34;</span>, i<span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000</span>, <span style="color:#bd93f9">100.0</span><span style="color:#ff79c6">*</span><span style="color:#8be9fd;font-style:italic">float64</span>(winCount)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1000.0</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// fmt.Println(rootNode.PrettyString(&#34;&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ff79c6">go</span> run main.<span style="color:#ff79c6">go</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">0</span>: win rate: <span style="color:#bd93f9">61.1</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">100000</span>: win rate: <span style="color:#bd93f9">98.7</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">200000</span>: win rate: <span style="color:#bd93f9">99.1</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">300000</span>: win rate: <span style="color:#bd93f9">99.5</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">400000</span>: win rate: <span style="color:#bd93f9">99.9</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">500000</span>: win rate: <span style="color:#bd93f9">99.4</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">600000</span>: win rate: <span style="color:#bd93f9">99.9</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">700000</span>: win rate: <span style="color:#bd93f9">99.5</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">800000</span>: win rate: <span style="color:#bd93f9">99.6</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">900000</span>: win rate: <span style="color:#bd93f9">99.8</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1000000</span>: win rate: <span style="color:#bd93f9">100.0</span><span style="color:#ff79c6">%</span>
</span></span></code></pre></div><p>木も更新されている。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>├──(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1</span>) [<span style="color:#bd93f9">0.839369</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">116</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">234</span>]
</span></span><span style="display:flex;"><span>│   ├──(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>) [<span style="color:#bd93f9">0.831078</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">20</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">53</span>]
</span></span><span style="display:flex;"><span>│   │   ├──C <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>) [<span style="color:#bd93f9">1.960251</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">3</span>]
</span></span><span style="display:flex;"><span>│   │   ├──C <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>) [<span style="color:#bd93f9">1.860205</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">3</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">5</span>]
</span></span><span style="display:flex;"><span>│   │   ├──C <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">0</span>) [<span style="color:#bd93f9">1.922211</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">6</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">7</span>]
</span></span><span style="display:flex;"><span>│   │   ├──C <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1</span>) [<span style="color:#bd93f9">1.983738</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">5</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">6</span>]
</span></span><span style="display:flex;"><span>│   │   ├──C <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">2</span>) [<span style="color:#bd93f9">1.626918</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">3</span>]
</span></span><span style="display:flex;"><span>│   │   ├──(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">1</span>) [<span style="color:#bd93f9">1.939301</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">9</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">9</span>]
</span></span><span style="display:flex;"><span>│   │   ├──(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">0</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1</span>) [<span style="color:#bd93f9">1.908952</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">4</span>]
</span></span><span style="display:flex;"><span>│   │   ├──(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">0</span>) [<span style="color:#bd93f9">1.817071</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">4</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">6</span>]
</span></span><span style="display:flex;"><span>│   │   ├──(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1</span>) [<span style="color:#bd93f9">1.626918</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">3</span>]
</span></span><span style="display:flex;"><span>│   │   ├──(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">2</span>) [<span style="color:#bd93f9">1.908952</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">4</span>]
</span></span><span style="display:flex;"><span>│   │   ├──(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">2</span>) [<span style="color:#bd93f9">1.960251</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">3</span>]
</span></span><span style="display:flex;"><span>│   ├──(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>) [<span style="color:#bd93f9">0.954886</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">18</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">41</span>]
</span></span><span style="display:flex;"><span>│   │   ├──C <span style="color:#ff79c6">-</span>&gt; (<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">1</span>) [<span style="color:#bd93f9">1.862639</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">...</span>
</span></span></code></pre></div><h2 id="参考">参考</h2>
<p><a href="https://koseki2580.github.io/study-docs/docs/Search-Algorithm/alternate-move-game/monte-carlo-tree-search">モンテカルロ木探索 | 備忘録</a></p>
<p><a href="https://www.cs.swarthmore.edu/~mitchell/classes/cs63/f20/reading/mcts.html">Monte Carlo Tree Search - About</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>