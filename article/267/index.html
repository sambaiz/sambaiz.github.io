<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="generator" content="Hugo 0.79.1" />

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        font-family: -apple-system, "BlinkMacSystemFont", "Helvetica Neue", "Yu Gothic", YuGothic, Verdana, Meiryo, sans-serif;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 30px;
        height: 30px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.5rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single p>code {
        background-color: #eee;
        color: #333;
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>Bellman–Ford法とDijkstra法で最短経路問題を解く - sambaiz-net</title>
  <meta name="twitter:title" content="Bellman–Ford法とDijkstra法で最短経路問題を解く - sambaiz-net">
  <meta property='og:title' content="Bellman–Ford法とDijkstra法で最短経路問題を解く - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="最短経路問題">
  <meta name="twitter:description" content="最短経路問題">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/article/267/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "Bellman–Ford法とDijkstra法で最短経路問題を解く",
    "datePublished": "2020-04-01T23:55:00JST",
    "dateModified": "2020-04-01T23:55:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "最短経路問題"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="アイコン" />
        <a class="nl" href="https://www.sambaiz.net/">
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://twitter.com/sambaiz">
            <img src="//www.sambaiz.net/image/twitter.png" width="30px" height="30px" alt="twitter">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="//www.sambaiz.net/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://bookmeter.com/users/1060169/books/read">
            <img src="//www.sambaiz.net/image/bookmeter.png" width="30px" height="30px" alt="bookmeter">
          </a>
        </div>
        <div class="sns-item">
          <a href="https://filmarks.com/users/sambaiz" class="filmarks" aria-label="filmarks"></a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.alltrails.com/members/taiki-sakamoto/recordings">
            <img src="//www.sambaiz.net/image/alltrails.png" width="30px" height="30px" alt="alltrails">
          </a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/log/">
            log</a>
          
          <a class="tag" href="/tags/docker/">
            docker</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag" href="/tags/infra/">
            infra</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>Bellman–Ford法とDijkstra法で最短経路問題を解く</h1>
        <time>2020-04-01</time>
        <a class="tag" href="/tags/algorithm/">algorithm</a>
      </div>
      <p>Bellman–Ford法とDijkstra法で最短経路問題を解く。</p>
<h2 id="bellman-ford法">Bellman-Ford法</h2>
<p>始点の距離が0、それ以外の頂点の距離が無限大な初期状態から、
全辺を見て各辺を通るとしたときに現在の距離を下回るなら更新する、というのを繰り返すアルゴリズム。
辺の重みは負でも問題ないが、総和が負の値になる閉路が存在する場合、そこで無限ループしてしまうので決まらない。
その場合を除けば、頂点の数を<code>|V|</code>、辺の数を<code>|E|</code>とすると、繰り返しは<code>|V|-1</code>回で終わり、計算量は<code>O(|V||E|)</code>になる。</p>
<p><img src="https://www.sambaiz.net/images/267-bf.png" alt="Bellman-Ford法"></p>
<h2 id="dijkstra法">Dijkstra法</h2>
<p>同じく始点の距離が0、それ以外の頂点の距離が無限大な初期状態から、
まだ選ばれていない頂点の中から最小の距離のものを1つ選んでその最短距離を確定させ、そこから伸びている辺を見て更新していく、というのを繰り返す。
Bellman-Ford法が全ての頂点から同時に探索するのに対してDijkstra法は始点から着実に進んでいくイメージ。
頂点を選ぶ/取り除くのに<code>O(log|V|)</code>かかる二分ヒープのpriority queueで実装すると計算量は<code>O((|E|+|V|)log|V|)</code>となる。
Bellman-Ford法より高速だが、負の重みがあると選んだ頂点の現在の距離が最短であることが確定しないので適用できない。</p>
<p><img src="https://www.sambaiz.net/images/267-dijk.png" alt="Dijkstra法"></p>
<h2 id="cheapest-flights-within-k-stops---leetcodehttpsleetcodecomproblemscheapest-flights-within-k-stops"><a href="https://leetcode.com/problems/cheapest-flights-within-k-stops/">Cheapest Flights Within K Stops - LeetCode</a></h2>
<p>乗継K回以内のフライトの最安値を返す問題。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">There are n cities connected by m flights. Each flight starts from city u and arrives at v with a price w.

Now given all the cities and flights, together with starting city src and the destination dst, your task is to find the cheapest price from src to dst with up to k stops. If there is no such route, output -1.

Example 1:
Input: 
n = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]
src = 0, dst = 2, k = 1
Output: 200
</code></pre></div><p>まずはBellman-Ford法で解く。繰り返しを最大K+1回で止めることで乗継K回以内という制約をかけている。
実行時間は128ms。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-cpp" data-lang="cpp"><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Solution</span> {
<span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
    <span style="color:#8be9fd">int</span> inf <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1000</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>;
    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">findCheapestPrice</span>(<span style="color:#8be9fd">int</span> n, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;&amp;</span> flights, <span style="color:#8be9fd">int</span> src, <span style="color:#8be9fd">int</span> dst, <span style="color:#8be9fd">int</span> K) {
        vector costs(n, inf);
        costs[src] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
        <span style="color:#8be9fd">int</span> step <span style="color:#ff79c6">=</span> min(K <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>, n <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>);
        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> step; i<span style="color:#ff79c6">++</span>) {
            vector nextCosts <span style="color:#ff79c6">=</span> costs;
            <span style="color:#ff79c6">for</span>(vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">flight</span>: flights) {
                nextCosts[flight[<span style="color:#bd93f9">1</span>]] <span style="color:#ff79c6">=</span> min(nextCosts[flight[<span style="color:#bd93f9">1</span>]], costs[flight[<span style="color:#bd93f9">0</span>]] <span style="color:#ff79c6">+</span> flight[<span style="color:#bd93f9">2</span>]);
            }
            costs <span style="color:#ff79c6">=</span> nextCosts;
        }
        
        <span style="color:#ff79c6">if</span> (costs[dst] <span style="color:#ff79c6">==</span> inf) {
            <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
        }
        <span style="color:#ff79c6">return</span> costs[dst];
    }
};
</code></pre></div><p>次にDijkstra法で解く。価格と共に乗継数を持ち超過したルートは無視することで、最安でなくても乗継数が少ないルートも採用されるようにする。
実行時間は172msとあまり振るわず。</p>
<p><a href="https://leetcode.com/problems/cheapest-flights-within-k-stops/discuss/115541/JavaPython-Priority-Queue-Solution">[Java/Python] Priority Queue Solution - LeetCode Discuss</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-cpp" data-lang="cpp"><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Solution</span> {
<span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
    <span style="color:#8be9fd">int</span> inf <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1000</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>;
    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">findCheapestPrice</span>(<span style="color:#8be9fd">int</span> n, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;&amp;</span> flights, <span style="color:#8be9fd">int</span> src, <span style="color:#8be9fd">int</span> dst, <span style="color:#8be9fd">int</span> K) {
        map<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, map<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;</span> costs;
        <span style="color:#ff79c6">for</span> (vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">flight</span>: flights) {
            costs[flight[<span style="color:#bd93f9">0</span>]][flight[<span style="color:#bd93f9">1</span>]] <span style="color:#ff79c6">=</span> flight[<span style="color:#bd93f9">2</span>]; <span style="color:#6272a4">// [from][to] = cost
</span><span style="color:#6272a4"></span>        }
        
        <span style="color:#ff79c6">auto</span> compare <span style="color:#ff79c6">=</span> [](vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> a, vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> b) { <span style="color:#ff79c6">return</span> a[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">&gt;</span> b[<span style="color:#bd93f9">1</span>]; };
        priority_queue<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span>, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;</span>, <span style="color:#ff79c6">decltype</span>(compare)<span style="color:#ff79c6">&gt;</span> Q(compare);
        Q.push({src, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>}); <span style="color:#6272a4">// city, price, stop 
</span><span style="color:#6272a4"></span>        
        <span style="color:#ff79c6">while</span>(<span style="color:#ff79c6">!</span>Q.empty()) {
            vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> current <span style="color:#ff79c6">=</span> Q.top();
            Q.pop();
            <span style="color:#ff79c6">if</span> (current[<span style="color:#bd93f9">0</span>] <span style="color:#ff79c6">==</span> dst) {
                <span style="color:#ff79c6">return</span> current[<span style="color:#bd93f9">1</span>];
            }
            <span style="color:#ff79c6">if</span> (current[<span style="color:#bd93f9">2</span>] <span style="color:#ff79c6">&gt;</span> K) {
                <span style="color:#ff79c6">continue</span>;
            }
            <span style="color:#ff79c6">for</span> (<span style="color:#ff79c6">auto</span> <span style="color:#8be9fd;font-style:italic">cost</span>: costs[current[<span style="color:#bd93f9">0</span>]]) {
                Q.push({cost.first, current[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">+</span> cost.second, current[<span style="color:#bd93f9">2</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>});
            }
        }
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
    }
};
</code></pre></div><h2 id="参考">参考</h2>
<p><a href="https://nw.tsuda.ac.jp/lec/BellmanFord/">Bellman-Ford法: 負の重みのエッジを含むグラフにおける最短経路</a></p>
<p><a href="http://www.ss.cs.meiji.ac.jp/CCP024.html">ダイクストラ法</a></p>
<p><a href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra&rsquo;s algorithm - Wikipedia</a></p>

    </div>
  </article>
</div>

</div>
</body>

</html>