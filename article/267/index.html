<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NCML2RV');</script>
  

  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="stylesheet" href="/css/destyle.css">
  <style>
    body {
        background-color: #f1f1f1;
        line-height: 1.3;
        
        font-family: "Helvetica Neue", 
            Arial, 
            "Hiragino Kaku Gothic ProN",
            "Hiragino Sans",
            "BIZ UDPGothic",
            Meiryo,
            sans-serif;
    }

    table {
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    table th,table td{
        padding: 0.2rem 1.0rem;
    }

    table tr{
        border-bottom: solid 1px #eee;
    }

    .languages {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #3a9240;
    }

    header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
    }

    header>.title {
        font-size: 1.875rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .sns-item {
        display: inline-block;
        margin: 3px;
    }

    .filmarks {
        display: inline-block;
        width: 30px;
        height: 30px;
        margin-top: 3px;
        background: url(/image/filmarks.svg) no-repeat;
        background-size: 450%;
    }

    header>.tags {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        max-width: 1000px;
        margin: auto;
        padding: 0 20px;
    }

    header>.tags .others {
        font-weight: bold;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .nl {
        display: inline-block;
    }

    .cell {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
    }

    time {
        color: #333;
    }

    .tag {
        color: #3a9240;
        margin: 0 5px;
    }

    .tag:hover {
        text-decoration: underline;
    }

     
    .paging {
        display: inline-block;
        font-size: 1.25rem;
        margin: 10px 10px;
    }

    .paging.next {
        float: right;
    }


     
    .list>.title {
        font-size: 1.75rem;
        margin: 0 0 10px 10px;
    }

     
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(262px, 1fr));
        gap: 20px;
        margin: 0 10px;
    }

    .grid-nl {
        width: 100%;
    }

    .grid-cell {
        height: 11.25rem;
        overflow: hidden;
        box-sizing: content-box;
    }

    .grid-cell>.title {
        font-size: 1.4rem;
        word-wrap: break-word;
    }

     
    .single {
        margin: 0 10px 10px 10px;
        line-height: 1.5;
    }

    @media screen and (min-width: 768px) {
        .single .cell {
            padding: 10px 20px;
        }
    }

    .single-header {
        margin-block-start: 1.875rem;
        margin-block-end: 1.875rem;
        line-height: 1.3;
    }

    .single-header h1 {
        font-size: 2rem;
        font-weight: bold;
    }

    .single h2 {
        font-size: 1.8rem;
        border-bottom: 1px solid #ddd;
        margin-block-start: 1.875rem;
    }

    .single h3 {
        font-size: 1.5rem;
        margin-block-start: 1.5rem;
    }

    .single h4 {
        font-size: 1.2rem;
        margin-block-start: 1rem;
    }

    .single a {
        color: #3a9240;
    }

    .single a:hover {
        text-decoration: underline;
    }

    .single p {
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    code {
        
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    }

    .single p>code, .single li>code {
        padding: 0 0.2rem;
        display: inline-block;
        overflow: auto;
        max-width: 100%;
        vertical-align: bottom;
    }

    .single strong {
        color: #d2691e;
        font-weight: normal;
    }

    .single .highlight {
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.1) inset;
        margin-block-start: 1rem;
        margin-block-end: 1rem;
        font-size: 0.875rem;
    }

    .single .img_container {
        margin-block-start: 0.1rem;
        margin-block-end: 0.1rem;
        text-align: center;
    }

    .single img {
        border: 1px solid #ddd;
    }

    .share-button > img {
        border: none;
    }

    .single .highlight>pre {
        padding: 10px;
        overflow-x: auto;
    }

    .single img {
        max-width: 100%;
    }

    .single blockquote {
        border-left: 5px solid #ddd;
        color: #777;
        padding: 1rem 0 1rem 1rem;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .single blockquote > p {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .single hr {
        color: #bbb;
        margin-block-start: 1.5rem;
        margin-block-end: 1.5rem;
    }

    .single ul {
        list-style-type: disc;
        padding-left: 1.5em;
        margin-block-start: 0.83rem;
        margin-block-end: 0.83rem;
    }

    .share {
        position: relative;
        text-align: right;
        margin-top: 5px;
    }

    .share .cell {
        display: inline-block;
        text-align: center;
        margin-bottom: 5px;
    }

    .share-button {
        display: inline-block;
        margin: 0 5px;
    }

    @media screen and (min-width: 1400px) {
        .share .cell {
            position: absolute;
            bottom: 0;
            margin-left: 5px;
        }

        .share-button {
            display: inline-block;
            margin: 5px 0;
        }
    }
</style>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.sambaiz.net/index.xml">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">

  <meta name="theme-color" content="#41a248">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@sambaiz">
  
  <title>ベルマンフォード法とダイクストラ法とワーシャルフロイド法で最短経路問題を解く - sambaiz-net</title>
  <meta name="twitter:title" content="ベルマンフォード法とダイクストラ法とワーシャルフロイド法で最短経路問題を解く - sambaiz-net">
  <meta property='og:title' content="ベルマンフォード法とダイクストラ法とワーシャルフロイド法で最短経路問題を解く - sambaiz-net">
  <meta property="og:type" content="article">
  
  <meta name="description" content="最短経路問題">
  <meta name="twitter:description" content="最短経路問題">
  
  

  <meta property="og:url" content="https://www.sambaiz.net/article/267/">
  <meta property="og:image" content="https://www.sambaiz.net/images/my_l.jpg">
  <meta name="twitter:image" content="https://www.sambaiz.net/images/my.jpg" />

  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id": "https://www.sambaiz.net/"
    },
    "headline": "ベルマンフォード法とダイクストラ法とワーシャルフロイド法で最短経路問題を解く",
    "datePublished": "2020-04-01T23:55:00JST",
    "dateModified": "2020-04-01T23:55:00JST",
    "author": {
      "@type": "Person",
      "name": "sambaiz",
      "url": "https://www.sambaiz.net/",
      "image": "https://www.sambaiz.net/images/my.jpg"
    },
    "publisher": {
      "@type": "Person",
      "name": "sambaiz-net",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.sambaiz.net/images/my.jpg",
        "height": 60,
        "width": 60
      }
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://www.sambaiz.net/images/my.jpg",
      "height": 138,
      "width": 138
    },
    "description": "最短経路問題"
  }
</script>
</head>

<body>
  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCML2RV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <div class="languages">
      
    </div>

    <header>
      <div class="title">
        <img src="https://www.sambaiz.net/images/my.png" width="60px" height="60px" alt="icon" />
        <a class="nl" href='/'>
          <h1>sambaiz-net</h1>
        </a>
      </div>

      <div class="sns">
        <div class="sns-item">
          <a class="nl" href="https://github.com/sambaiz">
            <img src="/image/github.png" width="30px" height="30px" alt="github">
          </a>
        </div>
        <div class="sns-item">
          <a class="nl" href="https://www.goodreads.com/sambaiz">
            <img src="/image/goodreads.svg" width="30px" height="30px" alt="goodreads">
          </a>
        </div>
        <div class="sns-item">
          <a href="https://filmarks.com/users/sambaiz" class="filmarks" aria-label="filmarks"></a>
        </div>
      </div>
      <div class="tags">
        <div>
          
          <a class="tag" href="/tags/aws/">
            aws</a>
          
          <a class="tag" href="/tags/golang/">
            golang</a>
          
          <a class="tag" href="/tags/machinelearning/">
            machinelearning</a>
          
          <a class="tag" href="/tags/python/">
            python</a>
          
          <a class="tag" href="/tags/kubernetes/">
            kubernetes</a>
          
          <a class="tag" href="/tags/fluentd/">
            fluentd</a>
          
          <a class="tag" href="/tags/gcp/">
            gcp</a>
          
          <a class="tag" href="/tags/tensorflow/">
            tensorflow</a>
          
          <a class="tag" href="/tags/ios/">
            ios</a>
          
          <a class="tag" href="/tags/web/">
            web</a>
          
          <a class="tag others" href="/tags/">...</a>
        </div>
      </div>
    </header>

<div class="container">
  <article class="single">
    <div class="cell">
      <div class="single-header">
        <h1>ベルマンフォード法とダイクストラ法とワーシャルフロイド法で最短経路問題を解く</h1>
        <time>2020-04-01</time>
        <a class="tag" href='/tags/algorithm/'>algorithm</a>
      </div>
      <p>ベルマンフォード法とダイクストラ法ワーシャルフロイド法で最短経路問題を解く。</p>
<h2 id="ベルマンフォード法">ベルマンフォード法</h2>
<p>始点の距離が0、それ以外の頂点の距離が無限大な初期状態から、
全辺を見て各辺を通るとしたときに現在の距離を下回るなら更新する、というのを繰り返すアルゴリズム。
辺の重みは負でも問題ないが、総和が負の値になる閉路が存在する場合、そこで無限ループしてしまうので決まらない。
その場合を除けば、頂点の数を<code>|V|</code>、辺の数を<code>|E|</code>とすると、繰り返しは<code>|V|-1</code>回で終わり、計算量は<code>O(|V||E|)</code>になる。</p>
<p><img src="https://www.sambaiz.net/images/267-bf.png" alt="ベルマンフォード法"></p>
<h2 id="ダイクストラ法">ダイクストラ法</h2>
<p>同じく始点の距離が0、それ以外の頂点の距離が無限大な初期状態から、
まだ選ばれていない頂点の中から最小の距離のものを1つ選んでその最短距離を確定させ、そこから伸びている辺を見て更新していく、というのを繰り返す。
ベルマンフォード法が全ての頂点から同時に探索するのに対してこちらは始点から着実に進んでいくイメージ。
頂点を選ぶ/取り除くのに<code>O(log|V|)</code>かかる二分ヒープのpriority queueで実装すると計算量は<code>O((|E|+|V|)log|V|)</code>となる。
ベルマンフォード法より高速だが、負の重みがあると選んだ頂点の現在の距離が最短であることが確定しないので適用できない。</p>
<p><img src="https://www.sambaiz.net/images/267-dijk.png" alt="ダイクストラ法"></p>
<h2 id="ワーシャルフロイド法">ワーシャルフロイド法</h2>
<p>2点間ではなく全ての頂点間の最短経路を求めるアルゴリズム。
i→j間の最短経路上に頂点kがあると仮定した場合その経路はi→kの最短経路とk→jの最短経路を繋げたものになることを利用し、
ある2点間の最短経路上に各頂点があるとした場合を総当たりする。
計算量は<code>O(|V|^3)</code>とかなり遅いが次のように単純な3重ループで実装できる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>for (int k = 0; k &lt; n; k++)
</span></span><span style="display:flex;"><span>    for (int i = 0; i &lt; n; i++)
</span></span><span style="display:flex;"><span>        for (int j = 0; j &lt; n; j++) 
</span></span><span style="display:flex;"><span>            costs[i][j] = min(cost[i][j], cost[i][k] + cost[k][j]);
</span></span></code></pre></div><h2 id="cheapest-flights-within-k-stops---leetcodehttpsleetcodecomproblemscheapest-flights-within-k-stops"><a href="https://leetcode.com/problems/cheapest-flights-within-k-stops/">Cheapest Flights Within K Stops - LeetCode</a></h2>
<p>乗継K回以内のフライトの最安値を返す問題。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>There are n cities connected by m flights. Each flight starts from city u and arrives at v with a price w.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Now given all the cities and flights, together with starting city src and the destination dst, your task is to find the cheapest price from src to dst with up to k stops. If there is no such route, output -1.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Example 1:
</span></span><span style="display:flex;"><span>Input: 
</span></span><span style="display:flex;"><span>n = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]
</span></span><span style="display:flex;"><span>src = 0, dst = 2, k = 1
</span></span><span style="display:flex;"><span>Output: 200
</span></span></code></pre></div><p>まずはベルマンフォード法で解く。繰り返しを最大K+1回で止めることで乗継K回以内という制約をかけている。
実行時間は128ms。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Solution</span> {
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> inf <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1000</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">findCheapestPrice</span>(<span style="color:#8be9fd">int</span> n, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;&amp;</span> flights, <span style="color:#8be9fd">int</span> src, <span style="color:#8be9fd">int</span> dst, <span style="color:#8be9fd">int</span> K) {
</span></span><span style="display:flex;"><span>        vector costs(n, inf);
</span></span><span style="display:flex;"><span>        costs[src] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">int</span> step <span style="color:#ff79c6">=</span> min(K <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>, n <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> step; i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>            vector nextCosts <span style="color:#ff79c6">=</span> costs;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span>(vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">flight</span>: flights) {
</span></span><span style="display:flex;"><span>                nextCosts[flight[<span style="color:#bd93f9">1</span>]] <span style="color:#ff79c6">=</span> min(nextCosts[flight[<span style="color:#bd93f9">1</span>]], costs[flight[<span style="color:#bd93f9">0</span>]] <span style="color:#ff79c6">+</span> flight[<span style="color:#bd93f9">2</span>]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            costs <span style="color:#ff79c6">=</span> nextCosts;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (costs[dst] <span style="color:#ff79c6">==</span> inf) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> costs[dst];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>次にダイクストラ法で解く。価格と共に乗継数を持ち超過したルートは無視することで、最安でなくても乗継数が少ないルートも採用されるようにする。
実行時間は172msとあまり振るわず。</p>
<p><a href="https://leetcode.com/problems/cheapest-flights-within-k-stops/discuss/115541/JavaPython-Priority-Queue-Solution">[Java/Python] Priority Queue Solution - LeetCode Discuss</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Solution</span> {
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> inf <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1000</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">findCheapestPrice</span>(<span style="color:#8be9fd">int</span> n, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;&amp;</span> flights, <span style="color:#8be9fd">int</span> src, <span style="color:#8be9fd">int</span> dst, <span style="color:#8be9fd">int</span> K) {
</span></span><span style="display:flex;"><span>        map<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, map<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;</span> costs;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">flight</span>: flights) {
</span></span><span style="display:flex;"><span>            costs[flight[<span style="color:#bd93f9">0</span>]][flight[<span style="color:#bd93f9">1</span>]] <span style="color:#ff79c6">=</span> flight[<span style="color:#bd93f9">2</span>]; <span style="color:#6272a4">// [from][to] = cost
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">auto</span> compare <span style="color:#ff79c6">=</span> [](vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> a, vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> b) { <span style="color:#ff79c6">return</span> a[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">&gt;</span> b[<span style="color:#bd93f9">1</span>]; };
</span></span><span style="display:flex;"><span>        priority_queue<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span>, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;</span>, <span style="color:#ff79c6">decltype</span>(compare)<span style="color:#ff79c6">&gt;</span> Q(compare);
</span></span><span style="display:flex;"><span>        Q.push({src, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>}); <span style="color:#6272a4">// city, price, stop 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">while</span>(<span style="color:#ff79c6">!</span>Q.empty()) {
</span></span><span style="display:flex;"><span>            vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;</span> current <span style="color:#ff79c6">=</span> Q.top();
</span></span><span style="display:flex;"><span>            Q.pop();
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (current[<span style="color:#bd93f9">0</span>] <span style="color:#ff79c6">==</span> dst) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> current[<span style="color:#bd93f9">1</span>];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (current[<span style="color:#bd93f9">2</span>] <span style="color:#ff79c6">&gt;</span> K) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (<span style="color:#ff79c6">auto</span> <span style="color:#8be9fd;font-style:italic">cost</span>: costs[current[<span style="color:#bd93f9">0</span>]]) {
</span></span><span style="display:flex;"><span>                Q.push({cost.first, current[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">+</span> cost.second, current[<span style="color:#bd93f9">2</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>});
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>最後にワーシャルフロイド法で解いたがTLEになってしまった。
i→j間を<code>step</code>回以内の乗継で移動する最小コストを、<code>m</code>回以内の乗継でi→l区間を移動する最小コストと<code>step-m</code>回以内の乗継でl→j区間を移動する最小コストを足して求めている。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Solution</span> {
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> findCheapestPrice(<span style="color:#8be9fd">int</span> n, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">&gt;&gt;&amp;</span> flights, <span style="color:#8be9fd">int</span> src, <span style="color:#8be9fd">int</span> dst, <span style="color:#8be9fd">int</span> k) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// costs[from][to][step] = min_cost
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">long</span><span style="color:#ff79c6">&gt;&gt;&gt;</span> costs(n, vector<span style="color:#ff79c6">&lt;</span>vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">long</span><span style="color:#ff79c6">&gt;&gt;</span>(n, vector<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">long</span><span style="color:#ff79c6">&gt;</span>(k<span style="color:#ff79c6">+</span><span style="color:#bd93f9">2</span>, INT_MAX)));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> flights.size(); i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>            costs[flights[i][<span style="color:#bd93f9">0</span>]][flights[i][<span style="color:#bd93f9">1</span>]][<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">=</span> flights[i][<span style="color:#bd93f9">2</span>];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> step <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>; step <span style="color:#ff79c6">&lt;=</span> k<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>; step<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> l <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; l <span style="color:#ff79c6">&lt;</span> n; l<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> n; i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> j <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; j <span style="color:#ff79c6">&lt;</span> n; j<span style="color:#ff79c6">++</span>) { 
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> m <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>; m <span style="color:#ff79c6">&lt;</span> step; m<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>                            <span style="color:#6272a4">// i --(m steps)--&gt; l --(step-m steps)--&gt; j
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                            costs[i][j][step] <span style="color:#ff79c6">=</span> min(costs[i][j][step], min(costs[i][j][step<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>], costs[i][l][m] <span style="color:#ff79c6">+</span> costs[l][j][step<span style="color:#ff79c6">-</span>m]));
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (costs[src][dst][k<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">==</span> INT_MAX) <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> costs[src][dst][k<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="参考">参考</h2>
<p><a href="https://nw.tsuda.ac.jp/lec/BellmanFord/">Bellman-Ford法: 負の重みのエッジを含むグラフにおける最短経路</a></p>
<p><a href="http://www.ss.cs.meiji.ac.jp/CCP024.html">ダイクストラ法</a></p>
<p><a href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra&rsquo;s algorithm - Wikipedia</a></p>

    </div>
    <div class="share">
      <div class="cell">
        <div>share</div>
        <div>
          <a class="share-button" href='https://twitter.com/intent/tweet?url=https://www.sambaiz.net/article/267/&text=%e3%83%99%e3%83%ab%e3%83%9e%e3%83%b3%e3%83%95%e3%82%a9%e3%83%bc%e3%83%89%e6%b3%95%e3%81%a8%e3%83%80%e3%82%a4%e3%82%af%e3%82%b9%e3%83%88%e3%83%a9%e6%b3%95%e3%81%a8%e3%83%af%e3%83%bc%e3%82%b7%e3%83%a3%e3%83%ab%e3%83%95%e3%83%ad%e3%82%a4%e3%83%89%e6%b3%95%e3%81%a7%e6%9c%80%e7%9f%ad%e7%b5%8c%e8%b7%af%e5%95%8f%e9%a1%8c%e3%82%92%e8%a7%a3%e3%81%8f%20-%20sambaiz-net'>
            <img src="/image/twitter.png" width="40px" height="40px" alt="twitter">
          </a>
          <a href="https://b.hatena.ne.jp/entry/" class="share-button hatena-bookmark-button" data-hatena-bookmark-layout="touch" data-hatena-bookmark-width="40" data-hatena-bookmark-height="40" title="このエントリーをはてなブックマークに追加">
            <img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="40" height="40" style="border: none;" />
          </a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        </div>
      </div>
    </div>
  </article>
</div>

</div>
</body>

</html>